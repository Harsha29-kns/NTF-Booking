var dW=Object.defineProperty;var uW=(e,g,t)=>g in e?dW(e,g,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[g]=t;var R=(e,g,t)=>(uW(e,typeof g!="symbol"?g+"":g,t),t),KA=(e,g,t)=>{if(!g.has(e))throw TypeError("Cannot "+t)};var d=(e,g,t)=>(KA(e,g,"read from private field"),t?t.call(e):g.get(e)),k=(e,g,t)=>{if(g.has(e))throw TypeError("Cannot add the same private member more than once");g instanceof WeakSet?g.add(e):g.set(e,t)},p=(e,g,t,I)=>(KA(e,g,"write to private field"),I?I.call(e,t):g.set(e,t),t);var Xr=(e,g,t,I)=>({set _(n){p(e,g,n,t)},get _(){return d(e,g,I)}}),E=(e,g,t)=>(KA(e,g,"access private method"),t);function mW(e,g){for(var t=0;t<g.length;t++){const I=g[t];if(typeof I!="string"&&!Array.isArray(I)){for(const n in I)if(n!=="default"&&!(n in e)){const l=Object.getOwnPropertyDescriptor(I,n);l&&Object.defineProperty(e,n,l.get?l:{enumerable:!0,get:()=>I[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))I(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const C of l.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&I(C)}).observe(document,{childList:!0,subtree:!0});function t(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function I(n){if(n.ep)return;n.ep=!0;const l=t(n);fetch(n.href,l)}})();function hW(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ny={exports:{}},Kc={},Hy={exports:{}},sg={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Aa=Symbol.for("react.element"),bW=Symbol.for("react.portal"),ZW=Symbol.for("react.fragment"),yW=Symbol.for("react.strict_mode"),GW=Symbol.for("react.profiler"),pW=Symbol.for("react.provider"),BW=Symbol.for("react.context"),fW=Symbol.for("react.forward_ref"),VW=Symbol.for("react.suspense"),WW=Symbol.for("react.memo"),SW=Symbol.for("react.lazy"),y0=Symbol.iterator;function RW(e){return e===null||typeof e!="object"?null:(e=y0&&e[y0]||e["@@iterator"],typeof e=="function"?e:null)}var Fy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xy=Object.assign,Ky={};function yr(e,g,t){this.props=e,this.context=g,this.refs=Ky,this.updater=t||Fy}yr.prototype.isReactComponent={};yr.prototype.setState=function(e,g){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,g,"setState")};yr.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Ey(){}Ey.prototype=yr.prototype;function Sm(e,g,t){this.props=e,this.context=g,this.refs=Ky,this.updater=t||Fy}var Rm=Sm.prototype=new Ey;Rm.constructor=Sm;xy(Rm,yr.prototype);Rm.isPureReactComponent=!0;var G0=Array.isArray,Uy=Object.prototype.hasOwnProperty,km={current:null},zy={key:!0,ref:!0,__self:!0,__source:!0};function Qy(e,g,t){var I,n={},l=null,C=null;if(g!=null)for(I in g.ref!==void 0&&(C=g.ref),g.key!==void 0&&(l=""+g.key),g)Uy.call(g,I)&&!zy.hasOwnProperty(I)&&(n[I]=g[I]);var s=arguments.length-2;if(s===1)n.children=t;else if(1<s){for(var r=Array(s),a=0;a<s;a++)r[a]=arguments[a+2];n.children=r}if(e&&e.defaultProps)for(I in s=e.defaultProps,s)n[I]===void 0&&(n[I]=s[I]);return{$$typeof:Aa,type:e,key:l,ref:C,props:n,_owner:km.current}}function kW(e,g){return{$$typeof:Aa,type:e.type,key:g,ref:e.ref,props:e.props,_owner:e._owner}}function Xm(e){return typeof e=="object"&&e!==null&&e.$$typeof===Aa}function XW(e){var g={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(t){return g[t]})}var p0=/\/+/g;function EA(e,g){return typeof e=="object"&&e!==null&&e.key!=null?XW(""+e.key):g.toString(36)}function ro(e,g,t,I,n){var l=typeof e;(l==="undefined"||l==="boolean")&&(e=null);var C=!1;if(e===null)C=!0;else switch(l){case"string":case"number":C=!0;break;case"object":switch(e.$$typeof){case Aa:case bW:C=!0}}if(C)return C=e,n=n(C),e=I===""?"."+EA(C,0):I,G0(n)?(t="",e!=null&&(t=e.replace(p0,"$&/")+"/"),ro(n,g,t,"",function(a){return a})):n!=null&&(Xm(n)&&(n=kW(n,t+(!n.key||C&&C.key===n.key?"":(""+n.key).replace(p0,"$&/")+"/")+e)),g.push(n)),1;if(C=0,I=I===""?".":I+":",G0(e))for(var s=0;s<e.length;s++){l=e[s];var r=I+EA(l,s);C+=ro(l,g,t,r,n)}else if(r=RW(e),typeof r=="function")for(e=r.call(e),s=0;!(l=e.next()).done;)l=l.value,r=I+EA(l,s++),C+=ro(l,g,t,r,n);else if(l==="object")throw g=String(e),Error("Objects are not valid as a React child (found: "+(g==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":g)+"). If you meant to render a collection of children, use an array instead.");return C}function ka(e,g,t){if(e==null)return e;var I=[],n=0;return ro(e,I,"","",function(l){return g.call(t,l,n++)}),I}function JW(e){if(e._status===-1){var g=e._result;g=g(),g.then(function(t){(e._status===0||e._status===-1)&&(e._status=1,e._result=t)},function(t){(e._status===0||e._status===-1)&&(e._status=2,e._result=t)}),e._status===-1&&(e._status=0,e._result=g)}if(e._status===1)return e._result.default;throw e._result}var We={current:null},io={transition:null},wW={ReactCurrentDispatcher:We,ReactCurrentBatchConfig:io,ReactCurrentOwner:km};function Ly(){throw Error("act(...) is not supported in production builds of React.")}sg.Children={map:ka,forEach:function(e,g,t){ka(e,function(){g.apply(this,arguments)},t)},count:function(e){var g=0;return ka(e,function(){g++}),g},toArray:function(e){return ka(e,function(g){return g})||[]},only:function(e){if(!Xm(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};sg.Component=yr;sg.Fragment=ZW;sg.Profiler=GW;sg.PureComponent=Sm;sg.StrictMode=yW;sg.Suspense=VW;sg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wW;sg.act=Ly;sg.cloneElement=function(e,g,t){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var I=xy({},e.props),n=e.key,l=e.ref,C=e._owner;if(g!=null){if(g.ref!==void 0&&(l=g.ref,C=km.current),g.key!==void 0&&(n=""+g.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(r in g)Uy.call(g,r)&&!zy.hasOwnProperty(r)&&(I[r]=g[r]===void 0&&s!==void 0?s[r]:g[r])}var r=arguments.length-2;if(r===1)I.children=t;else if(1<r){s=Array(r);for(var a=0;a<r;a++)s[a]=arguments[a+2];I.children=s}return{$$typeof:Aa,type:e.type,key:n,ref:l,props:I,_owner:C}};sg.createContext=function(e){return e={$$typeof:BW,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:pW,_context:e},e.Consumer=e};sg.createElement=Qy;sg.createFactory=function(e){var g=Qy.bind(null,e);return g.type=e,g};sg.createRef=function(){return{current:null}};sg.forwardRef=function(e){return{$$typeof:fW,render:e}};sg.isValidElement=Xm;sg.lazy=function(e){return{$$typeof:SW,_payload:{_status:-1,_result:e},_init:JW}};sg.memo=function(e,g){return{$$typeof:WW,type:e,compare:g===void 0?null:g}};sg.startTransition=function(e){var g=io.transition;io.transition={};try{e()}finally{io.transition=g}};sg.unstable_act=Ly;sg.useCallback=function(e,g){return We.current.useCallback(e,g)};sg.useContext=function(e){return We.current.useContext(e)};sg.useDebugValue=function(){};sg.useDeferredValue=function(e){return We.current.useDeferredValue(e)};sg.useEffect=function(e,g){return We.current.useEffect(e,g)};sg.useId=function(){return We.current.useId()};sg.useImperativeHandle=function(e,g,t){return We.current.useImperativeHandle(e,g,t)};sg.useInsertionEffect=function(e,g){return We.current.useInsertionEffect(e,g)};sg.useLayoutEffect=function(e,g){return We.current.useLayoutEffect(e,g)};sg.useMemo=function(e,g){return We.current.useMemo(e,g)};sg.useReducer=function(e,g,t){return We.current.useReducer(e,g,t)};sg.useRef=function(e){return We.current.useRef(e)};sg.useState=function(e){return We.current.useState(e)};sg.useSyncExternalStore=function(e,g,t){return We.current.useSyncExternalStore(e,g,t)};sg.useTransition=function(){return We.current.useTransition()};sg.version="18.3.1";Hy.exports=sg;var B=Hy.exports;const Ty=hW(B),YW=mW({__proto__:null,default:Ty},[B]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vW=B,NW=Symbol.for("react.element"),HW=Symbol.for("react.fragment"),FW=Object.prototype.hasOwnProperty,xW=vW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,KW={key:!0,ref:!0,__self:!0,__source:!0};function My(e,g,t){var I,n={},l=null,C=null;t!==void 0&&(l=""+t),g.key!==void 0&&(l=""+g.key),g.ref!==void 0&&(C=g.ref);for(I in g)FW.call(g,I)&&!KW.hasOwnProperty(I)&&(n[I]=g[I]);if(e&&e.defaultProps)for(I in g=e.defaultProps,g)n[I]===void 0&&(n[I]=g[I]);return{$$typeof:NW,type:e,key:l,ref:C,props:n,_owner:xW.current}}Kc.Fragment=HW;Kc.jsx=My;Kc.jsxs=My;Ny.exports=Kc;var i=Ny.exports,Nd={},Dy={exports:{}},tt={},jy={exports:{}},Py={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function g(x,L){var v=x.length;x.push(L);g:for(;0<v;){var z=v-1>>>1,M=x[z];if(0<n(M,L))x[z]=L,x[v]=M,v=z;else break g}}function t(x){return x.length===0?null:x[0]}function I(x){if(x.length===0)return null;var L=x[0],v=x.pop();if(v!==L){x[0]=v;g:for(var z=0,M=x.length,hg=M>>>1;z<hg;){var wg=2*(z+1)-1,Ue=x[wg],ze=wg+1,Qe=x[ze];if(0>n(Ue,v))ze<M&&0>n(Qe,Ue)?(x[z]=Qe,x[ze]=v,z=ze):(x[z]=Ue,x[wg]=v,z=wg);else if(ze<M&&0>n(Qe,v))x[z]=Qe,x[ze]=v,z=ze;else break g}}return L}function n(x,L){var v=x.sortIndex-L.sortIndex;return v!==0?v:x.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var C=Date,s=C.now();e.unstable_now=function(){return C.now()-s}}var r=[],a=[],o=1,c=null,A=3,b=!1,m=!1,Z=!1,G=typeof setTimeout=="function"?setTimeout:null,h=typeof clearTimeout=="function"?clearTimeout:null,u=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(x){for(var L=t(a);L!==null;){if(L.callback===null)I(a);else if(L.startTime<=x)I(a),L.sortIndex=L.expirationTime,g(r,L);else break;L=t(a)}}function W(x){if(Z=!1,y(x),!m)if(t(r)!==null)m=!0,T(S);else{var L=t(a);L!==null&&gg(W,L.startTime-x)}}function S(x,L){m=!1,Z&&(Z=!1,h(X),X=-1),b=!0;var v=A;try{for(y(L),c=t(r);c!==null&&(!(c.expirationTime>L)||x&&!N());){var z=c.callback;if(typeof z=="function"){c.callback=null,A=c.priorityLevel;var M=z(c.expirationTime<=L);L=e.unstable_now(),typeof M=="function"?c.callback=M:c===t(r)&&I(r),y(L)}else I(r);c=t(r)}if(c!==null)var hg=!0;else{var wg=t(a);wg!==null&&gg(W,wg.startTime-L),hg=!1}return hg}finally{c=null,A=v,b=!1}}var J=!1,f=null,X=-1,U=5,Y=-1;function N(){return!(e.unstable_now()-Y<U)}function j(){if(f!==null){var x=e.unstable_now();Y=x;var L=!0;try{L=f(!0,x)}finally{L?_():(J=!1,f=null)}}else J=!1}var _;if(typeof u=="function")_=function(){u(j)};else if(typeof MessageChannel<"u"){var tg=new MessageChannel,F=tg.port2;tg.port1.onmessage=j,_=function(){F.postMessage(null)}}else _=function(){G(j,0)};function T(x){f=x,J||(J=!0,_())}function gg(x,L){X=G(function(){x(e.unstable_now())},L)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(x){x.callback=null},e.unstable_continueExecution=function(){m||b||(m=!0,T(S))},e.unstable_forceFrameRate=function(x){0>x||125<x?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<x?Math.floor(1e3/x):5},e.unstable_getCurrentPriorityLevel=function(){return A},e.unstable_getFirstCallbackNode=function(){return t(r)},e.unstable_next=function(x){switch(A){case 1:case 2:case 3:var L=3;break;default:L=A}var v=A;A=L;try{return x()}finally{A=v}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(x,L){switch(x){case 1:case 2:case 3:case 4:case 5:break;default:x=3}var v=A;A=x;try{return L()}finally{A=v}},e.unstable_scheduleCallback=function(x,L,v){var z=e.unstable_now();switch(typeof v=="object"&&v!==null?(v=v.delay,v=typeof v=="number"&&0<v?z+v:z):v=z,x){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=v+M,x={id:o++,callback:L,priorityLevel:x,startTime:v,expirationTime:M,sortIndex:-1},v>z?(x.sortIndex=v,g(a,x),t(r)===null&&x===t(a)&&(Z?(h(X),X=-1):Z=!0,gg(W,v-z))):(x.sortIndex=M,g(r,x),m||b||(m=!0,T(S))),x},e.unstable_shouldYield=N,e.unstable_wrapCallback=function(x){var L=A;return function(){var v=A;A=L;try{return x.apply(this,arguments)}finally{A=v}}}})(Py);jy.exports=Py;var EW=jy.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UW=B,et=EW;function Q(e){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+e,t=1;t<arguments.length;t++)g+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+e+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Oy=new Set,ii={};function GC(e,g){Ir(e,g),Ir(e+"Capture",g)}function Ir(e,g){for(ii[e]=g,e=0;e<g.length;e++)Oy.add(g[e])}var qI=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Hd=Object.prototype.hasOwnProperty,zW=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,B0={},f0={};function QW(e){return Hd.call(f0,e)?!0:Hd.call(B0,e)?!1:zW.test(e)?f0[e]=!0:(B0[e]=!0,!1)}function LW(e,g,t,I){if(t!==null&&t.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return I?!1:t!==null?!t.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function TW(e,g,t,I){if(g===null||typeof g>"u"||LW(e,g,t,I))return!0;if(I)return!1;if(t!==null)switch(t.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function Se(e,g,t,I,n,l,C){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=I,this.attributeNamespace=n,this.mustUseProperty=t,this.propertyName=e,this.type=g,this.sanitizeURL=l,this.removeEmptyString=C}var le={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){le[e]=new Se(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var g=e[0];le[g]=new Se(g,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){le[e]=new Se(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){le[e]=new Se(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){le[e]=new Se(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){le[e]=new Se(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){le[e]=new Se(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){le[e]=new Se(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){le[e]=new Se(e,5,!1,e.toLowerCase(),null,!1,!1)});var Jm=/[\-:]([a-z])/g;function wm(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var g=e.replace(Jm,wm);le[g]=new Se(g,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var g=e.replace(Jm,wm);le[g]=new Se(g,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var g=e.replace(Jm,wm);le[g]=new Se(g,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){le[e]=new Se(e,1,!1,e.toLowerCase(),null,!1,!1)});le.xlinkHref=new Se("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){le[e]=new Se(e,1,!1,e.toLowerCase(),null,!0,!0)});function Ym(e,g,t,I){var n=le.hasOwnProperty(g)?le[g]:null;(n!==null?n.type!==0:I||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(TW(g,t,n,I)&&(t=null),I||n===null?QW(g)&&(t===null?e.removeAttribute(g):e.setAttribute(g,""+t)):n.mustUseProperty?e[n.propertyName]=t===null?n.type===3?!1:"":t:(g=n.attributeName,I=n.attributeNamespace,t===null?e.removeAttribute(g):(n=n.type,t=n===3||n===4&&t===!0?"":""+t,I?e.setAttributeNS(I,g,t):e.setAttribute(g,t))))}var ln=UW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Xa=Symbol.for("react.element"),FC=Symbol.for("react.portal"),xC=Symbol.for("react.fragment"),vm=Symbol.for("react.strict_mode"),Fd=Symbol.for("react.profiler"),qy=Symbol.for("react.provider"),_y=Symbol.for("react.context"),Nm=Symbol.for("react.forward_ref"),xd=Symbol.for("react.suspense"),Kd=Symbol.for("react.suspense_list"),Hm=Symbol.for("react.memo"),mn=Symbol.for("react.lazy"),$y=Symbol.for("react.offscreen"),V0=Symbol.iterator;function Jr(e){return e===null||typeof e!="object"?null:(e=V0&&e[V0]||e["@@iterator"],typeof e=="function"?e:null)}var Xg=Object.assign,UA;function Qr(e){if(UA===void 0)try{throw Error()}catch(t){var g=t.stack.trim().match(/\n( *(at )?)/);UA=g&&g[1]||""}return`
`+UA+e}var zA=!1;function QA(e,g){if(!e||zA)return"";zA=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(a){var I=a}Reflect.construct(e,[],g)}else{try{g.call()}catch(a){I=a}e.call(g.prototype)}else{try{throw Error()}catch(a){I=a}e()}}catch(a){if(a&&I&&typeof a.stack=="string"){for(var n=a.stack.split(`
`),l=I.stack.split(`
`),C=n.length-1,s=l.length-1;1<=C&&0<=s&&n[C]!==l[s];)s--;for(;1<=C&&0<=s;C--,s--)if(n[C]!==l[s]){if(C!==1||s!==1)do if(C--,s--,0>s||n[C]!==l[s]){var r=`
`+n[C].replace(" at new "," at ");return e.displayName&&r.includes("<anonymous>")&&(r=r.replace("<anonymous>",e.displayName)),r}while(1<=C&&0<=s);break}}}finally{zA=!1,Error.prepareStackTrace=t}return(e=e?e.displayName||e.name:"")?Qr(e):""}function MW(e){switch(e.tag){case 5:return Qr(e.type);case 16:return Qr("Lazy");case 13:return Qr("Suspense");case 19:return Qr("SuspenseList");case 0:case 2:case 15:return e=QA(e.type,!1),e;case 11:return e=QA(e.type.render,!1),e;case 1:return e=QA(e.type,!0),e;default:return""}}function Ed(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case xC:return"Fragment";case FC:return"Portal";case Fd:return"Profiler";case vm:return"StrictMode";case xd:return"Suspense";case Kd:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case _y:return(e.displayName||"Context")+".Consumer";case qy:return(e._context.displayName||"Context")+".Provider";case Nm:var g=e.render;return e=e.displayName,e||(e=g.displayName||g.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Hm:return g=e.displayName||null,g!==null?g:Ed(e.type)||"Memo";case mn:g=e._payload,e=e._init;try{return Ed(e(g))}catch{}}return null}function DW(e){var g=e.type;switch(e.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=g.render,e=e.displayName||e.name||"",g.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ed(g);case 8:return g===vm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function el(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function gG(e){var g=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function jW(e){var g=gG(e)?"checked":"value",t=Object.getOwnPropertyDescriptor(e.constructor.prototype,g),I=""+e[g];if(!e.hasOwnProperty(g)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var n=t.get,l=t.set;return Object.defineProperty(e,g,{configurable:!0,get:function(){return n.call(this)},set:function(C){I=""+C,l.call(this,C)}}),Object.defineProperty(e,g,{enumerable:t.enumerable}),{getValue:function(){return I},setValue:function(C){I=""+C},stopTracking:function(){e._valueTracker=null,delete e[g]}}}}function Ja(e){e._valueTracker||(e._valueTracker=jW(e))}function eG(e){if(!e)return!1;var g=e._valueTracker;if(!g)return!0;var t=g.getValue(),I="";return e&&(I=gG(e)?e.checked?"true":"false":e.value),e=I,e!==t?(g.setValue(e),!0):!1}function Eo(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ud(e,g){var t=g.checked;return Xg({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??e._wrapperState.initialChecked})}function W0(e,g){var t=g.defaultValue==null?"":g.defaultValue,I=g.checked!=null?g.checked:g.defaultChecked;t=el(g.value!=null?g.value:t),e._wrapperState={initialChecked:I,initialValue:t,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function tG(e,g){g=g.checked,g!=null&&Ym(e,"checked",g,!1)}function zd(e,g){tG(e,g);var t=el(g.value),I=g.type;if(t!=null)I==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+t):e.value!==""+t&&(e.value=""+t);else if(I==="submit"||I==="reset"){e.removeAttribute("value");return}g.hasOwnProperty("value")?Qd(e,g.type,t):g.hasOwnProperty("defaultValue")&&Qd(e,g.type,el(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(e.defaultChecked=!!g.defaultChecked)}function S0(e,g,t){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var I=g.type;if(!(I!=="submit"&&I!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+e._wrapperState.initialValue,t||g===e.value||(e.value=g),e.defaultValue=g}t=e.name,t!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,t!==""&&(e.name=t)}function Qd(e,g,t){(g!=="number"||Eo(e.ownerDocument)!==e)&&(t==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+t&&(e.defaultValue=""+t))}var Lr=Array.isArray;function es(e,g,t,I){if(e=e.options,g){g={};for(var n=0;n<t.length;n++)g["$"+t[n]]=!0;for(t=0;t<e.length;t++)n=g.hasOwnProperty("$"+e[t].value),e[t].selected!==n&&(e[t].selected=n),n&&I&&(e[t].defaultSelected=!0)}else{for(t=""+el(t),g=null,n=0;n<e.length;n++){if(e[n].value===t){e[n].selected=!0,I&&(e[n].defaultSelected=!0);return}g!==null||e[n].disabled||(g=e[n])}g!==null&&(g.selected=!0)}}function Ld(e,g){if(g.dangerouslySetInnerHTML!=null)throw Error(Q(91));return Xg({},g,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function R0(e,g){var t=g.value;if(t==null){if(t=g.children,g=g.defaultValue,t!=null){if(g!=null)throw Error(Q(92));if(Lr(t)){if(1<t.length)throw Error(Q(93));t=t[0]}g=t}g==null&&(g=""),t=g}e._wrapperState={initialValue:el(t)}}function IG(e,g){var t=el(g.value),I=el(g.defaultValue);t!=null&&(t=""+t,t!==e.value&&(e.value=t),g.defaultValue==null&&e.defaultValue!==t&&(e.defaultValue=t)),I!=null&&(e.defaultValue=""+I)}function k0(e){var g=e.textContent;g===e._wrapperState.initialValue&&g!==""&&g!==null&&(e.value=g)}function nG(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Td(e,g){return e==null||e==="http://www.w3.org/1999/xhtml"?nG(g):e==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var wa,lG=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,t,I,n){MSApp.execUnsafeLocalFunction(function(){return e(g,t,I,n)})}:e}(function(e,g){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=g;else{for(wa=wa||document.createElement("div"),wa.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=wa.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;g.firstChild;)e.appendChild(g.firstChild)}});function ai(e,g){if(g){var t=e.firstChild;if(t&&t===e.lastChild&&t.nodeType===3){t.nodeValue=g;return}}e.textContent=g}var _r={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},PW=["Webkit","ms","Moz","O"];Object.keys(_r).forEach(function(e){PW.forEach(function(g){g=g+e.charAt(0).toUpperCase()+e.substring(1),_r[g]=_r[e]})});function CG(e,g,t){return g==null||typeof g=="boolean"||g===""?"":t||typeof g!="number"||g===0||_r.hasOwnProperty(e)&&_r[e]?(""+g).trim():g+"px"}function sG(e,g){e=e.style;for(var t in g)if(g.hasOwnProperty(t)){var I=t.indexOf("--")===0,n=CG(t,g[t],I);t==="float"&&(t="cssFloat"),I?e.setProperty(t,n):e[t]=n}}var OW=Xg({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Md(e,g){if(g){if(OW[e]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(Q(137,e));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(Q(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(Q(61))}if(g.style!=null&&typeof g.style!="object")throw Error(Q(62))}}function Dd(e,g){if(e.indexOf("-")===-1)return typeof g.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jd=null;function Fm(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Pd=null,ts=null,Is=null;function X0(e){if(e=ma(e)){if(typeof Pd!="function")throw Error(Q(280));var g=e.stateNode;g&&(g=Lc(g),Pd(e.stateNode,e.type,g))}}function rG(e){ts?Is?Is.push(e):Is=[e]:ts=e}function iG(){if(ts){var e=ts,g=Is;if(Is=ts=null,X0(e),g)for(e=0;e<g.length;e++)X0(g[e])}}function aG(e,g){return e(g)}function oG(){}var LA=!1;function cG(e,g,t){if(LA)return e(g,t);LA=!0;try{return aG(e,g,t)}finally{LA=!1,(ts!==null||Is!==null)&&(oG(),iG())}}function oi(e,g){var t=e.stateNode;if(t===null)return null;var I=Lc(t);if(I===null)return null;t=I[g];g:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(e=e.type,I=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!I;break g;default:e=!1}if(e)return null;if(t&&typeof t!="function")throw Error(Q(231,g,typeof t));return t}var Od=!1;if(qI)try{var wr={};Object.defineProperty(wr,"passive",{get:function(){Od=!0}}),window.addEventListener("test",wr,wr),window.removeEventListener("test",wr,wr)}catch{Od=!1}function qW(e,g,t,I,n,l,C,s,r){var a=Array.prototype.slice.call(arguments,3);try{g.apply(t,a)}catch(o){this.onError(o)}}var $r=!1,Uo=null,zo=!1,qd=null,_W={onError:function(e){$r=!0,Uo=e}};function $W(e,g,t,I,n,l,C,s,r){$r=!1,Uo=null,qW.apply(_W,arguments)}function gS(e,g,t,I,n,l,C,s,r){if($W.apply(this,arguments),$r){if($r){var a=Uo;$r=!1,Uo=null}else throw Error(Q(198));zo||(zo=!0,qd=a)}}function pC(e){var g=e,t=e;if(e.alternate)for(;g.return;)g=g.return;else{e=g;do g=e,g.flags&4098&&(t=g.return),e=g.return;while(e)}return g.tag===3?t:null}function AG(e){if(e.tag===13){var g=e.memoizedState;if(g===null&&(e=e.alternate,e!==null&&(g=e.memoizedState)),g!==null)return g.dehydrated}return null}function J0(e){if(pC(e)!==e)throw Error(Q(188))}function eS(e){var g=e.alternate;if(!g){if(g=pC(e),g===null)throw Error(Q(188));return g!==e?null:e}for(var t=e,I=g;;){var n=t.return;if(n===null)break;var l=n.alternate;if(l===null){if(I=n.return,I!==null){t=I;continue}break}if(n.child===l.child){for(l=n.child;l;){if(l===t)return J0(n),e;if(l===I)return J0(n),g;l=l.sibling}throw Error(Q(188))}if(t.return!==I.return)t=n,I=l;else{for(var C=!1,s=n.child;s;){if(s===t){C=!0,t=n,I=l;break}if(s===I){C=!0,I=n,t=l;break}s=s.sibling}if(!C){for(s=l.child;s;){if(s===t){C=!0,t=l,I=n;break}if(s===I){C=!0,I=l,t=n;break}s=s.sibling}if(!C)throw Error(Q(189))}}if(t.alternate!==I)throw Error(Q(190))}if(t.tag!==3)throw Error(Q(188));return t.stateNode.current===t?e:g}function dG(e){return e=eS(e),e!==null?uG(e):null}function uG(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var g=uG(e);if(g!==null)return g;e=e.sibling}return null}var mG=et.unstable_scheduleCallback,w0=et.unstable_cancelCallback,tS=et.unstable_shouldYield,IS=et.unstable_requestPaint,vg=et.unstable_now,nS=et.unstable_getCurrentPriorityLevel,xm=et.unstable_ImmediatePriority,hG=et.unstable_UserBlockingPriority,Qo=et.unstable_NormalPriority,lS=et.unstable_LowPriority,bG=et.unstable_IdlePriority,Ec=null,bI=null;function CS(e){if(bI&&typeof bI.onCommitFiberRoot=="function")try{bI.onCommitFiberRoot(Ec,e,void 0,(e.current.flags&128)===128)}catch{}}var zt=Math.clz32?Math.clz32:iS,sS=Math.log,rS=Math.LN2;function iS(e){return e>>>=0,e===0?32:31-(sS(e)/rS|0)|0}var Ya=64,va=4194304;function Tr(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Lo(e,g){var t=e.pendingLanes;if(t===0)return 0;var I=0,n=e.suspendedLanes,l=e.pingedLanes,C=t&268435455;if(C!==0){var s=C&~n;s!==0?I=Tr(s):(l&=C,l!==0&&(I=Tr(l)))}else C=t&~n,C!==0?I=Tr(C):l!==0&&(I=Tr(l));if(I===0)return 0;if(g!==0&&g!==I&&!(g&n)&&(n=I&-I,l=g&-g,n>=l||n===16&&(l&4194240)!==0))return g;if(I&4&&(I|=t&16),g=e.entangledLanes,g!==0)for(e=e.entanglements,g&=I;0<g;)t=31-zt(g),n=1<<t,I|=e[t],g&=~n;return I}function aS(e,g){switch(e){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oS(e,g){for(var t=e.suspendedLanes,I=e.pingedLanes,n=e.expirationTimes,l=e.pendingLanes;0<l;){var C=31-zt(l),s=1<<C,r=n[C];r===-1?(!(s&t)||s&I)&&(n[C]=aS(s,g)):r<=g&&(e.expiredLanes|=s),l&=~s}}function _d(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function ZG(){var e=Ya;return Ya<<=1,!(Ya&4194240)&&(Ya=64),e}function TA(e){for(var g=[],t=0;31>t;t++)g.push(e);return g}function da(e,g,t){e.pendingLanes|=g,g!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,g=31-zt(g),e[g]=t}function cS(e,g){var t=e.pendingLanes&~g;e.pendingLanes=g,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=g,e.mutableReadLanes&=g,e.entangledLanes&=g,g=e.entanglements;var I=e.eventTimes;for(e=e.expirationTimes;0<t;){var n=31-zt(t),l=1<<n;g[n]=0,I[n]=-1,e[n]=-1,t&=~l}}function Km(e,g){var t=e.entangledLanes|=g;for(e=e.entanglements;t;){var I=31-zt(t),n=1<<I;n&g|e[I]&g&&(e[I]|=g),t&=~n}}var Ag=0;function yG(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var GG,Em,pG,BG,fG,$d=!1,Na=[],Ln=null,Tn=null,Mn=null,ci=new Map,Ai=new Map,Zn=[],AS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Y0(e,g){switch(e){case"focusin":case"focusout":Ln=null;break;case"dragenter":case"dragleave":Tn=null;break;case"mouseover":case"mouseout":Mn=null;break;case"pointerover":case"pointerout":ci.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ai.delete(g.pointerId)}}function Yr(e,g,t,I,n,l){return e===null||e.nativeEvent!==l?(e={blockedOn:g,domEventName:t,eventSystemFlags:I,nativeEvent:l,targetContainers:[n]},g!==null&&(g=ma(g),g!==null&&Em(g)),e):(e.eventSystemFlags|=I,g=e.targetContainers,n!==null&&g.indexOf(n)===-1&&g.push(n),e)}function dS(e,g,t,I,n){switch(g){case"focusin":return Ln=Yr(Ln,e,g,t,I,n),!0;case"dragenter":return Tn=Yr(Tn,e,g,t,I,n),!0;case"mouseover":return Mn=Yr(Mn,e,g,t,I,n),!0;case"pointerover":var l=n.pointerId;return ci.set(l,Yr(ci.get(l)||null,e,g,t,I,n)),!0;case"gotpointercapture":return l=n.pointerId,Ai.set(l,Yr(Ai.get(l)||null,e,g,t,I,n)),!0}return!1}function VG(e){var g=Sl(e.target);if(g!==null){var t=pC(g);if(t!==null){if(g=t.tag,g===13){if(g=AG(t),g!==null){e.blockedOn=g,fG(e.priority,function(){pG(t)});return}}else if(g===3&&t.stateNode.current.memoizedState.isDehydrated){e.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ao(e){if(e.blockedOn!==null)return!1;for(var g=e.targetContainers;0<g.length;){var t=gu(e.domEventName,e.eventSystemFlags,g[0],e.nativeEvent);if(t===null){t=e.nativeEvent;var I=new t.constructor(t.type,t);jd=I,t.target.dispatchEvent(I),jd=null}else return g=ma(t),g!==null&&Em(g),e.blockedOn=t,!1;g.shift()}return!0}function v0(e,g,t){ao(e)&&t.delete(g)}function uS(){$d=!1,Ln!==null&&ao(Ln)&&(Ln=null),Tn!==null&&ao(Tn)&&(Tn=null),Mn!==null&&ao(Mn)&&(Mn=null),ci.forEach(v0),Ai.forEach(v0)}function vr(e,g){e.blockedOn===g&&(e.blockedOn=null,$d||($d=!0,et.unstable_scheduleCallback(et.unstable_NormalPriority,uS)))}function di(e){function g(n){return vr(n,e)}if(0<Na.length){vr(Na[0],e);for(var t=1;t<Na.length;t++){var I=Na[t];I.blockedOn===e&&(I.blockedOn=null)}}for(Ln!==null&&vr(Ln,e),Tn!==null&&vr(Tn,e),Mn!==null&&vr(Mn,e),ci.forEach(g),Ai.forEach(g),t=0;t<Zn.length;t++)I=Zn[t],I.blockedOn===e&&(I.blockedOn=null);for(;0<Zn.length&&(t=Zn[0],t.blockedOn===null);)VG(t),t.blockedOn===null&&Zn.shift()}var ns=ln.ReactCurrentBatchConfig,To=!0;function mS(e,g,t,I){var n=Ag,l=ns.transition;ns.transition=null;try{Ag=1,Um(e,g,t,I)}finally{Ag=n,ns.transition=l}}function hS(e,g,t,I){var n=Ag,l=ns.transition;ns.transition=null;try{Ag=4,Um(e,g,t,I)}finally{Ag=n,ns.transition=l}}function Um(e,g,t,I){if(To){var n=gu(e,g,t,I);if(n===null)ed(e,g,I,Mo,t),Y0(e,I);else if(dS(n,e,g,t,I))I.stopPropagation();else if(Y0(e,I),g&4&&-1<AS.indexOf(e)){for(;n!==null;){var l=ma(n);if(l!==null&&GG(l),l=gu(e,g,t,I),l===null&&ed(e,g,I,Mo,t),l===n)break;n=l}n!==null&&I.stopPropagation()}else ed(e,g,I,null,t)}}var Mo=null;function gu(e,g,t,I){if(Mo=null,e=Fm(I),e=Sl(e),e!==null)if(g=pC(e),g===null)e=null;else if(t=g.tag,t===13){if(e=AG(g),e!==null)return e;e=null}else if(t===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;e=null}else g!==e&&(e=null);return Mo=e,null}function WG(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(nS()){case xm:return 1;case hG:return 4;case Qo:case lS:return 16;case bG:return 536870912;default:return 16}default:return 16}}var En=null,zm=null,oo=null;function SG(){if(oo)return oo;var e,g=zm,t=g.length,I,n="value"in En?En.value:En.textContent,l=n.length;for(e=0;e<t&&g[e]===n[e];e++);var C=t-e;for(I=1;I<=C&&g[t-I]===n[l-I];I++);return oo=n.slice(e,1<I?1-I:void 0)}function co(e){var g=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&g===13&&(e=13)):e=g,e===10&&(e=13),32<=e||e===13?e:0}function Ha(){return!0}function N0(){return!1}function It(e){function g(t,I,n,l,C){this._reactName=t,this._targetInst=n,this.type=I,this.nativeEvent=l,this.target=C,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(l):l[s]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?Ha:N0,this.isPropagationStopped=N0,this}return Xg(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Ha)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Ha)},persist:function(){},isPersistent:Ha}),g}var Gr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qm=It(Gr),ua=Xg({},Gr,{view:0,detail:0}),bS=It(ua),MA,DA,Nr,Uc=Xg({},ua,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lm,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Nr&&(Nr&&e.type==="mousemove"?(MA=e.screenX-Nr.screenX,DA=e.screenY-Nr.screenY):DA=MA=0,Nr=e),MA)},movementY:function(e){return"movementY"in e?e.movementY:DA}}),H0=It(Uc),ZS=Xg({},Uc,{dataTransfer:0}),yS=It(ZS),GS=Xg({},ua,{relatedTarget:0}),jA=It(GS),pS=Xg({},Gr,{animationName:0,elapsedTime:0,pseudoElement:0}),BS=It(pS),fS=Xg({},Gr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),VS=It(fS),WS=Xg({},Gr,{data:0}),F0=It(WS),SS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function XS(e){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(e):(e=kS[e])?!!g[e]:!1}function Lm(){return XS}var JS=Xg({},ua,{key:function(e){if(e.key){var g=SS[e.key]||e.key;if(g!=="Unidentified")return g}return e.type==="keypress"?(e=co(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?RS[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lm,charCode:function(e){return e.type==="keypress"?co(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?co(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),wS=It(JS),YS=Xg({},Uc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),x0=It(YS),vS=Xg({},ua,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lm}),NS=It(vS),HS=Xg({},Gr,{propertyName:0,elapsedTime:0,pseudoElement:0}),FS=It(HS),xS=Xg({},Uc,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),KS=It(xS),ES=[9,13,27,32],Tm=qI&&"CompositionEvent"in window,gi=null;qI&&"documentMode"in document&&(gi=document.documentMode);var US=qI&&"TextEvent"in window&&!gi,RG=qI&&(!Tm||gi&&8<gi&&11>=gi),K0=String.fromCharCode(32),E0=!1;function kG(e,g){switch(e){case"keyup":return ES.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XG(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var KC=!1;function zS(e,g){switch(e){case"compositionend":return XG(g);case"keypress":return g.which!==32?null:(E0=!0,K0);case"textInput":return e=g.data,e===K0&&E0?null:e;default:return null}}function QS(e,g){if(KC)return e==="compositionend"||!Tm&&kG(e,g)?(e=SG(),oo=zm=En=null,KC=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return RG&&g.locale!=="ko"?null:g.data;default:return null}}var LS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function U0(e){var g=e&&e.nodeName&&e.nodeName.toLowerCase();return g==="input"?!!LS[e.type]:g==="textarea"}function JG(e,g,t,I){rG(I),g=Do(g,"onChange"),0<g.length&&(t=new Qm("onChange","change",null,t,I),e.push({event:t,listeners:g}))}var ei=null,ui=null;function TS(e){zG(e,0)}function zc(e){var g=zC(e);if(eG(g))return e}function MS(e,g){if(e==="change")return g}var wG=!1;if(qI){var PA;if(qI){var OA="oninput"in document;if(!OA){var z0=document.createElement("div");z0.setAttribute("oninput","return;"),OA=typeof z0.oninput=="function"}PA=OA}else PA=!1;wG=PA&&(!document.documentMode||9<document.documentMode)}function Q0(){ei&&(ei.detachEvent("onpropertychange",YG),ui=ei=null)}function YG(e){if(e.propertyName==="value"&&zc(ui)){var g=[];JG(g,ui,e,Fm(e)),cG(TS,g)}}function DS(e,g,t){e==="focusin"?(Q0(),ei=g,ui=t,ei.attachEvent("onpropertychange",YG)):e==="focusout"&&Q0()}function jS(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return zc(ui)}function PS(e,g){if(e==="click")return zc(g)}function OS(e,g){if(e==="input"||e==="change")return zc(g)}function qS(e,g){return e===g&&(e!==0||1/e===1/g)||e!==e&&g!==g}var Mt=typeof Object.is=="function"?Object.is:qS;function mi(e,g){if(Mt(e,g))return!0;if(typeof e!="object"||e===null||typeof g!="object"||g===null)return!1;var t=Object.keys(e),I=Object.keys(g);if(t.length!==I.length)return!1;for(I=0;I<t.length;I++){var n=t[I];if(!Hd.call(g,n)||!Mt(e[n],g[n]))return!1}return!0}function L0(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function T0(e,g){var t=L0(e);e=0;for(var I;t;){if(t.nodeType===3){if(I=e+t.textContent.length,e<=g&&I>=g)return{node:t,offset:g-e};e=I}g:{for(;t;){if(t.nextSibling){t=t.nextSibling;break g}t=t.parentNode}t=void 0}t=L0(t)}}function vG(e,g){return e&&g?e===g?!0:e&&e.nodeType===3?!1:g&&g.nodeType===3?vG(e,g.parentNode):"contains"in e?e.contains(g):e.compareDocumentPosition?!!(e.compareDocumentPosition(g)&16):!1:!1}function NG(){for(var e=window,g=Eo();g instanceof e.HTMLIFrameElement;){try{var t=typeof g.contentWindow.location.href=="string"}catch{t=!1}if(t)e=g.contentWindow;else break;g=Eo(e.document)}return g}function Mm(e){var g=e&&e.nodeName&&e.nodeName.toLowerCase();return g&&(g==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||g==="textarea"||e.contentEditable==="true")}function _S(e){var g=NG(),t=e.focusedElem,I=e.selectionRange;if(g!==t&&t&&t.ownerDocument&&vG(t.ownerDocument.documentElement,t)){if(I!==null&&Mm(t)){if(g=I.start,e=I.end,e===void 0&&(e=g),"selectionStart"in t)t.selectionStart=g,t.selectionEnd=Math.min(e,t.value.length);else if(e=(g=t.ownerDocument||document)&&g.defaultView||window,e.getSelection){e=e.getSelection();var n=t.textContent.length,l=Math.min(I.start,n);I=I.end===void 0?l:Math.min(I.end,n),!e.extend&&l>I&&(n=I,I=l,l=n),n=T0(t,l);var C=T0(t,I);n&&C&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==C.node||e.focusOffset!==C.offset)&&(g=g.createRange(),g.setStart(n.node,n.offset),e.removeAllRanges(),l>I?(e.addRange(g),e.extend(C.node,C.offset)):(g.setEnd(C.node,C.offset),e.addRange(g)))}}for(g=[],e=t;e=e.parentNode;)e.nodeType===1&&g.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<g.length;t++)e=g[t],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var $S=qI&&"documentMode"in document&&11>=document.documentMode,EC=null,eu=null,ti=null,tu=!1;function M0(e,g,t){var I=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;tu||EC==null||EC!==Eo(I)||(I=EC,"selectionStart"in I&&Mm(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),ti&&mi(ti,I)||(ti=I,I=Do(eu,"onSelect"),0<I.length&&(g=new Qm("onSelect","select",null,g,t),e.push({event:g,listeners:I}),g.target=EC)))}function Fa(e,g){var t={};return t[e.toLowerCase()]=g.toLowerCase(),t["Webkit"+e]="webkit"+g,t["Moz"+e]="moz"+g,t}var UC={animationend:Fa("Animation","AnimationEnd"),animationiteration:Fa("Animation","AnimationIteration"),animationstart:Fa("Animation","AnimationStart"),transitionend:Fa("Transition","TransitionEnd")},qA={},HG={};qI&&(HG=document.createElement("div").style,"AnimationEvent"in window||(delete UC.animationend.animation,delete UC.animationiteration.animation,delete UC.animationstart.animation),"TransitionEvent"in window||delete UC.transitionend.transition);function Qc(e){if(qA[e])return qA[e];if(!UC[e])return e;var g=UC[e],t;for(t in g)if(g.hasOwnProperty(t)&&t in HG)return qA[e]=g[t];return e}var FG=Qc("animationend"),xG=Qc("animationiteration"),KG=Qc("animationstart"),EG=Qc("transitionend"),UG=new Map,D0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ll(e,g){UG.set(e,g),GC(g,[e])}for(var _A=0;_A<D0.length;_A++){var $A=D0[_A],gR=$A.toLowerCase(),eR=$A[0].toUpperCase()+$A.slice(1);ll(gR,"on"+eR)}ll(FG,"onAnimationEnd");ll(xG,"onAnimationIteration");ll(KG,"onAnimationStart");ll("dblclick","onDoubleClick");ll("focusin","onFocus");ll("focusout","onBlur");ll(EG,"onTransitionEnd");Ir("onMouseEnter",["mouseout","mouseover"]);Ir("onMouseLeave",["mouseout","mouseover"]);Ir("onPointerEnter",["pointerout","pointerover"]);Ir("onPointerLeave",["pointerout","pointerover"]);GC("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));GC("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));GC("onBeforeInput",["compositionend","keypress","textInput","paste"]);GC("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));GC("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));GC("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tR=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mr));function j0(e,g,t){var I=e.type||"unknown-event";e.currentTarget=t,gS(I,g,void 0,e),e.currentTarget=null}function zG(e,g){g=(g&4)!==0;for(var t=0;t<e.length;t++){var I=e[t],n=I.event;I=I.listeners;g:{var l=void 0;if(g)for(var C=I.length-1;0<=C;C--){var s=I[C],r=s.instance,a=s.currentTarget;if(s=s.listener,r!==l&&n.isPropagationStopped())break g;j0(n,s,a),l=r}else for(C=0;C<I.length;C++){if(s=I[C],r=s.instance,a=s.currentTarget,s=s.listener,r!==l&&n.isPropagationStopped())break g;j0(n,s,a),l=r}}}if(zo)throw e=qd,zo=!1,qd=null,e}function yg(e,g){var t=g[su];t===void 0&&(t=g[su]=new Set);var I=e+"__bubble";t.has(I)||(QG(g,e,2,!1),t.add(I))}function gd(e,g,t){var I=0;g&&(I|=4),QG(t,e,I,g)}var xa="_reactListening"+Math.random().toString(36).slice(2);function hi(e){if(!e[xa]){e[xa]=!0,Oy.forEach(function(t){t!=="selectionchange"&&(tR.has(t)||gd(t,!1,e),gd(t,!0,e))});var g=e.nodeType===9?e:e.ownerDocument;g===null||g[xa]||(g[xa]=!0,gd("selectionchange",!1,g))}}function QG(e,g,t,I){switch(WG(g)){case 1:var n=mS;break;case 4:n=hS;break;default:n=Um}t=n.bind(null,g,t,e),n=void 0,!Od||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(n=!0),I?n!==void 0?e.addEventListener(g,t,{capture:!0,passive:n}):e.addEventListener(g,t,!0):n!==void 0?e.addEventListener(g,t,{passive:n}):e.addEventListener(g,t,!1)}function ed(e,g,t,I,n){var l=I;if(!(g&1)&&!(g&2)&&I!==null)g:for(;;){if(I===null)return;var C=I.tag;if(C===3||C===4){var s=I.stateNode.containerInfo;if(s===n||s.nodeType===8&&s.parentNode===n)break;if(C===4)for(C=I.return;C!==null;){var r=C.tag;if((r===3||r===4)&&(r=C.stateNode.containerInfo,r===n||r.nodeType===8&&r.parentNode===n))return;C=C.return}for(;s!==null;){if(C=Sl(s),C===null)return;if(r=C.tag,r===5||r===6){I=l=C;continue g}s=s.parentNode}}I=I.return}cG(function(){var a=l,o=Fm(t),c=[];g:{var A=UG.get(e);if(A!==void 0){var b=Qm,m=e;switch(e){case"keypress":if(co(t)===0)break g;case"keydown":case"keyup":b=wS;break;case"focusin":m="focus",b=jA;break;case"focusout":m="blur",b=jA;break;case"beforeblur":case"afterblur":b=jA;break;case"click":if(t.button===2)break g;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=H0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=yS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=NS;break;case FG:case xG:case KG:b=BS;break;case EG:b=FS;break;case"scroll":b=bS;break;case"wheel":b=KS;break;case"copy":case"cut":case"paste":b=VS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=x0}var Z=(g&4)!==0,G=!Z&&e==="scroll",h=Z?A!==null?A+"Capture":null:A;Z=[];for(var u=a,y;u!==null;){y=u;var W=y.stateNode;if(y.tag===5&&W!==null&&(y=W,h!==null&&(W=oi(u,h),W!=null&&Z.push(bi(u,W,y)))),G)break;u=u.return}0<Z.length&&(A=new b(A,m,null,t,o),c.push({event:A,listeners:Z}))}}if(!(g&7)){g:{if(A=e==="mouseover"||e==="pointerover",b=e==="mouseout"||e==="pointerout",A&&t!==jd&&(m=t.relatedTarget||t.fromElement)&&(Sl(m)||m[_I]))break g;if((b||A)&&(A=o.window===o?o:(A=o.ownerDocument)?A.defaultView||A.parentWindow:window,b?(m=t.relatedTarget||t.toElement,b=a,m=m?Sl(m):null,m!==null&&(G=pC(m),m!==G||m.tag!==5&&m.tag!==6)&&(m=null)):(b=null,m=a),b!==m)){if(Z=H0,W="onMouseLeave",h="onMouseEnter",u="mouse",(e==="pointerout"||e==="pointerover")&&(Z=x0,W="onPointerLeave",h="onPointerEnter",u="pointer"),G=b==null?A:zC(b),y=m==null?A:zC(m),A=new Z(W,u+"leave",b,t,o),A.target=G,A.relatedTarget=y,W=null,Sl(o)===a&&(Z=new Z(h,u+"enter",m,t,o),Z.target=y,Z.relatedTarget=G,W=Z),G=W,b&&m)e:{for(Z=b,h=m,u=0,y=Z;y;y=kC(y))u++;for(y=0,W=h;W;W=kC(W))y++;for(;0<u-y;)Z=kC(Z),u--;for(;0<y-u;)h=kC(h),y--;for(;u--;){if(Z===h||h!==null&&Z===h.alternate)break e;Z=kC(Z),h=kC(h)}Z=null}else Z=null;b!==null&&P0(c,A,b,Z,!1),m!==null&&G!==null&&P0(c,G,m,Z,!0)}}g:{if(A=a?zC(a):window,b=A.nodeName&&A.nodeName.toLowerCase(),b==="select"||b==="input"&&A.type==="file")var S=MS;else if(U0(A))if(wG)S=OS;else{S=jS;var J=DS}else(b=A.nodeName)&&b.toLowerCase()==="input"&&(A.type==="checkbox"||A.type==="radio")&&(S=PS);if(S&&(S=S(e,a))){JG(c,S,t,o);break g}J&&J(e,A,a),e==="focusout"&&(J=A._wrapperState)&&J.controlled&&A.type==="number"&&Qd(A,"number",A.value)}switch(J=a?zC(a):window,e){case"focusin":(U0(J)||J.contentEditable==="true")&&(EC=J,eu=a,ti=null);break;case"focusout":ti=eu=EC=null;break;case"mousedown":tu=!0;break;case"contextmenu":case"mouseup":case"dragend":tu=!1,M0(c,t,o);break;case"selectionchange":if($S)break;case"keydown":case"keyup":M0(c,t,o)}var f;if(Tm)g:{switch(e){case"compositionstart":var X="onCompositionStart";break g;case"compositionend":X="onCompositionEnd";break g;case"compositionupdate":X="onCompositionUpdate";break g}X=void 0}else KC?kG(e,t)&&(X="onCompositionEnd"):e==="keydown"&&t.keyCode===229&&(X="onCompositionStart");X&&(RG&&t.locale!=="ko"&&(KC||X!=="onCompositionStart"?X==="onCompositionEnd"&&KC&&(f=SG()):(En=o,zm="value"in En?En.value:En.textContent,KC=!0)),J=Do(a,X),0<J.length&&(X=new F0(X,e,null,t,o),c.push({event:X,listeners:J}),f?X.data=f:(f=XG(t),f!==null&&(X.data=f)))),(f=US?zS(e,t):QS(e,t))&&(a=Do(a,"onBeforeInput"),0<a.length&&(o=new F0("onBeforeInput","beforeinput",null,t,o),c.push({event:o,listeners:a}),o.data=f))}zG(c,g)})}function bi(e,g,t){return{instance:e,listener:g,currentTarget:t}}function Do(e,g){for(var t=g+"Capture",I=[];e!==null;){var n=e,l=n.stateNode;n.tag===5&&l!==null&&(n=l,l=oi(e,t),l!=null&&I.unshift(bi(e,l,n)),l=oi(e,g),l!=null&&I.push(bi(e,l,n))),e=e.return}return I}function kC(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function P0(e,g,t,I,n){for(var l=g._reactName,C=[];t!==null&&t!==I;){var s=t,r=s.alternate,a=s.stateNode;if(r!==null&&r===I)break;s.tag===5&&a!==null&&(s=a,n?(r=oi(t,l),r!=null&&C.unshift(bi(t,r,s))):n||(r=oi(t,l),r!=null&&C.push(bi(t,r,s)))),t=t.return}C.length!==0&&e.push({event:g,listeners:C})}var IR=/\r\n?/g,nR=/\u0000|\uFFFD/g;function O0(e){return(typeof e=="string"?e:""+e).replace(IR,`
`).replace(nR,"")}function Ka(e,g,t){if(g=O0(g),O0(e)!==g&&t)throw Error(Q(425))}function jo(){}var Iu=null,nu=null;function lu(e,g){return e==="textarea"||e==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Cu=typeof setTimeout=="function"?setTimeout:void 0,lR=typeof clearTimeout=="function"?clearTimeout:void 0,q0=typeof Promise=="function"?Promise:void 0,CR=typeof queueMicrotask=="function"?queueMicrotask:typeof q0<"u"?function(e){return q0.resolve(null).then(e).catch(sR)}:Cu;function sR(e){setTimeout(function(){throw e})}function td(e,g){var t=g,I=0;do{var n=t.nextSibling;if(e.removeChild(t),n&&n.nodeType===8)if(t=n.data,t==="/$"){if(I===0){e.removeChild(n),di(g);return}I--}else t!=="$"&&t!=="$?"&&t!=="$!"||I++;t=n}while(t);di(g)}function Dn(e){for(;e!=null;e=e.nextSibling){var g=e.nodeType;if(g===1||g===3)break;if(g===8){if(g=e.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return e}function _0(e){e=e.previousSibling;for(var g=0;e;){if(e.nodeType===8){var t=e.data;if(t==="$"||t==="$!"||t==="$?"){if(g===0)return e;g--}else t==="/$"&&g++}e=e.previousSibling}return null}var pr=Math.random().toString(36).slice(2),aI="__reactFiber$"+pr,Zi="__reactProps$"+pr,_I="__reactContainer$"+pr,su="__reactEvents$"+pr,rR="__reactListeners$"+pr,iR="__reactHandles$"+pr;function Sl(e){var g=e[aI];if(g)return g;for(var t=e.parentNode;t;){if(g=t[_I]||t[aI]){if(t=g.alternate,g.child!==null||t!==null&&t.child!==null)for(e=_0(e);e!==null;){if(t=e[aI])return t;e=_0(e)}return g}e=t,t=e.parentNode}return null}function ma(e){return e=e[aI]||e[_I],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function zC(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Q(33))}function Lc(e){return e[Zi]||null}var ru=[],QC=-1;function Cl(e){return{current:e}}function Gg(e){0>QC||(e.current=ru[QC],ru[QC]=null,QC--)}function bg(e,g){QC++,ru[QC]=e.current,e.current=g}var tl={},de=Cl(tl),Ne=Cl(!1),iC=tl;function nr(e,g){var t=e.type.contextTypes;if(!t)return tl;var I=e.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===g)return I.__reactInternalMemoizedMaskedChildContext;var n={},l;for(l in t)n[l]=g[l];return I&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=g,e.__reactInternalMemoizedMaskedChildContext=n),n}function He(e){return e=e.childContextTypes,e!=null}function Po(){Gg(Ne),Gg(de)}function $0(e,g,t){if(de.current!==tl)throw Error(Q(168));bg(de,g),bg(Ne,t)}function LG(e,g,t){var I=e.stateNode;if(g=g.childContextTypes,typeof I.getChildContext!="function")return t;I=I.getChildContext();for(var n in I)if(!(n in g))throw Error(Q(108,DW(e)||"Unknown",n));return Xg({},t,I)}function Oo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||tl,iC=de.current,bg(de,e),bg(Ne,Ne.current),!0}function gb(e,g,t){var I=e.stateNode;if(!I)throw Error(Q(169));t?(e=LG(e,g,iC),I.__reactInternalMemoizedMergedChildContext=e,Gg(Ne),Gg(de),bg(de,e)):Gg(Ne),bg(Ne,t)}var kI=null,Tc=!1,Id=!1;function TG(e){kI===null?kI=[e]:kI.push(e)}function aR(e){Tc=!0,TG(e)}function sl(){if(!Id&&kI!==null){Id=!0;var e=0,g=Ag;try{var t=kI;for(Ag=1;e<t.length;e++){var I=t[e];do I=I(!0);while(I!==null)}kI=null,Tc=!1}catch(n){throw kI!==null&&(kI=kI.slice(e+1)),mG(xm,sl),n}finally{Ag=g,Id=!1}}return null}var LC=[],TC=0,qo=null,_o=0,bt=[],Zt=0,aC=null,LI=1,TI="";function bl(e,g){LC[TC++]=_o,LC[TC++]=qo,qo=e,_o=g}function MG(e,g,t){bt[Zt++]=LI,bt[Zt++]=TI,bt[Zt++]=aC,aC=e;var I=LI;e=TI;var n=32-zt(I)-1;I&=~(1<<n),t+=1;var l=32-zt(g)+n;if(30<l){var C=n-n%5;l=(I&(1<<C)-1).toString(32),I>>=C,n-=C,LI=1<<32-zt(g)+n|t<<n|I,TI=l+e}else LI=1<<l|t<<n|I,TI=e}function Dm(e){e.return!==null&&(bl(e,1),MG(e,1,0))}function jm(e){for(;e===qo;)qo=LC[--TC],LC[TC]=null,_o=LC[--TC],LC[TC]=null;for(;e===aC;)aC=bt[--Zt],bt[Zt]=null,TI=bt[--Zt],bt[Zt]=null,LI=bt[--Zt],bt[Zt]=null}var $e=null,_e=null,fg=!1,xt=null;function DG(e,g){var t=yt(5,null,null,0);t.elementType="DELETED",t.stateNode=g,t.return=e,g=e.deletions,g===null?(e.deletions=[t],e.flags|=16):g.push(t)}function eb(e,g){switch(e.tag){case 5:var t=e.type;return g=g.nodeType!==1||t.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(e.stateNode=g,$e=e,_e=Dn(g.firstChild),!0):!1;case 6:return g=e.pendingProps===""||g.nodeType!==3?null:g,g!==null?(e.stateNode=g,$e=e,_e=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(t=aC!==null?{id:LI,overflow:TI}:null,e.memoizedState={dehydrated:g,treeContext:t,retryLane:1073741824},t=yt(18,null,null,0),t.stateNode=g,t.return=e,e.child=t,$e=e,_e=null,!0):!1;default:return!1}}function iu(e){return(e.mode&1)!==0&&(e.flags&128)===0}function au(e){if(fg){var g=_e;if(g){var t=g;if(!eb(e,g)){if(iu(e))throw Error(Q(418));g=Dn(t.nextSibling);var I=$e;g&&eb(e,g)?DG(I,t):(e.flags=e.flags&-4097|2,fg=!1,$e=e)}}else{if(iu(e))throw Error(Q(418));e.flags=e.flags&-4097|2,fg=!1,$e=e}}}function tb(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;$e=e}function Ea(e){if(e!==$e)return!1;if(!fg)return tb(e),fg=!0,!1;var g;if((g=e.tag!==3)&&!(g=e.tag!==5)&&(g=e.type,g=g!=="head"&&g!=="body"&&!lu(e.type,e.memoizedProps)),g&&(g=_e)){if(iu(e))throw jG(),Error(Q(418));for(;g;)DG(e,g),g=Dn(g.nextSibling)}if(tb(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Q(317));g:{for(e=e.nextSibling,g=0;e;){if(e.nodeType===8){var t=e.data;if(t==="/$"){if(g===0){_e=Dn(e.nextSibling);break g}g--}else t!=="$"&&t!=="$!"&&t!=="$?"||g++}e=e.nextSibling}_e=null}}else _e=$e?Dn(e.stateNode.nextSibling):null;return!0}function jG(){for(var e=_e;e;)e=Dn(e.nextSibling)}function lr(){_e=$e=null,fg=!1}function Pm(e){xt===null?xt=[e]:xt.push(e)}var oR=ln.ReactCurrentBatchConfig;function Hr(e,g,t){if(e=t.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Q(309));var I=t.stateNode}if(!I)throw Error(Q(147,e));var n=I,l=""+e;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===l?g.ref:(g=function(C){var s=n.refs;C===null?delete s[l]:s[l]=C},g._stringRef=l,g)}if(typeof e!="string")throw Error(Q(284));if(!t._owner)throw Error(Q(290,e))}return e}function Ua(e,g){throw e=Object.prototype.toString.call(g),Error(Q(31,e==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":e))}function Ib(e){var g=e._init;return g(e._payload)}function PG(e){function g(h,u){if(e){var y=h.deletions;y===null?(h.deletions=[u],h.flags|=16):y.push(u)}}function t(h,u){if(!e)return null;for(;u!==null;)g(h,u),u=u.sibling;return null}function I(h,u){for(h=new Map;u!==null;)u.key!==null?h.set(u.key,u):h.set(u.index,u),u=u.sibling;return h}function n(h,u){return h=qn(h,u),h.index=0,h.sibling=null,h}function l(h,u,y){return h.index=y,e?(y=h.alternate,y!==null?(y=y.index,y<u?(h.flags|=2,u):y):(h.flags|=2,u)):(h.flags|=1048576,u)}function C(h){return e&&h.alternate===null&&(h.flags|=2),h}function s(h,u,y,W){return u===null||u.tag!==6?(u=ad(y,h.mode,W),u.return=h,u):(u=n(u,y),u.return=h,u)}function r(h,u,y,W){var S=y.type;return S===xC?o(h,u,y.props.children,W,y.key):u!==null&&(u.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===mn&&Ib(S)===u.type)?(W=n(u,y.props),W.ref=Hr(h,u,y),W.return=h,W):(W=yo(y.type,y.key,y.props,null,h.mode,W),W.ref=Hr(h,u,y),W.return=h,W)}function a(h,u,y,W){return u===null||u.tag!==4||u.stateNode.containerInfo!==y.containerInfo||u.stateNode.implementation!==y.implementation?(u=od(y,h.mode,W),u.return=h,u):(u=n(u,y.children||[]),u.return=h,u)}function o(h,u,y,W,S){return u===null||u.tag!==7?(u=nC(y,h.mode,W,S),u.return=h,u):(u=n(u,y),u.return=h,u)}function c(h,u,y){if(typeof u=="string"&&u!==""||typeof u=="number")return u=ad(""+u,h.mode,y),u.return=h,u;if(typeof u=="object"&&u!==null){switch(u.$$typeof){case Xa:return y=yo(u.type,u.key,u.props,null,h.mode,y),y.ref=Hr(h,null,u),y.return=h,y;case FC:return u=od(u,h.mode,y),u.return=h,u;case mn:var W=u._init;return c(h,W(u._payload),y)}if(Lr(u)||Jr(u))return u=nC(u,h.mode,y,null),u.return=h,u;Ua(h,u)}return null}function A(h,u,y,W){var S=u!==null?u.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return S!==null?null:s(h,u,""+y,W);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Xa:return y.key===S?r(h,u,y,W):null;case FC:return y.key===S?a(h,u,y,W):null;case mn:return S=y._init,A(h,u,S(y._payload),W)}if(Lr(y)||Jr(y))return S!==null?null:o(h,u,y,W,null);Ua(h,y)}return null}function b(h,u,y,W,S){if(typeof W=="string"&&W!==""||typeof W=="number")return h=h.get(y)||null,s(u,h,""+W,S);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case Xa:return h=h.get(W.key===null?y:W.key)||null,r(u,h,W,S);case FC:return h=h.get(W.key===null?y:W.key)||null,a(u,h,W,S);case mn:var J=W._init;return b(h,u,y,J(W._payload),S)}if(Lr(W)||Jr(W))return h=h.get(y)||null,o(u,h,W,S,null);Ua(u,W)}return null}function m(h,u,y,W){for(var S=null,J=null,f=u,X=u=0,U=null;f!==null&&X<y.length;X++){f.index>X?(U=f,f=null):U=f.sibling;var Y=A(h,f,y[X],W);if(Y===null){f===null&&(f=U);break}e&&f&&Y.alternate===null&&g(h,f),u=l(Y,u,X),J===null?S=Y:J.sibling=Y,J=Y,f=U}if(X===y.length)return t(h,f),fg&&bl(h,X),S;if(f===null){for(;X<y.length;X++)f=c(h,y[X],W),f!==null&&(u=l(f,u,X),J===null?S=f:J.sibling=f,J=f);return fg&&bl(h,X),S}for(f=I(h,f);X<y.length;X++)U=b(f,h,X,y[X],W),U!==null&&(e&&U.alternate!==null&&f.delete(U.key===null?X:U.key),u=l(U,u,X),J===null?S=U:J.sibling=U,J=U);return e&&f.forEach(function(N){return g(h,N)}),fg&&bl(h,X),S}function Z(h,u,y,W){var S=Jr(y);if(typeof S!="function")throw Error(Q(150));if(y=S.call(y),y==null)throw Error(Q(151));for(var J=S=null,f=u,X=u=0,U=null,Y=y.next();f!==null&&!Y.done;X++,Y=y.next()){f.index>X?(U=f,f=null):U=f.sibling;var N=A(h,f,Y.value,W);if(N===null){f===null&&(f=U);break}e&&f&&N.alternate===null&&g(h,f),u=l(N,u,X),J===null?S=N:J.sibling=N,J=N,f=U}if(Y.done)return t(h,f),fg&&bl(h,X),S;if(f===null){for(;!Y.done;X++,Y=y.next())Y=c(h,Y.value,W),Y!==null&&(u=l(Y,u,X),J===null?S=Y:J.sibling=Y,J=Y);return fg&&bl(h,X),S}for(f=I(h,f);!Y.done;X++,Y=y.next())Y=b(f,h,X,Y.value,W),Y!==null&&(e&&Y.alternate!==null&&f.delete(Y.key===null?X:Y.key),u=l(Y,u,X),J===null?S=Y:J.sibling=Y,J=Y);return e&&f.forEach(function(j){return g(h,j)}),fg&&bl(h,X),S}function G(h,u,y,W){if(typeof y=="object"&&y!==null&&y.type===xC&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Xa:g:{for(var S=y.key,J=u;J!==null;){if(J.key===S){if(S=y.type,S===xC){if(J.tag===7){t(h,J.sibling),u=n(J,y.props.children),u.return=h,h=u;break g}}else if(J.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===mn&&Ib(S)===J.type){t(h,J.sibling),u=n(J,y.props),u.ref=Hr(h,J,y),u.return=h,h=u;break g}t(h,J);break}else g(h,J);J=J.sibling}y.type===xC?(u=nC(y.props.children,h.mode,W,y.key),u.return=h,h=u):(W=yo(y.type,y.key,y.props,null,h.mode,W),W.ref=Hr(h,u,y),W.return=h,h=W)}return C(h);case FC:g:{for(J=y.key;u!==null;){if(u.key===J)if(u.tag===4&&u.stateNode.containerInfo===y.containerInfo&&u.stateNode.implementation===y.implementation){t(h,u.sibling),u=n(u,y.children||[]),u.return=h,h=u;break g}else{t(h,u);break}else g(h,u);u=u.sibling}u=od(y,h.mode,W),u.return=h,h=u}return C(h);case mn:return J=y._init,G(h,u,J(y._payload),W)}if(Lr(y))return m(h,u,y,W);if(Jr(y))return Z(h,u,y,W);Ua(h,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,u!==null&&u.tag===6?(t(h,u.sibling),u=n(u,y),u.return=h,h=u):(t(h,u),u=ad(y,h.mode,W),u.return=h,h=u),C(h)):t(h,u)}return G}var Cr=PG(!0),OG=PG(!1),$o=Cl(null),gc=null,MC=null,Om=null;function qm(){Om=MC=gc=null}function _m(e){var g=$o.current;Gg($o),e._currentValue=g}function ou(e,g,t){for(;e!==null;){var I=e.alternate;if((e.childLanes&g)!==g?(e.childLanes|=g,I!==null&&(I.childLanes|=g)):I!==null&&(I.childLanes&g)!==g&&(I.childLanes|=g),e===t)break;e=e.return}}function ls(e,g){gc=e,Om=MC=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&g&&(ve=!0),e.firstContext=null)}function pt(e){var g=e._currentValue;if(Om!==e)if(e={context:e,memoizedValue:g,next:null},MC===null){if(gc===null)throw Error(Q(308));MC=e,gc.dependencies={lanes:0,firstContext:e}}else MC=MC.next=e;return g}var Rl=null;function $m(e){Rl===null?Rl=[e]:Rl.push(e)}function qG(e,g,t,I){var n=g.interleaved;return n===null?(t.next=t,$m(g)):(t.next=n.next,n.next=t),g.interleaved=t,$I(e,I)}function $I(e,g){e.lanes|=g;var t=e.alternate;for(t!==null&&(t.lanes|=g),t=e,e=e.return;e!==null;)e.childLanes|=g,t=e.alternate,t!==null&&(t.childLanes|=g),t=e,e=e.return;return t.tag===3?t.stateNode:null}var hn=!1;function gh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _G(e,g){e=e.updateQueue,g.updateQueue===e&&(g.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function DI(e,g){return{eventTime:e,lane:g,tag:0,payload:null,callback:null,next:null}}function jn(e,g,t){var I=e.updateQueue;if(I===null)return null;if(I=I.shared,og&2){var n=I.pending;return n===null?g.next=g:(g.next=n.next,n.next=g),I.pending=g,$I(e,t)}return n=I.interleaved,n===null?(g.next=g,$m(I)):(g.next=n.next,n.next=g),I.interleaved=g,$I(e,t)}function Ao(e,g,t){if(g=g.updateQueue,g!==null&&(g=g.shared,(t&4194240)!==0)){var I=g.lanes;I&=e.pendingLanes,t|=I,g.lanes=t,Km(e,t)}}function nb(e,g){var t=e.updateQueue,I=e.alternate;if(I!==null&&(I=I.updateQueue,t===I)){var n=null,l=null;if(t=t.firstBaseUpdate,t!==null){do{var C={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};l===null?n=l=C:l=l.next=C,t=t.next}while(t!==null);l===null?n=l=g:l=l.next=g}else n=l=g;t={baseState:I.baseState,firstBaseUpdate:n,lastBaseUpdate:l,shared:I.shared,effects:I.effects},e.updateQueue=t;return}e=t.lastBaseUpdate,e===null?t.firstBaseUpdate=g:e.next=g,t.lastBaseUpdate=g}function ec(e,g,t,I){var n=e.updateQueue;hn=!1;var l=n.firstBaseUpdate,C=n.lastBaseUpdate,s=n.shared.pending;if(s!==null){n.shared.pending=null;var r=s,a=r.next;r.next=null,C===null?l=a:C.next=a,C=r;var o=e.alternate;o!==null&&(o=o.updateQueue,s=o.lastBaseUpdate,s!==C&&(s===null?o.firstBaseUpdate=a:s.next=a,o.lastBaseUpdate=r))}if(l!==null){var c=n.baseState;C=0,o=a=r=null,s=l;do{var A=s.lane,b=s.eventTime;if((I&A)===A){o!==null&&(o=o.next={eventTime:b,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});g:{var m=e,Z=s;switch(A=g,b=t,Z.tag){case 1:if(m=Z.payload,typeof m=="function"){c=m.call(b,c,A);break g}c=m;break g;case 3:m.flags=m.flags&-65537|128;case 0:if(m=Z.payload,A=typeof m=="function"?m.call(b,c,A):m,A==null)break g;c=Xg({},c,A);break g;case 2:hn=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,A=n.effects,A===null?n.effects=[s]:A.push(s))}else b={eventTime:b,lane:A,tag:s.tag,payload:s.payload,callback:s.callback,next:null},o===null?(a=o=b,r=c):o=o.next=b,C|=A;if(s=s.next,s===null){if(s=n.shared.pending,s===null)break;A=s,s=A.next,A.next=null,n.lastBaseUpdate=A,n.shared.pending=null}}while(1);if(o===null&&(r=c),n.baseState=r,n.firstBaseUpdate=a,n.lastBaseUpdate=o,g=n.shared.interleaved,g!==null){n=g;do C|=n.lane,n=n.next;while(n!==g)}else l===null&&(n.shared.lanes=0);cC|=C,e.lanes=C,e.memoizedState=c}}function lb(e,g,t){if(e=g.effects,g.effects=null,e!==null)for(g=0;g<e.length;g++){var I=e[g],n=I.callback;if(n!==null){if(I.callback=null,I=t,typeof n!="function")throw Error(Q(191,n));n.call(I)}}}var ha={},ZI=Cl(ha),yi=Cl(ha),Gi=Cl(ha);function kl(e){if(e===ha)throw Error(Q(174));return e}function eh(e,g){switch(bg(Gi,g),bg(yi,e),bg(ZI,ha),e=g.nodeType,e){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Td(null,"");break;default:e=e===8?g.parentNode:g,g=e.namespaceURI||null,e=e.tagName,g=Td(g,e)}Gg(ZI),bg(ZI,g)}function sr(){Gg(ZI),Gg(yi),Gg(Gi)}function $G(e){kl(Gi.current);var g=kl(ZI.current),t=Td(g,e.type);g!==t&&(bg(yi,e),bg(ZI,t))}function th(e){yi.current===e&&(Gg(ZI),Gg(yi))}var Wg=Cl(0);function tc(e){for(var g=e;g!==null;){if(g.tag===13){var t=g.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if(g.flags&128)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===e)break;for(;g.sibling===null;){if(g.return===null||g.return===e)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var nd=[];function Ih(){for(var e=0;e<nd.length;e++)nd[e]._workInProgressVersionPrimary=null;nd.length=0}var uo=ln.ReactCurrentDispatcher,ld=ln.ReactCurrentBatchConfig,oC=0,kg=null,Ug=null,Lg=null,Ic=!1,Ii=!1,pi=0,cR=0;function Ce(){throw Error(Q(321))}function nh(e,g){if(g===null)return!1;for(var t=0;t<g.length&&t<e.length;t++)if(!Mt(e[t],g[t]))return!1;return!0}function lh(e,g,t,I,n,l){if(oC=l,kg=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,uo.current=e===null||e.memoizedState===null?mR:hR,e=t(I,n),Ii){l=0;do{if(Ii=!1,pi=0,25<=l)throw Error(Q(301));l+=1,Lg=Ug=null,g.updateQueue=null,uo.current=bR,e=t(I,n)}while(Ii)}if(uo.current=nc,g=Ug!==null&&Ug.next!==null,oC=0,Lg=Ug=kg=null,Ic=!1,g)throw Error(Q(300));return e}function Ch(){var e=pi!==0;return pi=0,e}function $t(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Lg===null?kg.memoizedState=Lg=e:Lg=Lg.next=e,Lg}function Bt(){if(Ug===null){var e=kg.alternate;e=e!==null?e.memoizedState:null}else e=Ug.next;var g=Lg===null?kg.memoizedState:Lg.next;if(g!==null)Lg=g,Ug=e;else{if(e===null)throw Error(Q(310));Ug=e,e={memoizedState:Ug.memoizedState,baseState:Ug.baseState,baseQueue:Ug.baseQueue,queue:Ug.queue,next:null},Lg===null?kg.memoizedState=Lg=e:Lg=Lg.next=e}return Lg}function Bi(e,g){return typeof g=="function"?g(e):g}function Cd(e){var g=Bt(),t=g.queue;if(t===null)throw Error(Q(311));t.lastRenderedReducer=e;var I=Ug,n=I.baseQueue,l=t.pending;if(l!==null){if(n!==null){var C=n.next;n.next=l.next,l.next=C}I.baseQueue=n=l,t.pending=null}if(n!==null){l=n.next,I=I.baseState;var s=C=null,r=null,a=l;do{var o=a.lane;if((oC&o)===o)r!==null&&(r=r.next={lane:0,action:a.action,hasEagerState:a.hasEagerState,eagerState:a.eagerState,next:null}),I=a.hasEagerState?a.eagerState:e(I,a.action);else{var c={lane:o,action:a.action,hasEagerState:a.hasEagerState,eagerState:a.eagerState,next:null};r===null?(s=r=c,C=I):r=r.next=c,kg.lanes|=o,cC|=o}a=a.next}while(a!==null&&a!==l);r===null?C=I:r.next=s,Mt(I,g.memoizedState)||(ve=!0),g.memoizedState=I,g.baseState=C,g.baseQueue=r,t.lastRenderedState=I}if(e=t.interleaved,e!==null){n=e;do l=n.lane,kg.lanes|=l,cC|=l,n=n.next;while(n!==e)}else n===null&&(t.lanes=0);return[g.memoizedState,t.dispatch]}function sd(e){var g=Bt(),t=g.queue;if(t===null)throw Error(Q(311));t.lastRenderedReducer=e;var I=t.dispatch,n=t.pending,l=g.memoizedState;if(n!==null){t.pending=null;var C=n=n.next;do l=e(l,C.action),C=C.next;while(C!==n);Mt(l,g.memoizedState)||(ve=!0),g.memoizedState=l,g.baseQueue===null&&(g.baseState=l),t.lastRenderedState=l}return[l,I]}function gp(){}function ep(e,g){var t=kg,I=Bt(),n=g(),l=!Mt(I.memoizedState,n);if(l&&(I.memoizedState=n,ve=!0),I=I.queue,sh(np.bind(null,t,I,e),[e]),I.getSnapshot!==g||l||Lg!==null&&Lg.memoizedState.tag&1){if(t.flags|=2048,fi(9,Ip.bind(null,t,I,n,g),void 0,null),jg===null)throw Error(Q(349));oC&30||tp(t,g,n)}return n}function tp(e,g,t){e.flags|=16384,e={getSnapshot:g,value:t},g=kg.updateQueue,g===null?(g={lastEffect:null,stores:null},kg.updateQueue=g,g.stores=[e]):(t=g.stores,t===null?g.stores=[e]:t.push(e))}function Ip(e,g,t,I){g.value=t,g.getSnapshot=I,lp(g)&&Cp(e)}function np(e,g,t){return t(function(){lp(g)&&Cp(e)})}function lp(e){var g=e.getSnapshot;e=e.value;try{var t=g();return!Mt(e,t)}catch{return!0}}function Cp(e){var g=$I(e,1);g!==null&&Qt(g,e,1,-1)}function Cb(e){var g=$t();return typeof e=="function"&&(e=e()),g.memoizedState=g.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bi,lastRenderedState:e},g.queue=e,e=e.dispatch=uR.bind(null,kg,e),[g.memoizedState,e]}function fi(e,g,t,I){return e={tag:e,create:g,destroy:t,deps:I,next:null},g=kg.updateQueue,g===null?(g={lastEffect:null,stores:null},kg.updateQueue=g,g.lastEffect=e.next=e):(t=g.lastEffect,t===null?g.lastEffect=e.next=e:(I=t.next,t.next=e,e.next=I,g.lastEffect=e)),e}function sp(){return Bt().memoizedState}function mo(e,g,t,I){var n=$t();kg.flags|=e,n.memoizedState=fi(1|g,t,void 0,I===void 0?null:I)}function Mc(e,g,t,I){var n=Bt();I=I===void 0?null:I;var l=void 0;if(Ug!==null){var C=Ug.memoizedState;if(l=C.destroy,I!==null&&nh(I,C.deps)){n.memoizedState=fi(g,t,l,I);return}}kg.flags|=e,n.memoizedState=fi(1|g,t,l,I)}function sb(e,g){return mo(8390656,8,e,g)}function sh(e,g){return Mc(2048,8,e,g)}function rp(e,g){return Mc(4,2,e,g)}function ip(e,g){return Mc(4,4,e,g)}function ap(e,g){if(typeof g=="function")return e=e(),g(e),function(){g(null)};if(g!=null)return e=e(),g.current=e,function(){g.current=null}}function op(e,g,t){return t=t!=null?t.concat([e]):null,Mc(4,4,ap.bind(null,g,e),t)}function rh(){}function cp(e,g){var t=Bt();g=g===void 0?null:g;var I=t.memoizedState;return I!==null&&g!==null&&nh(g,I[1])?I[0]:(t.memoizedState=[e,g],e)}function Ap(e,g){var t=Bt();g=g===void 0?null:g;var I=t.memoizedState;return I!==null&&g!==null&&nh(g,I[1])?I[0]:(e=e(),t.memoizedState=[e,g],e)}function dp(e,g,t){return oC&21?(Mt(t,g)||(t=ZG(),kg.lanes|=t,cC|=t,e.baseState=!0),g):(e.baseState&&(e.baseState=!1,ve=!0),e.memoizedState=t)}function AR(e,g){var t=Ag;Ag=t!==0&&4>t?t:4,e(!0);var I=ld.transition;ld.transition={};try{e(!1),g()}finally{Ag=t,ld.transition=I}}function up(){return Bt().memoizedState}function dR(e,g,t){var I=On(e);if(t={lane:I,action:t,hasEagerState:!1,eagerState:null,next:null},mp(e))hp(g,t);else if(t=qG(e,g,t,I),t!==null){var n=fe();Qt(t,e,I,n),bp(t,g,I)}}function uR(e,g,t){var I=On(e),n={lane:I,action:t,hasEagerState:!1,eagerState:null,next:null};if(mp(e))hp(g,n);else{var l=e.alternate;if(e.lanes===0&&(l===null||l.lanes===0)&&(l=g.lastRenderedReducer,l!==null))try{var C=g.lastRenderedState,s=l(C,t);if(n.hasEagerState=!0,n.eagerState=s,Mt(s,C)){var r=g.interleaved;r===null?(n.next=n,$m(g)):(n.next=r.next,r.next=n),g.interleaved=n;return}}catch{}finally{}t=qG(e,g,n,I),t!==null&&(n=fe(),Qt(t,e,I,n),bp(t,g,I))}}function mp(e){var g=e.alternate;return e===kg||g!==null&&g===kg}function hp(e,g){Ii=Ic=!0;var t=e.pending;t===null?g.next=g:(g.next=t.next,t.next=g),e.pending=g}function bp(e,g,t){if(t&4194240){var I=g.lanes;I&=e.pendingLanes,t|=I,g.lanes=t,Km(e,t)}}var nc={readContext:pt,useCallback:Ce,useContext:Ce,useEffect:Ce,useImperativeHandle:Ce,useInsertionEffect:Ce,useLayoutEffect:Ce,useMemo:Ce,useReducer:Ce,useRef:Ce,useState:Ce,useDebugValue:Ce,useDeferredValue:Ce,useTransition:Ce,useMutableSource:Ce,useSyncExternalStore:Ce,useId:Ce,unstable_isNewReconciler:!1},mR={readContext:pt,useCallback:function(e,g){return $t().memoizedState=[e,g===void 0?null:g],e},useContext:pt,useEffect:sb,useImperativeHandle:function(e,g,t){return t=t!=null?t.concat([e]):null,mo(4194308,4,ap.bind(null,g,e),t)},useLayoutEffect:function(e,g){return mo(4194308,4,e,g)},useInsertionEffect:function(e,g){return mo(4,2,e,g)},useMemo:function(e,g){var t=$t();return g=g===void 0?null:g,e=e(),t.memoizedState=[e,g],e},useReducer:function(e,g,t){var I=$t();return g=t!==void 0?t(g):g,I.memoizedState=I.baseState=g,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:g},I.queue=e,e=e.dispatch=dR.bind(null,kg,e),[I.memoizedState,e]},useRef:function(e){var g=$t();return e={current:e},g.memoizedState=e},useState:Cb,useDebugValue:rh,useDeferredValue:function(e){return $t().memoizedState=e},useTransition:function(){var e=Cb(!1),g=e[0];return e=AR.bind(null,e[1]),$t().memoizedState=e,[g,e]},useMutableSource:function(){},useSyncExternalStore:function(e,g,t){var I=kg,n=$t();if(fg){if(t===void 0)throw Error(Q(407));t=t()}else{if(t=g(),jg===null)throw Error(Q(349));oC&30||tp(I,g,t)}n.memoizedState=t;var l={value:t,getSnapshot:g};return n.queue=l,sb(np.bind(null,I,l,e),[e]),I.flags|=2048,fi(9,Ip.bind(null,I,l,t,g),void 0,null),t},useId:function(){var e=$t(),g=jg.identifierPrefix;if(fg){var t=TI,I=LI;t=(I&~(1<<32-zt(I)-1)).toString(32)+t,g=":"+g+"R"+t,t=pi++,0<t&&(g+="H"+t.toString(32)),g+=":"}else t=cR++,g=":"+g+"r"+t.toString(32)+":";return e.memoizedState=g},unstable_isNewReconciler:!1},hR={readContext:pt,useCallback:cp,useContext:pt,useEffect:sh,useImperativeHandle:op,useInsertionEffect:rp,useLayoutEffect:ip,useMemo:Ap,useReducer:Cd,useRef:sp,useState:function(){return Cd(Bi)},useDebugValue:rh,useDeferredValue:function(e){var g=Bt();return dp(g,Ug.memoizedState,e)},useTransition:function(){var e=Cd(Bi)[0],g=Bt().memoizedState;return[e,g]},useMutableSource:gp,useSyncExternalStore:ep,useId:up,unstable_isNewReconciler:!1},bR={readContext:pt,useCallback:cp,useContext:pt,useEffect:sh,useImperativeHandle:op,useInsertionEffect:rp,useLayoutEffect:ip,useMemo:Ap,useReducer:sd,useRef:sp,useState:function(){return sd(Bi)},useDebugValue:rh,useDeferredValue:function(e){var g=Bt();return Ug===null?g.memoizedState=e:dp(g,Ug.memoizedState,e)},useTransition:function(){var e=sd(Bi)[0],g=Bt().memoizedState;return[e,g]},useMutableSource:gp,useSyncExternalStore:ep,useId:up,unstable_isNewReconciler:!1};function Rt(e,g){if(e&&e.defaultProps){g=Xg({},g),e=e.defaultProps;for(var t in e)g[t]===void 0&&(g[t]=e[t]);return g}return g}function cu(e,g,t,I){g=e.memoizedState,t=t(I,g),t=t==null?g:Xg({},g,t),e.memoizedState=t,e.lanes===0&&(e.updateQueue.baseState=t)}var Dc={isMounted:function(e){return(e=e._reactInternals)?pC(e)===e:!1},enqueueSetState:function(e,g,t){e=e._reactInternals;var I=fe(),n=On(e),l=DI(I,n);l.payload=g,t!=null&&(l.callback=t),g=jn(e,l,n),g!==null&&(Qt(g,e,n,I),Ao(g,e,n))},enqueueReplaceState:function(e,g,t){e=e._reactInternals;var I=fe(),n=On(e),l=DI(I,n);l.tag=1,l.payload=g,t!=null&&(l.callback=t),g=jn(e,l,n),g!==null&&(Qt(g,e,n,I),Ao(g,e,n))},enqueueForceUpdate:function(e,g){e=e._reactInternals;var t=fe(),I=On(e),n=DI(t,I);n.tag=2,g!=null&&(n.callback=g),g=jn(e,n,I),g!==null&&(Qt(g,e,I,t),Ao(g,e,I))}};function rb(e,g,t,I,n,l,C){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(I,l,C):g.prototype&&g.prototype.isPureReactComponent?!mi(t,I)||!mi(n,l):!0}function Zp(e,g,t){var I=!1,n=tl,l=g.contextType;return typeof l=="object"&&l!==null?l=pt(l):(n=He(g)?iC:de.current,I=g.contextTypes,l=(I=I!=null)?nr(e,n):tl),g=new g(t,l),e.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Dc,e.stateNode=g,g._reactInternals=e,I&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=l),g}function ib(e,g,t,I){e=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(t,I),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(t,I),g.state!==e&&Dc.enqueueReplaceState(g,g.state,null)}function Au(e,g,t,I){var n=e.stateNode;n.props=t,n.state=e.memoizedState,n.refs={},gh(e);var l=g.contextType;typeof l=="object"&&l!==null?n.context=pt(l):(l=He(g)?iC:de.current,n.context=nr(e,l)),n.state=e.memoizedState,l=g.getDerivedStateFromProps,typeof l=="function"&&(cu(e,g,l,t),n.state=e.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(g=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),g!==n.state&&Dc.enqueueReplaceState(n,n.state,null),ec(e,t,n,I),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function rr(e,g){try{var t="",I=g;do t+=MW(I),I=I.return;while(I);var n=t}catch(l){n=`
Error generating stack: `+l.message+`
`+l.stack}return{value:e,source:g,stack:n,digest:null}}function rd(e,g,t){return{value:e,source:null,stack:t??null,digest:g??null}}function du(e,g){try{console.error(g.value)}catch(t){setTimeout(function(){throw t})}}var ZR=typeof WeakMap=="function"?WeakMap:Map;function yp(e,g,t){t=DI(-1,t),t.tag=3,t.payload={element:null};var I=g.value;return t.callback=function(){Cc||(Cc=!0,fu=I),du(e,g)},t}function Gp(e,g,t){t=DI(-1,t),t.tag=3;var I=e.type.getDerivedStateFromError;if(typeof I=="function"){var n=g.value;t.payload=function(){return I(n)},t.callback=function(){du(e,g)}}var l=e.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(t.callback=function(){du(e,g),typeof I!="function"&&(Pn===null?Pn=new Set([this]):Pn.add(this));var C=g.stack;this.componentDidCatch(g.value,{componentStack:C!==null?C:""})}),t}function ab(e,g,t){var I=e.pingCache;if(I===null){I=e.pingCache=new ZR;var n=new Set;I.set(g,n)}else n=I.get(g),n===void 0&&(n=new Set,I.set(g,n));n.has(t)||(n.add(t),e=YR.bind(null,e,g,t),g.then(e,e))}function ob(e){do{var g;if((g=e.tag===13)&&(g=e.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return e;e=e.return}while(e!==null);return null}function cb(e,g,t,I,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===g?e.flags|=65536:(e.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(g=DI(-1,1),g.tag=2,jn(t,g,1))),t.lanes|=1),e)}var yR=ln.ReactCurrentOwner,ve=!1;function be(e,g,t,I){g.child=e===null?OG(g,null,t,I):Cr(g,e.child,t,I)}function Ab(e,g,t,I,n){t=t.render;var l=g.ref;return ls(g,n),I=lh(e,g,t,I,l,n),t=Ch(),e!==null&&!ve?(g.updateQueue=e.updateQueue,g.flags&=-2053,e.lanes&=~n,gn(e,g,n)):(fg&&t&&Dm(g),g.flags|=1,be(e,g,I,n),g.child)}function db(e,g,t,I,n){if(e===null){var l=t.type;return typeof l=="function"&&!mh(l)&&l.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(g.tag=15,g.type=l,pp(e,g,l,I,n)):(e=yo(t.type,null,I,g,g.mode,n),e.ref=g.ref,e.return=g,g.child=e)}if(l=e.child,!(e.lanes&n)){var C=l.memoizedProps;if(t=t.compare,t=t!==null?t:mi,t(C,I)&&e.ref===g.ref)return gn(e,g,n)}return g.flags|=1,e=qn(l,I),e.ref=g.ref,e.return=g,g.child=e}function pp(e,g,t,I,n){if(e!==null){var l=e.memoizedProps;if(mi(l,I)&&e.ref===g.ref)if(ve=!1,g.pendingProps=I=l,(e.lanes&n)!==0)e.flags&131072&&(ve=!0);else return g.lanes=e.lanes,gn(e,g,n)}return uu(e,g,t,I,n)}function Bp(e,g,t){var I=g.pendingProps,n=I.children,l=e!==null?e.memoizedState:null;if(I.mode==="hidden")if(!(g.mode&1))g.memoizedState={baseLanes:0,cachePool:null,transitions:null},bg(jC,Oe),Oe|=t;else{if(!(t&1073741824))return e=l!==null?l.baseLanes|t:t,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:e,cachePool:null,transitions:null},g.updateQueue=null,bg(jC,Oe),Oe|=e,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=l!==null?l.baseLanes:t,bg(jC,Oe),Oe|=I}else l!==null?(I=l.baseLanes|t,g.memoizedState=null):I=t,bg(jC,Oe),Oe|=I;return be(e,g,n,t),g.child}function fp(e,g){var t=g.ref;(e===null&&t!==null||e!==null&&e.ref!==t)&&(g.flags|=512,g.flags|=2097152)}function uu(e,g,t,I,n){var l=He(t)?iC:de.current;return l=nr(g,l),ls(g,n),t=lh(e,g,t,I,l,n),I=Ch(),e!==null&&!ve?(g.updateQueue=e.updateQueue,g.flags&=-2053,e.lanes&=~n,gn(e,g,n)):(fg&&I&&Dm(g),g.flags|=1,be(e,g,t,n),g.child)}function ub(e,g,t,I,n){if(He(t)){var l=!0;Oo(g)}else l=!1;if(ls(g,n),g.stateNode===null)ho(e,g),Zp(g,t,I),Au(g,t,I,n),I=!0;else if(e===null){var C=g.stateNode,s=g.memoizedProps;C.props=s;var r=C.context,a=t.contextType;typeof a=="object"&&a!==null?a=pt(a):(a=He(t)?iC:de.current,a=nr(g,a));var o=t.getDerivedStateFromProps,c=typeof o=="function"||typeof C.getSnapshotBeforeUpdate=="function";c||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(s!==I||r!==a)&&ib(g,C,I,a),hn=!1;var A=g.memoizedState;C.state=A,ec(g,I,C,n),r=g.memoizedState,s!==I||A!==r||Ne.current||hn?(typeof o=="function"&&(cu(g,t,o,I),r=g.memoizedState),(s=hn||rb(g,t,s,I,A,r,a))?(c||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(g.flags|=4194308)):(typeof C.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=I,g.memoizedState=r),C.props=I,C.state=r,C.context=a,I=s):(typeof C.componentDidMount=="function"&&(g.flags|=4194308),I=!1)}else{C=g.stateNode,_G(e,g),s=g.memoizedProps,a=g.type===g.elementType?s:Rt(g.type,s),C.props=a,c=g.pendingProps,A=C.context,r=t.contextType,typeof r=="object"&&r!==null?r=pt(r):(r=He(t)?iC:de.current,r=nr(g,r));var b=t.getDerivedStateFromProps;(o=typeof b=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(s!==c||A!==r)&&ib(g,C,I,r),hn=!1,A=g.memoizedState,C.state=A,ec(g,I,C,n);var m=g.memoizedState;s!==c||A!==m||Ne.current||hn?(typeof b=="function"&&(cu(g,t,b,I),m=g.memoizedState),(a=hn||rb(g,t,a,I,A,m,r)||!1)?(o||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(I,m,r),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(I,m,r)),typeof C.componentDidUpdate=="function"&&(g.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof C.componentDidUpdate!="function"||s===e.memoizedProps&&A===e.memoizedState||(g.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&A===e.memoizedState||(g.flags|=1024),g.memoizedProps=I,g.memoizedState=m),C.props=I,C.state=m,C.context=r,I=a):(typeof C.componentDidUpdate!="function"||s===e.memoizedProps&&A===e.memoizedState||(g.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&A===e.memoizedState||(g.flags|=1024),I=!1)}return mu(e,g,t,I,l,n)}function mu(e,g,t,I,n,l){fp(e,g);var C=(g.flags&128)!==0;if(!I&&!C)return n&&gb(g,t,!1),gn(e,g,l);I=g.stateNode,yR.current=g;var s=C&&typeof t.getDerivedStateFromError!="function"?null:I.render();return g.flags|=1,e!==null&&C?(g.child=Cr(g,e.child,null,l),g.child=Cr(g,null,s,l)):be(e,g,s,l),g.memoizedState=I.state,n&&gb(g,t,!0),g.child}function Vp(e){var g=e.stateNode;g.pendingContext?$0(e,g.pendingContext,g.pendingContext!==g.context):g.context&&$0(e,g.context,!1),eh(e,g.containerInfo)}function mb(e,g,t,I,n){return lr(),Pm(n),g.flags|=256,be(e,g,t,I),g.child}var hu={dehydrated:null,treeContext:null,retryLane:0};function bu(e){return{baseLanes:e,cachePool:null,transitions:null}}function Wp(e,g,t){var I=g.pendingProps,n=Wg.current,l=!1,C=(g.flags&128)!==0,s;if((s=C)||(s=e!==null&&e.memoizedState===null?!1:(n&2)!==0),s?(l=!0,g.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),bg(Wg,n&1),e===null)return au(g),e=g.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(g.mode&1?e.data==="$!"?g.lanes=8:g.lanes=1073741824:g.lanes=1,null):(C=I.children,e=I.fallback,l?(I=g.mode,l=g.child,C={mode:"hidden",children:C},!(I&1)&&l!==null?(l.childLanes=0,l.pendingProps=C):l=Oc(C,I,0,null),e=nC(e,I,t,null),l.return=g,e.return=g,l.sibling=e,g.child=l,g.child.memoizedState=bu(t),g.memoizedState=hu,e):ih(g,C));if(n=e.memoizedState,n!==null&&(s=n.dehydrated,s!==null))return GR(e,g,C,I,s,n,t);if(l){l=I.fallback,C=g.mode,n=e.child,s=n.sibling;var r={mode:"hidden",children:I.children};return!(C&1)&&g.child!==n?(I=g.child,I.childLanes=0,I.pendingProps=r,g.deletions=null):(I=qn(n,r),I.subtreeFlags=n.subtreeFlags&14680064),s!==null?l=qn(s,l):(l=nC(l,C,t,null),l.flags|=2),l.return=g,I.return=g,I.sibling=l,g.child=I,I=l,l=g.child,C=e.child.memoizedState,C=C===null?bu(t):{baseLanes:C.baseLanes|t,cachePool:null,transitions:C.transitions},l.memoizedState=C,l.childLanes=e.childLanes&~t,g.memoizedState=hu,I}return l=e.child,e=l.sibling,I=qn(l,{mode:"visible",children:I.children}),!(g.mode&1)&&(I.lanes=t),I.return=g,I.sibling=null,e!==null&&(t=g.deletions,t===null?(g.deletions=[e],g.flags|=16):t.push(e)),g.child=I,g.memoizedState=null,I}function ih(e,g){return g=Oc({mode:"visible",children:g},e.mode,0,null),g.return=e,e.child=g}function za(e,g,t,I){return I!==null&&Pm(I),Cr(g,e.child,null,t),e=ih(g,g.pendingProps.children),e.flags|=2,g.memoizedState=null,e}function GR(e,g,t,I,n,l,C){if(t)return g.flags&256?(g.flags&=-257,I=rd(Error(Q(422))),za(e,g,C,I)):g.memoizedState!==null?(g.child=e.child,g.flags|=128,null):(l=I.fallback,n=g.mode,I=Oc({mode:"visible",children:I.children},n,0,null),l=nC(l,n,C,null),l.flags|=2,I.return=g,l.return=g,I.sibling=l,g.child=I,g.mode&1&&Cr(g,e.child,null,C),g.child.memoizedState=bu(C),g.memoizedState=hu,l);if(!(g.mode&1))return za(e,g,C,null);if(n.data==="$!"){if(I=n.nextSibling&&n.nextSibling.dataset,I)var s=I.dgst;return I=s,l=Error(Q(419)),I=rd(l,I,void 0),za(e,g,C,I)}if(s=(C&e.childLanes)!==0,ve||s){if(I=jg,I!==null){switch(C&-C){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(I.suspendedLanes|C)?0:n,n!==0&&n!==l.retryLane&&(l.retryLane=n,$I(e,n),Qt(I,e,n,-1))}return uh(),I=rd(Error(Q(421))),za(e,g,C,I)}return n.data==="$?"?(g.flags|=128,g.child=e.child,g=vR.bind(null,e),n._reactRetry=g,null):(e=l.treeContext,_e=Dn(n.nextSibling),$e=g,fg=!0,xt=null,e!==null&&(bt[Zt++]=LI,bt[Zt++]=TI,bt[Zt++]=aC,LI=e.id,TI=e.overflow,aC=g),g=ih(g,I.children),g.flags|=4096,g)}function hb(e,g,t){e.lanes|=g;var I=e.alternate;I!==null&&(I.lanes|=g),ou(e.return,g,t)}function id(e,g,t,I,n){var l=e.memoizedState;l===null?e.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:I,tail:t,tailMode:n}:(l.isBackwards=g,l.rendering=null,l.renderingStartTime=0,l.last=I,l.tail=t,l.tailMode=n)}function Sp(e,g,t){var I=g.pendingProps,n=I.revealOrder,l=I.tail;if(be(e,g,I.children,t),I=Wg.current,I&2)I=I&1|2,g.flags|=128;else{if(e!==null&&e.flags&128)g:for(e=g.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&hb(e,t,g);else if(e.tag===19)hb(e,t,g);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===g)break g;for(;e.sibling===null;){if(e.return===null||e.return===g)break g;e=e.return}e.sibling.return=e.return,e=e.sibling}I&=1}if(bg(Wg,I),!(g.mode&1))g.memoizedState=null;else switch(n){case"forwards":for(t=g.child,n=null;t!==null;)e=t.alternate,e!==null&&tc(e)===null&&(n=t),t=t.sibling;t=n,t===null?(n=g.child,g.child=null):(n=t.sibling,t.sibling=null),id(g,!1,n,t,l);break;case"backwards":for(t=null,n=g.child,g.child=null;n!==null;){if(e=n.alternate,e!==null&&tc(e)===null){g.child=n;break}e=n.sibling,n.sibling=t,t=n,n=e}id(g,!0,t,null,l);break;case"together":id(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function ho(e,g){!(g.mode&1)&&e!==null&&(e.alternate=null,g.alternate=null,g.flags|=2)}function gn(e,g,t){if(e!==null&&(g.dependencies=e.dependencies),cC|=g.lanes,!(t&g.childLanes))return null;if(e!==null&&g.child!==e.child)throw Error(Q(153));if(g.child!==null){for(e=g.child,t=qn(e,e.pendingProps),g.child=t,t.return=g;e.sibling!==null;)e=e.sibling,t=t.sibling=qn(e,e.pendingProps),t.return=g;t.sibling=null}return g.child}function pR(e,g,t){switch(g.tag){case 3:Vp(g),lr();break;case 5:$G(g);break;case 1:He(g.type)&&Oo(g);break;case 4:eh(g,g.stateNode.containerInfo);break;case 10:var I=g.type._context,n=g.memoizedProps.value;bg($o,I._currentValue),I._currentValue=n;break;case 13:if(I=g.memoizedState,I!==null)return I.dehydrated!==null?(bg(Wg,Wg.current&1),g.flags|=128,null):t&g.child.childLanes?Wp(e,g,t):(bg(Wg,Wg.current&1),e=gn(e,g,t),e!==null?e.sibling:null);bg(Wg,Wg.current&1);break;case 19:if(I=(t&g.childLanes)!==0,e.flags&128){if(I)return Sp(e,g,t);g.flags|=128}if(n=g.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),bg(Wg,Wg.current),I)break;return null;case 22:case 23:return g.lanes=0,Bp(e,g,t)}return gn(e,g,t)}var Rp,Zu,kp,Xp;Rp=function(e,g){for(var t=g.child;t!==null;){if(t.tag===5||t.tag===6)e.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===g)break;for(;t.sibling===null;){if(t.return===null||t.return===g)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Zu=function(){};kp=function(e,g,t,I){var n=e.memoizedProps;if(n!==I){e=g.stateNode,kl(ZI.current);var l=null;switch(t){case"input":n=Ud(e,n),I=Ud(e,I),l=[];break;case"select":n=Xg({},n,{value:void 0}),I=Xg({},I,{value:void 0}),l=[];break;case"textarea":n=Ld(e,n),I=Ld(e,I),l=[];break;default:typeof n.onClick!="function"&&typeof I.onClick=="function"&&(e.onclick=jo)}Md(t,I);var C;t=null;for(a in n)if(!I.hasOwnProperty(a)&&n.hasOwnProperty(a)&&n[a]!=null)if(a==="style"){var s=n[a];for(C in s)s.hasOwnProperty(C)&&(t||(t={}),t[C]="")}else a!=="dangerouslySetInnerHTML"&&a!=="children"&&a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(ii.hasOwnProperty(a)?l||(l=[]):(l=l||[]).push(a,null));for(a in I){var r=I[a];if(s=n!=null?n[a]:void 0,I.hasOwnProperty(a)&&r!==s&&(r!=null||s!=null))if(a==="style")if(s){for(C in s)!s.hasOwnProperty(C)||r&&r.hasOwnProperty(C)||(t||(t={}),t[C]="");for(C in r)r.hasOwnProperty(C)&&s[C]!==r[C]&&(t||(t={}),t[C]=r[C])}else t||(l||(l=[]),l.push(a,t)),t=r;else a==="dangerouslySetInnerHTML"?(r=r?r.__html:void 0,s=s?s.__html:void 0,r!=null&&s!==r&&(l=l||[]).push(a,r)):a==="children"?typeof r!="string"&&typeof r!="number"||(l=l||[]).push(a,""+r):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&(ii.hasOwnProperty(a)?(r!=null&&a==="onScroll"&&yg("scroll",e),l||s===r||(l=[])):(l=l||[]).push(a,r))}t&&(l=l||[]).push("style",t);var a=l;(g.updateQueue=a)&&(g.flags|=4)}};Xp=function(e,g,t,I){t!==I&&(g.flags|=4)};function Fr(e,g){if(!fg)switch(e.tailMode){case"hidden":g=e.tail;for(var t=null;g!==null;)g.alternate!==null&&(t=g),g=g.sibling;t===null?e.tail=null:t.sibling=null;break;case"collapsed":t=e.tail;for(var I=null;t!==null;)t.alternate!==null&&(I=t),t=t.sibling;I===null?g||e.tail===null?e.tail=null:e.tail.sibling=null:I.sibling=null}}function se(e){var g=e.alternate!==null&&e.alternate.child===e.child,t=0,I=0;if(g)for(var n=e.child;n!==null;)t|=n.lanes|n.childLanes,I|=n.subtreeFlags&14680064,I|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)t|=n.lanes|n.childLanes,I|=n.subtreeFlags,I|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=I,e.childLanes=t,g}function BR(e,g,t){var I=g.pendingProps;switch(jm(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return se(g),null;case 1:return He(g.type)&&Po(),se(g),null;case 3:return I=g.stateNode,sr(),Gg(Ne),Gg(de),Ih(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(e===null||e.child===null)&&(Ea(g)?g.flags|=4:e===null||e.memoizedState.isDehydrated&&!(g.flags&256)||(g.flags|=1024,xt!==null&&(Su(xt),xt=null))),Zu(e,g),se(g),null;case 5:th(g);var n=kl(Gi.current);if(t=g.type,e!==null&&g.stateNode!=null)kp(e,g,t,I,n),e.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!I){if(g.stateNode===null)throw Error(Q(166));return se(g),null}if(e=kl(ZI.current),Ea(g)){I=g.stateNode,t=g.type;var l=g.memoizedProps;switch(I[aI]=g,I[Zi]=l,e=(g.mode&1)!==0,t){case"dialog":yg("cancel",I),yg("close",I);break;case"iframe":case"object":case"embed":yg("load",I);break;case"video":case"audio":for(n=0;n<Mr.length;n++)yg(Mr[n],I);break;case"source":yg("error",I);break;case"img":case"image":case"link":yg("error",I),yg("load",I);break;case"details":yg("toggle",I);break;case"input":W0(I,l),yg("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!l.multiple},yg("invalid",I);break;case"textarea":R0(I,l),yg("invalid",I)}Md(t,l),n=null;for(var C in l)if(l.hasOwnProperty(C)){var s=l[C];C==="children"?typeof s=="string"?I.textContent!==s&&(l.suppressHydrationWarning!==!0&&Ka(I.textContent,s,e),n=["children",s]):typeof s=="number"&&I.textContent!==""+s&&(l.suppressHydrationWarning!==!0&&Ka(I.textContent,s,e),n=["children",""+s]):ii.hasOwnProperty(C)&&s!=null&&C==="onScroll"&&yg("scroll",I)}switch(t){case"input":Ja(I),S0(I,l,!0);break;case"textarea":Ja(I),k0(I);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(I.onclick=jo)}I=n,g.updateQueue=I,I!==null&&(g.flags|=4)}else{C=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=nG(t)),e==="http://www.w3.org/1999/xhtml"?t==="script"?(e=C.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof I.is=="string"?e=C.createElement(t,{is:I.is}):(e=C.createElement(t),t==="select"&&(C=e,I.multiple?C.multiple=!0:I.size&&(C.size=I.size))):e=C.createElementNS(e,t),e[aI]=g,e[Zi]=I,Rp(e,g,!1,!1),g.stateNode=e;g:{switch(C=Dd(t,I),t){case"dialog":yg("cancel",e),yg("close",e),n=I;break;case"iframe":case"object":case"embed":yg("load",e),n=I;break;case"video":case"audio":for(n=0;n<Mr.length;n++)yg(Mr[n],e);n=I;break;case"source":yg("error",e),n=I;break;case"img":case"image":case"link":yg("error",e),yg("load",e),n=I;break;case"details":yg("toggle",e),n=I;break;case"input":W0(e,I),n=Ud(e,I),yg("invalid",e);break;case"option":n=I;break;case"select":e._wrapperState={wasMultiple:!!I.multiple},n=Xg({},I,{value:void 0}),yg("invalid",e);break;case"textarea":R0(e,I),n=Ld(e,I),yg("invalid",e);break;default:n=I}Md(t,n),s=n;for(l in s)if(s.hasOwnProperty(l)){var r=s[l];l==="style"?sG(e,r):l==="dangerouslySetInnerHTML"?(r=r?r.__html:void 0,r!=null&&lG(e,r)):l==="children"?typeof r=="string"?(t!=="textarea"||r!=="")&&ai(e,r):typeof r=="number"&&ai(e,""+r):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(ii.hasOwnProperty(l)?r!=null&&l==="onScroll"&&yg("scroll",e):r!=null&&Ym(e,l,r,C))}switch(t){case"input":Ja(e),S0(e,I,!1);break;case"textarea":Ja(e),k0(e);break;case"option":I.value!=null&&e.setAttribute("value",""+el(I.value));break;case"select":e.multiple=!!I.multiple,l=I.value,l!=null?es(e,!!I.multiple,l,!1):I.defaultValue!=null&&es(e,!!I.multiple,I.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=jo)}switch(t){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break g;case"img":I=!0;break g;default:I=!1}}I&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return se(g),null;case 6:if(e&&g.stateNode!=null)Xp(e,g,e.memoizedProps,I);else{if(typeof I!="string"&&g.stateNode===null)throw Error(Q(166));if(t=kl(Gi.current),kl(ZI.current),Ea(g)){if(I=g.stateNode,t=g.memoizedProps,I[aI]=g,(l=I.nodeValue!==t)&&(e=$e,e!==null))switch(e.tag){case 3:Ka(I.nodeValue,t,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ka(I.nodeValue,t,(e.mode&1)!==0)}l&&(g.flags|=4)}else I=(t.nodeType===9?t:t.ownerDocument).createTextNode(I),I[aI]=g,g.stateNode=I}return se(g),null;case 13:if(Gg(Wg),I=g.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(fg&&_e!==null&&g.mode&1&&!(g.flags&128))jG(),lr(),g.flags|=98560,l=!1;else if(l=Ea(g),I!==null&&I.dehydrated!==null){if(e===null){if(!l)throw Error(Q(318));if(l=g.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(Q(317));l[aI]=g}else lr(),!(g.flags&128)&&(g.memoizedState=null),g.flags|=4;se(g),l=!1}else xt!==null&&(Su(xt),xt=null),l=!0;if(!l)return g.flags&65536?g:null}return g.flags&128?(g.lanes=t,g):(I=I!==null,I!==(e!==null&&e.memoizedState!==null)&&I&&(g.child.flags|=8192,g.mode&1&&(e===null||Wg.current&1?zg===0&&(zg=3):uh())),g.updateQueue!==null&&(g.flags|=4),se(g),null);case 4:return sr(),Zu(e,g),e===null&&hi(g.stateNode.containerInfo),se(g),null;case 10:return _m(g.type._context),se(g),null;case 17:return He(g.type)&&Po(),se(g),null;case 19:if(Gg(Wg),l=g.memoizedState,l===null)return se(g),null;if(I=(g.flags&128)!==0,C=l.rendering,C===null)if(I)Fr(l,!1);else{if(zg!==0||e!==null&&e.flags&128)for(e=g.child;e!==null;){if(C=tc(e),C!==null){for(g.flags|=128,Fr(l,!1),I=C.updateQueue,I!==null&&(g.updateQueue=I,g.flags|=4),g.subtreeFlags=0,I=t,t=g.child;t!==null;)l=t,e=I,l.flags&=14680066,C=l.alternate,C===null?(l.childLanes=0,l.lanes=e,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=C.childLanes,l.lanes=C.lanes,l.child=C.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=C.memoizedProps,l.memoizedState=C.memoizedState,l.updateQueue=C.updateQueue,l.type=C.type,e=C.dependencies,l.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t=t.sibling;return bg(Wg,Wg.current&1|2),g.child}e=e.sibling}l.tail!==null&&vg()>ir&&(g.flags|=128,I=!0,Fr(l,!1),g.lanes=4194304)}else{if(!I)if(e=tc(C),e!==null){if(g.flags|=128,I=!0,t=e.updateQueue,t!==null&&(g.updateQueue=t,g.flags|=4),Fr(l,!0),l.tail===null&&l.tailMode==="hidden"&&!C.alternate&&!fg)return se(g),null}else 2*vg()-l.renderingStartTime>ir&&t!==1073741824&&(g.flags|=128,I=!0,Fr(l,!1),g.lanes=4194304);l.isBackwards?(C.sibling=g.child,g.child=C):(t=l.last,t!==null?t.sibling=C:g.child=C,l.last=C)}return l.tail!==null?(g=l.tail,l.rendering=g,l.tail=g.sibling,l.renderingStartTime=vg(),g.sibling=null,t=Wg.current,bg(Wg,I?t&1|2:t&1),g):(se(g),null);case 22:case 23:return dh(),I=g.memoizedState!==null,e!==null&&e.memoizedState!==null!==I&&(g.flags|=8192),I&&g.mode&1?Oe&1073741824&&(se(g),g.subtreeFlags&6&&(g.flags|=8192)):se(g),null;case 24:return null;case 25:return null}throw Error(Q(156,g.tag))}function fR(e,g){switch(jm(g),g.tag){case 1:return He(g.type)&&Po(),e=g.flags,e&65536?(g.flags=e&-65537|128,g):null;case 3:return sr(),Gg(Ne),Gg(de),Ih(),e=g.flags,e&65536&&!(e&128)?(g.flags=e&-65537|128,g):null;case 5:return th(g),null;case 13:if(Gg(Wg),e=g.memoizedState,e!==null&&e.dehydrated!==null){if(g.alternate===null)throw Error(Q(340));lr()}return e=g.flags,e&65536?(g.flags=e&-65537|128,g):null;case 19:return Gg(Wg),null;case 4:return sr(),null;case 10:return _m(g.type._context),null;case 22:case 23:return dh(),null;case 24:return null;default:return null}}var Qa=!1,oe=!1,VR=typeof WeakSet=="function"?WeakSet:Set,O=null;function DC(e,g){var t=e.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(I){Jg(e,g,I)}else t.current=null}function yu(e,g,t){try{t()}catch(I){Jg(e,g,I)}}var bb=!1;function WR(e,g){if(Iu=To,e=NG(),Mm(e)){if("selectionStart"in e)var t={start:e.selectionStart,end:e.selectionEnd};else g:{t=(t=e.ownerDocument)&&t.defaultView||window;var I=t.getSelection&&t.getSelection();if(I&&I.rangeCount!==0){t=I.anchorNode;var n=I.anchorOffset,l=I.focusNode;I=I.focusOffset;try{t.nodeType,l.nodeType}catch{t=null;break g}var C=0,s=-1,r=-1,a=0,o=0,c=e,A=null;e:for(;;){for(var b;c!==t||n!==0&&c.nodeType!==3||(s=C+n),c!==l||I!==0&&c.nodeType!==3||(r=C+I),c.nodeType===3&&(C+=c.nodeValue.length),(b=c.firstChild)!==null;)A=c,c=b;for(;;){if(c===e)break e;if(A===t&&++a===n&&(s=C),A===l&&++o===I&&(r=C),(b=c.nextSibling)!==null)break;c=A,A=c.parentNode}c=b}t=s===-1||r===-1?null:{start:s,end:r}}else t=null}t=t||{start:0,end:0}}else t=null;for(nu={focusedElem:e,selectionRange:t},To=!1,O=g;O!==null;)if(g=O,e=g.child,(g.subtreeFlags&1028)!==0&&e!==null)e.return=g,O=e;else for(;O!==null;){g=O;try{var m=g.alternate;if(g.flags&1024)switch(g.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var Z=m.memoizedProps,G=m.memoizedState,h=g.stateNode,u=h.getSnapshotBeforeUpdate(g.elementType===g.type?Z:Rt(g.type,Z),G);h.__reactInternalSnapshotBeforeUpdate=u}break;case 3:var y=g.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Q(163))}}catch(W){Jg(g,g.return,W)}if(e=g.sibling,e!==null){e.return=g.return,O=e;break}O=g.return}return m=bb,bb=!1,m}function ni(e,g,t){var I=g.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var n=I=I.next;do{if((n.tag&e)===e){var l=n.destroy;n.destroy=void 0,l!==void 0&&yu(g,t,l)}n=n.next}while(n!==I)}}function jc(e,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var t=g=g.next;do{if((t.tag&e)===e){var I=t.create;t.destroy=I()}t=t.next}while(t!==g)}}function Gu(e){var g=e.ref;if(g!==null){var t=e.stateNode;switch(e.tag){case 5:e=t;break;default:e=t}typeof g=="function"?g(e):g.current=e}}function Jp(e){var g=e.alternate;g!==null&&(e.alternate=null,Jp(g)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(g=e.stateNode,g!==null&&(delete g[aI],delete g[Zi],delete g[su],delete g[rR],delete g[iR])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function wp(e){return e.tag===5||e.tag===3||e.tag===4}function Zb(e){g:for(;;){for(;e.sibling===null;){if(e.return===null||wp(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue g;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function pu(e,g,t){var I=e.tag;if(I===5||I===6)e=e.stateNode,g?t.nodeType===8?t.parentNode.insertBefore(e,g):t.insertBefore(e,g):(t.nodeType===8?(g=t.parentNode,g.insertBefore(e,t)):(g=t,g.appendChild(e)),t=t._reactRootContainer,t!=null||g.onclick!==null||(g.onclick=jo));else if(I!==4&&(e=e.child,e!==null))for(pu(e,g,t),e=e.sibling;e!==null;)pu(e,g,t),e=e.sibling}function Bu(e,g,t){var I=e.tag;if(I===5||I===6)e=e.stateNode,g?t.insertBefore(e,g):t.appendChild(e);else if(I!==4&&(e=e.child,e!==null))for(Bu(e,g,t),e=e.sibling;e!==null;)Bu(e,g,t),e=e.sibling}var _g=null,Ft=!1;function rn(e,g,t){for(t=t.child;t!==null;)Yp(e,g,t),t=t.sibling}function Yp(e,g,t){if(bI&&typeof bI.onCommitFiberUnmount=="function")try{bI.onCommitFiberUnmount(Ec,t)}catch{}switch(t.tag){case 5:oe||DC(t,g);case 6:var I=_g,n=Ft;_g=null,rn(e,g,t),_g=I,Ft=n,_g!==null&&(Ft?(e=_g,t=t.stateNode,e.nodeType===8?e.parentNode.removeChild(t):e.removeChild(t)):_g.removeChild(t.stateNode));break;case 18:_g!==null&&(Ft?(e=_g,t=t.stateNode,e.nodeType===8?td(e.parentNode,t):e.nodeType===1&&td(e,t),di(e)):td(_g,t.stateNode));break;case 4:I=_g,n=Ft,_g=t.stateNode.containerInfo,Ft=!0,rn(e,g,t),_g=I,Ft=n;break;case 0:case 11:case 14:case 15:if(!oe&&(I=t.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){n=I=I.next;do{var l=n,C=l.destroy;l=l.tag,C!==void 0&&(l&2||l&4)&&yu(t,g,C),n=n.next}while(n!==I)}rn(e,g,t);break;case 1:if(!oe&&(DC(t,g),I=t.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=t.memoizedProps,I.state=t.memoizedState,I.componentWillUnmount()}catch(s){Jg(t,g,s)}rn(e,g,t);break;case 21:rn(e,g,t);break;case 22:t.mode&1?(oe=(I=oe)||t.memoizedState!==null,rn(e,g,t),oe=I):rn(e,g,t);break;default:rn(e,g,t)}}function yb(e){var g=e.updateQueue;if(g!==null){e.updateQueue=null;var t=e.stateNode;t===null&&(t=e.stateNode=new VR),g.forEach(function(I){var n=NR.bind(null,e,I);t.has(I)||(t.add(I),I.then(n,n))})}}function Wt(e,g){var t=g.deletions;if(t!==null)for(var I=0;I<t.length;I++){var n=t[I];try{var l=e,C=g,s=C;g:for(;s!==null;){switch(s.tag){case 5:_g=s.stateNode,Ft=!1;break g;case 3:_g=s.stateNode.containerInfo,Ft=!0;break g;case 4:_g=s.stateNode.containerInfo,Ft=!0;break g}s=s.return}if(_g===null)throw Error(Q(160));Yp(l,C,n),_g=null,Ft=!1;var r=n.alternate;r!==null&&(r.return=null),n.return=null}catch(a){Jg(n,g,a)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)vp(g,e),g=g.sibling}function vp(e,g){var t=e.alternate,I=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Wt(g,e),Ot(e),I&4){try{ni(3,e,e.return),jc(3,e)}catch(Z){Jg(e,e.return,Z)}try{ni(5,e,e.return)}catch(Z){Jg(e,e.return,Z)}}break;case 1:Wt(g,e),Ot(e),I&512&&t!==null&&DC(t,t.return);break;case 5:if(Wt(g,e),Ot(e),I&512&&t!==null&&DC(t,t.return),e.flags&32){var n=e.stateNode;try{ai(n,"")}catch(Z){Jg(e,e.return,Z)}}if(I&4&&(n=e.stateNode,n!=null)){var l=e.memoizedProps,C=t!==null?t.memoizedProps:l,s=e.type,r=e.updateQueue;if(e.updateQueue=null,r!==null)try{s==="input"&&l.type==="radio"&&l.name!=null&&tG(n,l),Dd(s,C);var a=Dd(s,l);for(C=0;C<r.length;C+=2){var o=r[C],c=r[C+1];o==="style"?sG(n,c):o==="dangerouslySetInnerHTML"?lG(n,c):o==="children"?ai(n,c):Ym(n,o,c,a)}switch(s){case"input":zd(n,l);break;case"textarea":IG(n,l);break;case"select":var A=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!l.multiple;var b=l.value;b!=null?es(n,!!l.multiple,b,!1):A!==!!l.multiple&&(l.defaultValue!=null?es(n,!!l.multiple,l.defaultValue,!0):es(n,!!l.multiple,l.multiple?[]:"",!1))}n[Zi]=l}catch(Z){Jg(e,e.return,Z)}}break;case 6:if(Wt(g,e),Ot(e),I&4){if(e.stateNode===null)throw Error(Q(162));n=e.stateNode,l=e.memoizedProps;try{n.nodeValue=l}catch(Z){Jg(e,e.return,Z)}}break;case 3:if(Wt(g,e),Ot(e),I&4&&t!==null&&t.memoizedState.isDehydrated)try{di(g.containerInfo)}catch(Z){Jg(e,e.return,Z)}break;case 4:Wt(g,e),Ot(e);break;case 13:Wt(g,e),Ot(e),n=e.child,n.flags&8192&&(l=n.memoizedState!==null,n.stateNode.isHidden=l,!l||n.alternate!==null&&n.alternate.memoizedState!==null||(ch=vg())),I&4&&yb(e);break;case 22:if(o=t!==null&&t.memoizedState!==null,e.mode&1?(oe=(a=oe)||o,Wt(g,e),oe=a):Wt(g,e),Ot(e),I&8192){if(a=e.memoizedState!==null,(e.stateNode.isHidden=a)&&!o&&e.mode&1)for(O=e,o=e.child;o!==null;){for(c=O=o;O!==null;){switch(A=O,b=A.child,A.tag){case 0:case 11:case 14:case 15:ni(4,A,A.return);break;case 1:DC(A,A.return);var m=A.stateNode;if(typeof m.componentWillUnmount=="function"){I=A,t=A.return;try{g=I,m.props=g.memoizedProps,m.state=g.memoizedState,m.componentWillUnmount()}catch(Z){Jg(I,t,Z)}}break;case 5:DC(A,A.return);break;case 22:if(A.memoizedState!==null){pb(c);continue}}b!==null?(b.return=A,O=b):pb(c)}o=o.sibling}g:for(o=null,c=e;;){if(c.tag===5){if(o===null){o=c;try{n=c.stateNode,a?(l=n.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(s=c.stateNode,r=c.memoizedProps.style,C=r!=null&&r.hasOwnProperty("display")?r.display:null,s.style.display=CG("display",C))}catch(Z){Jg(e,e.return,Z)}}}else if(c.tag===6){if(o===null)try{c.stateNode.nodeValue=a?"":c.memoizedProps}catch(Z){Jg(e,e.return,Z)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===e)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===e)break g;for(;c.sibling===null;){if(c.return===null||c.return===e)break g;o===c&&(o=null),c=c.return}o===c&&(o=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:Wt(g,e),Ot(e),I&4&&yb(e);break;case 21:break;default:Wt(g,e),Ot(e)}}function Ot(e){var g=e.flags;if(g&2){try{g:{for(var t=e.return;t!==null;){if(wp(t)){var I=t;break g}t=t.return}throw Error(Q(160))}switch(I.tag){case 5:var n=I.stateNode;I.flags&32&&(ai(n,""),I.flags&=-33);var l=Zb(e);Bu(e,l,n);break;case 3:case 4:var C=I.stateNode.containerInfo,s=Zb(e);pu(e,s,C);break;default:throw Error(Q(161))}}catch(r){Jg(e,e.return,r)}e.flags&=-3}g&4096&&(e.flags&=-4097)}function SR(e,g,t){O=e,Np(e)}function Np(e,g,t){for(var I=(e.mode&1)!==0;O!==null;){var n=O,l=n.child;if(n.tag===22&&I){var C=n.memoizedState!==null||Qa;if(!C){var s=n.alternate,r=s!==null&&s.memoizedState!==null||oe;s=Qa;var a=oe;if(Qa=C,(oe=r)&&!a)for(O=n;O!==null;)C=O,r=C.child,C.tag===22&&C.memoizedState!==null?Bb(n):r!==null?(r.return=C,O=r):Bb(n);for(;l!==null;)O=l,Np(l),l=l.sibling;O=n,Qa=s,oe=a}Gb(e)}else n.subtreeFlags&8772&&l!==null?(l.return=n,O=l):Gb(e)}}function Gb(e){for(;O!==null;){var g=O;if(g.flags&8772){var t=g.alternate;try{if(g.flags&8772)switch(g.tag){case 0:case 11:case 15:oe||jc(5,g);break;case 1:var I=g.stateNode;if(g.flags&4&&!oe)if(t===null)I.componentDidMount();else{var n=g.elementType===g.type?t.memoizedProps:Rt(g.type,t.memoizedProps);I.componentDidUpdate(n,t.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var l=g.updateQueue;l!==null&&lb(g,l,I);break;case 3:var C=g.updateQueue;if(C!==null){if(t=null,g.child!==null)switch(g.child.tag){case 5:t=g.child.stateNode;break;case 1:t=g.child.stateNode}lb(g,C,t)}break;case 5:var s=g.stateNode;if(t===null&&g.flags&4){t=s;var r=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":r.autoFocus&&t.focus();break;case"img":r.src&&(t.src=r.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var a=g.alternate;if(a!==null){var o=a.memoizedState;if(o!==null){var c=o.dehydrated;c!==null&&di(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Q(163))}oe||g.flags&512&&Gu(g)}catch(A){Jg(g,g.return,A)}}if(g===e){O=null;break}if(t=g.sibling,t!==null){t.return=g.return,O=t;break}O=g.return}}function pb(e){for(;O!==null;){var g=O;if(g===e){O=null;break}var t=g.sibling;if(t!==null){t.return=g.return,O=t;break}O=g.return}}function Bb(e){for(;O!==null;){var g=O;try{switch(g.tag){case 0:case 11:case 15:var t=g.return;try{jc(4,g)}catch(r){Jg(g,t,r)}break;case 1:var I=g.stateNode;if(typeof I.componentDidMount=="function"){var n=g.return;try{I.componentDidMount()}catch(r){Jg(g,n,r)}}var l=g.return;try{Gu(g)}catch(r){Jg(g,l,r)}break;case 5:var C=g.return;try{Gu(g)}catch(r){Jg(g,C,r)}}}catch(r){Jg(g,g.return,r)}if(g===e){O=null;break}var s=g.sibling;if(s!==null){s.return=g.return,O=s;break}O=g.return}}var RR=Math.ceil,lc=ln.ReactCurrentDispatcher,ah=ln.ReactCurrentOwner,Gt=ln.ReactCurrentBatchConfig,og=0,jg=null,xg=null,Ie=0,Oe=0,jC=Cl(0),zg=0,Vi=null,cC=0,Pc=0,oh=0,li=null,we=null,ch=0,ir=1/0,WI=null,Cc=!1,fu=null,Pn=null,La=!1,Un=null,sc=0,Ci=0,Vu=null,bo=-1,Zo=0;function fe(){return og&6?vg():bo!==-1?bo:bo=vg()}function On(e){return e.mode&1?og&2&&Ie!==0?Ie&-Ie:oR.transition!==null?(Zo===0&&(Zo=ZG()),Zo):(e=Ag,e!==0||(e=window.event,e=e===void 0?16:WG(e.type)),e):1}function Qt(e,g,t,I){if(50<Ci)throw Ci=0,Vu=null,Error(Q(185));da(e,t,I),(!(og&2)||e!==jg)&&(e===jg&&(!(og&2)&&(Pc|=t),zg===4&&yn(e,Ie)),Fe(e,I),t===1&&og===0&&!(g.mode&1)&&(ir=vg()+500,Tc&&sl()))}function Fe(e,g){var t=e.callbackNode;oS(e,g);var I=Lo(e,e===jg?Ie:0);if(I===0)t!==null&&w0(t),e.callbackNode=null,e.callbackPriority=0;else if(g=I&-I,e.callbackPriority!==g){if(t!=null&&w0(t),g===1)e.tag===0?aR(fb.bind(null,e)):TG(fb.bind(null,e)),CR(function(){!(og&6)&&sl()}),t=null;else{switch(yG(I)){case 1:t=xm;break;case 4:t=hG;break;case 16:t=Qo;break;case 536870912:t=bG;break;default:t=Qo}t=Qp(t,Hp.bind(null,e))}e.callbackPriority=g,e.callbackNode=t}}function Hp(e,g){if(bo=-1,Zo=0,og&6)throw Error(Q(327));var t=e.callbackNode;if(Cs()&&e.callbackNode!==t)return null;var I=Lo(e,e===jg?Ie:0);if(I===0)return null;if(I&30||I&e.expiredLanes||g)g=rc(e,I);else{g=I;var n=og;og|=2;var l=xp();(jg!==e||Ie!==g)&&(WI=null,ir=vg()+500,IC(e,g));do try{JR();break}catch(s){Fp(e,s)}while(1);qm(),lc.current=l,og=n,xg!==null?g=0:(jg=null,Ie=0,g=zg)}if(g!==0){if(g===2&&(n=_d(e),n!==0&&(I=n,g=Wu(e,n))),g===1)throw t=Vi,IC(e,0),yn(e,I),Fe(e,vg()),t;if(g===6)yn(e,I);else{if(n=e.current.alternate,!(I&30)&&!kR(n)&&(g=rc(e,I),g===2&&(l=_d(e),l!==0&&(I=l,g=Wu(e,l))),g===1))throw t=Vi,IC(e,0),yn(e,I),Fe(e,vg()),t;switch(e.finishedWork=n,e.finishedLanes=I,g){case 0:case 1:throw Error(Q(345));case 2:Zl(e,we,WI);break;case 3:if(yn(e,I),(I&130023424)===I&&(g=ch+500-vg(),10<g)){if(Lo(e,0)!==0)break;if(n=e.suspendedLanes,(n&I)!==I){fe(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=Cu(Zl.bind(null,e,we,WI),g);break}Zl(e,we,WI);break;case 4:if(yn(e,I),(I&4194240)===I)break;for(g=e.eventTimes,n=-1;0<I;){var C=31-zt(I);l=1<<C,C=g[C],C>n&&(n=C),I&=~l}if(I=n,I=vg()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*RR(I/1960))-I,10<I){e.timeoutHandle=Cu(Zl.bind(null,e,we,WI),I);break}Zl(e,we,WI);break;case 5:Zl(e,we,WI);break;default:throw Error(Q(329))}}}return Fe(e,vg()),e.callbackNode===t?Hp.bind(null,e):null}function Wu(e,g){var t=li;return e.current.memoizedState.isDehydrated&&(IC(e,g).flags|=256),e=rc(e,g),e!==2&&(g=we,we=t,g!==null&&Su(g)),e}function Su(e){we===null?we=e:we.push.apply(we,e)}function kR(e){for(var g=e;;){if(g.flags&16384){var t=g.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var I=0;I<t.length;I++){var n=t[I],l=n.getSnapshot;n=n.value;try{if(!Mt(l(),n))return!1}catch{return!1}}}if(t=g.child,g.subtreeFlags&16384&&t!==null)t.return=g,g=t;else{if(g===e)break;for(;g.sibling===null;){if(g.return===null||g.return===e)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function yn(e,g){for(g&=~oh,g&=~Pc,e.suspendedLanes|=g,e.pingedLanes&=~g,e=e.expirationTimes;0<g;){var t=31-zt(g),I=1<<t;e[t]=-1,g&=~I}}function fb(e){if(og&6)throw Error(Q(327));Cs();var g=Lo(e,0);if(!(g&1))return Fe(e,vg()),null;var t=rc(e,g);if(e.tag!==0&&t===2){var I=_d(e);I!==0&&(g=I,t=Wu(e,I))}if(t===1)throw t=Vi,IC(e,0),yn(e,g),Fe(e,vg()),t;if(t===6)throw Error(Q(345));return e.finishedWork=e.current.alternate,e.finishedLanes=g,Zl(e,we,WI),Fe(e,vg()),null}function Ah(e,g){var t=og;og|=1;try{return e(g)}finally{og=t,og===0&&(ir=vg()+500,Tc&&sl())}}function AC(e){Un!==null&&Un.tag===0&&!(og&6)&&Cs();var g=og;og|=1;var t=Gt.transition,I=Ag;try{if(Gt.transition=null,Ag=1,e)return e()}finally{Ag=I,Gt.transition=t,og=g,!(og&6)&&sl()}}function dh(){Oe=jC.current,Gg(jC)}function IC(e,g){e.finishedWork=null,e.finishedLanes=0;var t=e.timeoutHandle;if(t!==-1&&(e.timeoutHandle=-1,lR(t)),xg!==null)for(t=xg.return;t!==null;){var I=t;switch(jm(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&Po();break;case 3:sr(),Gg(Ne),Gg(de),Ih();break;case 5:th(I);break;case 4:sr();break;case 13:Gg(Wg);break;case 19:Gg(Wg);break;case 10:_m(I.type._context);break;case 22:case 23:dh()}t=t.return}if(jg=e,xg=e=qn(e.current,null),Ie=Oe=g,zg=0,Vi=null,oh=Pc=cC=0,we=li=null,Rl!==null){for(g=0;g<Rl.length;g++)if(t=Rl[g],I=t.interleaved,I!==null){t.interleaved=null;var n=I.next,l=t.pending;if(l!==null){var C=l.next;l.next=n,I.next=C}t.pending=I}Rl=null}return e}function Fp(e,g){do{var t=xg;try{if(qm(),uo.current=nc,Ic){for(var I=kg.memoizedState;I!==null;){var n=I.queue;n!==null&&(n.pending=null),I=I.next}Ic=!1}if(oC=0,Lg=Ug=kg=null,Ii=!1,pi=0,ah.current=null,t===null||t.return===null){zg=1,Vi=g,xg=null;break}g:{var l=e,C=t.return,s=t,r=g;if(g=Ie,s.flags|=32768,r!==null&&typeof r=="object"&&typeof r.then=="function"){var a=r,o=s,c=o.tag;if(!(o.mode&1)&&(c===0||c===11||c===15)){var A=o.alternate;A?(o.updateQueue=A.updateQueue,o.memoizedState=A.memoizedState,o.lanes=A.lanes):(o.updateQueue=null,o.memoizedState=null)}var b=ob(C);if(b!==null){b.flags&=-257,cb(b,C,s,l,g),b.mode&1&&ab(l,a,g),g=b,r=a;var m=g.updateQueue;if(m===null){var Z=new Set;Z.add(r),g.updateQueue=Z}else m.add(r);break g}else{if(!(g&1)){ab(l,a,g),uh();break g}r=Error(Q(426))}}else if(fg&&s.mode&1){var G=ob(C);if(G!==null){!(G.flags&65536)&&(G.flags|=256),cb(G,C,s,l,g),Pm(rr(r,s));break g}}l=r=rr(r,s),zg!==4&&(zg=2),li===null?li=[l]:li.push(l),l=C;do{switch(l.tag){case 3:l.flags|=65536,g&=-g,l.lanes|=g;var h=yp(l,r,g);nb(l,h);break g;case 1:s=r;var u=l.type,y=l.stateNode;if(!(l.flags&128)&&(typeof u.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Pn===null||!Pn.has(y)))){l.flags|=65536,g&=-g,l.lanes|=g;var W=Gp(l,s,g);nb(l,W);break g}}l=l.return}while(l!==null)}Ep(t)}catch(S){g=S,xg===t&&t!==null&&(xg=t=t.return);continue}break}while(1)}function xp(){var e=lc.current;return lc.current=nc,e===null?nc:e}function uh(){(zg===0||zg===3||zg===2)&&(zg=4),jg===null||!(cC&268435455)&&!(Pc&268435455)||yn(jg,Ie)}function rc(e,g){var t=og;og|=2;var I=xp();(jg!==e||Ie!==g)&&(WI=null,IC(e,g));do try{XR();break}catch(n){Fp(e,n)}while(1);if(qm(),og=t,lc.current=I,xg!==null)throw Error(Q(261));return jg=null,Ie=0,zg}function XR(){for(;xg!==null;)Kp(xg)}function JR(){for(;xg!==null&&!tS();)Kp(xg)}function Kp(e){var g=zp(e.alternate,e,Oe);e.memoizedProps=e.pendingProps,g===null?Ep(e):xg=g,ah.current=null}function Ep(e){var g=e;do{var t=g.alternate;if(e=g.return,g.flags&32768){if(t=fR(t,g),t!==null){t.flags&=32767,xg=t;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{zg=6,xg=null;return}}else if(t=BR(t,g,Oe),t!==null){xg=t;return}if(g=g.sibling,g!==null){xg=g;return}xg=g=e}while(g!==null);zg===0&&(zg=5)}function Zl(e,g,t){var I=Ag,n=Gt.transition;try{Gt.transition=null,Ag=1,wR(e,g,t,I)}finally{Gt.transition=n,Ag=I}return null}function wR(e,g,t,I){do Cs();while(Un!==null);if(og&6)throw Error(Q(327));t=e.finishedWork;var n=e.finishedLanes;if(t===null)return null;if(e.finishedWork=null,e.finishedLanes=0,t===e.current)throw Error(Q(177));e.callbackNode=null,e.callbackPriority=0;var l=t.lanes|t.childLanes;if(cS(e,l),e===jg&&(xg=jg=null,Ie=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||La||(La=!0,Qp(Qo,function(){return Cs(),null})),l=(t.flags&15990)!==0,t.subtreeFlags&15990||l){l=Gt.transition,Gt.transition=null;var C=Ag;Ag=1;var s=og;og|=4,ah.current=null,WR(e,t),vp(t,e),_S(nu),To=!!Iu,nu=Iu=null,e.current=t,SR(t),IS(),og=s,Ag=C,Gt.transition=l}else e.current=t;if(La&&(La=!1,Un=e,sc=n),l=e.pendingLanes,l===0&&(Pn=null),CS(t.stateNode),Fe(e,vg()),g!==null)for(I=e.onRecoverableError,t=0;t<g.length;t++)n=g[t],I(n.value,{componentStack:n.stack,digest:n.digest});if(Cc)throw Cc=!1,e=fu,fu=null,e;return sc&1&&e.tag!==0&&Cs(),l=e.pendingLanes,l&1?e===Vu?Ci++:(Ci=0,Vu=e):Ci=0,sl(),null}function Cs(){if(Un!==null){var e=yG(sc),g=Gt.transition,t=Ag;try{if(Gt.transition=null,Ag=16>e?16:e,Un===null)var I=!1;else{if(e=Un,Un=null,sc=0,og&6)throw Error(Q(331));var n=og;for(og|=4,O=e.current;O!==null;){var l=O,C=l.child;if(O.flags&16){var s=l.deletions;if(s!==null){for(var r=0;r<s.length;r++){var a=s[r];for(O=a;O!==null;){var o=O;switch(o.tag){case 0:case 11:case 15:ni(8,o,l)}var c=o.child;if(c!==null)c.return=o,O=c;else for(;O!==null;){o=O;var A=o.sibling,b=o.return;if(Jp(o),o===a){O=null;break}if(A!==null){A.return=b,O=A;break}O=b}}}var m=l.alternate;if(m!==null){var Z=m.child;if(Z!==null){m.child=null;do{var G=Z.sibling;Z.sibling=null,Z=G}while(Z!==null)}}O=l}}if(l.subtreeFlags&2064&&C!==null)C.return=l,O=C;else g:for(;O!==null;){if(l=O,l.flags&2048)switch(l.tag){case 0:case 11:case 15:ni(9,l,l.return)}var h=l.sibling;if(h!==null){h.return=l.return,O=h;break g}O=l.return}}var u=e.current;for(O=u;O!==null;){C=O;var y=C.child;if(C.subtreeFlags&2064&&y!==null)y.return=C,O=y;else g:for(C=u;O!==null;){if(s=O,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:jc(9,s)}}catch(S){Jg(s,s.return,S)}if(s===C){O=null;break g}var W=s.sibling;if(W!==null){W.return=s.return,O=W;break g}O=s.return}}if(og=n,sl(),bI&&typeof bI.onPostCommitFiberRoot=="function")try{bI.onPostCommitFiberRoot(Ec,e)}catch{}I=!0}return I}finally{Ag=t,Gt.transition=g}}return!1}function Vb(e,g,t){g=rr(t,g),g=yp(e,g,1),e=jn(e,g,1),g=fe(),e!==null&&(da(e,1,g),Fe(e,g))}function Jg(e,g,t){if(e.tag===3)Vb(e,e,t);else for(;g!==null;){if(g.tag===3){Vb(g,e,t);break}else if(g.tag===1){var I=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Pn===null||!Pn.has(I))){e=rr(t,e),e=Gp(g,e,1),g=jn(g,e,1),e=fe(),g!==null&&(da(g,1,e),Fe(g,e));break}}g=g.return}}function YR(e,g,t){var I=e.pingCache;I!==null&&I.delete(g),g=fe(),e.pingedLanes|=e.suspendedLanes&t,jg===e&&(Ie&t)===t&&(zg===4||zg===3&&(Ie&130023424)===Ie&&500>vg()-ch?IC(e,0):oh|=t),Fe(e,g)}function Up(e,g){g===0&&(e.mode&1?(g=va,va<<=1,!(va&130023424)&&(va=4194304)):g=1);var t=fe();e=$I(e,g),e!==null&&(da(e,g,t),Fe(e,t))}function vR(e){var g=e.memoizedState,t=0;g!==null&&(t=g.retryLane),Up(e,t)}function NR(e,g){var t=0;switch(e.tag){case 13:var I=e.stateNode,n=e.memoizedState;n!==null&&(t=n.retryLane);break;case 19:I=e.stateNode;break;default:throw Error(Q(314))}I!==null&&I.delete(g),Up(e,t)}var zp;zp=function(e,g,t){if(e!==null)if(e.memoizedProps!==g.pendingProps||Ne.current)ve=!0;else{if(!(e.lanes&t)&&!(g.flags&128))return ve=!1,pR(e,g,t);ve=!!(e.flags&131072)}else ve=!1,fg&&g.flags&1048576&&MG(g,_o,g.index);switch(g.lanes=0,g.tag){case 2:var I=g.type;ho(e,g),e=g.pendingProps;var n=nr(g,de.current);ls(g,t),n=lh(null,g,I,e,n,t);var l=Ch();return g.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,He(I)?(l=!0,Oo(g)):l=!1,g.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,gh(g),n.updater=Dc,g.stateNode=n,n._reactInternals=g,Au(g,I,e,t),g=mu(null,g,I,!0,l,t)):(g.tag=0,fg&&l&&Dm(g),be(null,g,n,t),g=g.child),g;case 16:I=g.elementType;g:{switch(ho(e,g),e=g.pendingProps,n=I._init,I=n(I._payload),g.type=I,n=g.tag=FR(I),e=Rt(I,e),n){case 0:g=uu(null,g,I,e,t);break g;case 1:g=ub(null,g,I,e,t);break g;case 11:g=Ab(null,g,I,e,t);break g;case 14:g=db(null,g,I,Rt(I.type,e),t);break g}throw Error(Q(306,I,""))}return g;case 0:return I=g.type,n=g.pendingProps,n=g.elementType===I?n:Rt(I,n),uu(e,g,I,n,t);case 1:return I=g.type,n=g.pendingProps,n=g.elementType===I?n:Rt(I,n),ub(e,g,I,n,t);case 3:g:{if(Vp(g),e===null)throw Error(Q(387));I=g.pendingProps,l=g.memoizedState,n=l.element,_G(e,g),ec(g,I,null,t);var C=g.memoizedState;if(I=C.element,l.isDehydrated)if(l={element:I,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},g.updateQueue.baseState=l,g.memoizedState=l,g.flags&256){n=rr(Error(Q(423)),g),g=mb(e,g,I,t,n);break g}else if(I!==n){n=rr(Error(Q(424)),g),g=mb(e,g,I,t,n);break g}else for(_e=Dn(g.stateNode.containerInfo.firstChild),$e=g,fg=!0,xt=null,t=OG(g,null,I,t),g.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(lr(),I===n){g=gn(e,g,t);break g}be(e,g,I,t)}g=g.child}return g;case 5:return $G(g),e===null&&au(g),I=g.type,n=g.pendingProps,l=e!==null?e.memoizedProps:null,C=n.children,lu(I,n)?C=null:l!==null&&lu(I,l)&&(g.flags|=32),fp(e,g),be(e,g,C,t),g.child;case 6:return e===null&&au(g),null;case 13:return Wp(e,g,t);case 4:return eh(g,g.stateNode.containerInfo),I=g.pendingProps,e===null?g.child=Cr(g,null,I,t):be(e,g,I,t),g.child;case 11:return I=g.type,n=g.pendingProps,n=g.elementType===I?n:Rt(I,n),Ab(e,g,I,n,t);case 7:return be(e,g,g.pendingProps,t),g.child;case 8:return be(e,g,g.pendingProps.children,t),g.child;case 12:return be(e,g,g.pendingProps.children,t),g.child;case 10:g:{if(I=g.type._context,n=g.pendingProps,l=g.memoizedProps,C=n.value,bg($o,I._currentValue),I._currentValue=C,l!==null)if(Mt(l.value,C)){if(l.children===n.children&&!Ne.current){g=gn(e,g,t);break g}}else for(l=g.child,l!==null&&(l.return=g);l!==null;){var s=l.dependencies;if(s!==null){C=l.child;for(var r=s.firstContext;r!==null;){if(r.context===I){if(l.tag===1){r=DI(-1,t&-t),r.tag=2;var a=l.updateQueue;if(a!==null){a=a.shared;var o=a.pending;o===null?r.next=r:(r.next=o.next,o.next=r),a.pending=r}}l.lanes|=t,r=l.alternate,r!==null&&(r.lanes|=t),ou(l.return,t,g),s.lanes|=t;break}r=r.next}}else if(l.tag===10)C=l.type===g.type?null:l.child;else if(l.tag===18){if(C=l.return,C===null)throw Error(Q(341));C.lanes|=t,s=C.alternate,s!==null&&(s.lanes|=t),ou(C,t,g),C=l.sibling}else C=l.child;if(C!==null)C.return=l;else for(C=l;C!==null;){if(C===g){C=null;break}if(l=C.sibling,l!==null){l.return=C.return,C=l;break}C=C.return}l=C}be(e,g,n.children,t),g=g.child}return g;case 9:return n=g.type,I=g.pendingProps.children,ls(g,t),n=pt(n),I=I(n),g.flags|=1,be(e,g,I,t),g.child;case 14:return I=g.type,n=Rt(I,g.pendingProps),n=Rt(I.type,n),db(e,g,I,n,t);case 15:return pp(e,g,g.type,g.pendingProps,t);case 17:return I=g.type,n=g.pendingProps,n=g.elementType===I?n:Rt(I,n),ho(e,g),g.tag=1,He(I)?(e=!0,Oo(g)):e=!1,ls(g,t),Zp(g,I,n),Au(g,I,n,t),mu(null,g,I,!0,e,t);case 19:return Sp(e,g,t);case 22:return Bp(e,g,t)}throw Error(Q(156,g.tag))};function Qp(e,g){return mG(e,g)}function HR(e,g,t,I){this.tag=e,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yt(e,g,t,I){return new HR(e,g,t,I)}function mh(e){return e=e.prototype,!(!e||!e.isReactComponent)}function FR(e){if(typeof e=="function")return mh(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Nm)return 11;if(e===Hm)return 14}return 2}function qn(e,g){var t=e.alternate;return t===null?(t=yt(e.tag,g,e.key,e.mode),t.elementType=e.elementType,t.type=e.type,t.stateNode=e.stateNode,t.alternate=e,e.alternate=t):(t.pendingProps=g,t.type=e.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=e.flags&14680064,t.childLanes=e.childLanes,t.lanes=e.lanes,t.child=e.child,t.memoizedProps=e.memoizedProps,t.memoizedState=e.memoizedState,t.updateQueue=e.updateQueue,g=e.dependencies,t.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},t.sibling=e.sibling,t.index=e.index,t.ref=e.ref,t}function yo(e,g,t,I,n,l){var C=2;if(I=e,typeof e=="function")mh(e)&&(C=1);else if(typeof e=="string")C=5;else g:switch(e){case xC:return nC(t.children,n,l,g);case vm:C=8,n|=8;break;case Fd:return e=yt(12,t,g,n|2),e.elementType=Fd,e.lanes=l,e;case xd:return e=yt(13,t,g,n),e.elementType=xd,e.lanes=l,e;case Kd:return e=yt(19,t,g,n),e.elementType=Kd,e.lanes=l,e;case $y:return Oc(t,n,l,g);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case qy:C=10;break g;case _y:C=9;break g;case Nm:C=11;break g;case Hm:C=14;break g;case mn:C=16,I=null;break g}throw Error(Q(130,e==null?e:typeof e,""))}return g=yt(C,t,g,n),g.elementType=e,g.type=I,g.lanes=l,g}function nC(e,g,t,I){return e=yt(7,e,I,g),e.lanes=t,e}function Oc(e,g,t,I){return e=yt(22,e,I,g),e.elementType=$y,e.lanes=t,e.stateNode={isHidden:!1},e}function ad(e,g,t){return e=yt(6,e,null,g),e.lanes=t,e}function od(e,g,t){return g=yt(4,e.children!==null?e.children:[],e.key,g),g.lanes=t,g.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},g}function xR(e,g,t,I,n){this.tag=g,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=TA(0),this.expirationTimes=TA(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=TA(0),this.identifierPrefix=I,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function hh(e,g,t,I,n,l,C,s,r){return e=new xR(e,g,t,s,r),g===1?(g=1,l===!0&&(g|=8)):g=0,l=yt(3,null,null,g),e.current=l,l.stateNode=e,l.memoizedState={element:I,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},gh(l),e}function KR(e,g,t){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:FC,key:I==null?null:""+I,children:e,containerInfo:g,implementation:t}}function Lp(e){if(!e)return tl;e=e._reactInternals;g:{if(pC(e)!==e||e.tag!==1)throw Error(Q(170));var g=e;do{switch(g.tag){case 3:g=g.stateNode.context;break g;case 1:if(He(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break g}}g=g.return}while(g!==null);throw Error(Q(171))}if(e.tag===1){var t=e.type;if(He(t))return LG(e,t,g)}return g}function Tp(e,g,t,I,n,l,C,s,r){return e=hh(t,I,!0,e,n,l,C,s,r),e.context=Lp(null),t=e.current,I=fe(),n=On(t),l=DI(I,n),l.callback=g??null,jn(t,l,n),e.current.lanes=n,da(e,n,I),Fe(e,I),e}function qc(e,g,t,I){var n=g.current,l=fe(),C=On(n);return t=Lp(t),g.context===null?g.context=t:g.pendingContext=t,g=DI(l,C),g.payload={element:e},I=I===void 0?null:I,I!==null&&(g.callback=I),e=jn(n,g,C),e!==null&&(Qt(e,n,C,l),Ao(e,n,C)),C}function ic(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Wb(e,g){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var t=e.retryLane;e.retryLane=t!==0&&t<g?t:g}}function bh(e,g){Wb(e,g),(e=e.alternate)&&Wb(e,g)}function ER(){return null}var Mp=typeof reportError=="function"?reportError:function(e){console.error(e)};function Zh(e){this._internalRoot=e}_c.prototype.render=Zh.prototype.render=function(e){var g=this._internalRoot;if(g===null)throw Error(Q(409));qc(e,g,null,null)};_c.prototype.unmount=Zh.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var g=e.containerInfo;AC(function(){qc(null,e,null,null)}),g[_I]=null}};function _c(e){this._internalRoot=e}_c.prototype.unstable_scheduleHydration=function(e){if(e){var g=BG();e={blockedOn:null,target:e,priority:g};for(var t=0;t<Zn.length&&g!==0&&g<Zn[t].priority;t++);Zn.splice(t,0,e),t===0&&VG(e)}};function yh(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function $c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Sb(){}function UR(e,g,t,I,n){if(n){if(typeof I=="function"){var l=I;I=function(){var a=ic(C);l.call(a)}}var C=Tp(g,I,e,0,null,!1,!1,"",Sb);return e._reactRootContainer=C,e[_I]=C.current,hi(e.nodeType===8?e.parentNode:e),AC(),C}for(;n=e.lastChild;)e.removeChild(n);if(typeof I=="function"){var s=I;I=function(){var a=ic(r);s.call(a)}}var r=hh(e,0,!1,null,null,!1,!1,"",Sb);return e._reactRootContainer=r,e[_I]=r.current,hi(e.nodeType===8?e.parentNode:e),AC(function(){qc(g,r,t,I)}),r}function gA(e,g,t,I,n){var l=t._reactRootContainer;if(l){var C=l;if(typeof n=="function"){var s=n;n=function(){var r=ic(C);s.call(r)}}qc(g,C,e,n)}else C=UR(t,g,e,n,I);return ic(C)}GG=function(e){switch(e.tag){case 3:var g=e.stateNode;if(g.current.memoizedState.isDehydrated){var t=Tr(g.pendingLanes);t!==0&&(Km(g,t|1),Fe(g,vg()),!(og&6)&&(ir=vg()+500,sl()))}break;case 13:AC(function(){var I=$I(e,1);if(I!==null){var n=fe();Qt(I,e,1,n)}}),bh(e,1)}};Em=function(e){if(e.tag===13){var g=$I(e,134217728);if(g!==null){var t=fe();Qt(g,e,134217728,t)}bh(e,134217728)}};pG=function(e){if(e.tag===13){var g=On(e),t=$I(e,g);if(t!==null){var I=fe();Qt(t,e,g,I)}bh(e,g)}};BG=function(){return Ag};fG=function(e,g){var t=Ag;try{return Ag=e,g()}finally{Ag=t}};Pd=function(e,g,t){switch(g){case"input":if(zd(e,t),g=t.name,t.type==="radio"&&g!=null){for(t=e;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<t.length;g++){var I=t[g];if(I!==e&&I.form===e.form){var n=Lc(I);if(!n)throw Error(Q(90));eG(I),zd(I,n)}}}break;case"textarea":IG(e,t);break;case"select":g=t.value,g!=null&&es(e,!!t.multiple,g,!1)}};aG=Ah;oG=AC;var zR={usingClientEntryPoint:!1,Events:[ma,zC,Lc,rG,iG,Ah]},xr={findFiberByHostInstance:Sl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},QR={bundleType:xr.bundleType,version:xr.version,rendererPackageName:xr.rendererPackageName,rendererConfig:xr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ln.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=dG(e),e===null?null:e.stateNode},findFiberByHostInstance:xr.findFiberByHostInstance||ER,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ta=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ta.isDisabled&&Ta.supportsFiber)try{Ec=Ta.inject(QR),bI=Ta}catch{}}tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zR;tt.createPortal=function(e,g){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!yh(g))throw Error(Q(200));return KR(e,g,null,t)};tt.createRoot=function(e,g){if(!yh(e))throw Error(Q(299));var t=!1,I="",n=Mp;return g!=null&&(g.unstable_strictMode===!0&&(t=!0),g.identifierPrefix!==void 0&&(I=g.identifierPrefix),g.onRecoverableError!==void 0&&(n=g.onRecoverableError)),g=hh(e,1,!1,null,null,t,!1,I,n),e[_I]=g.current,hi(e.nodeType===8?e.parentNode:e),new Zh(g)};tt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var g=e._reactInternals;if(g===void 0)throw typeof e.render=="function"?Error(Q(188)):(e=Object.keys(e).join(","),Error(Q(268,e)));return e=dG(g),e=e===null?null:e.stateNode,e};tt.flushSync=function(e){return AC(e)};tt.hydrate=function(e,g,t){if(!$c(g))throw Error(Q(200));return gA(null,e,g,!0,t)};tt.hydrateRoot=function(e,g,t){if(!yh(e))throw Error(Q(405));var I=t!=null&&t.hydratedSources||null,n=!1,l="",C=Mp;if(t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(l=t.identifierPrefix),t.onRecoverableError!==void 0&&(C=t.onRecoverableError)),g=Tp(g,null,e,1,t??null,n,!1,l,C),e[_I]=g.current,hi(e),I)for(e=0;e<I.length;e++)t=I[e],n=t._getVersion,n=n(t._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[t,n]:g.mutableSourceEagerHydrationData.push(t,n);return new _c(g)};tt.render=function(e,g,t){if(!$c(g))throw Error(Q(200));return gA(null,e,g,!1,t)};tt.unmountComponentAtNode=function(e){if(!$c(e))throw Error(Q(40));return e._reactRootContainer?(AC(function(){gA(null,null,e,!1,function(){e._reactRootContainer=null,e[_I]=null})}),!0):!1};tt.unstable_batchedUpdates=Ah;tt.unstable_renderSubtreeIntoContainer=function(e,g,t,I){if(!$c(t))throw Error(Q(200));if(e==null||e._reactInternals===void 0)throw Error(Q(38));return gA(e,g,t,!1,I)};tt.version="18.3.1-next-f1338f8080-20240426";function Dp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Dp)}catch(e){console.error(e)}}Dp(),Dy.exports=tt;var LR=Dy.exports,Rb=LR;Nd.createRoot=Rb.createRoot,Nd.hydrateRoot=Rb.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wi(){return Wi=Object.assign?Object.assign.bind():function(e){for(var g=1;g<arguments.length;g++){var t=arguments[g];for(var I in t)Object.prototype.hasOwnProperty.call(t,I)&&(e[I]=t[I])}return e},Wi.apply(this,arguments)}var zn;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(zn||(zn={}));const kb="popstate";function TR(e){e===void 0&&(e={});function g(I,n){let{pathname:l,search:C,hash:s}=I.location;return Ru("",{pathname:l,search:C,hash:s},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function t(I,n){return typeof n=="string"?n:ac(n)}return DR(g,t,null,e)}function Fg(e,g){if(e===!1||e===null||typeof e>"u")throw new Error(g)}function Gh(e,g){if(!e){typeof console<"u"&&console.warn(g);try{throw new Error(g)}catch{}}}function MR(){return Math.random().toString(36).substr(2,8)}function Xb(e,g){return{usr:e.state,key:e.key,idx:g}}function Ru(e,g,t,I){return t===void 0&&(t=null),Wi({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof g=="string"?Br(g):g,{state:t,key:g&&g.key||I||MR()})}function ac(e){let{pathname:g="/",search:t="",hash:I=""}=e;return t&&t!=="?"&&(g+=t.charAt(0)==="?"?t:"?"+t),I&&I!=="#"&&(g+=I.charAt(0)==="#"?I:"#"+I),g}function Br(e){let g={};if(e){let t=e.indexOf("#");t>=0&&(g.hash=e.substr(t),e=e.substr(0,t));let I=e.indexOf("?");I>=0&&(g.search=e.substr(I),e=e.substr(0,I)),e&&(g.pathname=e)}return g}function DR(e,g,t,I){I===void 0&&(I={});let{window:n=document.defaultView,v5Compat:l=!1}=I,C=n.history,s=zn.Pop,r=null,a=o();a==null&&(a=0,C.replaceState(Wi({},C.state,{idx:a}),""));function o(){return(C.state||{idx:null}).idx}function c(){s=zn.Pop;let G=o(),h=G==null?null:G-a;a=G,r&&r({action:s,location:Z.location,delta:h})}function A(G,h){s=zn.Push;let u=Ru(Z.location,G,h);t&&t(u,G),a=o()+1;let y=Xb(u,a),W=Z.createHref(u);try{C.pushState(y,"",W)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;n.location.assign(W)}l&&r&&r({action:s,location:Z.location,delta:1})}function b(G,h){s=zn.Replace;let u=Ru(Z.location,G,h);t&&t(u,G),a=o();let y=Xb(u,a),W=Z.createHref(u);C.replaceState(y,"",W),l&&r&&r({action:s,location:Z.location,delta:0})}function m(G){let h=n.location.origin!=="null"?n.location.origin:n.location.href,u=typeof G=="string"?G:ac(G);return u=u.replace(/ $/,"%20"),Fg(h,"No window.location.(origin|href) available to create URL for href: "+u),new URL(u,h)}let Z={get action(){return s},get location(){return e(n,C)},listen(G){if(r)throw new Error("A history only accepts one active listener");return n.addEventListener(kb,c),r=G,()=>{n.removeEventListener(kb,c),r=null}},createHref(G){return g(n,G)},createURL:m,encodeLocation(G){let h=m(G);return{pathname:h.pathname,search:h.search,hash:h.hash}},push:A,replace:b,go(G){return C.go(G)}};return Z}var Jb;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Jb||(Jb={}));function jR(e,g,t){return t===void 0&&(t="/"),PR(e,g,t,!1)}function PR(e,g,t,I){let n=typeof g=="string"?Br(g):g,l=ph(n.pathname||"/",t);if(l==null)return null;let C=jp(e);OR(C);let s=null;for(let r=0;s==null&&r<C.length;++r){let a=s2(l);s=l2(C[r],a,I)}return s}function jp(e,g,t,I){g===void 0&&(g=[]),t===void 0&&(t=[]),I===void 0&&(I="");let n=(l,C,s)=>{let r={relativePath:s===void 0?l.path||"":s,caseSensitive:l.caseSensitive===!0,childrenIndex:C,route:l};r.relativePath.startsWith("/")&&(Fg(r.relativePath.startsWith(I),'Absolute route path "'+r.relativePath+'" nested under path '+('"'+I+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),r.relativePath=r.relativePath.slice(I.length));let a=_n([I,r.relativePath]),o=t.concat(r);l.children&&l.children.length>0&&(Fg(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+a+'".')),jp(l.children,g,o,a)),!(l.path==null&&!l.index)&&g.push({path:a,score:I2(a,l.index),routesMeta:o})};return e.forEach((l,C)=>{var s;if(l.path===""||!((s=l.path)!=null&&s.includes("?")))n(l,C);else for(let r of Pp(l.path))n(l,C,r)}),g}function Pp(e){let g=e.split("/");if(g.length===0)return[];let[t,...I]=g,n=t.endsWith("?"),l=t.replace(/\?$/,"");if(I.length===0)return n?[l,""]:[l];let C=Pp(I.join("/")),s=[];return s.push(...C.map(r=>r===""?l:[l,r].join("/"))),n&&s.push(...C),s.map(r=>e.startsWith("/")&&r===""?"/":r)}function OR(e){e.sort((g,t)=>g.score!==t.score?t.score-g.score:n2(g.routesMeta.map(I=>I.childrenIndex),t.routesMeta.map(I=>I.childrenIndex)))}const qR=/^:[\w-]+$/,_R=3,$R=2,g2=1,e2=10,t2=-2,wb=e=>e==="*";function I2(e,g){let t=e.split("/"),I=t.length;return t.some(wb)&&(I+=t2),g&&(I+=$R),t.filter(n=>!wb(n)).reduce((n,l)=>n+(qR.test(l)?_R:l===""?g2:e2),I)}function n2(e,g){return e.length===g.length&&e.slice(0,-1).every((I,n)=>I===g[n])?e[e.length-1]-g[g.length-1]:0}function l2(e,g,t){t===void 0&&(t=!1);let{routesMeta:I}=e,n={},l="/",C=[];for(let s=0;s<I.length;++s){let r=I[s],a=s===I.length-1,o=l==="/"?g:g.slice(l.length)||"/",c=Yb({path:r.relativePath,caseSensitive:r.caseSensitive,end:a},o),A=r.route;if(!c&&a&&t&&!I[I.length-1].route.index&&(c=Yb({path:r.relativePath,caseSensitive:r.caseSensitive,end:!1},o)),!c)return null;Object.assign(n,c.params),C.push({params:n,pathname:_n([l,c.pathname]),pathnameBase:c2(_n([l,c.pathnameBase])),route:A}),c.pathnameBase!=="/"&&(l=_n([l,c.pathnameBase]))}return C}function Yb(e,g){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[t,I]=C2(e.path,e.caseSensitive,e.end),n=g.match(t);if(!n)return null;let l=n[0],C=l.replace(/(.)\/+$/,"$1"),s=n.slice(1);return{params:I.reduce((a,o,c)=>{let{paramName:A,isOptional:b}=o;if(A==="*"){let Z=s[c]||"";C=l.slice(0,l.length-Z.length).replace(/(.)\/+$/,"$1")}const m=s[c];return b&&!m?a[A]=void 0:a[A]=(m||"").replace(/%2F/g,"/"),a},{}),pathname:l,pathnameBase:C,pattern:e}}function C2(e,g,t){g===void 0&&(g=!1),t===void 0&&(t=!0),Gh(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let I=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(C,s,r)=>(I.push({paramName:s,isOptional:r!=null}),r?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(I.push({paramName:"*"}),n+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":e!==""&&e!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,g?void 0:"i"),I]}function s2(e){try{return e.split("/").map(g=>decodeURIComponent(g).replace(/\//g,"%2F")).join("/")}catch(g){return Gh(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+g+").")),e}}function ph(e,g){if(g==="/")return e;if(!e.toLowerCase().startsWith(g.toLowerCase()))return null;let t=g.endsWith("/")?g.length-1:g.length,I=e.charAt(t);return I&&I!=="/"?null:e.slice(t)||"/"}const r2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,i2=e=>r2.test(e);function a2(e,g){g===void 0&&(g="/");let{pathname:t,search:I="",hash:n=""}=typeof e=="string"?Br(e):e,l;if(t)if(i2(t))l=t;else{if(t.includes("//")){let C=t;t=t.replace(/\/\/+/g,"/"),Gh(!1,"Pathnames cannot have embedded double slashes - normalizing "+(C+" -> "+t))}t.startsWith("/")?l=vb(t.substring(1),"/"):l=vb(t,g)}else l=g;return{pathname:l,search:A2(I),hash:d2(n)}}function vb(e,g){let t=g.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?t.length>1&&t.pop():n!=="."&&t.push(n)}),t.length>1?t.join("/"):"/"}function cd(e,g,t,I){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+g+"` field ["+JSON.stringify(I)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function o2(e){return e.filter((g,t)=>t===0||g.route.path&&g.route.path.length>0)}function Bh(e,g){let t=o2(e);return g?t.map((I,n)=>n===t.length-1?I.pathname:I.pathnameBase):t.map(I=>I.pathnameBase)}function fh(e,g,t,I){I===void 0&&(I=!1);let n;typeof e=="string"?n=Br(e):(n=Wi({},e),Fg(!n.pathname||!n.pathname.includes("?"),cd("?","pathname","search",n)),Fg(!n.pathname||!n.pathname.includes("#"),cd("#","pathname","hash",n)),Fg(!n.search||!n.search.includes("#"),cd("#","search","hash",n)));let l=e===""||n.pathname==="",C=l?"/":n.pathname,s;if(C==null)s=t;else{let c=g.length-1;if(!I&&C.startsWith("..")){let A=C.split("/");for(;A[0]==="..";)A.shift(),c-=1;n.pathname=A.join("/")}s=c>=0?g[c]:"/"}let r=a2(n,s),a=C&&C!=="/"&&C.endsWith("/"),o=(l||C===".")&&t.endsWith("/");return!r.pathname.endsWith("/")&&(a||o)&&(r.pathname+="/"),r}const _n=e=>e.join("/").replace(/\/\/+/g,"/"),c2=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),A2=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,d2=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function u2(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Op=["post","put","patch","delete"];new Set(Op);const m2=["get",...Op];new Set(m2);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Si(){return Si=Object.assign?Object.assign.bind():function(e){for(var g=1;g<arguments.length;g++){var t=arguments[g];for(var I in t)Object.prototype.hasOwnProperty.call(t,I)&&(e[I]=t[I])}return e},Si.apply(this,arguments)}const Vh=B.createContext(null),h2=B.createContext(null),rl=B.createContext(null),eA=B.createContext(null),Cn=B.createContext({outlet:null,matches:[],isDataRoute:!1}),qp=B.createContext(null);function b2(e,g){let{relative:t}=g===void 0?{}:g;fr()||Fg(!1);let{basename:I,navigator:n}=B.useContext(rl),{hash:l,pathname:C,search:s}=gB(e,{relative:t}),r=C;return I!=="/"&&(r=C==="/"?I:_n([I,C])),n.createHref({pathname:r,search:s,hash:l})}function fr(){return B.useContext(eA)!=null}function BC(){return fr()||Fg(!1),B.useContext(eA).location}function _p(e){B.useContext(rl).static||B.useLayoutEffect(e)}function pI(){let{isDataRoute:e}=B.useContext(Cn);return e?J2():Z2()}function Z2(){fr()||Fg(!1);let e=B.useContext(Vh),{basename:g,future:t,navigator:I}=B.useContext(rl),{matches:n}=B.useContext(Cn),{pathname:l}=BC(),C=JSON.stringify(Bh(n,t.v7_relativeSplatPath)),s=B.useRef(!1);return _p(()=>{s.current=!0}),B.useCallback(function(a,o){if(o===void 0&&(o={}),!s.current)return;if(typeof a=="number"){I.go(a);return}let c=fh(a,JSON.parse(C),l,o.relative==="path");e==null&&g!=="/"&&(c.pathname=c.pathname==="/"?g:_n([g,c.pathname])),(o.replace?I.replace:I.push)(c,o.state,o)},[g,I,C,l,e])}function $p(){let{matches:e}=B.useContext(Cn),g=e[e.length-1];return g?g.params:{}}function gB(e,g){let{relative:t}=g===void 0?{}:g,{future:I}=B.useContext(rl),{matches:n}=B.useContext(Cn),{pathname:l}=BC(),C=JSON.stringify(Bh(n,I.v7_relativeSplatPath));return B.useMemo(()=>fh(e,JSON.parse(C),l,t==="path"),[e,C,l,t])}function y2(e,g){return G2(e,g)}function G2(e,g,t,I){fr()||Fg(!1);let{navigator:n}=B.useContext(rl),{matches:l}=B.useContext(Cn),C=l[l.length-1],s=C?C.params:{};C&&C.pathname;let r=C?C.pathnameBase:"/";C&&C.route;let a=BC(),o;if(g){var c;let G=typeof g=="string"?Br(g):g;r==="/"||(c=G.pathname)!=null&&c.startsWith(r)||Fg(!1),o=G}else o=a;let A=o.pathname||"/",b=A;if(r!=="/"){let G=r.replace(/^\//,"").split("/");b="/"+A.replace(/^\//,"").split("/").slice(G.length).join("/")}let m=jR(e,{pathname:b}),Z=W2(m&&m.map(G=>Object.assign({},G,{params:Object.assign({},s,G.params),pathname:_n([r,n.encodeLocation?n.encodeLocation(G.pathname).pathname:G.pathname]),pathnameBase:G.pathnameBase==="/"?r:_n([r,n.encodeLocation?n.encodeLocation(G.pathnameBase).pathname:G.pathnameBase])})),l,t,I);return g&&Z?B.createElement(eA.Provider,{value:{location:Si({pathname:"/",search:"",hash:"",state:null,key:"default"},o),navigationType:zn.Pop}},Z):Z}function p2(){let e=X2(),g=u2(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),t=e instanceof Error?e.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},l=null;return B.createElement(B.Fragment,null,B.createElement("h2",null,"Unexpected Application Error!"),B.createElement("h3",{style:{fontStyle:"italic"}},g),t?B.createElement("pre",{style:n},t):null,l)}const B2=B.createElement(p2,null);class f2 extends B.Component{constructor(g){super(g),this.state={location:g.location,revalidation:g.revalidation,error:g.error}}static getDerivedStateFromError(g){return{error:g}}static getDerivedStateFromProps(g,t){return t.location!==g.location||t.revalidation!=="idle"&&g.revalidation==="idle"?{error:g.error,location:g.location,revalidation:g.revalidation}:{error:g.error!==void 0?g.error:t.error,location:t.location,revalidation:g.revalidation||t.revalidation}}componentDidCatch(g,t){console.error("React Router caught the following error during render",g,t)}render(){return this.state.error!==void 0?B.createElement(Cn.Provider,{value:this.props.routeContext},B.createElement(qp.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function V2(e){let{routeContext:g,match:t,children:I}=e,n=B.useContext(Vh);return n&&n.static&&n.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=t.route.id),B.createElement(Cn.Provider,{value:g},I)}function W2(e,g,t,I){var n;if(g===void 0&&(g=[]),t===void 0&&(t=null),I===void 0&&(I=null),e==null){var l;if(!t)return null;if(t.errors)e=t.matches;else if((l=I)!=null&&l.v7_partialHydration&&g.length===0&&!t.initialized&&t.matches.length>0)e=t.matches;else return null}let C=e,s=(n=t)==null?void 0:n.errors;if(s!=null){let o=C.findIndex(c=>c.route.id&&(s==null?void 0:s[c.route.id])!==void 0);o>=0||Fg(!1),C=C.slice(0,Math.min(C.length,o+1))}let r=!1,a=-1;if(t&&I&&I.v7_partialHydration)for(let o=0;o<C.length;o++){let c=C[o];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(a=o),c.route.id){let{loaderData:A,errors:b}=t,m=c.route.loader&&A[c.route.id]===void 0&&(!b||b[c.route.id]===void 0);if(c.route.lazy||m){r=!0,a>=0?C=C.slice(0,a+1):C=[C[0]];break}}}return C.reduceRight((o,c,A)=>{let b,m=!1,Z=null,G=null;t&&(b=s&&c.route.id?s[c.route.id]:void 0,Z=c.route.errorElement||B2,r&&(a<0&&A===0?(w2("route-fallback",!1),m=!0,G=null):a===A&&(m=!0,G=c.route.hydrateFallbackElement||null)));let h=g.concat(C.slice(0,A+1)),u=()=>{let y;return b?y=Z:m?y=G:c.route.Component?y=B.createElement(c.route.Component,null):c.route.element?y=c.route.element:y=o,B.createElement(V2,{match:c,routeContext:{outlet:o,matches:h,isDataRoute:t!=null},children:y})};return t&&(c.route.ErrorBoundary||c.route.errorElement||A===0)?B.createElement(f2,{location:t.location,revalidation:t.revalidation,component:Z,error:b,children:u(),routeContext:{outlet:null,matches:h,isDataRoute:!0}}):u()},null)}var eB=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(eB||{}),oc=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(oc||{});function S2(e){let g=B.useContext(Vh);return g||Fg(!1),g}function R2(e){let g=B.useContext(h2);return g||Fg(!1),g}function k2(e){let g=B.useContext(Cn);return g||Fg(!1),g}function tB(e){let g=k2(),t=g.matches[g.matches.length-1];return t.route.id||Fg(!1),t.route.id}function X2(){var e;let g=B.useContext(qp),t=R2(oc.UseRouteError),I=tB(oc.UseRouteError);return g!==void 0?g:(e=t.errors)==null?void 0:e[I]}function J2(){let{router:e}=S2(eB.UseNavigateStable),g=tB(oc.UseNavigateStable),t=B.useRef(!1);return _p(()=>{t.current=!0}),B.useCallback(function(n,l){l===void 0&&(l={}),t.current&&(typeof n=="number"?e.navigate(n):e.navigate(n,Si({fromRouteId:g},l)))},[e,g])}const Nb={};function w2(e,g,t){!g&&!Nb[e]&&(Nb[e]=!0)}function Y2(e,g){e==null||e.v7_startTransition,(e==null?void 0:e.v7_relativeSplatPath)===void 0&&(!g||g.v7_relativeSplatPath),g&&(g.v7_fetcherPersist,g.v7_normalizeFormMethod,g.v7_partialHydration,g.v7_skipActionErrorRevalidation)}function Hb(e){let{to:g,replace:t,state:I,relative:n}=e;fr()||Fg(!1);let{future:l,static:C}=B.useContext(rl),{matches:s}=B.useContext(Cn),{pathname:r}=BC(),a=pI(),o=fh(g,Bh(s,l.v7_relativeSplatPath),r,n==="path"),c=JSON.stringify(o);return B.useEffect(()=>a(JSON.parse(c),{replace:t,state:I,relative:n}),[a,c,n,t,I]),null}function Re(e){Fg(!1)}function v2(e){let{basename:g="/",children:t=null,location:I,navigationType:n=zn.Pop,navigator:l,static:C=!1,future:s}=e;fr()&&Fg(!1);let r=g.replace(/^\/*/,"/"),a=B.useMemo(()=>({basename:r,navigator:l,static:C,future:Si({v7_relativeSplatPath:!1},s)}),[r,s,l,C]);typeof I=="string"&&(I=Br(I));let{pathname:o="/",search:c="",hash:A="",state:b=null,key:m="default"}=I,Z=B.useMemo(()=>{let G=ph(o,r);return G==null?null:{location:{pathname:G,search:c,hash:A,state:b,key:m},navigationType:n}},[r,o,c,A,b,m,n]);return Z==null?null:B.createElement(rl.Provider,{value:a},B.createElement(eA.Provider,{children:t,value:Z}))}function N2(e){let{children:g,location:t}=e;return y2(ku(g),t)}new Promise(()=>{});function ku(e,g){g===void 0&&(g=[]);let t=[];return B.Children.forEach(e,(I,n)=>{if(!B.isValidElement(I))return;let l=[...g,n];if(I.type===B.Fragment){t.push.apply(t,ku(I.props.children,l));return}I.type!==Re&&Fg(!1),!I.props.index||!I.props.children||Fg(!1);let C={id:I.props.id||l.join("-"),caseSensitive:I.props.caseSensitive,element:I.props.element,Component:I.props.Component,index:I.props.index,path:I.props.path,loader:I.props.loader,action:I.props.action,errorElement:I.props.errorElement,ErrorBoundary:I.props.ErrorBoundary,hasErrorBoundary:I.props.ErrorBoundary!=null||I.props.errorElement!=null,shouldRevalidate:I.props.shouldRevalidate,handle:I.props.handle,lazy:I.props.lazy};I.props.children&&(C.children=ku(I.props.children,l)),t.push(C)}),t}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Xu(){return Xu=Object.assign?Object.assign.bind():function(e){for(var g=1;g<arguments.length;g++){var t=arguments[g];for(var I in t)Object.prototype.hasOwnProperty.call(t,I)&&(e[I]=t[I])}return e},Xu.apply(this,arguments)}function H2(e,g){if(e==null)return{};var t={},I=Object.keys(e),n,l;for(l=0;l<I.length;l++)n=I[l],!(g.indexOf(n)>=0)&&(t[n]=e[n]);return t}function F2(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function x2(e,g){return e.button===0&&(!g||g==="_self")&&!F2(e)}function Ju(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((g,t)=>{let I=e[t];return g.concat(Array.isArray(I)?I.map(n=>[t,n]):[[t,I]])},[]))}function K2(e,g){let t=Ju(e);return g&&g.forEach((I,n)=>{t.has(n)||g.getAll(n).forEach(l=>{t.append(n,l)})}),t}const E2=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],U2="6";try{window.__reactRouterVersion=U2}catch{}const z2="startTransition",Fb=YW[z2];function Q2(e){let{basename:g,children:t,future:I,window:n}=e,l=B.useRef();l.current==null&&(l.current=TR({window:n,v5Compat:!0}));let C=l.current,[s,r]=B.useState({action:C.action,location:C.location}),{v7_startTransition:a}=I||{},o=B.useCallback(c=>{a&&Fb?Fb(()=>r(c)):r(c)},[r,a]);return B.useLayoutEffect(()=>C.listen(o),[C,o]),B.useEffect(()=>Y2(I),[I]),B.createElement(v2,{basename:g,children:t,location:s.location,navigationType:s.action,navigator:C,future:I})}const L2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",T2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$g=B.forwardRef(function(g,t){let{onClick:I,relative:n,reloadDocument:l,replace:C,state:s,target:r,to:a,preventScrollReset:o,viewTransition:c}=g,A=H2(g,E2),{basename:b}=B.useContext(rl),m,Z=!1;if(typeof a=="string"&&T2.test(a)&&(m=a,L2))try{let y=new URL(window.location.href),W=a.startsWith("//")?new URL(y.protocol+a):new URL(a),S=ph(W.pathname,b);W.origin===y.origin&&S!=null?a=S+W.search+W.hash:Z=!0}catch{}let G=b2(a,{relative:n}),h=M2(a,{replace:C,state:s,target:r,preventScrollReset:o,relative:n,viewTransition:c});function u(y){I&&I(y),y.defaultPrevented||h(y)}return B.createElement("a",Xu({},A,{href:m||G,onClick:Z||l?I:u,ref:t,target:r}))});var xb;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(xb||(xb={}));var Kb;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Kb||(Kb={}));function M2(e,g){let{target:t,replace:I,state:n,preventScrollReset:l,relative:C,viewTransition:s}=g===void 0?{}:g,r=pI(),a=BC(),o=gB(e,{relative:C});return B.useCallback(c=>{if(x2(c,t)){c.preventDefault();let A=I!==void 0?I:ac(a)===ac(o);r(e,{replace:A,state:n,preventScrollReset:l,relative:C,viewTransition:s})}},[a,r,o,I,n,t,e,l,C,s])}function D2(e){let g=B.useRef(Ju(e)),t=B.useRef(!1),I=BC(),n=B.useMemo(()=>K2(I.search,t.current?null:g.current),[I.search]),l=pI(),C=B.useCallback((s,r)=>{const a=Ju(typeof s=="function"?s(n):s);t.current=!0,l("?"+a,r)},[l,n]);return[n,C]}let j2={data:""},P2=e=>{if(typeof window=="object"){let g=(e?e.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return g.nonce=window.__nonce__,g.parentNode||(e||document.head).appendChild(g),g.firstChild}return e||j2},O2=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,q2=/\/\*[^]*?\*\/|  +/g,Eb=/\n+/g,Gn=(e,g)=>{let t="",I="",n="";for(let l in e){let C=e[l];l[0]=="@"?l[1]=="i"?t=l+" "+C+";":I+=l[1]=="f"?Gn(C,l):l+"{"+Gn(C,l[1]=="k"?"":g)+"}":typeof C=="object"?I+=Gn(C,g?g.replace(/([^,])+/g,s=>l.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,r=>/&/.test(r)?r.replace(/&/g,s):s?s+" "+r:r)):l):C!=null&&(l=/^--/.test(l)?l:l.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=Gn.p?Gn.p(l,C):l+":"+C+";")}return t+(g&&n?g+"{"+n+"}":n)+I},BI={},IB=e=>{if(typeof e=="object"){let g="";for(let t in e)g+=t+IB(e[t]);return g}return e},_2=(e,g,t,I,n)=>{let l=IB(e),C=BI[l]||(BI[l]=(r=>{let a=0,o=11;for(;a<r.length;)o=101*o+r.charCodeAt(a++)>>>0;return"go"+o})(l));if(!BI[C]){let r=l!==e?e:(a=>{let o,c,A=[{}];for(;o=O2.exec(a.replace(q2,""));)o[4]?A.shift():o[3]?(c=o[3].replace(Eb," ").trim(),A.unshift(A[0][c]=A[0][c]||{})):A[0][o[1]]=o[2].replace(Eb," ").trim();return A[0]})(e);BI[C]=Gn(n?{["@keyframes "+C]:r}:r,t?"":"."+C)}let s=t&&BI.g?BI.g:null;return t&&(BI.g=BI[C]),((r,a,o,c)=>{c?a.data=a.data.replace(c,r):a.data.indexOf(r)===-1&&(a.data=o?r+a.data:a.data+r)})(BI[C],g,I,s),C},$2=(e,g,t)=>e.reduce((I,n,l)=>{let C=g[l];if(C&&C.call){let s=C(t),r=s&&s.props&&s.props.className||/^go/.test(s)&&s;C=r?"."+r:s&&typeof s=="object"?s.props?"":Gn(s,""):s===!1?"":s}return I+n+(C??"")},"");function tA(e){let g=this||{},t=e.call?e(g.p):e;return _2(t.unshift?t.raw?$2(t,[].slice.call(arguments,1),g.p):t.reduce((I,n)=>Object.assign(I,n&&n.call?n(g.p):n),{}):t,P2(g.target),g.g,g.o,g.k)}let nB,wu,Yu;tA.bind({g:1});let en=tA.bind({k:1});function gk(e,g,t,I){Gn.p=g,nB=e,wu=t,Yu=I}function il(e,g){let t=this||{};return function(){let I=arguments;function n(l,C){let s=Object.assign({},l),r=s.className||n.className;t.p=Object.assign({theme:wu&&wu()},s),t.o=/ *go\d+/.test(r),s.className=tA.apply(t,I)+(r?" "+r:""),g&&(s.ref=C);let a=e;return e[0]&&(a=s.as||e,delete s.as),Yu&&a[0]&&Yu(s),nB(a,s)}return g?g(n):n}}var ek=e=>typeof e=="function",cc=(e,g)=>ek(e)?e(g):e,tk=(()=>{let e=0;return()=>(++e).toString()})(),lB=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let g=matchMedia("(prefers-reduced-motion: reduce)");e=!g||g.matches}return e}})(),Ik=20,Wh="default",CB=(e,g)=>{let{toastLimit:t}=e.settings;switch(g.type){case 0:return{...e,toasts:[g.toast,...e.toasts].slice(0,t)};case 1:return{...e,toasts:e.toasts.map(C=>C.id===g.toast.id?{...C,...g.toast}:C)};case 2:let{toast:I}=g;return CB(e,{type:e.toasts.find(C=>C.id===I.id)?1:0,toast:I});case 3:let{toastId:n}=g;return{...e,toasts:e.toasts.map(C=>C.id===n||n===void 0?{...C,dismissed:!0,visible:!1}:C)};case 4:return g.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(C=>C.id!==g.toastId)};case 5:return{...e,pausedAt:g.time};case 6:let l=g.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(C=>({...C,pauseDuration:C.pauseDuration+l}))}}},Go=[],sB={toasts:[],pausedAt:void 0,settings:{toastLimit:Ik}},dI={},rB=(e,g=Wh)=>{dI[g]=CB(dI[g]||sB,e),Go.forEach(([t,I])=>{t===g&&I(dI[g])})},iB=e=>Object.keys(dI).forEach(g=>rB(e,g)),nk=e=>Object.keys(dI).find(g=>dI[g].toasts.some(t=>t.id===e)),IA=(e=Wh)=>g=>{rB(g,e)},lk={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Ck=(e={},g=Wh)=>{let[t,I]=B.useState(dI[g]||sB),n=B.useRef(dI[g]);B.useEffect(()=>(n.current!==dI[g]&&I(dI[g]),Go.push([g,I]),()=>{let C=Go.findIndex(([s])=>s===g);C>-1&&Go.splice(C,1)}),[g]);let l=t.toasts.map(C=>{var s,r,a;return{...e,...e[C.type],...C,removeDelay:C.removeDelay||((s=e[C.type])==null?void 0:s.removeDelay)||(e==null?void 0:e.removeDelay),duration:C.duration||((r=e[C.type])==null?void 0:r.duration)||(e==null?void 0:e.duration)||lk[C.type],style:{...e.style,...(a=e[C.type])==null?void 0:a.style,...C.style}}});return{...t,toasts:l}},sk=(e,g="blank",t)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:g,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...t,id:(t==null?void 0:t.id)||tk()}),ba=e=>(g,t)=>{let I=sk(g,e,t);return IA(I.toasterId||nk(I.id))({type:2,toast:I}),I.id},Sg=(e,g)=>ba("blank")(e,g);Sg.error=ba("error");Sg.success=ba("success");Sg.loading=ba("loading");Sg.custom=ba("custom");Sg.dismiss=(e,g)=>{let t={type:3,toastId:e};g?IA(g)(t):iB(t)};Sg.dismissAll=e=>Sg.dismiss(void 0,e);Sg.remove=(e,g)=>{let t={type:4,toastId:e};g?IA(g)(t):iB(t)};Sg.removeAll=e=>Sg.remove(void 0,e);Sg.promise=(e,g,t)=>{let I=Sg.loading(g.loading,{...t,...t==null?void 0:t.loading});return typeof e=="function"&&(e=e()),e.then(n=>{let l=g.success?cc(g.success,n):void 0;return l?Sg.success(l,{id:I,...t,...t==null?void 0:t.success}):Sg.dismiss(I),n}).catch(n=>{let l=g.error?cc(g.error,n):void 0;l?Sg.error(l,{id:I,...t,...t==null?void 0:t.error}):Sg.dismiss(I)}),e};var rk=1e3,ik=(e,g="default")=>{let{toasts:t,pausedAt:I}=Ck(e,g),n=B.useRef(new Map).current,l=B.useCallback((c,A=rk)=>{if(n.has(c))return;let b=setTimeout(()=>{n.delete(c),C({type:4,toastId:c})},A);n.set(c,b)},[]);B.useEffect(()=>{if(I)return;let c=Date.now(),A=t.map(b=>{if(b.duration===1/0)return;let m=(b.duration||0)+b.pauseDuration-(c-b.createdAt);if(m<0){b.visible&&Sg.dismiss(b.id);return}return setTimeout(()=>Sg.dismiss(b.id,g),m)});return()=>{A.forEach(b=>b&&clearTimeout(b))}},[t,I,g]);let C=B.useCallback(IA(g),[g]),s=B.useCallback(()=>{C({type:5,time:Date.now()})},[C]),r=B.useCallback((c,A)=>{C({type:1,toast:{id:c,height:A}})},[C]),a=B.useCallback(()=>{I&&C({type:6,time:Date.now()})},[I,C]),o=B.useCallback((c,A)=>{let{reverseOrder:b=!1,gutter:m=8,defaultPosition:Z}=A||{},G=t.filter(y=>(y.position||Z)===(c.position||Z)&&y.height),h=G.findIndex(y=>y.id===c.id),u=G.filter((y,W)=>W<h&&y.visible).length;return G.filter(y=>y.visible).slice(...b?[u+1]:[0,u]).reduce((y,W)=>y+(W.height||0)+m,0)},[t]);return B.useEffect(()=>{t.forEach(c=>{if(c.dismissed)l(c.id,c.removeDelay);else{let A=n.get(c.id);A&&(clearTimeout(A),n.delete(c.id))}})},[t,l]),{toasts:t,handlers:{updateHeight:r,startPause:s,endPause:a,calculateOffset:o}}},ak=en`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,ok=en`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,ck=en`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Ak=il("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${ak} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${ok} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${ck} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,dk=en`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,uk=il("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${dk} 1s linear infinite;
`,mk=en`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,hk=en`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,bk=il("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${mk} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${hk} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Zk=il("div")`
  position: absolute;
`,yk=il("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Gk=en`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,pk=il("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Gk} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Bk=({toast:e})=>{let{icon:g,type:t,iconTheme:I}=e;return g!==void 0?typeof g=="string"?B.createElement(pk,null,g):g:t==="blank"?null:B.createElement(yk,null,B.createElement(uk,{...I}),t!=="loading"&&B.createElement(Zk,null,t==="error"?B.createElement(Ak,{...I}):B.createElement(bk,{...I})))},fk=e=>`
0% {transform: translate3d(0,${e*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Vk=e=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${e*-150}%,-1px) scale(.6); opacity:0;}
`,Wk="0%{opacity:0;} 100%{opacity:1;}",Sk="0%{opacity:1;} 100%{opacity:0;}",Rk=il("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,kk=il("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Xk=(e,g)=>{let t=e.includes("top")?1:-1,[I,n]=lB()?[Wk,Sk]:[fk(t),Vk(t)];return{animation:g?`${en(I)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${en(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Jk=B.memo(({toast:e,position:g,style:t,children:I})=>{let n=e.height?Xk(e.position||g||"top-center",e.visible):{opacity:0},l=B.createElement(Bk,{toast:e}),C=B.createElement(kk,{...e.ariaProps},cc(e.message,e));return B.createElement(Rk,{className:e.className,style:{...n,...t,...e.style}},typeof I=="function"?I({icon:l,message:C}):B.createElement(B.Fragment,null,l,C))});gk(B.createElement);var wk=({id:e,className:g,style:t,onHeightUpdate:I,children:n})=>{let l=B.useCallback(C=>{if(C){let s=()=>{let r=C.getBoundingClientRect().height;I(e,r)};s(),new MutationObserver(s).observe(C,{subtree:!0,childList:!0,characterData:!0})}},[e,I]);return B.createElement("div",{ref:l,className:g,style:t},n)},Yk=(e,g)=>{let t=e.includes("top"),I=t?{top:0}:{bottom:0},n=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:lB()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${g*(t?1:-1)}px)`,...I,...n}},vk=tA`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Ma=16,Nk=({reverseOrder:e,position:g="top-center",toastOptions:t,gutter:I,children:n,toasterId:l,containerStyle:C,containerClassName:s})=>{let{toasts:r,handlers:a}=ik(t,l);return B.createElement("div",{"data-rht-toaster":l||"",style:{position:"fixed",zIndex:9999,top:Ma,left:Ma,right:Ma,bottom:Ma,pointerEvents:"none",...C},className:s,onMouseEnter:a.startPause,onMouseLeave:a.endPause},r.map(o=>{let c=o.position||g,A=a.calculateOffset(o,{reverseOrder:e,gutter:I,defaultPosition:g}),b=Yk(c,A);return B.createElement(wk,{id:o.id,key:o.id,onHeightUpdate:a.updateHeight,className:o.visible?vk:"",style:b},o.type==="custom"?cc(o.message,o):n?n(o):B.createElement(Jk,{toast:o,position:c}))}))},K=Sg;const Hk="6.16.0";function Fk(e,g,t){const I=g.split("|").map(l=>l.trim());for(let l=0;l<I.length;l++)switch(g){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof e===g)return}const n=new Error(`invalid value for type ${g}`);throw n.code="INVALID_ARGUMENT",n.argument=`value.${t}`,n.value=e,n}async function Ze(e){const g=Object.keys(e);return(await Promise.all(g.map(I=>Promise.resolve(e[I])))).reduce((I,n,l)=>(I[g[l]]=n,I),{})}function $(e,g,t){for(let I in g){let n=g[I];const l=t?t[I]:null;l&&Fk(n,l,I),Object.defineProperty(e,I,{enumerable:!0,value:n,writable:!1})}}function PC(e,g){if(e==null)return"null";if(g==null&&(g=new Set),typeof e=="object"){if(g.has(e))return"[Circular]";g.add(e)}if(Array.isArray(e))return"[ "+e.map(t=>PC(t,g)).join(", ")+" ]";if(e instanceof Uint8Array){const t="0123456789abcdef";let I="0x";for(let n=0;n<e.length;n++)I+=t[e[n]>>4],I+=t[e[n]&15];return I}if(typeof e=="object"&&typeof e.toJSON=="function")return PC(e.toJSON(),g);switch(typeof e){case"boolean":case"number":case"symbol":return e.toString();case"bigint":return BigInt(e).toString();case"string":return JSON.stringify(e);case"object":{const t=Object.keys(e);return t.sort(),"{ "+t.map(I=>`${PC(I,g)}: ${PC(e[I],g)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function te(e,g){return e&&e.code===g}function Sh(e){return te(e,"CALL_EXCEPTION")}function Bg(e,g,t){let I=e;{const l=[];if(t){if("message"in t||"code"in t||"name"in t)throw new Error(`value will overwrite populated values: ${PC(t)}`);for(const C in t){if(C==="shortMessage")continue;const s=t[C];l.push(C+"="+PC(s))}}l.push(`code=${g}`),l.push(`version=${Hk}`),l.length&&(e+=" ("+l.join(", ")+")")}let n;switch(g){case"INVALID_ARGUMENT":n=new TypeError(e);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":n=new RangeError(e);break;default:n=new Error(e)}return $(n,{code:g}),t&&Object.assign(n,t),n.shortMessage==null&&$(n,{shortMessage:I}),n}function H(e,g,t,I){if(!e)throw Bg(g,t,I)}function V(e,g,t,I){H(e,g,"INVALID_ARGUMENT",{argument:t,value:I})}function aB(e,g,t){t==null&&(t=""),t&&(t=": "+t),H(e>=g,"missing argument"+t,"MISSING_ARGUMENT",{count:e,expectedCount:g}),H(e<=g,"too many arguments"+t,"UNEXPECTED_ARGUMENT",{count:e,expectedCount:g})}const xk=["NFD","NFC","NFKD","NFKC"].reduce((e,g)=>{try{if("test".normalize(g)!=="test")throw new Error("bad");if(g==="NFD"){const t=String.fromCharCode(233).normalize("NFD"),I=String.fromCharCode(101,769);if(t!==I)throw new Error("broken")}e.push(g)}catch{}return e},[]);function Kk(e){H(xk.indexOf(e)>=0,"platform missing String.prototype.normalize","UNSUPPORTED_OPERATION",{operation:"String.prototype.normalize",info:{form:e}})}function Za(e,g,t){if(t==null&&(t=""),e!==g){let I=t,n="new";t&&(I+=".",n+=" "+t),H(!1,`private constructor; use ${I}from* methods`,"UNSUPPORTED_OPERATION",{operation:n})}}function oB(e,g,t){if(e instanceof Uint8Array)return t?new Uint8Array(e):e;if(typeof e=="string"&&e.length%2===0&&e.match(/^0x[0-9a-f]*$/i)){const I=new Uint8Array((e.length-2)/2);let n=2;for(let l=0;l<I.length;l++)I[l]=parseInt(e.substring(n,n+2),16),n+=2;return I}V(!1,"invalid BytesLike value",g||"value",e)}function ng(e,g){return oB(e,g,!1)}function ye(e,g){return oB(e,g,!0)}function Zg(e,g){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||typeof g=="number"&&e.length!==2+2*g||g===!0&&e.length%2!==0)}function Rh(e){return Zg(e,!0)||e instanceof Uint8Array}const Ub="0123456789abcdef";function D(e){const g=ng(e);let t="0x";for(let I=0;I<g.length;I++){const n=g[I];t+=Ub[(n&240)>>4]+Ub[n&15]}return t}function pg(e){return"0x"+e.map(g=>D(g).substring(2)).join("")}function ss(e){return Zg(e,!0)?(e.length-2)/2:ng(e).length}function Vg(e,g,t){const I=ng(e);return t!=null&&t>I.length&&H(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:I,length:I.length,offset:t}),D(I.slice(g??0,t??I.length))}function u9(e){let g=D(e).substring(2);for(;g.startsWith("00");)g=g.substring(2);return"0x"+g}function cB(e,g,t){const I=ng(e);H(g>=I.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(I),length:g,offset:g+1});const n=new Uint8Array(g);return n.fill(0),t?n.set(I,g-I.length):n.set(I,0),D(n)}function tn(e,g){return cB(e,g,!0)}function Ek(e,g){return cB(e,g,!1)}const ya=BigInt(0),Et=BigInt(1),OC=9007199254740991;function Ac(e,g){const t=nA(e,"value"),I=BigInt(Ig(g,"width"));if(H(t>>I===ya,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:e}),t>>I-Et){const n=(Et<<I)-Et;return-((~t&n)+Et)}return t}function AB(e,g){let t=q(e,"value");const I=BigInt(Ig(g,"width")),n=Et<<I-Et;if(t<ya){t=-t,H(t<=n,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:e});const l=(Et<<I)-Et;return(~t&l)+Et}else H(t<n,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:e});return t}function Xl(e,g){const t=nA(e,"value"),I=BigInt(Ig(g,"bits"));return t&(Et<<I)-Et}function q(e,g){switch(typeof e){case"bigint":return e;case"number":return V(Number.isInteger(e),"underflow",g||"value",e),V(e>=-OC&&e<=OC,"overflow",g||"value",e),BigInt(e);case"string":try{if(e==="")throw new Error("empty string");return e[0]==="-"&&e[1]!=="-"?-BigInt(e.substring(1)):BigInt(e)}catch(t){V(!1,`invalid BigNumberish string: ${t.message}`,g||"value",e)}}V(!1,"invalid BigNumberish value",g||"value",e)}function nA(e,g){const t=q(e,g);return H(t>=ya,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:e}),t}const zb="0123456789abcdef";function lA(e){if(e instanceof Uint8Array){let g="0x0";for(const t of e)g+=zb[t>>4],g+=zb[t&15];return BigInt(g)}return q(e)}function Ig(e,g){switch(typeof e){case"bigint":return V(e>=-OC&&e<=OC,"overflow",g||"value",e),Number(e);case"number":return V(Number.isInteger(e),"underflow",g||"value",e),V(e>=-OC&&e<=OC,"overflow",g||"value",e),e;case"string":try{if(e==="")throw new Error("empty string");return Ig(BigInt(e),g)}catch(t){V(!1,`invalid numeric string: ${t.message}`,g||"value",e)}}V(!1,"invalid numeric value",g||"value",e)}function Uk(e){return Ig(lA(e))}function Il(e,g){const t=nA(e,"value");let I=t.toString(16);if(g==null)I.length%2&&(I="0"+I);else{const n=Ig(g,"width");if(n===0&&t===ya)return"0x";for(H(n*2>=I.length,`value exceeds width (${n} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:e});I.length<n*2;)I="0"+I}return"0x"+I}function Kg(e,g){const t=nA(e,"value");if(t===ya){const l=g!=null?Ig(g,"width"):0;return new Uint8Array(l)}let I=t.toString(16);if(I.length%2&&(I="0"+I),g!=null){const l=Ig(g,"width");for(;I.length<l*2;)I="00"+I;H(l*2===I.length,`value exceeds width (${l} bytes)`,"NUMERIC_FAULT",{operation:"toBeArray",fault:"overflow",value:e})}const n=new Uint8Array(I.length/2);for(let l=0;l<n.length;l++){const C=l*2;n[l]=parseInt(I.substring(C,C+2),16)}return n}function Kt(e){let g=D(Rh(e)?e:Kg(e)).substring(2);for(;g.startsWith("0");)g=g.substring(1);return g===""&&(g="0"),"0x"+g}const dc="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";let Da=null;function zk(e){if(Da==null){Da={};for(let t=0;t<dc.length;t++)Da[dc[t]]=BigInt(t)}const g=Da[e];return V(g!=null,"invalid base58 value","letter",e),g}const Qk=BigInt(0),vu=BigInt(58);function Lk(e){const g=ng(e);let t=lA(g),I="";for(;t;)I=dc[Number(t%vu)]+I,t/=vu;for(let n=0;n<g.length&&!g[n];n++)I=dc[0]+I;return I}function m9(e){let g=Qk;for(let t=0;t<e.length;t++)g*=vu,g+=zk(e[t]);return g}function Tk(e){e=atob(e);const g=new Uint8Array(e.length);for(let t=0;t<e.length;t++)g[t]=e.charCodeAt(t);return ng(g)}function Mk(e){const g=ng(e);let t="";for(let I=0;I<g.length;I++)t+=String.fromCharCode(g[I]);return btoa(t)}var os;class dB{constructor(g,t,I){R(this,"filter");R(this,"emitter");k(this,os,void 0);p(this,os,t),$(this,{emitter:g,filter:I})}async removeListener(){d(this,os)!=null&&await this.emitter.off(this.filter,d(this,os))}}os=new WeakMap;function Dk(e,g,t,I,n){V(!1,`invalid codepoint at offset ${g}; ${e}`,"bytes",t)}function uB(e,g,t,I,n){if(e==="BAD_PREFIX"||e==="UNEXPECTED_CONTINUE"){let l=0;for(let C=g+1;C<t.length&&t[C]>>6===2;C++)l++;return l}return e==="OVERRUN"?t.length-g-1:0}function jk(e,g,t,I,n){return e==="OVERLONG"?(V(typeof n=="number","invalid bad code point for replacement","badCodepoint",n),I.push(n),0):(I.push(65533),uB(e,g,t))}const Pk=Object.freeze({error:Dk,ignore:uB,replace:jk});function mB(e,g){g==null&&(g=Pk.error);const t=ng(e,"bytes"),I=[];let n=0;for(;n<t.length;){const l=t[n++];if(!(l>>7)){I.push(l);continue}let C=null,s=null;if((l&224)===192)C=1,s=127;else if((l&240)===224)C=2,s=2047;else if((l&248)===240)C=3,s=65535;else{(l&192)===128?n+=g("UNEXPECTED_CONTINUE",n-1,t,I):n+=g("BAD_PREFIX",n-1,t,I);continue}if(n-1+C>=t.length){n+=g("OVERRUN",n-1,t,I);continue}let r=l&(1<<8-C-1)-1;for(let a=0;a<C;a++){let o=t[n];if((o&192)!=128){n+=g("MISSING_CONTINUE",n,t,I),r=null;break}r=r<<6|o&63,n++}if(r!==null){if(r>1114111){n+=g("OUT_OF_RANGE",n-1-C,t,I,r);continue}if(r>=55296&&r<=57343){n+=g("UTF16_SURROGATE",n-1-C,t,I,r);continue}if(r<=s){n+=g("OVERLONG",n-1-C,t,I,r);continue}I.push(r)}}return I}function yI(e,g){V(typeof e=="string","invalid string value","str",e),g!=null&&(Kk(g),e=e.normalize(g));let t=[];for(let I=0;I<e.length;I++){const n=e.charCodeAt(I);if(n<128)t.push(n);else if(n<2048)t.push(n>>6|192),t.push(n&63|128);else if((n&64512)==55296){I++;const l=e.charCodeAt(I);V(I<e.length&&(l&64512)===56320,"invalid surrogate pair","str",e);const C=65536+((n&1023)<<10)+(l&1023);t.push(C>>18|240),t.push(C>>12&63|128),t.push(C>>6&63|128),t.push(C&63|128)}else t.push(n>>12|224),t.push(n>>6&63|128),t.push(n&63|128)}return new Uint8Array(t)}function Ok(e){return e.map(g=>g<=65535?String.fromCharCode(g):(g-=65536,String.fromCharCode((g>>10&1023)+55296,(g&1023)+56320))).join("")}function uc(e,g){return Ok(mB(e,g))}function h9(e,g){return mB(yI(e,g))}function hB(e){async function g(t,I){H(I==null||!I.cancelled,"request cancelled before sending","CANCELLED");const n=t.url.split(":")[0].toLowerCase();H(n==="http"||n==="https",`unsupported protocol ${n}`,"UNSUPPORTED_OPERATION",{info:{protocol:n},operation:"request"}),H(n==="https"||!t.credentials||t.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let l=null;const C=new AbortController,s=setTimeout(()=>{l=Bg("request timeout","TIMEOUT"),C.abort()},t.timeout);I&&I.addListener(()=>{l=Bg("request cancelled","CANCELLED"),C.abort()});const r=Object.assign({},e,{method:t.method,headers:new Headers(Array.from(t)),body:t.body||void 0,signal:C.signal});let a;try{a=await fetch(t.url,r)}catch(b){throw clearTimeout(s),l||b}clearTimeout(s);const o={};a.headers.forEach((b,m)=>{o[m.toLowerCase()]=b});const c=await a.arrayBuffer(),A=c==null?null:new Uint8Array(c);return{statusCode:a.status,statusMessage:a.statusText,headers:o,body:A}}return g}const qk=12,_k=250;let Qb=hB();const $k=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),gX=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let Ad=!1;async function bB(e,g){try{const t=e.match($k);if(!t)throw new Error("invalid data");return new $n(200,"OK",{"content-type":t[1]||"text/plain"},t[2]?Tk(t[3]):tX(t[3]))}catch{return new $n(599,"BAD REQUEST (invalid data: URI)",{},null,new In(e))}}function ZB(e){async function g(t,I){try{const n=t.match(gX);if(!n)throw new Error("invalid link");return new In(`${e}${n[2]}`)}catch{return new $n(599,"BAD REQUEST (invalid IPFS URI)",{},null,new In(t))}}return g}const ja={data:bB,ipfs:ZB("https://gateway.ipfs.io/ipfs/")},yB=new WeakMap;var Nl,pn;class eX{constructor(g){k(this,Nl,void 0);k(this,pn,void 0);p(this,Nl,[]),p(this,pn,!1),yB.set(g,()=>{if(!d(this,pn)){p(this,pn,!0);for(const t of d(this,Nl))setTimeout(()=>{t()},0);p(this,Nl,[])}})}addListener(g){H(!d(this,pn),"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),d(this,Nl).push(g)}get cancelled(){return d(this,pn)}checkSignal(){H(!this.cancelled,"cancelled","CANCELLED",{})}}Nl=new WeakMap,pn=new WeakMap;function Pa(e){if(e==null)throw new Error("missing signal; should not happen");return e.checkSignal(),e}var cs,As,Xt,JI,ds,us,Qg,Me,wI,Hl,Fl,xl,eI,Jt,Bn,Kl,Dr;const Jc=class Jc{constructor(g){k(this,Kl);k(this,cs,void 0);k(this,As,void 0);k(this,Xt,void 0);k(this,JI,void 0);k(this,ds,void 0);k(this,us,void 0);k(this,Qg,void 0);k(this,Me,void 0);k(this,wI,void 0);k(this,Hl,void 0);k(this,Fl,void 0);k(this,xl,void 0);k(this,eI,void 0);k(this,Jt,void 0);k(this,Bn,void 0);p(this,us,String(g)),p(this,cs,!1),p(this,As,!0),p(this,Xt,{}),p(this,JI,""),p(this,ds,3e5),p(this,Jt,{slotInterval:_k,maxAttempts:qk}),p(this,Bn,null)}get url(){return d(this,us)}set url(g){p(this,us,String(g))}get body(){return d(this,Qg)==null?null:new Uint8Array(d(this,Qg))}set body(g){if(g==null)p(this,Qg,void 0),p(this,Me,void 0);else if(typeof g=="string")p(this,Qg,yI(g)),p(this,Me,"text/plain");else if(g instanceof Uint8Array)p(this,Qg,g),p(this,Me,"application/octet-stream");else if(typeof g=="object")p(this,Qg,yI(JSON.stringify(g))),p(this,Me,"application/json");else throw new Error("invalid body")}hasBody(){return d(this,Qg)!=null}get method(){return d(this,JI)?d(this,JI):this.hasBody()?"POST":"GET"}set method(g){g==null&&(g=""),p(this,JI,String(g).toUpperCase())}get headers(){const g=Object.assign({},d(this,Xt));return d(this,wI)&&(g.authorization=`Basic ${Mk(yI(d(this,wI)))}`),this.allowGzip&&(g["accept-encoding"]="gzip"),g["content-type"]==null&&d(this,Me)&&(g["content-type"]=d(this,Me)),this.body&&(g["content-length"]=String(this.body.length)),g}getHeader(g){return this.headers[g.toLowerCase()]}setHeader(g,t){d(this,Xt)[String(g).toLowerCase()]=String(t)}clearHeaders(){p(this,Xt,{})}[Symbol.iterator](){const g=this.headers,t=Object.keys(g);let I=0;return{next:()=>{if(I<t.length){const n=t[I++];return{value:[n,g[n]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return d(this,wI)||null}setCredentials(g,t){V(!g.match(/:/),"invalid basic authentication username","username","[REDACTED]"),p(this,wI,`${g}:${t}`)}get allowGzip(){return d(this,As)}set allowGzip(g){p(this,As,!!g)}get allowInsecureAuthentication(){return!!d(this,cs)}set allowInsecureAuthentication(g){p(this,cs,!!g)}get timeout(){return d(this,ds)}set timeout(g){V(g>=0,"timeout must be non-zero","timeout",g),p(this,ds,g)}get preflightFunc(){return d(this,Hl)||null}set preflightFunc(g){p(this,Hl,g)}get processFunc(){return d(this,Fl)||null}set processFunc(g){p(this,Fl,g)}get retryFunc(){return d(this,xl)||null}set retryFunc(g){p(this,xl,g)}get getUrlFunc(){return d(this,Bn)||Qb}set getUrlFunc(g){p(this,Bn,g)}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${d(this,Qg)?D(d(this,Qg)):"null"}>`}setThrottleParams(g){g.slotInterval!=null&&(d(this,Jt).slotInterval=g.slotInterval),g.maxAttempts!=null&&(d(this,Jt).maxAttempts=g.maxAttempts)}send(){return H(d(this,eI)==null,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),p(this,eI,new eX(this)),E(this,Kl,Dr).call(this,0,Lb()+this.timeout,0,this,new $n(0,"",{},null,this))}cancel(){H(d(this,eI)!=null,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const g=yB.get(this);if(!g)throw new Error("missing signal; should not happen");g()}redirect(g){const t=this.url.split(":")[0].toLowerCase(),I=g.split(":")[0].toLowerCase();H(this.method==="GET"&&(t!=="https"||I!=="http")&&g.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(g)})`});const n=new Jc(g);return n.method="GET",n.allowGzip=this.allowGzip,n.timeout=this.timeout,p(n,Xt,Object.assign({},d(this,Xt))),d(this,Qg)&&p(n,Qg,new Uint8Array(d(this,Qg))),p(n,Me,d(this,Me)),n}clone(){const g=new Jc(this.url);return p(g,JI,d(this,JI)),d(this,Qg)&&p(g,Qg,d(this,Qg)),p(g,Me,d(this,Me)),p(g,Xt,Object.assign({},d(this,Xt))),p(g,wI,d(this,wI)),this.allowGzip&&(g.allowGzip=!0),g.timeout=this.timeout,this.allowInsecureAuthentication&&(g.allowInsecureAuthentication=!0),p(g,Hl,d(this,Hl)),p(g,Fl,d(this,Fl)),p(g,xl,d(this,xl)),p(g,Jt,Object.assign({},d(this,Jt))),p(g,Bn,d(this,Bn)),g}static lockConfig(){Ad=!0}static getGateway(g){return ja[g.toLowerCase()]||null}static registerGateway(g,t){if(g=g.toLowerCase(),g==="http"||g==="https")throw new Error(`cannot intercept ${g}; use registerGetUrl`);if(Ad)throw new Error("gateways locked");ja[g]=t}static registerGetUrl(g){if(Ad)throw new Error("gateways locked");Qb=g}static createGetUrlFunc(g){return hB(g)}static createDataGateway(){return bB}static createIpfsGatewayFunc(g){return ZB(g)}};cs=new WeakMap,As=new WeakMap,Xt=new WeakMap,JI=new WeakMap,ds=new WeakMap,us=new WeakMap,Qg=new WeakMap,Me=new WeakMap,wI=new WeakMap,Hl=new WeakMap,Fl=new WeakMap,xl=new WeakMap,eI=new WeakMap,Jt=new WeakMap,Bn=new WeakMap,Kl=new WeakSet,Dr=async function(g,t,I,n,l){var o,c,A;if(g>=d(this,Jt).maxAttempts)return l.makeServerError("exceeded maximum retry limit");H(Lb()<=t,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:n}),I>0&&await IX(I);let C=this.clone();const s=(C.url.split(":")[0]||"").toLowerCase();if(s in ja){const b=await ja[s](C.url,Pa(d(n,eI)));if(b instanceof $n){let m=b;if(this.processFunc){Pa(d(n,eI));try{m=await this.processFunc(C,m)}catch(Z){(Z.throttle==null||typeof Z.stall!="number")&&m.makeServerError("error in post-processing function",Z).assertOk()}}return m}C=b}this.preflightFunc&&(C=await this.preflightFunc(C));const r=await this.getUrlFunc(C,Pa(d(n,eI)));let a=new $n(r.statusCode,r.statusMessage,r.headers,r.body,n);if(a.statusCode===301||a.statusCode===302){try{const b=a.headers.location||"";return E(o=C.redirect(b),Kl,Dr).call(o,g+1,t,0,n,a)}catch{}return a}else if(a.statusCode===429&&(this.retryFunc==null||await this.retryFunc(C,a,g))){const b=a.headers["retry-after"];let m=d(this,Jt).slotInterval*Math.trunc(Math.random()*Math.pow(2,g));return typeof b=="string"&&b.match(/^[1-9][0-9]*$/)&&(m=parseInt(b)),E(c=C.clone(),Kl,Dr).call(c,g+1,t,m,n,a)}if(this.processFunc){Pa(d(n,eI));try{a=await this.processFunc(C,a)}catch(b){(b.throttle==null||typeof b.stall!="number")&&a.makeServerError("error in post-processing function",b).assertOk();let m=d(this,Jt).slotInterval*Math.trunc(Math.random()*Math.pow(2,g));return b.stall>=0&&(m=b.stall),E(A=C.clone(),Kl,Dr).call(A,g+1,t,m,n,a)}}return a};let In=Jc;var Li,Ti,Mi,De,ms,El;const A0=class A0{constructor(g,t,I,n,l){k(this,Li,void 0);k(this,Ti,void 0);k(this,Mi,void 0);k(this,De,void 0);k(this,ms,void 0);k(this,El,void 0);p(this,Li,g),p(this,Ti,t),p(this,Mi,Object.keys(I).reduce((C,s)=>(C[s.toLowerCase()]=String(I[s]),C),{})),p(this,De,n==null?null:new Uint8Array(n)),p(this,ms,l||null),p(this,El,{message:""})}toString(){return`<FetchResponse status=${this.statusCode} body=${d(this,De)?D(d(this,De)):"null"}>`}get statusCode(){return d(this,Li)}get statusMessage(){return d(this,Ti)}get headers(){return Object.assign({},d(this,Mi))}get body(){return d(this,De)==null?null:new Uint8Array(d(this,De))}get bodyText(){try{return d(this,De)==null?"":uc(d(this,De))}catch{H(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch{H(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const g=this.headers,t=Object.keys(g);let I=0;return{next:()=>{if(I<t.length){const n=t[I++];return{value:[n,g[n]],done:!1}}return{value:void 0,done:!0}}}}makeServerError(g,t){let I;g?I=`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${g})`:(g=`${this.statusCode} ${this.statusMessage}`,I=`CLIENT ESCALATED SERVER ERROR (${g})`);const n=new A0(599,I,this.headers,this.body,d(this,ms)||void 0);return p(n,El,{message:g,error:t}),n}throwThrottleError(g,t){t==null?t=-1:V(Number.isInteger(t)&&t>=0,"invalid stall timeout","stall",t);const I=new Error(g||"throttling requests");throw $(I,{stall:t,throttle:!0}),I}getHeader(g){return this.headers[g.toLowerCase()]}hasBody(){return d(this,De)!=null}get request(){return d(this,ms)}ok(){return d(this,El).message===""&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:g,error:t}=d(this,El);g===""&&(g=`server response ${this.statusCode} ${this.statusMessage}`);let I=null;this.request&&(I=this.request.url);let n=null;try{d(this,De)&&(n=uc(d(this,De)))}catch{}H(!1,g,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:t,info:{requestUrl:I,responseBody:n,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}};Li=new WeakMap,Ti=new WeakMap,Mi=new WeakMap,De=new WeakMap,ms=new WeakMap,El=new WeakMap;let $n=A0;function Lb(){return new Date().getTime()}function tX(e){return yI(e.replace(/%([0-9a-f][0-9a-f])/gi,(g,t)=>String.fromCharCode(parseInt(t,16))))}function IX(e){return new Promise(g=>setTimeout(g,e))}const nX=BigInt(-1),St=BigInt(0),qC=BigInt(1),lX=BigInt(5),XC={};let rs="0000";for(;rs.length<80;)rs+=rs;function dl(e){let g=rs;for(;g.length<e;)g+=g;return BigInt("1"+g.substring(0,e))}function Kr(e,g,t){const I=BigInt(g.width);if(g.signed){const n=qC<<I-qC;H(t==null||e>=-n&&e<n,"overflow","NUMERIC_FAULT",{operation:t,fault:"overflow",value:e}),e>St?e=Ac(Xl(e,I),I):e=-Ac(Xl(-e,I),I)}else{const n=qC<<I;H(t==null||e>=0&&e<n,"overflow","NUMERIC_FAULT",{operation:t,fault:"overflow",value:e}),e=(e%n+n)%n&n-qC}return e}function dd(e){typeof e=="number"&&(e=`fixed128x${e}`);let g=!0,t=128,I=18;if(typeof e=="string"){if(e!=="fixed")if(e==="ufixed")g=!1;else{const l=e.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);V(l,"invalid fixed format","format",e),g=l[1]!=="u",t=parseInt(l[2]),I=parseInt(l[3])}}else if(e){const l=e,C=(s,r,a)=>l[s]==null?a:(V(typeof l[s]===r,"invalid fixed format ("+s+" not "+r+")","format."+s,l[s]),l[s]);g=C("signed","boolean",g),t=C("width","number",t),I=C("decimals","number",I)}V(t%8===0,"invalid FixedNumber width (not byte aligned)","format.width",t),V(I<=80,"invalid FixedNumber decimals (too large)","format.decimals",I);const n=(g?"":"u")+"fixed"+String(t)+"x"+String(I);return{signed:g,width:t,decimals:I,name:n}}function CX(e,g){let t="";e<St&&(t="-",e*=nX);let I=e.toString();if(g===0)return t+I;for(;I.length<=g;)I=rs+I;const n=I.length-g;for(I=I.substring(0,n)+"."+I.substring(n);I[0]==="0"&&I[1]!==".";)I=I.substring(1);for(;I[I.length-1]==="0"&&I[I.length-2]!==".";)I=I.substring(0,I.length-1);return t+I}var wt,dg,ue,YI,yl,Yt,VI,Di,Nu,ji,Hu,Pi,Fu,Oi,xu;const bn=class bn{constructor(g,t,I){k(this,YI);k(this,Yt);k(this,Di);k(this,ji);k(this,Pi);k(this,Oi);R(this,"format");k(this,wt,void 0);k(this,dg,void 0);k(this,ue,void 0);R(this,"_value");Za(g,XC,"FixedNumber"),p(this,dg,t),p(this,wt,I);const n=CX(t,I.decimals);$(this,{format:I.name,_value:n}),p(this,ue,dl(I.decimals))}get signed(){return d(this,wt).signed}get width(){return d(this,wt).width}get decimals(){return d(this,wt).decimals}get value(){return d(this,dg)}addUnsafe(g){return E(this,Di,Nu).call(this,g)}add(g){return E(this,Di,Nu).call(this,g,"add")}subUnsafe(g){return E(this,ji,Hu).call(this,g)}sub(g){return E(this,ji,Hu).call(this,g,"sub")}mulUnsafe(g){return E(this,Pi,Fu).call(this,g)}mul(g){return E(this,Pi,Fu).call(this,g,"mul")}mulSignal(g){E(this,YI,yl).call(this,g);const t=d(this,dg)*d(g,dg);return H(t%d(this,ue)===St,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),E(this,Yt,VI).call(this,t/d(this,ue),"mulSignal")}divUnsafe(g){return E(this,Oi,xu).call(this,g)}div(g){return E(this,Oi,xu).call(this,g,"div")}divSignal(g){H(d(g,dg)!==St,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),E(this,YI,yl).call(this,g);const t=d(this,dg)*d(this,ue);return H(t%d(g,dg)===St,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),E(this,Yt,VI).call(this,t/d(g,dg),"divSignal")}cmp(g){let t=this.value,I=g.value;const n=this.decimals-g.decimals;return n>0?I*=dl(n):n<0&&(t*=dl(-n)),t<I?-1:t>I?1:0}eq(g){return this.cmp(g)===0}lt(g){return this.cmp(g)<0}lte(g){return this.cmp(g)<=0}gt(g){return this.cmp(g)>0}gte(g){return this.cmp(g)>=0}floor(){let g=d(this,dg);return d(this,dg)<St&&(g-=d(this,ue)-qC),g=d(this,dg)/d(this,ue)*d(this,ue),E(this,Yt,VI).call(this,g,"floor")}ceiling(){let g=d(this,dg);return d(this,dg)>St&&(g+=d(this,ue)-qC),g=d(this,dg)/d(this,ue)*d(this,ue),E(this,Yt,VI).call(this,g,"ceiling")}round(g){if(g==null&&(g=0),g>=this.decimals)return this;const t=this.decimals-g,I=lX*dl(t-1);let n=this.value+I;const l=dl(t);return n=n/l*l,Kr(n,d(this,wt),"round"),new bn(XC,n,d(this,wt))}isZero(){return d(this,dg)===St}isNegative(){return d(this,dg)<St}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(g){return bn.fromString(this.toString(),g)}static fromValue(g,t,I){const n=t==null?0:Ig(t),l=dd(I);let C=q(g,"value");const s=n-l.decimals;if(s>0){const r=dl(s);H(C%r===St,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:g}),C/=r}else s<0&&(C*=dl(-s));return Kr(C,l,"fromValue"),new bn(XC,C,l)}static fromString(g,t){const I=g.match(/^(-?)([0-9]*)\.?([0-9]*)$/);V(I&&I[2].length+I[3].length>0,"invalid FixedNumber string value","value",g);const n=dd(t);let l=I[2]||"0",C=I[3]||"";for(;C.length<n.decimals;)C+=rs;H(C.substring(n.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:g}),C=C.substring(0,n.decimals);const s=BigInt(I[1]+l+C);return Kr(s,n,"fromString"),new bn(XC,s,n)}static fromBytes(g,t){let I=lA(ng(g,"value"));const n=dd(t);return n.signed&&(I=Ac(I,n.width)),Kr(I,n,"fromBytes"),new bn(XC,I,n)}};wt=new WeakMap,dg=new WeakMap,ue=new WeakMap,YI=new WeakSet,yl=function(g){V(this.format===g.format,"incompatible format; use fixedNumber.toFormat","other",g)},Yt=new WeakSet,VI=function(g,t){return g=Kr(g,d(this,wt),t),new bn(XC,g,d(this,wt))},Di=new WeakSet,Nu=function(g,t){return E(this,YI,yl).call(this,g),E(this,Yt,VI).call(this,d(this,dg)+d(g,dg),t)},ji=new WeakSet,Hu=function(g,t){return E(this,YI,yl).call(this,g),E(this,Yt,VI).call(this,d(this,dg)-d(g,dg),t)},Pi=new WeakSet,Fu=function(g,t){return E(this,YI,yl).call(this,g),E(this,Yt,VI).call(this,d(this,dg)*d(g,dg)/d(this,ue),t)},Oi=new WeakSet,xu=function(g,t){return H(d(g,dg)!==St,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),E(this,YI,yl).call(this,g),E(this,Yt,VI).call(this,d(this,dg)*d(this,ue)/d(g,dg),t)};let mc=bn;function sX(e){let g=e.toString(16);for(;g.length<2;)g="0"+g;return"0x"+g}function Tb(e,g,t){let I=0;for(let n=0;n<t;n++)I=I*256+e[g+n];return I}function Mb(e,g,t,I){const n=[];for(;t<g+1+I;){const l=GB(e,t);n.push(l.result),t+=l.consumed,H(t<=g+1+I,"child data too short","BUFFER_OVERRUN",{buffer:e,length:I,offset:g})}return{consumed:1+I,result:n}}function GB(e,g){H(e.length!==0,"data too short","BUFFER_OVERRUN",{buffer:e,length:0,offset:1});const t=I=>{H(I<=e.length,"data short segment too short","BUFFER_OVERRUN",{buffer:e,length:e.length,offset:I})};if(e[g]>=248){const I=e[g]-247;t(g+1+I);const n=Tb(e,g+1,I);return t(g+1+I+n),Mb(e,g,g+1+I,I+n)}else if(e[g]>=192){const I=e[g]-192;return t(g+1+I),Mb(e,g,g+1,I)}else if(e[g]>=184){const I=e[g]-183;t(g+1+I);const n=Tb(e,g+1,I);t(g+1+I+n);const l=D(e.slice(g+1+I,g+1+I+n));return{consumed:1+I+n,result:l}}else if(e[g]>=128){const I=e[g]-128;t(g+1+I);const n=D(e.slice(g+1,g+1+I));return{consumed:1+I,result:n}}return{consumed:1,result:sX(e[g])}}function Ga(e){const g=ng(e,"data"),t=GB(g,0);return V(t.consumed===g.length,"unexpected junk after rlp payload","data",e),t.result}function Db(e){const g=[];for(;e;)g.unshift(e&255),e>>=8;return g}function pB(e){if(Array.isArray(e)){let I=[];if(e.forEach(function(l){I=I.concat(pB(l))}),I.length<=55)return I.unshift(192+I.length),I;const n=Db(I.length);return n.unshift(247+n.length),n.concat(I)}const g=Array.prototype.slice.call(ng(e,"object"));if(g.length===1&&g[0]<=127)return g;if(g.length<=55)return g.unshift(128+g.length),g;const t=Db(g.length);return t.unshift(183+t.length),t.concat(g)}const jb="0123456789abcdef";function jI(e){let g="0x";for(const t of pB(e))g+=jb[t>>4],g+=jb[t&15];return g}const BB=["wei","kwei","mwei","gwei","szabo","finney","ether"];function rX(e,g){let t=18;if(typeof g=="string"){const I=BB.indexOf(g);V(I>=0,"invalid unit","unit",g),t=3*I}else g!=null&&(t=Ig(g,"unit"));return mc.fromValue(e,t,{decimals:t,width:512}).toString()}function iX(e,g){V(typeof e=="string","value must be a string","value",e);let t=18;if(typeof g=="string"){const I=BB.indexOf(g);V(I>=0,"invalid unit","unit",g),t=3*I}else g!=null&&(t=Ig(g,"unit"));return mc.fromString(e,{decimals:t,width:512}).value}function fB(e){return rX(e,18)}function aX(e){return iX(e,18)}const Ge=32,Ku=new Uint8Array(Ge),oX=["then"],Oa={},VB=new WeakMap;function pl(e){return VB.get(e)}function Pb(e,g){VB.set(e,g)}function Er(e,g){const t=new Error(`deferred error during ABI decoding triggered accessing ${e}`);throw t.error=g,t}function Eu(e,g,t){return e.indexOf(null)>=0?g.map((I,n)=>I instanceof ar?Eu(pl(I),I,t):I):e.reduce((I,n,l)=>{let C=g.getValue(n);return n in I||(t&&C instanceof ar&&(C=Eu(pl(C),C,t)),I[n]=C),I},{})}var hs;const _C=class _C extends Array{constructor(...t){const I=t[0];let n=t[1],l=(t[2]||[]).slice(),C=!0;I!==Oa&&(n=t,l=[],C=!1);super(n.length);k(this,hs,void 0);n.forEach((a,o)=>{this[o]=a});const s=l.reduce((a,o)=>(typeof o=="string"&&a.set(o,(a.get(o)||0)+1),a),new Map);if(Pb(this,Object.freeze(n.map((a,o)=>{const c=l[o];return c!=null&&s.get(c)===1?c:null}))),p(this,hs,[]),d(this,hs)==null&&d(this,hs),!C)return;Object.freeze(this);const r=new Proxy(this,{get:(a,o,c)=>{if(typeof o=="string"){if(o.match(/^[0-9]+$/)){const b=Ig(o,"%index");if(b<0||b>=this.length)throw new RangeError("out of result range");const m=a[b];return m instanceof Error&&Er(`index ${b}`,m),m}if(oX.indexOf(o)>=0)return Reflect.get(a,o,c);const A=a[o];if(A instanceof Function)return function(...b){return A.apply(this===c?a:this,b)};if(!(o in a))return a.getValue.apply(this===c?a:this,[o])}return Reflect.get(a,o,c)}});return Pb(r,pl(this)),r}toArray(t){const I=[];return this.forEach((n,l)=>{n instanceof Error&&Er(`index ${l}`,n),t&&n instanceof _C&&(n=n.toArray(t)),I.push(n)}),I}toObject(t){const I=pl(this);return I.reduce((n,l,C)=>(H(l!=null,`value at index ${C} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),Eu(I,this,t)),{})}slice(t,I){t==null&&(t=0),t<0&&(t+=this.length,t<0&&(t=0)),I==null&&(I=this.length),I<0&&(I+=this.length,I<0&&(I=0)),I>this.length&&(I=this.length);const n=pl(this),l=[],C=[];for(let s=t;s<I;s++)l.push(this[s]),C.push(n[s]);return new _C(Oa,l,C)}filter(t,I){const n=pl(this),l=[],C=[];for(let s=0;s<this.length;s++){const r=this[s];r instanceof Error&&Er(`index ${s}`,r),t.call(I,r,s,this)&&(l.push(r),C.push(n[s]))}return new _C(Oa,l,C)}map(t,I){const n=[];for(let l=0;l<this.length;l++){const C=this[l];C instanceof Error&&Er(`index ${l}`,C),n.push(t.call(I,C,l,this))}return n}getValue(t){const I=pl(this).indexOf(t);if(I===-1)return;const n=this[I];return n instanceof Error&&Er(`property ${JSON.stringify(t)}`,n.error),n}static fromItems(t,I){return new _C(Oa,t,I)}};hs=new WeakMap;let ar=_C;function b9(e){const g=[],t=function(I,n){if(Array.isArray(n))for(let l in n){const C=I.slice();C.push(l);try{t(C,n[l])}catch(s){g.push({path:C,error:s})}}};return t([],e),g}function Ob(e){let g=Kg(e);return H(g.length<=Ge,"value out-of-bounds","BUFFER_OVERRUN",{buffer:g,length:Ge,offset:g.length}),g.length!==Ge&&(g=ye(pg([Ku.slice(g.length%Ge),g]))),g}class sn{constructor(g,t,I,n){R(this,"name");R(this,"type");R(this,"localName");R(this,"dynamic");$(this,{name:g,type:t,localName:I,dynamic:n},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(g,t){V(!1,g,this.localName,t)}}var vI,Ul,bs,po;class Uu{constructor(){k(this,bs);k(this,vI,void 0);k(this,Ul,void 0);p(this,vI,[]),p(this,Ul,0)}get data(){return pg(d(this,vI))}get length(){return d(this,Ul)}appendWriter(g){return E(this,bs,po).call(this,ye(g.data))}writeBytes(g){let t=ye(g);const I=t.length%Ge;return I&&(t=ye(pg([t,Ku.slice(I)]))),E(this,bs,po).call(this,t)}writeValue(g){return E(this,bs,po).call(this,Ob(g))}writeUpdatableValue(){const g=d(this,vI).length;return d(this,vI).push(Ku),p(this,Ul,d(this,Ul)+Ge),t=>{d(this,vI)[g]=Ob(t)}}}vI=new WeakMap,Ul=new WeakMap,bs=new WeakSet,po=function(g){return d(this,vI).push(g),p(this,Ul,d(this,Ul)+g.length),g.length};var ke,je,zl,Ql,fn,qi,zu,wc,WB,_i;let cX=(_i=class{constructor(g,t,I){k(this,qi);k(this,wc);R(this,"allowLoose");k(this,ke,void 0);k(this,je,void 0);k(this,zl,void 0);k(this,Ql,void 0);k(this,fn,void 0);$(this,{allowLoose:!!t}),p(this,ke,ye(g)),p(this,zl,0),p(this,Ql,null),p(this,fn,I??1024),p(this,je,0)}get data(){return D(d(this,ke))}get dataLength(){return d(this,ke).length}get consumed(){return d(this,je)}get bytes(){return new Uint8Array(d(this,ke))}subReader(g){const t=new _i(d(this,ke).slice(d(this,je)+g),this.allowLoose,d(this,fn));return p(t,Ql,this),t}readBytes(g,t){let I=E(this,wc,WB).call(this,0,g,!!t);return E(this,qi,zu).call(this,g),p(this,je,d(this,je)+I.length),I.slice(0,g)}readValue(){return lA(this.readBytes(Ge))}readIndex(){return Uk(this.readBytes(Ge))}},ke=new WeakMap,je=new WeakMap,zl=new WeakMap,Ql=new WeakMap,fn=new WeakMap,qi=new WeakSet,zu=function(g){var t;if(d(this,Ql))return E(t=d(this,Ql),qi,zu).call(t,g);p(this,zl,d(this,zl)+g),H(d(this,fn)<1||d(this,zl)<=d(this,fn)*this.dataLength,`compressed ABI data exceeds inflation ratio of ${d(this,fn)} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:ye(d(this,ke)),offset:d(this,je),length:g,info:{bytesRead:d(this,zl),dataLength:this.dataLength}})},wc=new WeakSet,WB=function(g,t,I){let n=Math.ceil(t/Ge)*Ge;return d(this,je)+n>d(this,ke).length&&(this.allowLoose&&I&&d(this,je)+t<=d(this,ke).length?n=t:H(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:ye(d(this,ke)),length:d(this,ke).length,offset:d(this,je)+n})),d(this,ke).slice(d(this,je),d(this,je)+n)},_i);function lC(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function kh(e,...g){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(g.length>0&&!g.includes(e.length))throw new Error(`Expected Uint8Array of length ${g}, not of length=${e.length}`)}function SB(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");lC(e.outputLen),lC(e.blockLen)}function or(e,g=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(g&&e.finished)throw new Error("Hash#digest() has already been called")}function RB(e,g){kh(e);const t=g.outputLen;if(e.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const ud=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const kB=e=>e instanceof Uint8Array,AX=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Bo=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),qt=(e,g)=>e<<32-g|e>>>g,dX=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!dX)throw new Error("Non little-endian hardware is not supported");const uX=async()=>{};async function Z9(e,g,t){let I=Date.now();for(let n=0;n<e;n++){t(n);const l=Date.now()-I;l>=0&&l<g||(await uX(),I+=l)}}function mX(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function cr(e){if(typeof e=="string"&&(e=mX(e)),!kB(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function hX(...e){const g=new Uint8Array(e.reduce((I,n)=>I+n.length,0));let t=0;return e.forEach(I=>{if(!kB(I))throw new Error("Uint8Array expected");g.set(I,t),t+=I.length}),g}let Xh=class{clone(){return this._cloneInto()}};const bX={}.toString;function ZX(e,g){if(g!==void 0&&bX.call(g)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(e,g)}function Jh(e){const g=I=>e().update(cr(I)).digest(),t=e();return g.outputLen=t.outputLen,g.blockLen=t.blockLen,g.create=()=>e(),g}function yX(e=32){if(ud&&typeof ud.getRandomValues=="function")return ud.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}class XB extends Xh{constructor(g,t){super(),this.finished=!1,this.destroyed=!1,SB(g);const I=cr(t);if(this.iHash=g.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,l=new Uint8Array(n);l.set(I.length>n?g.create().update(I).digest():I);for(let C=0;C<l.length;C++)l[C]^=54;this.iHash.update(l),this.oHash=g.create();for(let C=0;C<l.length;C++)l[C]^=106;this.oHash.update(l),l.fill(0)}update(g){return or(this),this.iHash.update(g),this}digestInto(g){or(this),kh(g,this.outputLen),this.finished=!0,this.iHash.digestInto(g),this.oHash.update(g),this.oHash.digestInto(g),this.destroy()}digest(){const g=new Uint8Array(this.oHash.outputLen);return this.digestInto(g),g}_cloneInto(g){g||(g=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:I,finished:n,destroyed:l,blockLen:C,outputLen:s}=this;return g=g,g.finished=n,g.destroyed=l,g.blockLen=C,g.outputLen=s,g.oHash=t._cloneInto(g.oHash),g.iHash=I._cloneInto(g.iHash),g}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const CA=(e,g,t)=>new XB(e,g).update(t).digest();CA.create=(e,g)=>new XB(e,g);function GX(e,g,t,I){SB(e);const n=ZX({dkLen:32,asyncTick:10},I),{c:l,dkLen:C,asyncTick:s}=n;if(lC(l),lC(C),lC(s),l<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const r=cr(g),a=cr(t),o=new Uint8Array(C),c=CA.create(e,r),A=c._cloneInto().update(a);return{c:l,dkLen:C,asyncTick:s,DK:o,PRF:c,PRFSalt:A}}function pX(e,g,t,I,n){return e.destroy(),g.destroy(),I&&I.destroy(),n.fill(0),t}function BX(e,g,t,I){const{c:n,dkLen:l,DK:C,PRF:s,PRFSalt:r}=GX(e,g,t,I);let a;const o=new Uint8Array(4),c=Bo(o),A=new Uint8Array(s.outputLen);for(let b=1,m=0;m<l;b++,m+=s.outputLen){const Z=C.subarray(m,m+s.outputLen);c.setInt32(0,b,!1),(a=r._cloneInto(a)).update(o).digestInto(A),Z.set(A.subarray(0,Z.length));for(let G=1;G<n;G++){s._cloneInto(a).update(A).digestInto(A);for(let h=0;h<Z.length;h++)Z[h]^=A[h]}}return pX(s,r,C,a,A)}function fX(e,g,t,I){if(typeof e.setBigUint64=="function")return e.setBigUint64(g,t,I);const n=BigInt(32),l=BigInt(4294967295),C=Number(t>>n&l),s=Number(t&l),r=I?4:0,a=I?0:4;e.setUint32(g+r,C,I),e.setUint32(g+a,s,I)}class JB extends Xh{constructor(g,t,I,n){super(),this.blockLen=g,this.outputLen=t,this.padOffset=I,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(g),this.view=Bo(this.buffer)}update(g){or(this);const{view:t,buffer:I,blockLen:n}=this;g=cr(g);const l=g.length;for(let C=0;C<l;){const s=Math.min(n-this.pos,l-C);if(s===n){const r=Bo(g);for(;n<=l-C;C+=n)this.process(r,C);continue}I.set(g.subarray(C,C+s),this.pos),this.pos+=s,C+=s,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=g.length,this.roundClean(),this}digestInto(g){or(this),RB(g,this),this.finished=!0;const{buffer:t,view:I,blockLen:n,isLE:l}=this;let{pos:C}=this;t[C++]=128,this.buffer.subarray(C).fill(0),this.padOffset>n-C&&(this.process(I,0),C=0);for(let c=C;c<n;c++)t[c]=0;fX(I,n-8,BigInt(this.length*8),l),this.process(I,0);const s=Bo(g),r=this.outputLen;if(r%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const a=r/4,o=this.get();if(a>o.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<a;c++)s.setUint32(4*c,o[c],l)}digest(){const{buffer:g,outputLen:t}=this;this.digestInto(g);const I=g.slice(0,t);return this.destroy(),I}_cloneInto(g){g||(g=new this.constructor),g.set(...this.get());const{blockLen:t,buffer:I,length:n,finished:l,destroyed:C,pos:s}=this;return g.length=n,g.pos=s,g.finished=l,g.destroyed=C,n%t&&g.buffer.set(I),g}}const VX=(e,g,t)=>e&g^~e&t,WX=(e,g,t)=>e&g^e&t^g&t,SX=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),an=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),on=new Uint32Array(64);class RX extends JB{constructor(){super(64,32,8,!1),this.A=an[0]|0,this.B=an[1]|0,this.C=an[2]|0,this.D=an[3]|0,this.E=an[4]|0,this.F=an[5]|0,this.G=an[6]|0,this.H=an[7]|0}get(){const{A:g,B:t,C:I,D:n,E:l,F:C,G:s,H:r}=this;return[g,t,I,n,l,C,s,r]}set(g,t,I,n,l,C,s,r){this.A=g|0,this.B=t|0,this.C=I|0,this.D=n|0,this.E=l|0,this.F=C|0,this.G=s|0,this.H=r|0}process(g,t){for(let c=0;c<16;c++,t+=4)on[c]=g.getUint32(t,!1);for(let c=16;c<64;c++){const A=on[c-15],b=on[c-2],m=qt(A,7)^qt(A,18)^A>>>3,Z=qt(b,17)^qt(b,19)^b>>>10;on[c]=Z+on[c-7]+m+on[c-16]|0}let{A:I,B:n,C:l,D:C,E:s,F:r,G:a,H:o}=this;for(let c=0;c<64;c++){const A=qt(s,6)^qt(s,11)^qt(s,25),b=o+A+VX(s,r,a)+SX[c]+on[c]|0,Z=(qt(I,2)^qt(I,13)^qt(I,22))+WX(I,n,l)|0;o=a,a=r,r=s,s=C+b|0,C=l,l=n,n=I,I=b+Z|0}I=I+this.A|0,n=n+this.B|0,l=l+this.C|0,C=C+this.D|0,s=s+this.E|0,r=r+this.F|0,a=a+this.G|0,o=o+this.H|0,this.set(I,n,l,C,s,r,a,o)}roundClean(){on.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const sA=Jh(()=>new RX),qa=BigInt(2**32-1),Qu=BigInt(32);function wB(e,g=!1){return g?{h:Number(e&qa),l:Number(e>>Qu&qa)}:{h:Number(e>>Qu&qa)|0,l:Number(e&qa)|0}}function YB(e,g=!1){let t=new Uint32Array(e.length),I=new Uint32Array(e.length);for(let n=0;n<e.length;n++){const{h:l,l:C}=wB(e[n],g);[t[n],I[n]]=[l,C]}return[t,I]}const kX=(e,g)=>BigInt(e>>>0)<<Qu|BigInt(g>>>0),XX=(e,g,t)=>e>>>t,JX=(e,g,t)=>e<<32-t|g>>>t,wX=(e,g,t)=>e>>>t|g<<32-t,YX=(e,g,t)=>e<<32-t|g>>>t,vX=(e,g,t)=>e<<64-t|g>>>t-32,NX=(e,g,t)=>e>>>t-32|g<<64-t,HX=(e,g)=>g,FX=(e,g)=>e,vB=(e,g,t)=>e<<t|g>>>32-t,NB=(e,g,t)=>g<<t|e>>>32-t,HB=(e,g,t)=>g<<t-32|e>>>64-t,FB=(e,g,t)=>e<<t-32|g>>>64-t;function xX(e,g,t,I){const n=(g>>>0)+(I>>>0);return{h:e+t+(n/2**32|0)|0,l:n|0}}const KX=(e,g,t)=>(e>>>0)+(g>>>0)+(t>>>0),EX=(e,g,t,I)=>g+t+I+(e/2**32|0)|0,UX=(e,g,t,I)=>(e>>>0)+(g>>>0)+(t>>>0)+(I>>>0),zX=(e,g,t,I,n)=>g+t+I+n+(e/2**32|0)|0,QX=(e,g,t,I,n)=>(e>>>0)+(g>>>0)+(t>>>0)+(I>>>0)+(n>>>0),LX=(e,g,t,I,n,l)=>g+t+I+n+l+(e/2**32|0)|0,TX={fromBig:wB,split:YB,toBig:kX,shrSH:XX,shrSL:JX,rotrSH:wX,rotrSL:YX,rotrBH:vX,rotrBL:NX,rotr32H:HX,rotr32L:FX,rotlSH:vB,rotlSL:NB,rotlBH:HB,rotlBL:FB,add:xX,add3L:KX,add3H:EX,add4L:UX,add4H:zX,add5H:LX,add5L:QX},Cg=TX,[MX,DX]=(()=>Cg.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))))(),cn=new Uint32Array(80),An=new Uint32Array(80);class jX extends JB{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:g,Al:t,Bh:I,Bl:n,Ch:l,Cl:C,Dh:s,Dl:r,Eh:a,El:o,Fh:c,Fl:A,Gh:b,Gl:m,Hh:Z,Hl:G}=this;return[g,t,I,n,l,C,s,r,a,o,c,A,b,m,Z,G]}set(g,t,I,n,l,C,s,r,a,o,c,A,b,m,Z,G){this.Ah=g|0,this.Al=t|0,this.Bh=I|0,this.Bl=n|0,this.Ch=l|0,this.Cl=C|0,this.Dh=s|0,this.Dl=r|0,this.Eh=a|0,this.El=o|0,this.Fh=c|0,this.Fl=A|0,this.Gh=b|0,this.Gl=m|0,this.Hh=Z|0,this.Hl=G|0}process(g,t){for(let y=0;y<16;y++,t+=4)cn[y]=g.getUint32(t),An[y]=g.getUint32(t+=4);for(let y=16;y<80;y++){const W=cn[y-15]|0,S=An[y-15]|0,J=Cg.rotrSH(W,S,1)^Cg.rotrSH(W,S,8)^Cg.shrSH(W,S,7),f=Cg.rotrSL(W,S,1)^Cg.rotrSL(W,S,8)^Cg.shrSL(W,S,7),X=cn[y-2]|0,U=An[y-2]|0,Y=Cg.rotrSH(X,U,19)^Cg.rotrBH(X,U,61)^Cg.shrSH(X,U,6),N=Cg.rotrSL(X,U,19)^Cg.rotrBL(X,U,61)^Cg.shrSL(X,U,6),j=Cg.add4L(f,N,An[y-7],An[y-16]),_=Cg.add4H(j,J,Y,cn[y-7],cn[y-16]);cn[y]=_|0,An[y]=j|0}let{Ah:I,Al:n,Bh:l,Bl:C,Ch:s,Cl:r,Dh:a,Dl:o,Eh:c,El:A,Fh:b,Fl:m,Gh:Z,Gl:G,Hh:h,Hl:u}=this;for(let y=0;y<80;y++){const W=Cg.rotrSH(c,A,14)^Cg.rotrSH(c,A,18)^Cg.rotrBH(c,A,41),S=Cg.rotrSL(c,A,14)^Cg.rotrSL(c,A,18)^Cg.rotrBL(c,A,41),J=c&b^~c&Z,f=A&m^~A&G,X=Cg.add5L(u,S,f,DX[y],An[y]),U=Cg.add5H(X,h,W,J,MX[y],cn[y]),Y=X|0,N=Cg.rotrSH(I,n,28)^Cg.rotrBH(I,n,34)^Cg.rotrBH(I,n,39),j=Cg.rotrSL(I,n,28)^Cg.rotrBL(I,n,34)^Cg.rotrBL(I,n,39),_=I&l^I&s^l&s,tg=n&C^n&r^C&r;h=Z|0,u=G|0,Z=b|0,G=m|0,b=c|0,m=A|0,{h:c,l:A}=Cg.add(a|0,o|0,U|0,Y|0),a=s|0,o=r|0,s=l|0,r=C|0,l=I|0,C=n|0;const F=Cg.add3L(Y,j,tg);I=Cg.add3H(F,U,N,_),n=F|0}({h:I,l:n}=Cg.add(this.Ah|0,this.Al|0,I|0,n|0)),{h:l,l:C}=Cg.add(this.Bh|0,this.Bl|0,l|0,C|0),{h:s,l:r}=Cg.add(this.Ch|0,this.Cl|0,s|0,r|0),{h:a,l:o}=Cg.add(this.Dh|0,this.Dl|0,a|0,o|0),{h:c,l:A}=Cg.add(this.Eh|0,this.El|0,c|0,A|0),{h:b,l:m}=Cg.add(this.Fh|0,this.Fl|0,b|0,m|0),{h:Z,l:G}=Cg.add(this.Gh|0,this.Gl|0,Z|0,G|0),{h,l:u}=Cg.add(this.Hh|0,this.Hl|0,h|0,u|0),this.set(I,n,l,C,s,r,a,o,c,A,b,m,Z,G,h,u)}roundClean(){cn.fill(0),An.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const wh=Jh(()=>new jX);function PX(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}const qb=PX(),_b=qb.crypto||qb.msCrypto;function xB(e){switch(e){case"sha256":return sA.create();case"sha512":return wh.create()}V(!1,"invalid hashing algorithm name","algorithm",e)}function G9(e,g){const t={sha256:sA,sha512:wh}[e];return V(t!=null,"invalid hmac algorithm","algorithm",e),CA.create(t,g)}function p9(e,g,t,I,n){const l={sha256:sA,sha512:wh}[n];return V(l!=null,"invalid pbkdf2 algorithm","algorithm",n),BX(l,e,g,{c:t,dkLen:I})}function B9(e){H(_b!=null,"platform does not support secure random numbers","UNSUPPORTED_OPERATION",{operation:"randomBytes"}),V(Number.isInteger(e)&&e>0&&e<=1024,"invalid length","length",e);const g=new Uint8Array(e);return _b.getRandomValues(g),g}const[KB,EB,UB]=[[],[],[]],OX=BigInt(0),Ur=BigInt(1),qX=BigInt(2),_X=BigInt(7),$X=BigInt(256),gJ=BigInt(113);for(let e=0,g=Ur,t=1,I=0;e<24;e++){[t,I]=[I,(2*t+3*I)%5],KB.push(2*(5*I+t)),EB.push((e+1)*(e+2)/2%64);let n=OX;for(let l=0;l<7;l++)g=(g<<Ur^(g>>_X)*gJ)%$X,g&qX&&(n^=Ur<<(Ur<<BigInt(l))-Ur);UB.push(n)}const[eJ,tJ]=YB(UB,!0),$b=(e,g,t)=>t>32?HB(e,g,t):vB(e,g,t),gZ=(e,g,t)=>t>32?FB(e,g,t):NB(e,g,t);function IJ(e,g=24){const t=new Uint32Array(10);for(let I=24-g;I<24;I++){for(let C=0;C<10;C++)t[C]=e[C]^e[C+10]^e[C+20]^e[C+30]^e[C+40];for(let C=0;C<10;C+=2){const s=(C+8)%10,r=(C+2)%10,a=t[r],o=t[r+1],c=$b(a,o,1)^t[s],A=gZ(a,o,1)^t[s+1];for(let b=0;b<50;b+=10)e[C+b]^=c,e[C+b+1]^=A}let n=e[2],l=e[3];for(let C=0;C<24;C++){const s=EB[C],r=$b(n,l,s),a=gZ(n,l,s),o=KB[C];n=e[o],l=e[o+1],e[o]=r,e[o+1]=a}for(let C=0;C<50;C+=10){for(let s=0;s<10;s++)t[s]=e[C+s];for(let s=0;s<10;s++)e[C+s]^=~t[(s+2)%10]&t[(s+4)%10]}e[0]^=eJ[I],e[1]^=tJ[I]}t.fill(0)}class Yh extends Xh{constructor(g,t,I,n=!1,l=24){if(super(),this.blockLen=g,this.suffix=t,this.outputLen=I,this.enableXOF=n,this.rounds=l,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,lC(I),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=AX(this.state)}keccak(){IJ(this.state32,this.rounds),this.posOut=0,this.pos=0}update(g){or(this);const{blockLen:t,state:I}=this;g=cr(g);const n=g.length;for(let l=0;l<n;){const C=Math.min(t-this.pos,n-l);for(let s=0;s<C;s++)I[this.pos++]^=g[l++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:g,suffix:t,pos:I,blockLen:n}=this;g[I]^=t,t&128&&I===n-1&&this.keccak(),g[n-1]^=128,this.keccak()}writeInto(g){or(this,!1),kh(g),this.finish();const t=this.state,{blockLen:I}=this;for(let n=0,l=g.length;n<l;){this.posOut>=I&&this.keccak();const C=Math.min(I-this.posOut,l-n);g.set(t.subarray(this.posOut,this.posOut+C),n),this.posOut+=C,n+=C}return g}xofInto(g){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(g)}xof(g){return lC(g),this.xofInto(new Uint8Array(g))}digestInto(g){if(RB(g,this),this.finished)throw new Error("digest() was already called");return this.writeInto(g),this.destroy(),g}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(g){const{blockLen:t,suffix:I,outputLen:n,rounds:l,enableXOF:C}=this;return g||(g=new Yh(t,I,n,C,l)),g.state32.set(this.state32),g.pos=this.pos,g.posOut=this.posOut,g.finished=this.finished,g.rounds=l,g.suffix=I,g.outputLen=n,g.enableXOF=C,g.destroyed=this.destroyed,g}}const nJ=(e,g,t)=>Jh(()=>new Yh(g,e,t)),lJ=nJ(1,136,256/8);let zB=!1;const QB=function(e){return lJ(e)};let LB=QB;function Hg(e){const g=ng(e,"data");return D(LB(g))}Hg._=QB;Hg.lock=function(){zB=!0};Hg.register=function(e){if(zB)throw new TypeError("keccak256 is locked");LB=e};Object.freeze(Hg);const TB=function(e){return xB("sha256").update(e).digest()},MB=function(e){return xB("sha512").update(e).digest()};let DB=TB,jB=MB,PB=!1,OB=!1;function Vr(e){const g=ng(e,"data");return D(DB(g))}Vr._=TB;Vr.lock=function(){PB=!0};Vr.register=function(e){if(PB)throw new Error("sha256 is locked");DB=e};Object.freeze(Vr);function vh(e){const g=ng(e,"data");return D(jB(g))}vh._=MB;vh.lock=function(){OB=!0};vh.register=function(e){if(OB)throw new Error("sha512 is locked");jB=e};Object.freeze(Vr);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const qB=BigInt(0),rA=BigInt(1),CJ=BigInt(2),iA=e=>e instanceof Uint8Array,sJ=Array.from({length:256},(e,g)=>g.toString(16).padStart(2,"0"));function Ar(e){if(!iA(e))throw new Error("Uint8Array expected");let g="";for(let t=0;t<e.length;t++)g+=sJ[e[t]];return g}function _B(e){const g=e.toString(16);return g.length&1?`0${g}`:g}function Nh(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function dr(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const g=e.length;if(g%2)throw new Error("padded hex string expected, got unpadded hex of length "+g);const t=new Uint8Array(g/2);for(let I=0;I<t.length;I++){const n=I*2,l=e.slice(n,n+2),C=Number.parseInt(l,16);if(Number.isNaN(C)||C<0)throw new Error("Invalid byte sequence");t[I]=C}return t}function CC(e){return Nh(Ar(e))}function Hh(e){if(!iA(e))throw new Error("Uint8Array expected");return Nh(Ar(Uint8Array.from(e).reverse()))}function ur(e,g){return dr(e.toString(16).padStart(g*2,"0"))}function Fh(e,g){return ur(e,g).reverse()}function rJ(e){return dr(_B(e))}function kt(e,g,t){let I;if(typeof g=="string")try{I=dr(g)}catch(l){throw new Error(`${e} must be valid hex string, got "${g}". Cause: ${l}`)}else if(iA(g))I=Uint8Array.from(g);else throw new Error(`${e} must be hex string or Uint8Array`);const n=I.length;if(typeof t=="number"&&n!==t)throw new Error(`${e} expected ${t} bytes, got ${n}`);return I}function Ri(...e){const g=new Uint8Array(e.reduce((I,n)=>I+n.length,0));let t=0;return e.forEach(I=>{if(!iA(I))throw new Error("Uint8Array expected");g.set(I,t),t+=I.length}),g}function iJ(e,g){if(e.length!==g.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==g[t])return!1;return!0}function aJ(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function oJ(e){let g;for(g=0;e>qB;e>>=rA,g+=1);return g}function cJ(e,g){return e>>BigInt(g)&rA}const AJ=(e,g,t)=>e|(t?rA:qB)<<BigInt(g),xh=e=>(CJ<<BigInt(e-1))-rA,md=e=>new Uint8Array(e),eZ=e=>Uint8Array.from(e);function $B(e,g,t){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof g!="number"||g<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let I=md(e),n=md(e),l=0;const C=()=>{I.fill(1),n.fill(0),l=0},s=(...c)=>t(n,I,...c),r=(c=md())=>{n=s(eZ([0]),c),I=s(),c.length!==0&&(n=s(eZ([1]),c),I=s())},a=()=>{if(l++>=1e3)throw new Error("drbg: tried 1000 values");let c=0;const A=[];for(;c<g;){I=s();const b=I.slice();A.push(b),c+=I.length}return Ri(...A)};return(c,A)=>{C(),r(c);let b;for(;!(b=A(a()));)r();return C(),b}}const dJ={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,g)=>g.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function pa(e,g,t={}){const I=(n,l,C)=>{const s=dJ[l];if(typeof s!="function")throw new Error(`Invalid validator "${l}", expected function`);const r=e[n];if(!(C&&r===void 0)&&!s(r,e))throw new Error(`Invalid param ${String(n)}=${r} (${typeof r}), expected ${l}`)};for(const[n,l]of Object.entries(g))I(n,l,!1);for(const[n,l]of Object.entries(t))I(n,l,!0);return e}const uJ=Object.freeze(Object.defineProperty({__proto__:null,bitGet:cJ,bitLen:oJ,bitMask:xh,bitSet:AJ,bytesToHex:Ar,bytesToNumberBE:CC,bytesToNumberLE:Hh,concatBytes:Ri,createHmacDrbg:$B,ensureBytes:kt,equalBytes:iJ,hexToBytes:dr,hexToNumber:Nh,numberToBytesBE:ur,numberToBytesLE:Fh,numberToHexUnpadded:_B,numberToVarBytesBE:rJ,utf8ToBytes:aJ,validateObject:pa},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Mg=BigInt(0),Ng=BigInt(1),Bl=BigInt(2),mJ=BigInt(3),Lu=BigInt(4),tZ=BigInt(5),IZ=BigInt(8);BigInt(9);BigInt(16);function Je(e,g){const t=e%g;return t>=Mg?t:g+t}function hJ(e,g,t){if(t<=Mg||g<Mg)throw new Error("Expected power/modulo > 0");if(t===Ng)return Mg;let I=Ng;for(;g>Mg;)g&Ng&&(I=I*e%t),e=e*e%t,g>>=Ng;return I}function Ct(e,g,t){let I=e;for(;g-- >Mg;)I*=I,I%=t;return I}function Tu(e,g){if(e===Mg||g<=Mg)throw new Error(`invert: expected positive integers, got n=${e} mod=${g}`);let t=Je(e,g),I=g,n=Mg,l=Ng;for(;t!==Mg;){const s=I/t,r=I%t,a=n-l*s;I=t,t=r,n=l,l=a}if(I!==Ng)throw new Error("invert: does not exist");return Je(n,g)}function bJ(e){const g=(e-Ng)/Bl;let t,I,n;for(t=e-Ng,I=0;t%Bl===Mg;t/=Bl,I++);for(n=Bl;n<e&&hJ(n,g,e)!==e-Ng;n++);if(I===1){const C=(e+Ng)/Lu;return function(r,a){const o=r.pow(a,C);if(!r.eql(r.sqr(o),a))throw new Error("Cannot find square root");return o}}const l=(t+Ng)/Bl;return function(s,r){if(s.pow(r,g)===s.neg(s.ONE))throw new Error("Cannot find square root");let a=I,o=s.pow(s.mul(s.ONE,n),t),c=s.pow(r,l),A=s.pow(r,t);for(;!s.eql(A,s.ONE);){if(s.eql(A,s.ZERO))return s.ZERO;let b=1;for(let Z=s.sqr(A);b<a&&!s.eql(Z,s.ONE);b++)Z=s.sqr(Z);const m=s.pow(o,Ng<<BigInt(a-b-1));o=s.sqr(m),c=s.mul(c,m),A=s.mul(A,o),a=b}return c}}function ZJ(e){if(e%Lu===mJ){const g=(e+Ng)/Lu;return function(I,n){const l=I.pow(n,g);if(!I.eql(I.sqr(l),n))throw new Error("Cannot find square root");return l}}if(e%IZ===tZ){const g=(e-tZ)/IZ;return function(I,n){const l=I.mul(n,Bl),C=I.pow(l,g),s=I.mul(n,C),r=I.mul(I.mul(s,Bl),C),a=I.mul(s,I.sub(r,I.ONE));if(!I.eql(I.sqr(a),n))throw new Error("Cannot find square root");return a}}return bJ(e)}const yJ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function GJ(e){const g={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=yJ.reduce((I,n)=>(I[n]="function",I),g);return pa(e,t)}function pJ(e,g,t){if(t<Mg)throw new Error("Expected power > 0");if(t===Mg)return e.ONE;if(t===Ng)return g;let I=e.ONE,n=g;for(;t>Mg;)t&Ng&&(I=e.mul(I,n)),n=e.sqr(n),t>>=Ng;return I}function BJ(e,g){const t=new Array(g.length),I=g.reduce((l,C,s)=>e.is0(C)?l:(t[s]=l,e.mul(l,C)),e.ONE),n=e.inv(I);return g.reduceRight((l,C,s)=>e.is0(C)?l:(t[s]=e.mul(l,t[s]),e.mul(l,C)),n),t}function gf(e,g){const t=g!==void 0?g:e.toString(2).length,I=Math.ceil(t/8);return{nBitLength:t,nByteLength:I}}function fJ(e,g,t=!1,I={}){if(e<=Mg)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:n,nByteLength:l}=gf(e,g);if(l>2048)throw new Error("Field lengths over 2048 bytes are not supported");const C=ZJ(e),s=Object.freeze({ORDER:e,BITS:n,BYTES:l,MASK:xh(n),ZERO:Mg,ONE:Ng,create:r=>Je(r,e),isValid:r=>{if(typeof r!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof r}`);return Mg<=r&&r<e},is0:r=>r===Mg,isOdd:r=>(r&Ng)===Ng,neg:r=>Je(-r,e),eql:(r,a)=>r===a,sqr:r=>Je(r*r,e),add:(r,a)=>Je(r+a,e),sub:(r,a)=>Je(r-a,e),mul:(r,a)=>Je(r*a,e),pow:(r,a)=>pJ(s,r,a),div:(r,a)=>Je(r*Tu(a,e),e),sqrN:r=>r*r,addN:(r,a)=>r+a,subN:(r,a)=>r-a,mulN:(r,a)=>r*a,inv:r=>Tu(r,e),sqrt:I.sqrt||(r=>C(s,r)),invertBatch:r=>BJ(s,r),cmov:(r,a,o)=>o?a:r,toBytes:r=>t?Fh(r,l):ur(r,l),fromBytes:r=>{if(r.length!==l)throw new Error(`Fp.fromBytes: expected ${l}, got ${r.length}`);return t?Hh(r):CC(r)}});return Object.freeze(s)}function ef(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const g=e.toString(2).length;return Math.ceil(g/8)}function tf(e){const g=ef(e);return g+Math.ceil(g/2)}function VJ(e,g,t=!1){const I=e.length,n=ef(g),l=tf(g);if(I<16||I<l||I>1024)throw new Error(`expected ${l}-1024 bytes of input, got ${I}`);const C=t?CC(e):Hh(e),s=Je(C,g-Ng)+Ng;return t?Fh(s,n):ur(s,n)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const WJ=BigInt(0),hd=BigInt(1);function SJ(e,g){const t=(n,l)=>{const C=l.negate();return n?C:l},I=n=>{const l=Math.ceil(g/n)+1,C=2**(n-1);return{windows:l,windowSize:C}};return{constTimeNegate:t,unsafeLadder(n,l){let C=e.ZERO,s=n;for(;l>WJ;)l&hd&&(C=C.add(s)),s=s.double(),l>>=hd;return C},precomputeWindow(n,l){const{windows:C,windowSize:s}=I(l),r=[];let a=n,o=a;for(let c=0;c<C;c++){o=a,r.push(o);for(let A=1;A<s;A++)o=o.add(a),r.push(o);a=o.double()}return r},wNAF(n,l,C){const{windows:s,windowSize:r}=I(n);let a=e.ZERO,o=e.BASE;const c=BigInt(2**n-1),A=2**n,b=BigInt(n);for(let m=0;m<s;m++){const Z=m*r;let G=Number(C&c);C>>=b,G>r&&(G-=A,C+=hd);const h=Z,u=Z+Math.abs(G)-1,y=m%2!==0,W=G<0;G===0?o=o.add(t(y,l[h])):a=a.add(t(W,l[u]))}return{p:a,f:o}},wNAFCached(n,l,C,s){const r=n._WINDOW_SIZE||1;let a=l.get(n);return a||(a=this.precomputeWindow(n,r),r!==1&&l.set(n,s(a))),this.wNAF(r,a,C)}}}function If(e){return GJ(e.Fp),pa(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...gf(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function RJ(e){const g=If(e);pa(g,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:I,a:n}=g;if(t){if(!I.eql(n,I.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...g})}const{bytesToNumberBE:kJ,hexToBytes:XJ}=uJ,Jl={Err:class extends Error{constructor(g=""){super(g)}},_parseInt(e){const{Err:g}=Jl;if(e.length<2||e[0]!==2)throw new g("Invalid signature integer tag");const t=e[1],I=e.subarray(2,t+2);if(!t||I.length!==t)throw new g("Invalid signature integer: wrong length");if(I[0]&128)throw new g("Invalid signature integer: negative");if(I[0]===0&&!(I[1]&128))throw new g("Invalid signature integer: unnecessary leading zero");return{d:kJ(I),l:e.subarray(t+2)}},toSig(e){const{Err:g}=Jl,t=typeof e=="string"?XJ(e):e;if(!(t instanceof Uint8Array))throw new Error("ui8a expected");let I=t.length;if(I<2||t[0]!=48)throw new g("Invalid signature tag");if(t[1]!==I-2)throw new g("Invalid signature: incorrect length");const{d:n,l}=Jl._parseInt(t.subarray(2)),{d:C,l:s}=Jl._parseInt(l);if(s.length)throw new g("Invalid signature: left bytes after parsing");return{r:n,s:C}},hexFromSig(e){const g=a=>Number.parseInt(a[0],16)&8?"00"+a:a,t=a=>{const o=a.toString(16);return o.length&1?`0${o}`:o},I=g(t(e.s)),n=g(t(e.r)),l=I.length/2,C=n.length/2,s=t(l),r=t(C);return`30${t(C+l+4)}02${r}${n}02${s}${I}`}},QI=BigInt(0),ht=BigInt(1);BigInt(2);const nZ=BigInt(3);BigInt(4);function JJ(e){const g=RJ(e),{Fp:t}=g,I=g.toBytes||((m,Z,G)=>{const h=Z.toAffine();return Ri(Uint8Array.from([4]),t.toBytes(h.x),t.toBytes(h.y))}),n=g.fromBytes||(m=>{const Z=m.subarray(1),G=t.fromBytes(Z.subarray(0,t.BYTES)),h=t.fromBytes(Z.subarray(t.BYTES,2*t.BYTES));return{x:G,y:h}});function l(m){const{a:Z,b:G}=g,h=t.sqr(m),u=t.mul(h,m);return t.add(t.add(u,t.mul(m,Z)),G)}if(!t.eql(t.sqr(g.Gy),l(g.Gx)))throw new Error("bad generator point: equation left != right");function C(m){return typeof m=="bigint"&&QI<m&&m<g.n}function s(m){if(!C(m))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function r(m){const{allowedPrivateKeyLengths:Z,nByteLength:G,wrapPrivateKey:h,n:u}=g;if(Z&&typeof m!="bigint"){if(m instanceof Uint8Array&&(m=Ar(m)),typeof m!="string"||!Z.includes(m.length))throw new Error("Invalid key");m=m.padStart(G*2,"0")}let y;try{y=typeof m=="bigint"?m:CC(kt("private key",m,G))}catch{throw new Error(`private key must be ${G} bytes, hex or bigint, not ${typeof m}`)}return h&&(y=Je(y,u)),s(y),y}const a=new Map;function o(m){if(!(m instanceof c))throw new Error("ProjectivePoint expected")}class c{constructor(Z,G,h){if(this.px=Z,this.py=G,this.pz=h,Z==null||!t.isValid(Z))throw new Error("x required");if(G==null||!t.isValid(G))throw new Error("y required");if(h==null||!t.isValid(h))throw new Error("z required")}static fromAffine(Z){const{x:G,y:h}=Z||{};if(!Z||!t.isValid(G)||!t.isValid(h))throw new Error("invalid affine point");if(Z instanceof c)throw new Error("projective point not allowed");const u=y=>t.eql(y,t.ZERO);return u(G)&&u(h)?c.ZERO:new c(G,h,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(Z){const G=t.invertBatch(Z.map(h=>h.pz));return Z.map((h,u)=>h.toAffine(G[u])).map(c.fromAffine)}static fromHex(Z){const G=c.fromAffine(n(kt("pointHex",Z)));return G.assertValidity(),G}static fromPrivateKey(Z){return c.BASE.multiply(r(Z))}_setWindowSize(Z){this._WINDOW_SIZE=Z,a.delete(this)}assertValidity(){if(this.is0()){if(g.allowInfinityPoint&&!t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:Z,y:G}=this.toAffine();if(!t.isValid(Z)||!t.isValid(G))throw new Error("bad point: x or y not FE");const h=t.sqr(G),u=l(Z);if(!t.eql(h,u))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:Z}=this.toAffine();if(t.isOdd)return!t.isOdd(Z);throw new Error("Field doesn't support isOdd")}equals(Z){o(Z);const{px:G,py:h,pz:u}=this,{px:y,py:W,pz:S}=Z,J=t.eql(t.mul(G,S),t.mul(y,u)),f=t.eql(t.mul(h,S),t.mul(W,u));return J&&f}negate(){return new c(this.px,t.neg(this.py),this.pz)}double(){const{a:Z,b:G}=g,h=t.mul(G,nZ),{px:u,py:y,pz:W}=this;let S=t.ZERO,J=t.ZERO,f=t.ZERO,X=t.mul(u,u),U=t.mul(y,y),Y=t.mul(W,W),N=t.mul(u,y);return N=t.add(N,N),f=t.mul(u,W),f=t.add(f,f),S=t.mul(Z,f),J=t.mul(h,Y),J=t.add(S,J),S=t.sub(U,J),J=t.add(U,J),J=t.mul(S,J),S=t.mul(N,S),f=t.mul(h,f),Y=t.mul(Z,Y),N=t.sub(X,Y),N=t.mul(Z,N),N=t.add(N,f),f=t.add(X,X),X=t.add(f,X),X=t.add(X,Y),X=t.mul(X,N),J=t.add(J,X),Y=t.mul(y,W),Y=t.add(Y,Y),X=t.mul(Y,N),S=t.sub(S,X),f=t.mul(Y,U),f=t.add(f,f),f=t.add(f,f),new c(S,J,f)}add(Z){o(Z);const{px:G,py:h,pz:u}=this,{px:y,py:W,pz:S}=Z;let J=t.ZERO,f=t.ZERO,X=t.ZERO;const U=g.a,Y=t.mul(g.b,nZ);let N=t.mul(G,y),j=t.mul(h,W),_=t.mul(u,S),tg=t.add(G,h),F=t.add(y,W);tg=t.mul(tg,F),F=t.add(N,j),tg=t.sub(tg,F),F=t.add(G,u);let T=t.add(y,S);return F=t.mul(F,T),T=t.add(N,_),F=t.sub(F,T),T=t.add(h,u),J=t.add(W,S),T=t.mul(T,J),J=t.add(j,_),T=t.sub(T,J),X=t.mul(U,F),J=t.mul(Y,_),X=t.add(J,X),J=t.sub(j,X),X=t.add(j,X),f=t.mul(J,X),j=t.add(N,N),j=t.add(j,N),_=t.mul(U,_),F=t.mul(Y,F),j=t.add(j,_),_=t.sub(N,_),_=t.mul(U,_),F=t.add(F,_),N=t.mul(j,F),f=t.add(f,N),N=t.mul(T,F),J=t.mul(tg,J),J=t.sub(J,N),N=t.mul(tg,j),X=t.mul(T,X),X=t.add(X,N),new c(J,f,X)}subtract(Z){return this.add(Z.negate())}is0(){return this.equals(c.ZERO)}wNAF(Z){return b.wNAFCached(this,a,Z,G=>{const h=t.invertBatch(G.map(u=>u.pz));return G.map((u,y)=>u.toAffine(h[y])).map(c.fromAffine)})}multiplyUnsafe(Z){const G=c.ZERO;if(Z===QI)return G;if(s(Z),Z===ht)return this;const{endo:h}=g;if(!h)return b.unsafeLadder(this,Z);let{k1neg:u,k1:y,k2neg:W,k2:S}=h.splitScalar(Z),J=G,f=G,X=this;for(;y>QI||S>QI;)y&ht&&(J=J.add(X)),S&ht&&(f=f.add(X)),X=X.double(),y>>=ht,S>>=ht;return u&&(J=J.negate()),W&&(f=f.negate()),f=new c(t.mul(f.px,h.beta),f.py,f.pz),J.add(f)}multiply(Z){s(Z);let G=Z,h,u;const{endo:y}=g;if(y){const{k1neg:W,k1:S,k2neg:J,k2:f}=y.splitScalar(G);let{p:X,f:U}=this.wNAF(S),{p:Y,f:N}=this.wNAF(f);X=b.constTimeNegate(W,X),Y=b.constTimeNegate(J,Y),Y=new c(t.mul(Y.px,y.beta),Y.py,Y.pz),h=X.add(Y),u=U.add(N)}else{const{p:W,f:S}=this.wNAF(G);h=W,u=S}return c.normalizeZ([h,u])[0]}multiplyAndAddUnsafe(Z,G,h){const u=c.BASE,y=(S,J)=>J===QI||J===ht||!S.equals(u)?S.multiplyUnsafe(J):S.multiply(J),W=y(this,G).add(y(Z,h));return W.is0()?void 0:W}toAffine(Z){const{px:G,py:h,pz:u}=this,y=this.is0();Z==null&&(Z=y?t.ONE:t.inv(u));const W=t.mul(G,Z),S=t.mul(h,Z),J=t.mul(u,Z);if(y)return{x:t.ZERO,y:t.ZERO};if(!t.eql(J,t.ONE))throw new Error("invZ was invalid");return{x:W,y:S}}isTorsionFree(){const{h:Z,isTorsionFree:G}=g;if(Z===ht)return!0;if(G)return G(c,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:Z,clearCofactor:G}=g;return Z===ht?this:G?G(c,this):this.multiplyUnsafe(g.h)}toRawBytes(Z=!0){return this.assertValidity(),I(c,this,Z)}toHex(Z=!0){return Ar(this.toRawBytes(Z))}}c.BASE=new c(g.Gx,g.Gy,t.ONE),c.ZERO=new c(t.ZERO,t.ONE,t.ZERO);const A=g.nBitLength,b=SJ(c,g.endo?Math.ceil(A/2):A);return{CURVE:g,ProjectivePoint:c,normPrivateKeyToScalar:r,weierstrassEquation:l,isWithinCurveOrder:C}}function wJ(e){const g=If(e);return pa(g,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...g})}function YJ(e){const g=wJ(e),{Fp:t,n:I}=g,n=t.BYTES+1,l=2*t.BYTES+1;function C(F){return QI<F&&F<t.ORDER}function s(F){return Je(F,I)}function r(F){return Tu(F,I)}const{ProjectivePoint:a,normPrivateKeyToScalar:o,weierstrassEquation:c,isWithinCurveOrder:A}=JJ({...g,toBytes(F,T,gg){const x=T.toAffine(),L=t.toBytes(x.x),v=Ri;return gg?v(Uint8Array.from([T.hasEvenY()?2:3]),L):v(Uint8Array.from([4]),L,t.toBytes(x.y))},fromBytes(F){const T=F.length,gg=F[0],x=F.subarray(1);if(T===n&&(gg===2||gg===3)){const L=CC(x);if(!C(L))throw new Error("Point is not on curve");const v=c(L);let z=t.sqrt(v);const M=(z&ht)===ht;return(gg&1)===1!==M&&(z=t.neg(z)),{x:L,y:z}}else if(T===l&&gg===4){const L=t.fromBytes(x.subarray(0,t.BYTES)),v=t.fromBytes(x.subarray(t.BYTES,2*t.BYTES));return{x:L,y:v}}else throw new Error(`Point of length ${T} was invalid. Expected ${n} compressed bytes or ${l} uncompressed bytes`)}}),b=F=>Ar(ur(F,g.nByteLength));function m(F){const T=I>>ht;return F>T}function Z(F){return m(F)?s(-F):F}const G=(F,T,gg)=>CC(F.slice(T,gg));class h{constructor(T,gg,x){this.r=T,this.s=gg,this.recovery=x,this.assertValidity()}static fromCompact(T){const gg=g.nByteLength;return T=kt("compactSignature",T,gg*2),new h(G(T,0,gg),G(T,gg,2*gg))}static fromDER(T){const{r:gg,s:x}=Jl.toSig(kt("DER",T));return new h(gg,x)}assertValidity(){if(!A(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!A(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(T){return new h(this.r,this.s,T)}recoverPublicKey(T){const{r:gg,s:x,recovery:L}=this,v=f(kt("msgHash",T));if(L==null||![0,1,2,3].includes(L))throw new Error("recovery id invalid");const z=L===2||L===3?gg+g.n:gg;if(z>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const M=L&1?"03":"02",hg=a.fromHex(M+b(z)),wg=r(z),Ue=s(-v*wg),ze=s(x*wg),Qe=a.BASE.multiplyAndAddUnsafe(hg,Ue,ze);if(!Qe)throw new Error("point at infinify");return Qe.assertValidity(),Qe}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return dr(this.toDERHex())}toDERHex(){return Jl.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return dr(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}const u={isValidPrivateKey(F){try{return o(F),!0}catch{return!1}},normPrivateKeyToScalar:o,randomPrivateKey:()=>{const F=tf(g.n);return VJ(g.randomBytes(F),g.n)},precompute(F=8,T=a.BASE){return T._setWindowSize(F),T.multiply(BigInt(3)),T}};function y(F,T=!0){return a.fromPrivateKey(F).toRawBytes(T)}function W(F){const T=F instanceof Uint8Array,gg=typeof F=="string",x=(T||gg)&&F.length;return T?x===n||x===l:gg?x===2*n||x===2*l:F instanceof a}function S(F,T,gg=!0){if(W(F))throw new Error("first arg must be private key");if(!W(T))throw new Error("second arg must be public key");return a.fromHex(T).multiply(o(F)).toRawBytes(gg)}const J=g.bits2int||function(F){const T=CC(F),gg=F.length*8-g.nBitLength;return gg>0?T>>BigInt(gg):T},f=g.bits2int_modN||function(F){return s(J(F))},X=xh(g.nBitLength);function U(F){if(typeof F!="bigint")throw new Error("bigint expected");if(!(QI<=F&&F<X))throw new Error(`bigint expected < 2^${g.nBitLength}`);return ur(F,g.nByteLength)}function Y(F,T,gg=N){if(["recovered","canonical"].some(Al=>Al in gg))throw new Error("sign() legacy options not supported");const{hash:x,randomBytes:L}=g;let{lowS:v,prehash:z,extraEntropy:M}=gg;v==null&&(v=!0),F=kt("msgHash",F),z&&(F=kt("prehashed msgHash",x(F)));const hg=f(F),wg=o(T),Ue=[U(wg),U(hg)];if(M!=null){const Al=M===!0?L(t.BYTES):M;Ue.push(kt("extraEntropy",Al))}const ze=Ri(...Ue),Qe=hg;function xA(Al){const WC=J(Al);if(!A(WC))return;const h0=r(WC),SC=a.BASE.multiply(WC).toAffine(),Vt=s(SC.x);if(Vt===QI)return;const RC=s(h0*s(Qe+Vt*wg));if(RC===QI)return;let b0=(SC.x===Vt?0:2)|Number(SC.y&ht),Z0=RC;return v&&m(RC)&&(Z0=Z(RC),b0^=1),new h(Vt,Z0,b0)}return{seed:ze,k2sig:xA}}const N={lowS:g.lowS,prehash:!1},j={lowS:g.lowS,prehash:!1};function _(F,T,gg=N){const{seed:x,k2sig:L}=Y(F,T,gg),v=g;return $B(v.hash.outputLen,v.nByteLength,v.hmac)(x,L)}a.BASE._setWindowSize(8);function tg(F,T,gg,x=j){var SC;const L=F;if(T=kt("msgHash",T),gg=kt("publicKey",gg),"strict"in x)throw new Error("options.strict was renamed to lowS");const{lowS:v,prehash:z}=x;let M,hg;try{if(typeof L=="string"||L instanceof Uint8Array)try{M=h.fromDER(L)}catch(Vt){if(!(Vt instanceof Jl.Err))throw Vt;M=h.fromCompact(L)}else if(typeof L=="object"&&typeof L.r=="bigint"&&typeof L.s=="bigint"){const{r:Vt,s:RC}=L;M=new h(Vt,RC)}else throw new Error("PARSE");hg=a.fromHex(gg)}catch(Vt){if(Vt.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(v&&M.hasHighS())return!1;z&&(T=g.hash(T));const{r:wg,s:Ue}=M,ze=f(T),Qe=r(Ue),xA=s(ze*Qe),Al=s(wg*Qe),WC=(SC=a.BASE.multiplyAndAddUnsafe(hg,xA,Al))==null?void 0:SC.toAffine();return WC?s(WC.x)===wg:!1}return{CURVE:g,getPublicKey:y,getSharedSecret:S,sign:_,verify:tg,ProjectivePoint:a,Signature:h,utils:u}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function vJ(e){return{hash:e,hmac:(g,...t)=>CA(e,g,hX(...t)),randomBytes:yX}}function NJ(e,g){const t=I=>YJ({...e,...vJ(I)});return Object.freeze({...t(g),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const nf=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),lZ=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),HJ=BigInt(1),Mu=BigInt(2),CZ=(e,g)=>(e+g/Mu)/g;function FJ(e){const g=nf,t=BigInt(3),I=BigInt(6),n=BigInt(11),l=BigInt(22),C=BigInt(23),s=BigInt(44),r=BigInt(88),a=e*e*e%g,o=a*a*e%g,c=Ct(o,t,g)*o%g,A=Ct(c,t,g)*o%g,b=Ct(A,Mu,g)*a%g,m=Ct(b,n,g)*b%g,Z=Ct(m,l,g)*m%g,G=Ct(Z,s,g)*Z%g,h=Ct(G,r,g)*G%g,u=Ct(h,s,g)*Z%g,y=Ct(u,t,g)*o%g,W=Ct(y,C,g)*m%g,S=Ct(W,I,g)*a%g,J=Ct(S,Mu,g);if(!Du.eql(Du.sqr(J),e))throw new Error("Cannot find square root");return J}const Du=fJ(nf,void 0,void 0,{sqrt:FJ}),un=NJ({a:BigInt(0),b:BigInt(7),Fp:Du,n:lZ,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const g=lZ,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),I=-HJ*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),l=t,C=BigInt("0x100000000000000000000000000000000"),s=CZ(l*e,g),r=CZ(-I*e,g);let a=Je(e-s*t-r*n,g),o=Je(-s*I-r*l,g);const c=a>C,A=o>C;if(c&&(a=g-a),A&&(o=g-o),a>C||o>C)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:c,k1:a,k2neg:A,k2:o}}}},sA);BigInt(0);un.ProjectivePoint;const ki="0x0000000000000000000000000000000000000000",sZ="0x0000000000000000000000000000000000000000000000000000000000000000",rZ=BigInt(0),iZ=BigInt(1),ju=BigInt(2),aZ=BigInt(27),oZ=BigInt(28),_a=BigInt(35),lf=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),xJ=lf/ju,KJ=Symbol.for("nodejs.util.inspect.custom"),ul={};function bd(e){return tn(Kg(e),32)}var Zs,tI,ys,Vn;const at=class at{constructor(g,t,I,n){k(this,Zs,void 0);k(this,tI,void 0);k(this,ys,void 0);k(this,Vn,void 0);Za(g,ul,"Signature"),p(this,Zs,t),p(this,tI,I),p(this,ys,n),p(this,Vn,null)}get r(){return d(this,Zs)}set r(g){V(ss(g)===32,"invalid r","value",g),p(this,Zs,D(g))}get s(){return V(parseInt(d(this,tI).substring(0,3))<8,"non-canonical s; use ._s","s",d(this,tI)),d(this,tI)}set s(g){V(ss(g)===32,"invalid s","value",g),p(this,tI,D(g))}get _s(){return d(this,tI)}isValid(){return BigInt(d(this,tI))<=xJ}get v(){return d(this,ys)}set v(g){const t=Ig(g,"value");V(t===27||t===28,"invalid v","v",g),p(this,ys,t)}get networkV(){return d(this,Vn)}get legacyChainId(){const g=this.networkV;return g==null?null:at.getChainId(g)}get yParity(){return this.v===27?0:1}get yParityAndS(){const g=ng(this.s);return this.yParity&&(g[0]|=128),D(g)}get compactSerialized(){return pg([this.r,this.yParityAndS])}get serialized(){return pg([this.r,this.s,this.yParity?"0x1c":"0x1b"])}getCanonical(){if(this.isValid())return this;const g=lf-BigInt(this._s),t=55-this.v,I=new at(ul,this.r,bd(g),t);return this.networkV&&p(I,Vn,this.networkV),I}clone(){const g=new at(ul,this.r,this._s,this.v);return this.networkV&&p(g,Vn,this.networkV),g}toJSON(){const g=this.networkV;return{_type:"signature",networkV:g!=null?g.toString():null,r:this.r,s:this._s,v:this.v}}[KJ](){return this.toString()}toString(){return this.isValid()?`Signature { r: ${this.r}, s: ${this._s}, v: ${this.v} }`:`Signature { r: ${this.r}, s: ${this._s}, v: ${this.v}, valid: false }`}static getChainId(g){const t=q(g,"v");return t==aZ||t==oZ?rZ:(V(t>=_a,"invalid EIP-155 v","v",g),(t-_a)/ju)}static getChainIdV(g,t){return q(g)*ju+BigInt(35+t-27)}static getNormalizedV(g){const t=q(g);return t===rZ||t===aZ?27:t===iZ||t===oZ?28:(V(t>=_a,"invalid v","v",g),t&iZ?27:28)}static from(g){function t(a,o){V(a,o,"signature",g)}if(g==null)return new at(ul,sZ,sZ,27);if(typeof g=="string"){const a=ng(g,"signature");if(a.length===64){const o=D(a.slice(0,32)),c=a.slice(32,64),A=c[0]&128?28:27;return c[0]&=127,new at(ul,o,D(c),A)}if(a.length===65){const o=D(a.slice(0,32)),c=D(a.slice(32,64)),A=at.getNormalizedV(a[64]);return new at(ul,o,c,A)}t(!1,"invalid raw signature length")}if(g instanceof at)return g.clone();const I=g.r;t(I!=null,"missing r");const n=bd(I),l=function(a,o){if(a!=null)return bd(a);if(o!=null){t(Zg(o,32),"invalid yParityAndS");const c=ng(o);return c[0]&=127,D(c)}t(!1,"missing s")}(g.s,g.yParityAndS),{networkV:C,v:s}=function(a,o,c){if(a!=null){const A=q(a);return{networkV:A>=_a?A:void 0,v:at.getNormalizedV(A)}}if(o!=null)return t(Zg(o,32),"invalid yParityAndS"),{v:ng(o)[0]&128?28:27};if(c!=null){switch(Ig(c,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}t(!1,"invalid yParity")}t(!1,"missing v")}(g.v,g.yParityAndS,g.yParity),r=new at(ul,n,l,s);return C&&p(r,Vn,C),t(g.yParity==null||Ig(g.yParity,"sig.yParity")===r.yParity,"yParity mismatch"),t(g.yParityAndS==null||g.yParityAndS===r.yParityAndS,"yParityAndS mismatch"),r}};Zs=new WeakMap,tI=new WeakMap,ys=new WeakMap,Vn=new WeakMap;let xe=at;var NI;const fl=class fl{constructor(g){k(this,NI,void 0);V(ss(g)===32,"invalid private key","privateKey","[REDACTED]"),p(this,NI,D(g))}get privateKey(){return d(this,NI)}get publicKey(){return fl.computePublicKey(d(this,NI))}get compressedPublicKey(){return fl.computePublicKey(d(this,NI),!0)}sign(g){V(ss(g)===32,"invalid digest length","digest",g);const t=un.sign(ye(g),ye(d(this,NI)),{lowS:!0});return xe.from({r:Il(t.r,32),s:Il(t.s,32),v:t.recovery?28:27})}computeSharedSecret(g){const t=fl.computePublicKey(g);return D(un.getSharedSecret(ye(d(this,NI)),ng(t),!1))}static computePublicKey(g,t){let I=ng(g,"key");if(I.length===32){const l=un.getPublicKey(I,!!t);return D(l)}if(I.length===64){const l=new Uint8Array(65);l[0]=4,l.set(I,1),I=l}const n=un.ProjectivePoint.fromHex(I);return D(n.toRawBytes(t))}static recoverPublicKey(g,t){V(ss(g)===32,"invalid digest length","digest",g);const I=xe.from(t);let n=un.Signature.fromCompact(ye(pg([I.r,I.s])));n=n.addRecoveryBit(I.yParity);const l=n.recoverPublicKey(ye(g));return V(l!=null,"invalid signature for digest","signature",t),"0x"+l.toHex(!1)}static addPoints(g,t,I){const n=un.ProjectivePoint.fromHex(fl.computePublicKey(g).substring(2)),l=un.ProjectivePoint.fromHex(fl.computePublicKey(t).substring(2));return"0x"+n.add(l).toHex(!!I)}};NI=new WeakMap;let Xi=fl;const EJ=BigInt(0),UJ=BigInt(36);function cZ(e){e=e.toLowerCase();const g=e.substring(2).split(""),t=new Uint8Array(40);for(let n=0;n<40;n++)t[n]=g[n].charCodeAt(0);const I=ng(Hg(t));for(let n=0;n<40;n+=2)I[n>>1]>>4>=8&&(g[n]=g[n].toUpperCase()),(I[n>>1]&15)>=8&&(g[n+1]=g[n+1].toUpperCase());return"0x"+g.join("")}const Kh={};for(let e=0;e<10;e++)Kh[String(e)]=String(e);for(let e=0;e<26;e++)Kh[String.fromCharCode(65+e)]=String(10+e);const AZ=15;function Cf(e){e=e.toUpperCase(),e=e.substring(4)+e.substring(0,2)+"00";let g=e.split("").map(I=>Kh[I]).join("");for(;g.length>=AZ;){let I=g.substring(0,AZ);g=parseInt(I,10)%97+g.substring(I.length)}let t=String(98-parseInt(g,10)%97);for(;t.length<2;)t="0"+t;return t}const zJ=function(){const e={};for(let g=0;g<36;g++){const t="0123456789abcdefghijklmnopqrstuvwxyz"[g];e[t]=BigInt(g)}return e}();function QJ(e){e=e.toLowerCase();let g=EJ;for(let t=0;t<e.length;t++)g=g*UJ+zJ[e[t]];return g}function ag(e){if(V(typeof e=="string","invalid address","address",e),e.match(/^(0x)?[0-9a-fA-F]{40}$/)){e.startsWith("0x")||(e="0x"+e);const g=cZ(e);return V(!e.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||g===e,"bad address checksum","address",e),g}if(e.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){V(e.substring(2,4)===Cf(e),"bad icap checksum","address",e);let g=QJ(e.substring(4)).toString(16);for(;g.length<40;)g="0"+g;return cZ("0x"+g)}V(!1,"invalid address","address",e)}function V9(e){let g=BigInt(ag(e)).toString(36).toUpperCase();for(;g.length<30;)g="0"+g;return"XE"+Cf("XE00"+g)+g}function LJ(e){const g=ag(e.from);let I=q(e.nonce,"tx.nonce").toString(16);return I==="0"?I="0x":I.length%2?I="0x0"+I:I="0x"+I,ag(Vg(Hg(jI([g,I])),12))}function W9(e,g,t){const I=ag(e),n=ng(g,"salt"),l=ng(t,"initCodeHash");return V(n.length===32,"salt must be 32 bytes","salt",g),V(l.length===32,"initCodeHash must be 32 bytes","initCodeHash",t),ag(Vg(Hg(pg(["0xff",I,n,l])),12))}function sf(e){return e&&typeof e.getAddress=="function"}function S9(e){try{return ag(e),!0}catch{}return!1}async function Zd(e,g){const t=await g;return(t==null||t==="0x0000000000000000000000000000000000000000")&&(H(typeof e!="string","unconfigured name","UNCONFIGURED_NAME",{value:e}),V(!1,"invalid AddressLike value; did not resolve to a value address","target",e)),ag(t)}function pe(e,g){if(typeof e=="string")return e.match(/^0x[0-9a-f]{40}$/i)?ag(e):(H(g!=null,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),Zd(e,g.resolveName(e)));if(sf(e))return Zd(e,e.getAddress());if(e&&typeof e.then=="function")return Zd(e,e);V(!1,"unsupported addressable value","target",e)}const SI={};function P(e,g){let t=!1;return g<0&&(t=!0,g*=-1),new Ae(SI,`${t?"":"u"}int${g}`,e,{signed:t,width:g})}function cg(e,g){return new Ae(SI,`bytes${g||""}`,e,{size:g})}const dZ=Symbol.for("_ethers_typed");var Ll;const RI=class RI{constructor(g,t,I,n){R(this,"type");R(this,"value");k(this,Ll,void 0);R(this,"_typedSymbol");n==null&&(n=null),Za(SI,g,"Typed"),$(this,{_typedSymbol:dZ,type:t,value:I}),p(this,Ll,n),this.format()}format(){if(this.type==="array")throw new Error("");if(this.type==="dynamicArray")throw new Error("");return this.type==="tuple"?`tuple(${this.value.map(g=>g.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return this.type==="string"}get tupleName(){if(this.type!=="tuple")throw TypeError("not a tuple");return d(this,Ll)}get arrayLength(){if(this.type!=="array")throw TypeError("not an array");return d(this,Ll)===!0?-1:d(this,Ll)===!1?this.value.length:null}static from(g,t){return new RI(SI,g,t)}static uint8(g){return P(g,8)}static uint16(g){return P(g,16)}static uint24(g){return P(g,24)}static uint32(g){return P(g,32)}static uint40(g){return P(g,40)}static uint48(g){return P(g,48)}static uint56(g){return P(g,56)}static uint64(g){return P(g,64)}static uint72(g){return P(g,72)}static uint80(g){return P(g,80)}static uint88(g){return P(g,88)}static uint96(g){return P(g,96)}static uint104(g){return P(g,104)}static uint112(g){return P(g,112)}static uint120(g){return P(g,120)}static uint128(g){return P(g,128)}static uint136(g){return P(g,136)}static uint144(g){return P(g,144)}static uint152(g){return P(g,152)}static uint160(g){return P(g,160)}static uint168(g){return P(g,168)}static uint176(g){return P(g,176)}static uint184(g){return P(g,184)}static uint192(g){return P(g,192)}static uint200(g){return P(g,200)}static uint208(g){return P(g,208)}static uint216(g){return P(g,216)}static uint224(g){return P(g,224)}static uint232(g){return P(g,232)}static uint240(g){return P(g,240)}static uint248(g){return P(g,248)}static uint256(g){return P(g,256)}static uint(g){return P(g,256)}static int8(g){return P(g,-8)}static int16(g){return P(g,-16)}static int24(g){return P(g,-24)}static int32(g){return P(g,-32)}static int40(g){return P(g,-40)}static int48(g){return P(g,-48)}static int56(g){return P(g,-56)}static int64(g){return P(g,-64)}static int72(g){return P(g,-72)}static int80(g){return P(g,-80)}static int88(g){return P(g,-88)}static int96(g){return P(g,-96)}static int104(g){return P(g,-104)}static int112(g){return P(g,-112)}static int120(g){return P(g,-120)}static int128(g){return P(g,-128)}static int136(g){return P(g,-136)}static int144(g){return P(g,-144)}static int152(g){return P(g,-152)}static int160(g){return P(g,-160)}static int168(g){return P(g,-168)}static int176(g){return P(g,-176)}static int184(g){return P(g,-184)}static int192(g){return P(g,-192)}static int200(g){return P(g,-200)}static int208(g){return P(g,-208)}static int216(g){return P(g,-216)}static int224(g){return P(g,-224)}static int232(g){return P(g,-232)}static int240(g){return P(g,-240)}static int248(g){return P(g,-248)}static int256(g){return P(g,-256)}static int(g){return P(g,-256)}static bytes1(g){return cg(g,1)}static bytes2(g){return cg(g,2)}static bytes3(g){return cg(g,3)}static bytes4(g){return cg(g,4)}static bytes5(g){return cg(g,5)}static bytes6(g){return cg(g,6)}static bytes7(g){return cg(g,7)}static bytes8(g){return cg(g,8)}static bytes9(g){return cg(g,9)}static bytes10(g){return cg(g,10)}static bytes11(g){return cg(g,11)}static bytes12(g){return cg(g,12)}static bytes13(g){return cg(g,13)}static bytes14(g){return cg(g,14)}static bytes15(g){return cg(g,15)}static bytes16(g){return cg(g,16)}static bytes17(g){return cg(g,17)}static bytes18(g){return cg(g,18)}static bytes19(g){return cg(g,19)}static bytes20(g){return cg(g,20)}static bytes21(g){return cg(g,21)}static bytes22(g){return cg(g,22)}static bytes23(g){return cg(g,23)}static bytes24(g){return cg(g,24)}static bytes25(g){return cg(g,25)}static bytes26(g){return cg(g,26)}static bytes27(g){return cg(g,27)}static bytes28(g){return cg(g,28)}static bytes29(g){return cg(g,29)}static bytes30(g){return cg(g,30)}static bytes31(g){return cg(g,31)}static bytes32(g){return cg(g,32)}static address(g){return new RI(SI,"address",g)}static bool(g){return new RI(SI,"bool",!!g)}static bytes(g){return new RI(SI,"bytes",g)}static string(g){return new RI(SI,"string",g)}static array(g,t){throw new Error("not implemented yet")}static tuple(g,t){throw new Error("not implemented yet")}static overrides(g){return new RI(SI,"overrides",Object.assign({},g))}static isTyped(g){return g&&typeof g=="object"&&"_typedSymbol"in g&&g._typedSymbol===dZ}static dereference(g,t){if(RI.isTyped(g)){if(g.type!==t)throw new Error(`invalid type: expecetd ${t}, got ${g.type}`);return g.value}return g}};Ll=new WeakMap;let Ae=RI;class TJ extends sn{constructor(g){super("address","address",g,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(g,t){let I=Ae.dereference(t,"string");try{I=ag(I)}catch(n){return this._throwError(n.message,t)}return g.writeValue(I)}decode(g){return ag(Il(g.readValue(),20))}}class MJ extends sn{constructor(t){super(t.name,t.type,"_",t.dynamic);R(this,"coder");this.coder=t}defaultValue(){return this.coder.defaultValue()}encode(t,I){return this.coder.encode(t,I)}decode(t){return this.coder.decode(t)}}function rf(e,g,t){let I=[];if(Array.isArray(t))I=t;else if(t&&typeof t=="object"){let r={};I=g.map(a=>{const o=a.localName;return H(o,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:a},value:t}),H(!r[o],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:a},value:t}),r[o]=!0,t[o]})}else V(!1,"invalid tuple value","tuple",t);V(g.length===I.length,"types/value length mismatch","tuple",t);let n=new Uu,l=new Uu,C=[];g.forEach((r,a)=>{let o=I[a];if(r.dynamic){let c=l.length;r.encode(l,o);let A=n.writeUpdatableValue();C.push(b=>{A(b+c)})}else r.encode(n,o)}),C.forEach(r=>{r(n.length)});let s=e.appendWriter(n);return s+=e.appendWriter(l),s}function af(e,g){let t=[],I=[],n=e.subReader(0);return g.forEach(l=>{let C=null;if(l.dynamic){let s=e.readIndex(),r=n.subReader(s);try{C=l.decode(r)}catch(a){if(te(a,"BUFFER_OVERRUN"))throw a;C=a,C.baseType=l.name,C.name=l.localName,C.type=l.type}}else try{C=l.decode(e)}catch(s){if(te(s,"BUFFER_OVERRUN"))throw s;C=s,C.baseType=l.name,C.name=l.localName,C.type=l.type}if(C==null)throw new Error("investigate");t.push(C),I.push(l.localName||null)}),ar.fromItems(t,I)}class DJ extends sn{constructor(t,I,n){const l=t.type+"["+(I>=0?I:"")+"]",C=I===-1||t.dynamic;super("array",l,n,C);R(this,"coder");R(this,"length");$(this,{coder:t,length:I})}defaultValue(){const t=this.coder.defaultValue(),I=[];for(let n=0;n<this.length;n++)I.push(t);return I}encode(t,I){const n=Ae.dereference(I,"array");Array.isArray(n)||this._throwError("expected array value",n);let l=this.length;l===-1&&(l=n.length,t.writeValue(n.length)),aB(n.length,l,"coder array"+(this.localName?" "+this.localName:""));let C=[];for(let s=0;s<n.length;s++)C.push(this.coder);return rf(t,C,n)}decode(t){let I=this.length;I===-1&&(I=t.readIndex(),H(I*Ge<=t.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:t.bytes,offset:I*Ge,length:t.dataLength}));let n=[];for(let l=0;l<I;l++)n.push(new MJ(this.coder));return af(t,n)}}class jJ extends sn{constructor(g){super("bool","bool",g,!1)}defaultValue(){return!1}encode(g,t){const I=Ae.dereference(t,"bool");return g.writeValue(I?1:0)}decode(g){return!!g.readValue()}}class of extends sn{constructor(g,t){super(g,g,t,!0)}defaultValue(){return"0x"}encode(g,t){t=ye(t);let I=g.writeValue(t.length);return I+=g.writeBytes(t),I}decode(g){return g.readBytes(g.readIndex(),!0)}}class PJ extends of{constructor(g){super("bytes",g)}decode(g){return D(super.decode(g))}}class OJ extends sn{constructor(t,I){let n="bytes"+String(t);super(n,n,I,!1);R(this,"size");$(this,{size:t},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(t,I){let n=ye(Ae.dereference(I,this.type));return n.length!==this.size&&this._throwError("incorrect data length",I),t.writeBytes(n)}decode(t){return D(t.readBytes(this.size))}}const qJ=new Uint8Array([]);class _J extends sn{constructor(g){super("null","",g,!1)}defaultValue(){return null}encode(g,t){return t!=null&&this._throwError("not null",t),g.writeBytes(qJ)}decode(g){return g.readBytes(0),null}}const $J=BigInt(0),gw=BigInt(1),ew=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class tw extends sn{constructor(t,I,n){const l=(I?"int":"uint")+t*8;super(l,l,n,!1);R(this,"size");R(this,"signed");$(this,{size:t,signed:I},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(t,I){let n=q(Ae.dereference(I,this.type)),l=Xl(ew,Ge*8);if(this.signed){let C=Xl(l,this.size*8-1);(n>C||n<-(C+gw))&&this._throwError("value out-of-bounds",I),n=AB(n,8*Ge)}else(n<$J||n>Xl(l,this.size*8))&&this._throwError("value out-of-bounds",I);return t.writeValue(n)}decode(t){let I=Xl(t.readValue(),this.size*8);return this.signed&&(I=Ac(I,this.size*8)),I}}class Iw extends of{constructor(g){super("string",g)}defaultValue(){return""}encode(g,t){return super.encode(g,yI(Ae.dereference(t,"string")))}decode(g){return uc(super.decode(g))}}class $a extends sn{constructor(t,I){let n=!1;const l=[];t.forEach(s=>{s.dynamic&&(n=!0),l.push(s.type)});const C="tuple("+l.join(",")+")";super("tuple",C,I,n);R(this,"coders");$(this,{coders:Object.freeze(t.slice())})}defaultValue(){const t=[];this.coders.forEach(n=>{t.push(n.defaultValue())});const I=this.coders.reduce((n,l)=>{const C=l.localName;return C&&(n[C]||(n[C]=0),n[C]++),n},{});return this.coders.forEach((n,l)=>{let C=n.localName;!C||I[C]!==1||(C==="length"&&(C="_length"),t[C]==null&&(t[C]=t[l]))}),Object.freeze(t)}encode(t,I){const n=Ae.dereference(I,"tuple");return rf(t,this.coders,n)}decode(t){return af(t,this.coders)}}function yd(e,g){return{address:ag(e),storageKeys:g.map((t,I)=>(V(Zg(t,32),"invalid slot",`storageKeys[${I}]`,t),t.toLowerCase()))}}function fC(e){if(Array.isArray(e))return e.map((t,I)=>Array.isArray(t)?(V(t.length===2,"invalid slot set",`value[${I}]`,t),yd(t[0],t[1])):(V(t!=null&&typeof t=="object","invalid address-slot set","value",e),yd(t.address,t.storageKeys)));V(e!=null&&typeof e=="object","invalid access list","value",e);const g=Object.keys(e).map(t=>{const I=e[t].reduce((n,l)=>(n[l]=!0,n),{});return yd(t,Object.keys(I).sort())});return g.sort((t,I)=>t.address.localeCompare(I.address)),g}function cf(e){return{address:ag(e.address),nonce:q(e.nonce!=null?e.nonce:0),chainId:q(e.chainId!=null?e.chainId:0),signature:xe.from(e.signature)}}function nw(e){let g;return typeof e=="string"?g=Xi.computePublicKey(e,!1):g=e.publicKey,ag(Hg("0x"+g.substring(4)).substring(26))}function Af(e,g){return nw(Xi.recoverPublicKey(e,g))}const Tg=BigInt(0),lw=BigInt(2),Cw=BigInt(27),sw=BigInt(28),rw=BigInt(35),iw=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),aw=Symbol.for("nodejs.util.inspect.custom"),Gd=4096*32,fo=128;function ow(e){return{blobToKzgCommitment:I=>{if("computeBlobProof"in e){if("blobToKzgCommitment"in e&&typeof e.blobToKzgCommitment=="function")return ng(e.blobToKzgCommitment(D(I)))}else if("blobToKzgCommitment"in e&&typeof e.blobToKzgCommitment=="function")return ng(e.blobToKzgCommitment(I));if("blobToKZGCommitment"in e&&typeof e.blobToKZGCommitment=="function")return ng(e.blobToKZGCommitment(D(I)));V(!1,"unsupported KZG library","kzg",e)},computeBlobKzgProof:(I,n)=>{if("computeBlobProof"in e&&typeof e.computeBlobProof=="function")return ng(e.computeBlobProof(D(I),D(n)));if("computeBlobKzgProof"in e&&typeof e.computeBlobKzgProof=="function")return e.computeBlobKzgProof(I,n);if("computeBlobKZGProof"in e&&typeof e.computeBlobKZGProof=="function")return ng(e.computeBlobKZGProof(D(I),D(n)));V(!1,"unsupported KZG library","kzg",e)}}}function uZ(e,g){let t=e.toString(16);for(;t.length<2;)t="0"+t;return t+=Vr(g).substring(4),"0x"+t}function Wr(e){return e==="0x"?null:ag(e)}function aA(e,g){try{return fC(e)}catch(t){V(!1,t.message,g,e)}}function cw(e,g){try{if(!Array.isArray(e))throw new Error("authorizationList: invalid array");const t=[];for(let I=0;I<e.length;I++){const n=e[I];if(!Array.isArray(n))throw new Error(`authorization[${I}]: invalid array`);if(n.length!==6)throw new Error(`authorization[${I}]: wrong length`);if(!n[1])throw new Error(`authorization[${I}]: null address`);t.push({address:Wr(n[1]),nonce:ug(n[2],"nonce"),chainId:ug(n[0],"chainId"),signature:xe.from({yParity:VC(n[3],"yParity"),r:tn(n[4],32),s:tn(n[5],32)})})}return t}catch(t){V(!1,t.message,g,e)}}function VC(e,g){return e==="0x"?0:Ig(e,g)}function ug(e,g){if(e==="0x")return Tg;const t=q(e,g);return V(t<=iw,"value exceeds uint size",g,t),t}function ig(e,g){const t=q(e,"value"),I=Kg(t);return V(I.length<=32,"value too large",`tx.${g}`,t),I}function oA(e){return fC(e).map(g=>[g.address,g.storageKeys])}function Aw(e){return e.map(g=>[ig(g.chainId,"chainId"),g.address,ig(g.nonce,"nonce"),ig(g.signature.yParity,"yParity"),Kg(g.signature.r),Kg(g.signature._s)])}function dw(e,g){V(Array.isArray(e),`invalid ${g}`,"value",e);for(let t=0;t<e.length;t++)V(Zg(e[t],32),"invalid ${ param } hash",`value[${t}]`,e[t]);return e}function uw(e){const g=Ga(e);V(Array.isArray(g)&&(g.length===9||g.length===6),"invalid field count for legacy transaction","data",e);const t={type:0,nonce:VC(g[0],"nonce"),gasPrice:ug(g[1],"gasPrice"),gasLimit:ug(g[2],"gasLimit"),to:Wr(g[3]),value:ug(g[4],"value"),data:D(g[5]),chainId:Tg};if(g.length===6)return t;const I=ug(g[6],"v"),n=ug(g[7],"r"),l=ug(g[8],"s");if(n===Tg&&l===Tg)t.chainId=I;else{let C=(I-rw)/lw;C<Tg&&(C=Tg),t.chainId=C,V(C!==Tg||I===Cw||I===sw,"non-canonical legacy v","v",g[6]),t.signature=xe.from({r:tn(g[7],32),s:tn(g[8],32),v:I})}return t}function mw(e,g){const t=[ig(e.nonce,"nonce"),ig(e.gasPrice||0,"gasPrice"),ig(e.gasLimit,"gasLimit"),e.to||"0x",ig(e.value,"value"),e.data];let I=Tg;if(e.chainId!=Tg)I=q(e.chainId,"tx.chainId"),V(!g||g.networkV==null||g.legacyChainId===I,"tx.chainId/sig.v mismatch","sig",g);else if(e.signature){const l=e.signature.legacyChainId;l!=null&&(I=l)}if(!g)return I!==Tg&&(t.push(Kg(I)),t.push("0x"),t.push("0x")),jI(t);let n=BigInt(27+g.yParity);return I!==Tg?n=xe.getChainIdV(I,g.v):BigInt(g.v)!==n&&V(!1,"tx.chainId/sig.v mismatch","sig",g),t.push(Kg(n)),t.push(Kg(g.r)),t.push(Kg(g._s)),jI(t)}function cA(e,g){let t;try{if(t=VC(g[0],"yParity"),t!==0&&t!==1)throw new Error("bad yParity")}catch{V(!1,"invalid yParity","yParity",g[0])}const I=tn(g[1],32),n=tn(g[2],32),l=xe.from({r:I,s:n,yParity:t});e.signature=l}function hw(e){const g=Ga(ng(e).slice(1));V(Array.isArray(g)&&(g.length===9||g.length===12),"invalid field count for transaction type: 2","data",D(e));const t={type:2,chainId:ug(g[0],"chainId"),nonce:VC(g[1],"nonce"),maxPriorityFeePerGas:ug(g[2],"maxPriorityFeePerGas"),maxFeePerGas:ug(g[3],"maxFeePerGas"),gasPrice:null,gasLimit:ug(g[4],"gasLimit"),to:Wr(g[5]),value:ug(g[6],"value"),data:D(g[7]),accessList:aA(g[8],"accessList")};return g.length===9||cA(t,g.slice(9)),t}function bw(e,g){const t=[ig(e.chainId,"chainId"),ig(e.nonce,"nonce"),ig(e.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ig(e.maxFeePerGas||0,"maxFeePerGas"),ig(e.gasLimit,"gasLimit"),e.to||"0x",ig(e.value,"value"),e.data,oA(e.accessList||[])];return g&&(t.push(ig(g.yParity,"yParity")),t.push(Kg(g.r)),t.push(Kg(g.s))),pg(["0x02",jI(t)])}function Zw(e){const g=Ga(ng(e).slice(1));V(Array.isArray(g)&&(g.length===8||g.length===11),"invalid field count for transaction type: 1","data",D(e));const t={type:1,chainId:ug(g[0],"chainId"),nonce:VC(g[1],"nonce"),gasPrice:ug(g[2],"gasPrice"),gasLimit:ug(g[3],"gasLimit"),to:Wr(g[4]),value:ug(g[5],"value"),data:D(g[6]),accessList:aA(g[7],"accessList")};return g.length===8||cA(t,g.slice(8)),t}function yw(e,g){const t=[ig(e.chainId,"chainId"),ig(e.nonce,"nonce"),ig(e.gasPrice||0,"gasPrice"),ig(e.gasLimit,"gasLimit"),e.to||"0x",ig(e.value,"value"),e.data,oA(e.accessList||[])];return g&&(t.push(ig(g.yParity,"recoveryParam")),t.push(Kg(g.r)),t.push(Kg(g.s))),pg(["0x01",jI(t)])}function Gw(e){let g=Ga(ng(e).slice(1)),t="3",I=null,n=null;if(g.length===4&&Array.isArray(g[0])){t="3 (network format)";const C=g[1],s=g[2],r=g[3];V(Array.isArray(C),"invalid network format: blobs not an array","fields[1]",C),V(Array.isArray(s),"invalid network format: commitments not an array","fields[2]",s),V(Array.isArray(r),"invalid network format: proofs not an array","fields[3]",r),V(C.length===s.length,"invalid network format: blobs/commitments length mismatch","fields",g),V(C.length===r.length,"invalid network format: blobs/proofs length mismatch","fields",g),n=[];for(let a=0;a<g[1].length;a++)n.push({data:C[a],commitment:s[a],proof:r[a]});g=g[0]}else if(g.length===5&&Array.isArray(g[0])){t="3 (EIP-7594 network format)",I=Ig(g[1]);const C=g[2],s=g[3],r=g[4];V(I===1,`unsupported EIP-7594 network format version: ${I}`,"fields[1]",I),V(Array.isArray(C),"invalid EIP-7594 network format: blobs not an array","fields[2]",C),V(Array.isArray(s),"invalid EIP-7594 network format: commitments not an array","fields[3]",s),V(Array.isArray(r),"invalid EIP-7594 network format: proofs not an array","fields[4]",r),V(C.length===s.length,"invalid network format: blobs/commitments length mismatch","fields",g),V(C.length*fo===r.length,"invalid network format: blobs/proofs length mismatch","fields",g),n=[];for(let a=0;a<C.length;a++){const o=[];for(let c=0;c<fo;c++)o.push(r[a*fo+c]);n.push({data:C[a],commitment:s[a],proof:pg(o)})}g=g[0]}V(Array.isArray(g)&&(g.length===11||g.length===14),`invalid field count for transaction type: ${t}`,"data",D(e));const l={type:3,chainId:ug(g[0],"chainId"),nonce:VC(g[1],"nonce"),maxPriorityFeePerGas:ug(g[2],"maxPriorityFeePerGas"),maxFeePerGas:ug(g[3],"maxFeePerGas"),gasPrice:null,gasLimit:ug(g[4],"gasLimit"),to:Wr(g[5]),value:ug(g[6],"value"),data:D(g[7]),accessList:aA(g[8],"accessList"),maxFeePerBlobGas:ug(g[9],"maxFeePerBlobGas"),blobVersionedHashes:g[10],blobWrapperVersion:I};n&&(l.blobs=n),V(l.to!=null,`invalid address for transaction type: ${t}`,"data",e),V(Array.isArray(l.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",e);for(let C=0;C<l.blobVersionedHashes.length;C++)V(Zg(l.blobVersionedHashes[C],32),`invalid blobVersionedHash at index ${C}: must be length 32`,"data",e);return g.length===11||cA(l,g.slice(11)),l}function pw(e,g,t){const I=[ig(e.chainId,"chainId"),ig(e.nonce,"nonce"),ig(e.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ig(e.maxFeePerGas||0,"maxFeePerGas"),ig(e.gasLimit,"gasLimit"),e.to||ki,ig(e.value,"value"),e.data,oA(e.accessList||[]),ig(e.maxFeePerBlobGas||0,"maxFeePerBlobGas"),dw(e.blobVersionedHashes||[],"blobVersionedHashes")];if(g&&(I.push(ig(g.yParity,"yParity")),I.push(Kg(g.r)),I.push(Kg(g.s)),t)){if(e.blobWrapperVersion!=null){const n=Kg(e.blobWrapperVersion),l=[];for(const{proof:C}of t){const s=ng(C),r=s.length/fo;for(let a=0;a<s.length;a+=r)l.push(s.subarray(a,a+r))}return pg(["0x03",jI([I,n,t.map(C=>C.data),t.map(C=>C.commitment),l])])}return pg(["0x03",jI([I,t.map(n=>n.data),t.map(n=>n.commitment),t.map(n=>n.proof)])])}return pg(["0x03",jI(I)])}function Bw(e){const g=Ga(ng(e).slice(1));V(Array.isArray(g)&&(g.length===10||g.length===13),"invalid field count for transaction type: 4","data",D(e));const t={type:4,chainId:ug(g[0],"chainId"),nonce:VC(g[1],"nonce"),maxPriorityFeePerGas:ug(g[2],"maxPriorityFeePerGas"),maxFeePerGas:ug(g[3],"maxFeePerGas"),gasPrice:null,gasLimit:ug(g[4],"gasLimit"),to:Wr(g[5]),value:ug(g[6],"value"),data:D(g[7]),accessList:aA(g[8],"accessList"),authorizationList:cw(g[9],"authorizationList")};return g.length===10||cA(t,g.slice(10)),t}function fw(e,g){const t=[ig(e.chainId,"chainId"),ig(e.nonce,"nonce"),ig(e.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ig(e.maxFeePerGas||0,"maxFeePerGas"),ig(e.gasLimit,"gasLimit"),e.to||"0x",ig(e.value,"value"),e.data,oA(e.accessList||[]),Aw(e.authorizationList||[])];return g&&(t.push(ig(g.yParity,"yParity")),t.push(Kg(g.r)),t.push(Kg(g.s))),pg(["0x04",jI(t)])}var vt,Gs,ps,Bs,fs,Vs,Ws,Ss,Rs,ks,Xs,Js,Tl,Wn,II,Sn,ws,Ys,vs,Vo;const gI=class gI{constructor(){k(this,vs);k(this,vt,void 0);k(this,Gs,void 0);k(this,ps,void 0);k(this,Bs,void 0);k(this,fs,void 0);k(this,Vs,void 0);k(this,Ws,void 0);k(this,Ss,void 0);k(this,Rs,void 0);k(this,ks,void 0);k(this,Xs,void 0);k(this,Js,void 0);k(this,Tl,void 0);k(this,Wn,void 0);k(this,II,void 0);k(this,Sn,void 0);k(this,ws,void 0);k(this,Ys,void 0);p(this,vt,null),p(this,Gs,null),p(this,Bs,0),p(this,fs,Tg),p(this,Vs,null),p(this,Ws,null),p(this,Ss,null),p(this,ps,"0x"),p(this,Rs,Tg),p(this,ks,Tg),p(this,Xs,null),p(this,Js,null),p(this,Tl,null),p(this,Wn,null),p(this,II,null),p(this,Sn,null),p(this,ws,null),p(this,Ys,null)}get type(){return d(this,vt)}set type(g){switch(g){case null:p(this,vt,null);break;case 0:case"legacy":p(this,vt,0);break;case 1:case"berlin":case"eip-2930":p(this,vt,1);break;case 2:case"london":case"eip-1559":p(this,vt,2);break;case 3:case"cancun":case"eip-4844":p(this,vt,3);break;case 4:case"pectra":case"eip-7702":p(this,vt,4);break;default:V(!1,"unsupported transaction type","type",g)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){const g=d(this,Gs);return g==null&&this.type===3?ki:g}set to(g){p(this,Gs,g==null?null:ag(g))}get nonce(){return d(this,Bs)}set nonce(g){p(this,Bs,Ig(g,"value"))}get gasLimit(){return d(this,fs)}set gasLimit(g){p(this,fs,q(g))}get gasPrice(){const g=d(this,Vs);return g==null&&(this.type===0||this.type===1)?Tg:g}set gasPrice(g){p(this,Vs,g==null?null:q(g,"gasPrice"))}get maxPriorityFeePerGas(){const g=d(this,Ws);return g??(this.type===2||this.type===3?Tg:null)}set maxPriorityFeePerGas(g){p(this,Ws,g==null?null:q(g,"maxPriorityFeePerGas"))}get maxFeePerGas(){const g=d(this,Ss);return g??(this.type===2||this.type===3?Tg:null)}set maxFeePerGas(g){p(this,Ss,g==null?null:q(g,"maxFeePerGas"))}get data(){return d(this,ps)}set data(g){p(this,ps,D(g))}get value(){return d(this,Rs)}set value(g){p(this,Rs,q(g,"value"))}get chainId(){return d(this,ks)}set chainId(g){p(this,ks,q(g))}get signature(){return d(this,Xs)||null}set signature(g){p(this,Xs,g==null?null:xe.from(g))}isValid(){const g=this.signature;if(g&&!g.isValid())return!1;const t=this.authorizationList;if(t){for(const I of t)if(!I.signature.isValid())return!1}return!0}get accessList(){const g=d(this,Js)||null;return g??(this.type===1||this.type===2||this.type===3?[]:null)}set accessList(g){p(this,Js,g==null?null:fC(g))}get authorizationList(){const g=d(this,ws)||null;return g==null&&this.type===4?[]:g}set authorizationList(g){p(this,ws,g==null?null:g.map(t=>cf(t)))}get maxFeePerBlobGas(){const g=d(this,Tl);return g==null&&this.type===3?Tg:g}set maxFeePerBlobGas(g){p(this,Tl,g==null?null:q(g,"maxFeePerBlobGas"))}get blobVersionedHashes(){let g=d(this,Wn);return g==null&&this.type===3?[]:g}set blobVersionedHashes(g){if(g!=null){V(Array.isArray(g),"blobVersionedHashes must be an Array","value",g),g=g.slice();for(let t=0;t<g.length;t++)V(Zg(g[t],32),"invalid blobVersionedHash",`value[${t}]`,g[t])}p(this,Wn,g)}get blobs(){return d(this,Sn)==null?null:d(this,Sn).map(g=>Object.assign({},g))}set blobs(g){if(g==null){p(this,Sn,null);return}const t=[],I=[];for(let n=0;n<g.length;n++){const l=g[n];if(Rh(l)){H(d(this,II),"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let C=ng(l);if(V(C.length<=Gd,"blob is too large",`blobs[${n}]`,l),C.length!==Gd){const a=new Uint8Array(Gd);a.set(C),C=a}const s=d(this,II).blobToKzgCommitment(C),r=D(d(this,II).computeBlobKzgProof(C,s));t.push({data:D(C),commitment:D(s),proof:r}),I.push(uZ(1,s))}else{const C=D(l.data),s=D(l.commitment),r=D(l.proof);t.push({data:C,commitment:s,proof:r}),I.push(uZ(1,s))}}p(this,Sn,t),p(this,Wn,I)}get kzg(){return d(this,II)}set kzg(g){g==null?p(this,II,null):p(this,II,ow(g))}get blobWrapperVersion(){return d(this,Ys)}set blobWrapperVersion(g){p(this,Ys,g)}get hash(){return this.signature==null?null:Hg(E(this,vs,Vo).call(this,!0,!1))}get unsignedHash(){return Hg(this.unsignedSerialized)}get from(){return this.signature==null?null:Af(this.unsignedHash,this.signature.getCanonical())}get fromPublicKey(){return this.signature==null?null:Xi.recoverPublicKey(this.unsignedHash,this.signature.getCanonical())}isSigned(){return this.signature!=null}get serialized(){return E(this,vs,Vo).call(this,!0,!0)}get unsignedSerialized(){return E(this,vs,Vo).call(this,!1,!1)}inferType(){const g=this.inferTypes();return g.indexOf(2)>=0?2:g.pop()}inferTypes(){const g=this.gasPrice!=null,t=this.maxFeePerGas!=null||this.maxPriorityFeePerGas!=null,I=this.accessList!=null,n=d(this,Tl)!=null||d(this,Wn);this.maxFeePerGas!=null&&this.maxPriorityFeePerGas!=null&&H(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),H(!t||this.type!==0&&this.type!==1,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),H(this.type!==0||!I,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const l=[];return this.type!=null?l.push(this.type):this.authorizationList&&this.authorizationList.length?l.push(4):t?l.push(2):g?(l.push(1),I||l.push(0)):I?(l.push(1),l.push(2)):(n&&this.to||(l.push(0),l.push(1),l.push(2)),l.push(3)),l.sort(),l}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}clone(){return gI.from(this)}toJSON(){const g=t=>t==null?null:t.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:g(this.gasLimit),gasPrice:g(this.gasPrice),maxPriorityFeePerGas:g(this.maxPriorityFeePerGas),maxFeePerGas:g(this.maxFeePerGas),value:g(this.value),chainId:g(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}[aw](){return this.toString()}toString(){const g=[],t=n=>{let l=this[n];typeof l=="string"&&(l=JSON.stringify(l)),g.push(`${n}: ${l}`)};this.type&&t("type"),t("to"),t("data"),t("nonce"),t("gasLimit"),t("value"),this.chainId!=null&&t("chainId"),this.signature&&(t("from"),g.push(`signature: ${this.signature.toString()}`));const I=this.authorizationList;if(I){const n=[];for(const l of I){const C=[];C.push(`address: ${JSON.stringify(l.address)}`),l.nonce!=null&&C.push(`nonce: ${l.nonce}`),l.chainId!=null&&C.push(`chainId: ${l.chainId}`),l.signature&&C.push(`signature: ${l.signature.toString()}`),n.push(`Authorization { ${C.join(", ")} }`)}g.push(`authorizations: [ ${n.join(", ")} ]`)}return`Transaction { ${g.join(", ")} }`}static from(g){if(g==null)return new gI;if(typeof g=="string"){const I=ng(g);if(I[0]>=127)return gI.from(uw(I));switch(I[0]){case 1:return gI.from(Zw(I));case 2:return gI.from(hw(I));case 3:return gI.from(Gw(I));case 4:return gI.from(Bw(I))}H(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const t=new gI;return g.type!=null&&(t.type=g.type),g.to!=null&&(t.to=g.to),g.nonce!=null&&(t.nonce=g.nonce),g.gasLimit!=null&&(t.gasLimit=g.gasLimit),g.gasPrice!=null&&(t.gasPrice=g.gasPrice),g.maxPriorityFeePerGas!=null&&(t.maxPriorityFeePerGas=g.maxPriorityFeePerGas),g.maxFeePerGas!=null&&(t.maxFeePerGas=g.maxFeePerGas),g.maxFeePerBlobGas!=null&&(t.maxFeePerBlobGas=g.maxFeePerBlobGas),g.data!=null&&(t.data=g.data),g.value!=null&&(t.value=g.value),g.chainId!=null&&(t.chainId=g.chainId),g.signature!=null&&(t.signature=xe.from(g.signature)),g.accessList!=null&&(t.accessList=g.accessList),g.authorizationList!=null&&(t.authorizationList=g.authorizationList),g.blobVersionedHashes!=null&&(t.blobVersionedHashes=g.blobVersionedHashes),g.kzg!=null&&(t.kzg=g.kzg),g.blobWrapperVersion!=null&&(t.blobWrapperVersion=g.blobWrapperVersion),g.blobs!=null&&(t.blobs=g.blobs),g.hash!=null&&(V(t.isSigned(),"unsigned transaction cannot define '.hash'","tx",g),V(t.hash===g.hash,"hash mismatch","tx",g)),g.from!=null&&(V(t.isSigned(),"unsigned transaction cannot define '.from'","tx",g),V(t.from.toLowerCase()===(g.from||"").toLowerCase(),"from mismatch","tx",g)),t}};vt=new WeakMap,Gs=new WeakMap,ps=new WeakMap,Bs=new WeakMap,fs=new WeakMap,Vs=new WeakMap,Ws=new WeakMap,Ss=new WeakMap,Rs=new WeakMap,ks=new WeakMap,Xs=new WeakMap,Js=new WeakMap,Tl=new WeakMap,Wn=new WeakMap,II=new WeakMap,Sn=new WeakMap,ws=new WeakMap,Ys=new WeakMap,vs=new WeakSet,Vo=function(g,t){H(!g||this.signature!=null,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const I=g?this.signature:null;switch(this.inferType()){case 0:return mw(this,I);case 1:return yw(this,I);case 2:return bw(this,I);case 3:return pw(this,I,t?this.blobs:null);case 4:return fw(this,I)}H(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})};let hc=gI;function dC(e){return Hg(yI(e))}var Vw="AEEUdwmgDS8BxQKKAP4BOgDjATAAngDUAIMAoABoAOAAagCOAEQAhABMAHIAOwA9ACsANgAmAGIAHgAuACgAJwAXAC0AGgAjAB8ALwAUACkAEgAeAAkAGwARABkAFgA5ACgALQArADcAFQApABAAHgAiABAAGgAeABMAGAUhBe8BFxREN8sF2wC5AK5HAW8ArQkDzQCuhzc3NzcBP68NEfMABQdHBuw5BV8FYAA9MzkI9r4ZBg7QyQAWA9CeOwLNCjcCjqkChuA/lm+RAsXTAoP6ASfnEQDytQFJAjWVCkeXAOsA6godAB/cwdAUE0WlBCN/AQUCQRjFD/MRBjHxDQSJbw0jBzUAswBxme+tnIcAYwabAysG8QAjAEMMmxcDqgPKQyDXCMMxA7kUQwD3NXOrAKmFIAAfBC0D3x4BJQDBGdUFAhEgVD8JnwmQJiNWYUzrg0oAGwAUAB0AFnNcACkAFgBP9h3gPfsDOWDKneY2ChglX1UDYD30ABsAFAAdABZzIGRAnwDD8wAjAEEMzRbDqgMB2sAFYwXqAtCnAsS4AwpUJKRtFHsadUz9AMMVbwLpABM1NJEX0ZkCgYMBEyMAxRVvAukAEzUBUFAtmUwSAy4DBTER33EftQHfSwB5MxJ/AjkWKQLzL8E/cwBB6QH9LQDPDtO9ASNriQC5DQANAwCK21EFI91zHwCoL9kBqQcHBwcHKzUDowBvAQohPvU3fAQgHwCyAc8CKQMA5zMSezr7ULgFmDp/LzVQBgEGAi8FYQVgt8AFcTtlQhpCWEmfe5tmZ6IAExsDzQ8t+X8rBKtTAltbAn0jsy8Bl6utPWMDTR8Ei2kRANkDBrNHNysDBzECQWUAcwFpJ3kAiyUhAJ0BUb8AL3EfAbfNAz81KUsFWwF3YQZtAm0A+VEfAzEJDQBRSQCzAQBlAHsAM70GD/v3IZWHBwARKQAxALsjTwHZAeMPEzmXgIHwABIAGQA8AEUAQDt3gdvIEGcQZAkGTRFMdEIVEwK0D64L7REdDNkq09PgADSxB/MDWwfzA1sDWwfzB/MDWwfzA1sDWwNbA1scEvAi28gQZw9QBHUFlgWTBN4IiyZREYkHMAjaVBV0JhxPA00BBCMtSSQ7mzMTJUpMFE0LCAQ2SmyvfUADTzGzVP2QqgPTMlc5dAkGHnkSqAAyD3skNb1OhnpPcagKU0+2tYdJak5vAsY6sEAACikJm2/Dd1YGRRAfJ6kQ+ww3AbkBPw3xS9wE9QY/BM0fgRkdD9GVoAipLeEM8SbnLqWAXiP5KocF8Uv4POELUVFsD10LaQnnOmeBUgMlAREijwrhDT0IcRD3Cs1vDekRSQc9A9lJngCpBwULFR05FbkmFGKwCw05ewb/GvoLkyazEy17AAXXGiUGUQEtGwMA0y7rhbRaNVwgT2MGBwspI8sUrFAkDSlAu3hMGh8HGSWtApVDdEqLUToelyH6PEENai4XUYAH+TwJGVMLhTyiRq9FEhHWPpE9TCJNTDAEOYMsMyePCdMPiQy9fHYBXQklCbUMdRM1ERs3yQg9Bx0xlygnGQglRplgngT7owP3E9UDDwVDCUUHFwO5HDETMhUtBRGBKNsC9zbZLrcCk1aEARsFzw8pH+MQVEfkDu0InwJpA4cl7wAxFSUAGyKfCEdnAGOP3FMJLs8Iy2pwI3gDaxTrZRF3B5UOWwerHDcVwxzlcMxeD4YMKKezCV8BeQmdAWME5wgNNV+MpCBFZ1eLXBifIGVBQ14AAjUMaRWjRMGHfAKPD28SHwE5AXcHPQ0FAnsR8RFvEJkI74YINbkz/DopBFMhhyAVCisDU2zSCysm/Qz8bQGnEmYDEDRBd/Jnr2C6KBgBBx0yyUFkIfULlk/RDKAaxRhGVDIZ6AfDA/ca9yfuQVsGAwOnBxc6UTPyBMELbQiPCUMATQ6nGwfbGG4KdYzUATWPAbudA1uVhwJzkwY7Bw8Aaw+LBX3pACECqwinAAkA0wNbAD0CsQehAB0AiUUBQQMrMwEl6QKTA5cINc8BmTMB9y0EH8cMGQD7O25OAsO1AoBuZqYF4VwCkgJNOQFRKQQJUktVA7N15QDfAE8GF+NLARmvTs8e50cB43MvAMsA/wAJOQcJRQHRAfdxALsBYws1Caa3uQFR7S0AhwAZbwHbAo0A4QA5AIP1AVcAUQVd/QXXAlNNARU1HC9bZQG/AyMBNwERAH0Gz5GpzQsjBHEH1wIQHxXlAu8yB7kFAyLjE9FCyQK94lkAMhoKPAqrCqpgX2Q3CjV2PVQAEh+sPss/UgVVO1c7XDtXO1w7VztcO1c7XDtXO1wDm8Pmw+YKcF9JYe8Mqg3YRMw6TRPfYFVgNhPMLbsUxRXSJVoZQRrAJwkl6FUNDwgt12Y0CDA0eRfAAEMpbINFY4oeNApPHOtTlVT8LR8AtUumM7MNsBsZREQFS3XxYi4WEgomAmSFAmJGX1GzAV83JAKh+wJonAJmDQKfiDgfDwJmPwJmKgRyBIMDfxcDfpY5Cjl7GzmGOicnAmwhAjI6OA4CbcsCbbLzjgM3a0kvAWsA4gDlAE4JB5wMkQECD8YAEbkCdzMCdqZDAnlPRwJ4viFg30WyRvcCfEMCeswCfQ0CfPRIBEiBZygALxlJXEpfGRtK0ALRBQLQ0EsrA4hTA4fqRMmRNgLypV0HAwOyS9JMMSkH001QTbMCi0MCitzFHwshR2sJuwKOOwKOYESbhQKO3QKOYHxRuFM5AQ5S2FSJApP/ApMQAO0AIFUiVbNV1AosHymZijLleGpFPz0Cl6MC77ZYJawAXSkClpMCloCgAK1ZsFoNhVEAPwKWuQKWUlxIXNUCmc8CmWhczl0LHQKcnznGOqECnBoCn58CnryOACETNS4TAp31Ap6WALlBYThh8wKe1wKgcgGtAp6jIwKeUqljzGQrKS8CJ7MCJoICoP8CoFDbAqYzAqXSAqgDAIECp/ZogGi1AAdNaiBq1QKs5wKssgKtawKtBgJXIQJV4AKx5dsDH1JsmwKywRECsuwbbORtZ21MYwMl0QK2YD9DbpQDKUkCuGICuUsZArkue3A6cOUCvR0DLbYDMhUCvoxyBgMzdQK+HnMmc1MCw88CwwhzhnRPOUl05AM8qwEDPJ4DPcMCxYACxksCxhSNAshtVQLISALJUwLJMgJkoQLd1nh9ZXiyeSlL1AMYp2cGAmH4GfeVKHsPXpZevxUCz28Cz3AzT1fW9xejAMqxAs93AS3uA04Wfk8JAtwrAtuOAtJTA1JgA1NjAQUDVZCAjUMEzxrxZEl5A4LSg5EC2ssC2eKEFIRNp0ADhqkAMwNkEoZ1Xf0AWQLfaQLevHd7AuIz7RgB8zQrAfSfAfLWiwLr9wLpdH0DAur9AuroAP1LAb0C7o0C66CWrpcHAu5DA4XkmH1w5HGlAvMHAG0DjhqZlwL3FwORcgOSiwL3nAL53QL4apogmq+/O5siA52HAv7+AR8APZ8gAZ+3AwWRA6ZuA6bdANXJAwZuoYyiCQ0DDE0BEwEjB3EGZb1rCQC/BG/DFY8etxEAG3k9ACcDNxJRA42DAWcrJQCM8wAlAOanC6OVCLsGI6fJBgCvBRnDBvElRUYFFoAFcD9GSDNCKUK8X3kZX8QAls0FOgCQVCGbwTsuYDoZutcONxjOGJHJ/gVfBWAFXwVgBWsFYAVfBWAFXwVgBV8FYAVfBWBOHQjfjW8KCgoKbF7xMwTRA7kGN8PDAMMEr8MA70gxFroFTj5xPnhCR0K+X30/X/AAWBkzswCNBsxzzASm70aCRS4rDDMeLz49fnXfcsH5GcoscQFz13Y4HwVnBXLJycnACNdRYwgICAqEXoWTxgA7P4kACxbZBu21Kw0AjMsTAwkVAOVtJUUsJ1JCuULESUArXy9gPi9AKwnJRQYKTD9LPoA+iT54PnkCkULEUUpDX9NWV3JVEjQAc1w3A3IBE3YnX+g7QiMJb6MKaiszRCUuQrNCxDPMCcwEX9EWJzYREBEEBwIHKn6l33JCNVIfybPJtAltydPUCmhBZw/tEKsZAJOVJU1CLRuxbUHOQAo7P0s+eEJHHA8SJVRPdGM0NVrpvBoKhfUlM0JHHGUQUhEWO1xLSj8MO0ucNAqJIzVCRxv9EFsqKyA4OQgNj2nwZgp5ZNFgE2A1K3YHS2AhQQojJmC7DgpzGG1WYFUZCQYHZO9gHWCdYIVgu2BTYJlwFh8GvRbcXbG8YgtDHrMBwzPVyQonHQgkCyYBgQJ0Ajc4nVqIAwGSCsBPIgDsK3SWEtIVBa5N8gGjAo+kVwVIZwD/AEUSCDweX4ITrRQsJ8K3TwBXFDwEAB0TvzVcAtoTS20RIwDgVgZ9BBImYgA5AL4Coi8LFnezOkCnIQFjAY4KBAPh9RcGsgZSBsEAJctdsWIRu2kTkQstRw7DAcMBKgpPBGIGMDAwKCYnKTQaLg4AKRSVAFwCdl+YUZ0JdicFD3lPAdt1F9ZZKCGxuE3yBxkFVGcA/wBFEgiCBwAOLHQSjxOtQDg1z7deFRMAZ8QTAGtKb1ApIiPHADkAvgKiLy1DFtYCmBiDAlDDWNB0eo7fpaMO/aEVRRv0ATEQZBIODyMEAc8JQhCbDRgzFD4TAEMAu9YBCgCsAOkAm5I3ABwAYxvONnR+MhXJAxgKQyxL2+kkJhMbhQKDBMkSsvF0AD9BNQ6uQC7WqSQHwxEAEEIu1hkhAH2z4iQPwyJPHNWpdyYBRSpnJALzoBAEVPPsH20MxA0CCEQKRgAFyAtFAlMNwwjEDUQJRArELtapMg7DDZgJIw+TGukEIwvDFkMAqAtDEMMMBhioe+QAO3MMRAACrgnEBSPY9Q0FDnbSBoMAB8MSYxkSxAEJAPIJAAB8FWMOFtMc/HcXwxhDAC7DAvOowwAewwJdKDKHAAHDAALrFUQVwwAbwyvzpWMWv8wA/ABpAy++bcYDUKPD0KhDCwKmJ1MAAmMA5+UZwxAagwipBRL/eADfw6fDGOMCGsOjk3l6BwOpo4sAEsMOGxMAA5sAbcMOAAvDp0MJGkMDwgipnNIPAwfIqUMGAOGDAAPzABXDAAcDAAnDAGmTABrDAA7DChjDjnEWAwABYwAOcwAuUyYABsMAF8MIKQANUgC6wy4AA8MADqMq8wCyYgAcIwAB8wqpAAXOCx0V4wAHowBCwwEKAGnDAAuDAB3DAAjDCakABdIAbqcZ3QCZCCkABdIAAAFDAAfjAB2jCCkABqIACYMAGzMAbSMA5sOIAAhjAAhDABTDBAkpAAbSAOOTAAlDC6kOzPtnAAdDAG6kQFAATwAKwwwAA0MACbUDPwAHIwAZgwACE6cDAAojAApDAAoDp/MGwwAJIwADEwAQQwgAFEMAEXMAD5MADfMADcMAGRMOFiMAFUMAbqMWuwHDAMIAE0MLAGkzEgDhUwACQwAEWgAXgwUjAAbYABjDBSYBgzBaAEFNALcQBxUMegAwMngBrA0IZgJ0KxQHBREPd1N0ZzKRJwaIHAZqNT4DqQq8BwngAB4DAwt2AX56T1ocKQNXAh1GATQGC3tOxYNagkgAMQA5CQADAQEAWxLjAIOYNAEzAH7tFRk6TglSAF8NAAlYAQ+S1ACAQwQorQBiAN4dAJ1wPyeTANVzuQDX3AIeEMp9eyMgXiUAEdkBkJizKltbVVAaRMqRAAEAhyQ/SDEz6BmfVwB6ATEsOClKIRcDOF0E/832AFNt5AByAnkCRxGCOs94NjXdAwINGBonDBwPALW2AwICAgAAAAAAAAYDBQMDARrUAwAtAAAAAgEGBgYGBgYFBQUFBQUEBQYHCAkEBQUFBQQAAAICAAAAIgCNAJAAlT0A6gC7ANwApEQAwgCyAK0AqADuAKYA2gCjAOcBCAEDAMcAgQBiANIA1AEDAN4A8gCQAKkBMQDqAN8A3AsBCQ8yO9ra2tq8xuLT1tRJOB0BUgFcNU0BWgFpAWgBWwFMUUlLbhMBUxsNEAs6PhMOACcUKy0vMj5AQENDQ0RFFEYGJFdXV1dZWVhZL1pbXVxcI2NnZ2ZoZypsbnZ1eHh4eHh4enp6enp6enp6enp8fH18e2IARPIASQCaAHgAMgBm+ACOAFcAVwA3AnbvAIsABfj4AGQAk/IAnwBPAGIAZP//sACFAIUAaQBWALEAJAC2AIMCQAJDAPwA5wD+AP4A6AD/AOkA6QDoAOYALwJ7AVEBQAE+AVQBPgE+AT4BOQE4ATgBOAEcAVgXADEQCAEAUx8SHgsdHhYAjgCWAKYAUQBqIAIxAHYAbwCXAxUDJzIDIUlGTzEAkQJPAMcCVwKkAMAClgKWApYClgKWApYCiwKWApYClgKWApYClgKVApUCmAKgApcClgKWApQClAKUApQCkgKVAnUB1AKXAp8ClgKWApUeAIETBQD+DQOfAmECOh8BVBg9AuIZEjMbAU4/G1WZAXusRAFpYQEFA0FPAQYAmTEeIJdyADFoAHEANgCRA5zMk/C2jGINwjMWygIZCaXdfDILBCs5dAE7YnQBugDlhoiHhoiGiYqKhouOjIaNkI6Ij4qQipGGkoaThpSSlYaWhpeKmIaZhpqGm4aci52QnoqfhuIC4XTpAt90AIp0LHSoAIsAdHQEQwRABEIERQRDBEkERgRBBEcESQRIBEQERgRJAJ5udACrA490ALxuAQ10ANFZdHQA13QCFHQA/mJ0AP4BIQD+APwA/AD9APwDhGZ03ASMK23HAP4A/AD8AP0A/CR0dACRYnQA/gCRASEA/gCRAvQA/gCRA4RmdNwEjCttxyR0AP9idAEhAP4A/gD8APwA/QD8AP8A/AD8AP0A/AOEZnTcBIwrbcckdHQAkWJ0ASEA/gCRAP4AkQL0AP4AkQOEZnTcBIwrbcckdAJLAT50AlIBQXQCU8l0dAJfdHQDpgL0A6YDpgOnA6cDpwOnA4RmdNwEjCttxyR0dACRYnQBIQOmAJEDpgCRAvQDpgCRA4RmdNwEjCttxyR0BDh0AJEEOQCRDpU5dSgCADR03gV2CwArdAEFAM5iCnR0AF1iAAYcOgp0dACRCnQAXAEIwWZ0CnRmdHQAkWZ0CnRmdEXgAFF03gp0dEY0tlT2u3SOAQTwscwhjZZKrhYcBSfFp9XNbKiVDOD2b+cpe4/Z17mQnbtzzhaeQtE2GGj0IDNTjRUSyTxxw/RPHW/+vS7d1NfRt9z9QPZg4X7QFfhCnkvgNPIItOsC2eV6hPannZNHlZ9xrwZXIMOlu3jSoQSq78WEjwLjw1ELSlF1aBvfzwk5ZX7AUvQzjPQKbDuQ+sm4wNOp4A6AdVuRS0t1y/DZpg4R6m7FNjM9HgvW7Bi88zaMjOo6lM8wtBBdj8LP4ylv3zCXPhebMKJc066o9sF71oFW/8JXu86HJbwDID5lzw5GWLR/LhT0Qqnp2JQxNZNfcbLIzPy+YypqRm/lBmGmex+82+PisxUumSeJkALIT6rJezxMH+CTJmQtt5uwTVbL3ptmjDUQzlSIvWi8Tl7ng1NpuRn1Ng4n14Qc+3Iil7OwkvNWogLSPkn3pihIFytyIGmMhOe3n1tWsuMy9BdKyqF4Z3v2SgggTL9KVvMXPnCbRe+oOuFFP3HejBG/w9gvmfNYvg6JuWia2lcSSN1uIjBktzoIazOHPJZ7kKHPz8mRWVdW3lA8WGF9dQF6Bm673boov3BUWDU2JNcahR23GtfHKLOz/viZ+rYnZFaIznXO67CYEJ1fXuTRpZhYZkKe54xeoagkNGLs+NTZHE0rX45/XvQ2RGADX6vcAvdxIUBV27wxGm2zjZo4X3ILgAlrOFheuZ6wtsvaIj4yLY7qqawlliaIcrz2G+c3vscAnCkCuMzMmZvMfu9lLwTvfX+3cVSyPdN9ZwgDZhfjRgNJcLiJ67b9xx8JHswprbiE3v9UphotAPIgnXVIN5KmMc0piXhc6cChPnN+MRhG9adtdttQTTwSIpl8I4/j//d3sz1326qTBTpPRM/Hgh3kzqEXs8ZAk4ErQhNO8hzrQ0DLkWMA/N+91tn2MdOJnWC2FCZehkQrwzwbKOjhvZsbM95QoeL9skYyMf4srVPVJSgg7pOLUtr/n9eT99oe9nLtFRpjA9okV2Kj8h9k5HaC0oivRD8VyXkJ81tcd4fHNXPCfloIQasxsuO18/46dR2jgul/UIet2G0kRvnyONMKhHs6J26FEoqSqd+rfYjeEGwHWVDpX1fh1jBBcKGMqRepju9Y00mDVHC+Xdij/j44rKfvfjGinNs1jO/0F3jB83XCDINN/HB84axlP+3E/klktRo+vl3U/aiyMJbIodE1XSsDn6UAzIoMtUObY2+k/4gY/l+AkZJ5Sj2vQrkyLm3FoxjhDX+31UXBFf9XrAH31fFqoBmDEZvhvvpnZ87N+oZEu7U9O/nnk+QWj3x8uyoRbEnf+O5UMr9i0nHP38IF5AvzrBW8YWBUR0mIAzIvndQq9N3v/Jto3aPjPXUPl8ASdPPyAp7jENf8bk7VMM9ol9XGmlBmeDMuGqt+WzuL6CXAxXjIhCPM5vACchgMJ/8XBGLO/D1isVvGhwwHHr1DLaI5mn2Jr/b1pUD90uciDaS8cXNDzCWvNmT/PhQe5e8nTnnnkt8Ds/SIjibcum/fqDhKopxAY8AkSrPn+IGDEKOO+U3XOP6djFs2H5N9+orhOahiQk5KnEUWa+CzkVzhp8bMHRbg81qhjjXuIKbHjSLSIBKWqockGtKinY+z4/RdBUF6pcc3JmnlxVcNgrI4SEzKUZSwcD2QCyxzKve+gAmg6ZuSRkpPFa6mfThu7LJNu3H5K42uCpNvPAsoedolKV/LHe/eJ+BbaG5MG0NaSGVPRUmNFMFFSSpXEcXwbVh7UETOZZtoVNRGOIbbkig3McEtR68cG0RZAoJevWYo7Dg/lZ1CQzblWeUvVHmr8fY4Nqd9JJiH/zEX24mJviH60fAyFr0A3c4bC1j3yZU60VgJxXn8JgJXLUIsiBnmKmMYz+7yBQFBvqb2eYnuW59joZBf56/wXvWIR4R8wTmV80i1mZy+S4+BUES+hzjk0uXpC///z/IlqHZ1monzlXp8aCfhGKMti73FI1KbL1q6IKO4fuBuZ59gagjn5xU79muMpHXg6S+e+gDM/U9BKLHbl9l6o8czQKl4RUkJJiqftQG2i3BMg/TQlUYFkJDYBOOvAugYuzYSDnZbDDd/aSd9x0Oe6F+bJcHfl9+gp6L5/TgA+BdFFovbfCrQ40s5vMPw8866pNX8zyFGeFWdxIpPVp9Rg1UPOVFbFZrvaFq/YAzHQgqMWpahMYfqHpmwXfHL1/kpYmGuHFwT55mQu0dylfNuq2Oq0hTMCPwqfxnuBIPLXfci4Y1ANy+1CUipQxld/izVh16WyG2Q0CQQ9NqtAnx1HCHwDj7sYxOSB0wopZSnOzxQOcExmxrVTF2BkOthVpGfuhaGECfCJpJKpjnihY+xOT2QJxN61+9K6QSqtv2Shr82I3jgJrqBg0wELFZPjvHpvzTtaJnLK6Vb97Yn933koO/saN7fsjwNKzp4l2lJVx2orjCGzC/4ZL4zCver6aQYtC5sdoychuFE6ufOiog+VWi5UDkbmvmtah/3aArEBIi39s5ILUnlFLgilcGuz9CQshEY7fw2ouoILAYPVT/gyAIq3TFAIwVsl+ktkRz/qGfnCDGrm5gsl/l9QdvCWGsjPz3dU7XuqKfdUrr/6XIgjp4rey6AJBmCmUJMjITHVdFb5m1p+dLMCL8t55zD42cmftmLEJC0Da04YiRCVUBLLa8D071/N5UBNBXDh0LFsmhV/5B5ExOB4j3WVG/S3lfK5o+V6ELHvy6RR9n4ac+VsK4VE4yphPvV+kG9FegTBH4ZRXL2HytUHCduJazB/KykjfetYxOXTLws267aGOd+I+JhKP//+VnXmS90OD/jvLcVu0asyqcuYN1mSb6XTlCkqv1vigZPIYwNF/zpWcT1GR/6aEIRjkh0yhg4LXJfaGobYJTY4JI58KiAKgmmgAKWdl5nYCeLqavRJGQNuYuZtZFGx+IkI4w4NS2xwbetNMunOjBu/hmKCI/w7tfiiyUd//4rbTeWt4izBY8YvGIN6vyKYmP/8X8wHKCeN+WRcKM70+tXKNGyevU9H2Dg5BsljnTf8YbsJ1TmMs74Ce2XlHisleguhyeg44rQOHZuw/6HTkhnnurK2d62q6yS7210SsAIaR+jXMQA+svkrLpsUY+F30Uw89uOdGAR6vo4FIME0EfVVeHTu6eKicfhSqOeXJhbftcd08sWEnNUL1C9fnprTgd83IMut8onVUF0hvqzZfHduPjbjwEXIcoYmy+P6tcJZHmeOv6VrvEdkHDJecjHuHeWANe79VG662qTjA/HCvumVv3qL+LrOcpqGps2ZGwQdFJ7PU4iuyRlBrwfO+xnPyr47s2cXVbWzAyznDiBGjCM3ksxjjqM62GE9C8f5U38kB3VjtabKp/nRdvMESPGDG90bWRLAt1Qk5DyLuazRR1YzdC1c+hZXvAWV8xA72S4A8B67vjVhbba3MMop293FeEXpe7zItMWrJG/LOH9ByOXmYnNJfjmfuX9KbrpgLOba4nZ+fl8Gbdv/ihv+6wFGKHCYrVwmhFC0J3V2bn2tIB1wCc1CST3d3X2OyxhguXcs4sm679UngzofuSeBewMFJboIQHbUh/m2JhW2hG9DIvG2t7yZIzKBTz9wBtnNC+2pCRYhSIuQ1j8xsz5VvqnyUIthvuoyyu7fNIrg/KQUVmGQaqkqZk/Vx5b33/gsEs8yX7SC1J+NV4icz6bvIE7C5G6McBaI8rVg56q5QBJWxn/87Q1sPK4+sQa8fLU5gXo4paaq4cOcQ4wR0VBHPGjKh+UlPCbA1nLXyEUX45qZ8J7/Ln4FPJE2TdzD0Z8MLSNQiykMMmSyOCiFfy84Rq60emYB2vD09KjYwsoIpeDcBDTElBbXxND72yhd9pC/1CMid/5HUMvAL27OtcIJDzNKpRPNqPOpyt2aPGz9QWIs9hQ9LiX5s8m9hjTUu/f7MyIatjjd+tSfQ3ufZxPpmJhTaBtZtKLUcfOCUqADuO+QoH8B9v6U+P0HV1GLQmtoNFTb3s74ivZgjES0qfK+8RdGgBbcCMSy8eBvh98+et1KIFqSe1KQPyXULBMTsIYnysIwiZBJYdI20vseV+wuJkcqGemehKjaAb9L57xZm3g2zX0bZ2xk/fU+bCo7TlnbW7JuF1YdURo/2Gw7VclDG1W7LOtas2LX4upifZ/23rzpsnY/ALfRgrcWP5hYmV9VxVOQA1fZvp9F2UNU+7d7xRyVm5wiLp3/0dlV7vdw1PMiZrbDAYzIVqEjRY2YU03sJhPnlwIPcZUG5ltL6S8XCxU1eYS5cjr34veBmXAvy7yN4ZjArIG0dfD/5UpBNlX1ZPoxJOwyqRi3wQWtOzd4oNKh0LkoTm8cwqgIfKhqqGOhwo71I+zXnMemTv2B2AUzABWyFztGgGULjDDzWYwJUVBTjKCn5K2QGMK1CQT7SzziOjo+BhAmqBjzuc3xYym2eedGeOIRJVyTwDw37iCMe4g5Vbnsb5ZBdxOAnMT7HU4DHpxWGuQ7GeiY30Cpbvzss55+5Km1YsbD5ea3NI9QNYIXol5apgSu9dZ8f8xS5dtHpido5BclDuLWY4lhik0tbJa07yJhH0BOyEut/GRbYTS6RfiTYWGMCkNpfSHi7HvdiTglEVHKZXaVhezH4kkXiIvKopYAlPusftpE4a5IZwvw1x/eLvoDIh/zpo9FiQInsTb2SAkKHV42XYBjpJDg4374XiVb3ws4qM0s9eSQ5HzsMU4OZJKuopFjBM+dAZEl8RUMx5uU2N486Kr141tVsGQfGjORYMCJAMsxELeNT4RmWjRcpdTGBwcx6XN9drWqPmJzcrGrH4+DRc7+n1w3kPZwu0BkNr6hQrqgo7JTB9A5kdJ/H7P4cWBMwsmuixAzJB3yrQpnGIq90lxAXLzDCdn1LPibsRt7rHNjgQBklRgPZ8vTbjXdgXrTWQsK5MdrXXQVPp0Rinq3frzZKJ0qD6Qhc40VzAraUXlob1gvkhK3vpmHgI6FRlQZNx6eRqkp0zy4AQlX813fAPtL3jMRaitGFFjo0zmErloC+h+YYdVQ6k4F/epxAoF0BmqEoKNTt6j4vQZNQ2BoqF9Vj53TOIoNmDiu9Xp15RkIgQIGcoLpfoIbenzpGUAtqFJp5W+LLnx38jHeECTJ/navKY1NWfN0sY1T8/pB8kIH3DU3DX+u6W3YwpypBMYOhbSxGjq84RZ84fWJow8pyHqn4S/9J15EcCMsXqrfwyd9mhiu3+rEo9pPpoJkdZqHjra4NvzFwuThNKy6hao/SlLw3ZADUcUp3w3SRVfW2rhl80zOgTYnKE0Hs2qp1J6H3xqPqIkvUDRMFDYyRbsFI3M9MEyovPk8rlw7/0a81cDVLmBsR2ze2pBuKb23fbeZC0uXoIvDppfTwIDxk1Oq2dGesGc+oJXWJLGkOha3CX+DUnzgAp9HGH9RsPZN63Hn4RMA5eSVhPHO+9RcRb/IOgtW31V1Q5IPGtoxPjC+MEJbVlIMYADd9aHYWUIQKopuPOHmoqSkubnAKnzgKHqgIOfW5RdAgotN6BN+O2ZYHkuemLnvQ8U9THVrS1RtLmKbcC7PeeDsYznvqzeg6VCNwmr0Yyx1wnLjyT84BZz3EJyCptD3yeueAyDWIs0L2qs/VQ3HUyqfrja0V1LdDzqAikeWuV4sc7RLIB69jEIBjCkyZedoUHqCrOvShVzyd73OdrJW0hPOuQv2qOoHDc9xVb6Yu6uq3Xqp2ZaH46A7lzevbxQEmfrzvAYSJuZ4WDk1Hz3QX1LVdiUK0EvlAGAYlG3Md30r7dcPN63yqBCIj25prpvZP0nI4+EgWoFG95V596CurXpKRBGRjQlHCvy5Ib/iW8nZJWwrET3mgd6mEhfP4KCuaLjopWs7h+MdXFdIv8dHQJgg1xi1eYqB0uDYjxwVmri0Sv5XKut/onqapC+FQiC2C1lvYJ9MVco6yDYsS3AANUfMtvtbYI2hfwZatiSsnoUeMZd34GVjkMMKA+XnjJpXgRW2SHTZplVowPmJsvXy6w3cfO1AK2dvtZEKTkC/TY9LFiKHCG0DnrMQdGm2lzlBHM9iEYynH2UcVMhUEjsc0oDBTgo2ZSQ1gzkAHeWeBXYFjYLuuf8yzTCy7/RFR81WDjXMbq2BOH5dURnxo6oivmxL3cKzKInlZkD31nvpHB9Kk7GfcfE1t+1V64b9LtgeJGlpRFxQCAqWJ5DoY77ski8gsOEOr2uywZaoO/NGa0X0y1pNQHBi3b2SUGNpcZxDT7rLbBf1FSnQ8guxGW3W+36BW0gBje4DOz6Ba6SVk0xiKgt+q2JOFyr4SYfnu+Ic1QZYIuwHBrgzr6UvOcSCzPTOo7D6IC4ISeS7zkl4h+2VoeHpnG/uWR3+ysNgPcOIXQbv0n4mr3BwQcdKJxgPSeyuP/z1Jjg4e9nUvoXegqQVIE30EHx5GHv+FAVUNTowYDJgyFhf5IvlYmEqRif6+WN1MkEJmDcQITx9FX23a4mxy1AQRsOHO/+eImX9l8EMJI3oPWzVXxSOeHU1dUWYr2uAA7AMb+vAEZSbU3qob9ibCyXeypEMpZ6863o6QPqlqGHZkuWABSTVNd4cOh9hv3qEpSx2Zy/DJMP6cItEmiBJ5PFqQnDEIt3NrA3COlOSgz43D7gpNFNJ5MBh4oFzhDPiglC2ypsNU4ISywY2erkyb1NC3Qh/IfWj0eDgZI4/ln8WPfBsT3meTjq1Uqt1E7Zl/qftqkx6aM9KueMCekSnMrcHj1CqTWWzEzPsZGcDe3Ue4Ws+XFYVxNbOFF8ezkvQGR6ZOtOLU2lQEnMBStx47vE6Pb7AYMBRj2OOfZXfisjJnpTfSNjo6sZ6qSvNxZNmDeS7Gk3yYyCk1HtKN2UnhMIjOXUzAqDv90lx9O/q/AT1ZMnit5XQe9wmQxnE/WSH0CqZ9/2Hy+Sfmpeg8RwsHI5Z8kC8H293m/LHVVM/BA7HaTJYg5Enk7M/xWpq0192ACfBai2LA/qrCjCr6Dh1BIMzMXINBmX96MJ5Hn2nxln/RXPFhwHxUmSV0EV2V0jm86/dxxuYSU1W7sVkEbN9EzkG0QFwPhyHKyb3t+Fj5WoUUTErcazE/N6EW6Lvp0d//SDPj7EV9UdJN+Amnf3Wwk3A0SlJ9Z00yvXZ7n3z70G47Hfsow8Wq1JXcfwnA+Yxa5mFsgV464KKP4T31wqIgzFPd3eCe3j5ory5fBF2hgCFyVFrLzI9eetNXvM7oQqyFgDo4CTp/hDV9NMX9JDHQ/nyHTLvZLNLF6ftn2OxjGm8+PqOwhxnPHWipkE/8wbtyri80Sr7pMNkQGMfo4ZYK9OcCC4ESVFFbLMIvlxSoRqWie0wxqnLfcLSXMSpMMQEJYDVObYsXIQNv4TGNwjq1kvT1UOkicTrG3IaBZ3XdScS3u8sgeZPVpOLkbiF940FjbCeNRINNvDbd01EPBrTCPpm12m43ze1bBB59Ia6Ovhnur/Nvx3IxwSWol+3H2qfCJR8df6aQf4v6WiONxkK+IqT4pKQrZK/LplgDI/PJZbOep8dtbV7oCr6CgfpWa8NczOkPx81iSHbsNhVSJBOtrLIMrL31LK9TqHqAbAHe0RLmmV806kRLDLNEhUEJfm9u0sxpkL93Zgd6rw+tqBfTMi59xqXHLXSHwSbSBl0EK0+loECOPtrl+/nsaFe197di4yUgoe4jKoAJDXc6DGDjrQOoFDWZJ9HXwt8xDrQP+7aRwWKWI1GF8s8O4KzxWBBcwnl3vnl1Oez3oh6Ea1vjR7/z7DDTrFtqU2W/KAEzAuXDNZ7MY73MF216dzdSbWmUp4lcm7keJfWaMHgut9x5C9mj66Z0lJ+yhsjVvyiWrfk1lzPOTdhG15Y7gQlXtacvI7qv/XNSscDwqkgwHT/gUsD5yB7LdRRvJxQGYINn9hTpodKFVSTPrtGvyQw+HlRFXIkodErAGu9Iy1YpfSPc3jkFh5CX3lPxv7aqjE/JAfTIpEjGb/H7MO0e2vsViSW1qa/Lmi4/n4DEI3g7lYrcanspDfEpKkdV1OjSLOy0BCUqVoECaB55vs06rXl4jqmLsPsFM/7vYJ0vrBhDCm/00A/H81l1uekJ/6Lml3Hb9+NKiLqATJmDpyzfYZFHumEjC662L0Bwkxi7E9U4cQA0XMVDuMYAIeLMPgQaMVOd8fmt5SflFIfuBoszeAw7ow5gXPE2Y/yBc/7jExARUf/BxIHQBF5Sn3i61w4z5xJdCyO1F1X3+3ax+JSvMeZ7S6QSKp1Fp/sjYz6Z+VgCZzibGeEoujryfMulH7Rai5kAft9ebcW50DyJr2uo2z97mTWIu45YsSnNSMrrNUuG1XsYBtD9TDYzQffKB87vWbkM4EbPAFgoBV4GQS+vtFDUqOFAoi1nTtmIOvg38N4hT2Sn8r8clmBCXspBlMBYTnrqFJGBT3wZOzAyJDre9dHH7+x7qaaKDOB4UQALD5ecS0DE4obubQEiuJZ0EpBVpLuYcce8Aa4PYd/V4DLDAJBYKQPCWTcrEaZ5HYbJi11Gd6hjGom1ii18VHYnG28NKpkz2UKVPxlhYSp8uZr367iOmoy7zsxehW9wzcy2zG0a80PBMCRQMb32hnaHeOR8fnNDzZhaNYhkOdDsBUZ3loDMa1YP0uS0cjUP3b/6DBlqmZOeNABDsLl5BI5QJups8uxAuWJdkUB/pO6Zax6tsg7fN5mjjDgMGngO+DPcKqiHIDbFIGudxtPTIyDi9SFMKBDcfdGQRv41q1AqmxgkVfJMnP8w/Bc7N9/TR6C7mGObFqFkIEom8sKi2xYqJLTCHK7cxzaZvqODo22c3wisBCP4HeAgcRbNPAsBkNRhSmD48dHupdBRw4mIvtS5oeF6zeT1KMCyhMnmhpkFAGWnGscoNkwvQ8ZM5lE/vgTHFYL99OuNxdFBxTEDd5v2qLR8y9WkXsWgG6kZNndFG+pO/UAkOCipqIhL3hq7cRSdrCq7YhUsTocEcnaFa6nVkhnSeRYUA1YO0z5itF9Sly3VlxYDw239TJJH6f3EUfYO5lb7bcFcz8Bp7Oo8QmnsUHOz/fagVUBtKEw1iT88j+aKkv8cscKNkMxjYr8344D1kFoZ7/td1W6LCNYN594301tUGRmFjAzeRg5vyoM1F6+bJZ/Q54jN/k8SFd3DxPTYaAUsivsBfgTn7Mx8H2SpPt4GOdYRnEJOH6jHM2p6SgB0gzIRq6fHxGMmSmqaPCmlfwxiuloaVIitLGN8wie2CDWhkzLoCJcODh7KIOAqbHEvXdUxaS4TTTs07Clzj/6GmVs9kiZDerMxEnhUB6QQPlcfqkG9882RqHoLiHGBoHfQuXIsAG8GTAtao2KVwRnvvam8jo1e312GQAKWEa4sUVEAMG4G6ckcONDwRcg1e2D3+ohXgY4UAWF8wHKQMrSnzCgfFpsxh+aHXMGtPQroQasRY4U6UdG0rz1Vjbka0MekOGRZQEvqQFlxseFor8zWFgHek3v29+WqN6gaK5gZOTOMZzpQIC1201LkMCXild3vWXSc5UX9xcFYfbRPzGFa1FDcPfPB/jUEq/FeGt419CI3YmBlVoHsa4KdcwQP5ZSwHHhFJ7/Ph/Rap/4vmG91eDwPP0lDfCDRCLszTqfzM71xpmiKi2HwS4WlqvGNwtvwF5Dqpn6KTq8ax00UMPkxDcZrEEEsIvHiUXXEphdb4GB4FymlPwBz4Gperqq5pW7TQ6/yNRhW8VT5NhuP0udlxo4gILq5ZxAZk8ZGh3g4CqxJlPKY7AQxupfUcVpWT5VItp1+30UqoyP4wWsRo3olRRgkWZZ2ZN6VC3OZFeXB8NbnUrSdikNptD1QiGuKkr8EmSR/AK9Rw+FF3s5uwuPbvHGiPeFOViltMK7AUaOsq9+x9cndk3iJEE5LKZRlWJbKOZweROzmPNVPkjE3K/TyA57Rs68TkZ3MR8akKpm7cFjnjPd/DdkWjgYoKHSr5Wu5ssoBYU4acRs5g2DHxUmdq8VXOXRbunD8QN0LhgkssgahcdoYsNvuXGUK/KXD/7oFb+VGdhqIn02veuM5bLudJOc2Ky0GMaG4W/xWBxIJcL7yliJOXOpx0AkBqUgzlDczmLT4iILXDxxtRR1oZa2JWFgiAb43obrJnG/TZC2KSK2wqOzRZTXavZZFMb1f3bXvVaNaK828w9TO610gk8JNf3gMfETzXXsbcvRGCG9JWQZ6+cDPqc4466Yo2RcKH+PILeKOqtnlbInR3MmBeGG3FH10yzkybuqEC2HSQwpA0An7d9+73BkDUTm30bZmoP/RGbgFN+GrCOfADgqr0WbI1a1okpFms8iHYw9hm0zUvlEMivBRxModrbJJ+9/p3jUdQQ9BCtQdxnOGrT5dzRUmw0593/mbRSdBg0nRvRZM5/E16m7ZHmDEtWhwvfdZCZ8J8M12W0yRMszXamWfQTwIZ4ayYktrnscQuWr8idp3PjT2eF/jmtdhIfcpMnb+IfZY2FebW6UY/AK3jP4u3Tu4zE4qlnQgLFbM19EBIsNf7KhjdbqQ/D6yiDb+NlEi2SKD+ivXVUK8ib0oBo366gXkR8ZxGjpJIDcEgZPa9TcYe0TIbiPl/rPUQDu3XBJ9X/GNq3FAUsKsll57DzaGMrjcT+gctp+9MLYXCq+sqP81eVQ0r9lt+gcQfZbACRbEjvlMskztZG8gbC8Qn9tt26Q7y7nDrbZq/LEz7kR6Jc6pg3N9rVX8Y5MJrGlML9p9lU4jbTkKqCveeZUJjHB03m2KRKR2TytoFkTXOLg7keU1s1lrPMQJpoOKLuAAC+y1HlJucU6ysB5hsXhvSPPLq5J7JtnqHKZ4vYjC4Vy8153QY+6780xDuGARsGbOs1WqzH0QS765rnSKEbbKlkO8oI/VDwUd0is13tKpqILu1mDJFNy/iJAWcvDgjxvusIT+PGz3ST/J9r9Mtfd0jpaGeiLYIqXc7DiHSS8TcjFVksi66PEkxW1z6ujbLLUGNNYnzOWpH8BZGK4bCK7iR+MbIv8ncDAz1u4StN3vTTzewr9IQjk9wxFxn+6N1ddKs0vffJiS08N3a4G1SVrlZ97Q/M+8G9fe5AP6d9/Qq4WRnORVhofPIKEdCr3llspUfE0oKIIYoByBRPh+bX1HLS3JWGJRhIvE1aW4NTd8ePi4Z+kXb+Z8snYfSNcqijhAgVsx4RCM54cXUiYkjeBmmC4ajOHrChoELscJJC7+9jjMjw5BagZKlgRMiSNYz7h7vvZIoQqbtQmspc0cUk1G/73iXtSpROl5wtLgQi0mW2Ex8i3WULhcggx6E1LMVHUsdc9GHI1PH3U2Ko0PyGdn9KdVOLm7FPBui0i9a0HpA60MsewVE4z8CAt5d401Gv6zXlIT5Ybit1VIA0FCs7wtvYreru1fUyW3oLAZ/+aTnZrOcYRNVA8spoRtlRoWflsRClFcgzkqiHOrf0/SVw+EpVaFlJ0g4Kxq1MMOmiQdpMNpte8lMMQqm6cIFXlnGbfJllysKDi+0JJMotkqgIxOSQgU9dn/lWkeVf8nUm3iwX2Nl3WDw9i6AUK3vBAbZZrcJpDQ/N64AVwjT07Jef30GSSmtNu2WlW7YoyW2FlWfZFQUwk867EdLYKk9VG6JgEnBiBxkY7LMo4YLQJJlAo9l/oTvJkSARDF/XtyAzM8O2t3eT/iXa6wDN3WewNmQHdPfsxChU/KtLG2Mn8i4ZqKdSlIaBZadxJmRzVS/o4yA65RTSViq60oa395Lqw0pzY4SipwE0SXXsKV+GZraGSkr/RW08wPRvqvSUkYBMA9lPx4m24az+IHmCbXA+0faxTRE9wuGeO06DIXa6QlKJ3puIyiuAVfPr736vzo2pBirS+Vxel3TMm3JKhz9o2ZoRvaFVpIkykb0Hcm4oHFBMcNSNj7/4GJt43ogonY2Vg4nsDQIWxAcorpXACzgBqQPjYsE/VUpXpwNManEru4NwMCFPkXvMoqvoeLN3qyu/N1eWEHttMD65v19l/0kH2mR35iv/FI+yjoHJ9gPMz67af3Mq/BoWXqu3rphiWMXVkmnPSEkpGpUI2h1MThideGFEOK6YZHPwYzMBvpNC7+ZHxPb7epfefGyIB4JzO9DTNEYnDLVVHdQyvOEVefrk6Uv5kTQYVYWWdqrdcIl7yljwwIWdfQ/y+2QB3eR/qxYObuYyB4gTbo2in4PzarU1sO9nETkmj9/AoxDA+JM3GMqQtJR4jtduHtnoCLxd1gQUscHRB/MoRYIEsP2pDZ9KvHgtlk1iTbWWbHhohwFEYX7y51fUV2nuUmnoUcqnWIQAAgl9LTVX+Bc0QGNEhChxHR4YjfE51PUdGfsSFE6ck7BL3/hTf9jLq4G1IafINxOLKeAtO7quulYvH5YOBc+zX7CrMgWnW47/jfRsWnJjYYoE7xMfWV2HN2iyIqLI";const mZ=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),hZ=4;function Ww(e){let g=0;function t(){return e[g++]<<8|e[g++]}let I=t(),n=1,l=[0,1];for(let S=1;S<I;S++)l.push(n+=t());let C=t(),s=g;g+=C;let r=0,a=0;function o(){return r==0&&(a=a<<8|e[g++],r=8),a>>--r&1}const c=31,A=2**c,b=A>>>1,m=b>>1,Z=A-1;let G=0;for(let S=0;S<c;S++)G=G<<1|o();let h=[],u=0,y=A;for(;;){let S=Math.floor(((G-u+1)*n-1)/y),J=0,f=I;for(;f-J>1;){let Y=J+f>>>1;S<l[Y]?f=Y:J=Y}if(J==0)break;h.push(J);let X=u+Math.floor(y*l[J]/n),U=u+Math.floor(y*l[J+1]/n)-1;for(;!((X^U)&b);)G=G<<1&Z|o(),X=X<<1&Z,U=U<<1&Z|1;for(;X&~U&m;)G=G&b|G<<1&Z>>>1|o(),X=X<<1^b,U=(U^b)<<1|b|1;u=X,y=1+U-X}let W=I-4;return h.map(S=>{switch(S-W){case 3:return W+65792+(e[s++]<<16|e[s++]<<8|e[s++]);case 2:return W+256+(e[s++]<<8|e[s++]);case 1:return W+e[s++];default:return S-1}})}function Sw(e){let g=0;return()=>e[g++]}function df(e){return Sw(Ww(Rw(e)))}function Rw(e){let g=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((n,l)=>g[n.charCodeAt(0)]=l);let t=e.length,I=new Uint8Array(6*t>>3);for(let n=0,l=0,C=0,s=0;n<t;n++)s=s<<6|g[e.charCodeAt(n)],C+=6,C>=8&&(I[l++]=s>>(C-=8));return I}function kw(e){return e&1?~e>>1:e>>1}function Xw(e,g){let t=Array(e);for(let I=0,n=0;I<e;I++)t[I]=n+=kw(g());return t}function Ji(e,g=0){let t=[];for(;;){let I=e(),n=e();if(!n)break;g+=I;for(let l=0;l<n;l++)t.push(g+l);g+=n+1}return t}function uf(e){return wi(()=>{let g=Ji(e);if(g.length)return g})}function mf(e){let g=[];for(;;){let t=e();if(t==0)break;g.push(Jw(t,e))}for(;;){let t=e()-1;if(t<0)break;g.push(ww(t,e))}return g.flat()}function wi(e){let g=[];for(;;){let t=e(g.length);if(!t)break;g.push(t)}return g}function hf(e,g,t){let I=Array(e).fill().map(()=>[]);for(let n=0;n<g;n++)Xw(e,t).forEach((l,C)=>I[C].push(l));return I}function Jw(e,g){let t=1+g(),I=g(),n=wi(g);return hf(n.length,1+e,g).flatMap((C,s)=>{let[r,...a]=C;return Array(n[s]).fill().map((o,c)=>{let A=c*I;return[r+c*t,a.map(b=>b+A)]})})}function ww(e,g){let t=1+g();return hf(t,1+e,g).map(n=>[n[0],n.slice(1)])}function Yw(e){let g=[],t=Ji(e);return n(I([]),[]),g;function I(l){let C=e(),s=wi(()=>{let r=Ji(e).map(a=>t[a]);if(r.length)return I(r)});return{S:C,B:s,Q:l}}function n({S:l,B:C},s,r){if(!(l&4&&r===s[s.length-1])){l&2&&(r=s[s.length-1]),l&1&&g.push(s);for(let a of C)for(let o of a.Q)n(a,[...s,o],r)}}}function vw(e){return e.toString(16).toUpperCase().padStart(2,"0")}function bf(e){return`{${vw(e)}}`}function Nw(e){let g=[];for(let t=0,I=e.length;t<I;){let n=e.codePointAt(t);t+=n<65536?1:2,g.push(n)}return g}function mr(e){let t=e.length;if(t<4096)return String.fromCodePoint(...e);let I=[];for(let n=0;n<t;)I.push(String.fromCodePoint(...e.slice(n,n+=4096)));return I.join("")}function Hw(e,g){let t=e.length,I=t-g.length;for(let n=0;I==0&&n<t;n++)I=e[n]-g[n];return I}var Fw="AEUDTAHBCFQATQDRADAAcgAgADQAFAAsABQAHwAOACQADQARAAoAFwAHABIACAAPAAUACwAFAAwABAAQAAMABwAEAAoABQAIAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACgANAA0AAwAKAAkABAAdAAYAZwDSAdsDJgC0CkMB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgsj26PTQyy8FfEQ8AY8IPAGcEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiACnwRZEkkVsS7tANAsBG0RuAQLEPABv9HICTUBXigPZwRBApMDOwAamhtaABqEAY8KvKx3LQ4ArAB8UhwEBAVSagD8AEFZADkBIadVj2UMUgx5Il4ANQC9AxIB1BlbEPMAs30CGxlXAhwZKQIECBc6EbsCoxngzv7UzRQA8M0BawL6ZwkN7wABAD33OQRcsgLJCjMCjqUChtw/km+NAsXPAoP2BT84PwURAK0RAvptb6cApQS/OMMey5HJS84UdxpxTPkCogVFITaTOwERAK5pAvkNBOVyA7q3BKlOJSALAgUIBRcEdASpBXqzABXFSWZOawLCOqw//AolCZdvv3dSBkEQGyelEPcMMwG1ATsN7UvYBPEGOwTJH30ZGQ/NlZwIpS3dDO0m4y6hgFoj9SqDBe1L9DzdC01RaA9ZC2UJ4zpjgU4DIQENIosK3Q05CG0Q8wrJaw3lEUUHOQPVSZoApQcBCxEdNRW1JhBirAsJOXcG+xr2C48mrxMpevwF0xohBk0BKRr/AM8u54WwWjFcHE9fBgMLJSPHFKhQIA0lQLd4SBobBxUlqQKRQ3BKh1E2HpMh9jw9DWYuE1F8B/U8BRlPC4E8nkarRQ4R0j6NPUgiSUwsBDV/LC8niwnPD4UMuXxyAVkJIQmxDHETMREXN8UIOQcZLZckJxUIIUaVYJoE958D8xPRAwsFPwlBBxMDtRwtEy4VKQUNgSTXAvM21S6zAo9WgAEXBcsPJR/fEFBH4A7pCJsCZQODJesALRUhABcimwhDYwBfj9hTBS7LCMdqbCN0A2cU52ERcweRDlcHpxwzFb8c4XDIXguGCCijrwlbAXUJmQFfBOMICTVbjKAgQWdTi1gYmyBhQT9d/AIxDGUVn0S9h3gCiw9rEhsBNQFzBzkNAQJ3Ee0RaxCVCOuGBDW1M/g6JQRPIYMgEQonA09szgsnJvkM+GkBoxJiAww0PXfuZ6tgtiQX/QcZMsVBYCHxC5JPzQycGsEYQlQuGeQHvwPzGvMn6kFXBf8DowMTOk0z7gS9C2kIiwk/AEkOoxcH1xhqCnGM0AExiwG3mQNXkYMCb48GNwcLAGcLhwV55QAdAqcIowAFAM8DVwA5Aq0HnQAZAIVBAT0DJy8BIeUCjwOTCDHLAZUvAfMpBBvDDBUA9zduSgLDsQKAamaiBd1YAo4CSTUBTSUEBU5HUQOvceEA2wBLBhPfRwEVq0rLGuNDAd9vKwDHAPsABTUHBUEBzQHzbQC3AV8LMQmis7UBTekpAIMAFWsB1wKJAN0ANQB/8QFTAE0FWfkF0wJPSQERMRgrV2EBuwMfATMBDQB5BsuNpckHHwRtB9MCEBsV4QLvLge1AQMi3xPNQsUCvd5VoWACZIECYkJbTa9bNyACofcCaJgCZgkCn4Q4GwsCZjsCZiYEbgR/A38TA36SOQY5dxc5gjojIwJsHQIyNjgKAm3HAm2u74ozZ0UrAWcA3gDhAEoFB5gMjQD+C8IADbUCdy8CdqI/AnlLQwJ4uh1c20WuRtcCfD8CesgCfQkCfPAFWQUgSABIfWMkAoFtAoAAAoAFAn+uSVhKWxUXSswC0QEC0MxLJwOITwOH5kTFkTIC8qFdAwMDrkvOTC0lA89NTE2vAos/AorYwRsHHUNnBbcCjjcCjlxAl4ECjtkCjlx4UbRTNQpS1FSFApP7ApMMAOkAHFUeVa9V0AYsGymVhjLheGZFOzkCl58C77JYIagAWSUClo8ClnycAKlZrFoJgU0AOwKWtQKWTlxEXNECmcsCmWRcyl0HGQKcmznCOp0CnBYCn5sCnriKAB0PMSoPAp3xAp6SALU9YTRh7wKe0wKgbgGpAp6fHwKeTqVjyGQnJSsCJ68CJn4CoPsCoEwCot0CocQCpi8Cpc4Cp/8AfQKn8mh8aLEAA0lqHGrRAqzjAqyuAq1nAq0CAlcdAlXcArHh1wMfTmyXArK9DQKy6Bds4G1jbUhfAyXNArZcOz9ukAMpRQK4XgK5RxUCuSp3cDZw4QK9GQK72nCWAzIRAr6IcgIDM3ECvhpzInNPAsPLAsMEc4J0SzVFdOADPKcDPJoDPb8CxXwCxkcCxhCJAshpUQLIRALJTwLJLgJknQLd0nh5YXiueSVL0AMYo2cCAmH0GfOVJHsLXpJeuxECz2sCz2wvS1PS8xOfAMatAs9zASnqA04SfksFAtwnAtuKAtJPA1JcA1NfAQEDVYyAiT8AyxbtYEWCHILTgs6DjQLaxwLZ3oQQhEmnPAOGpQAvA2QOhnFZ+QBVAt9lAt64c3cC4i/tFAHzMCcB9JsB8tKHAuvzAulweQLq+QLq5AD5RwG5Au6JAuuclqqXAwLuPwOF4Jh5cOBxoQLzAwBpA44WmZMC9xMDkW4DkocC95gC+dkC+GaaHJqruzebHgOdgwL++gEbADmfHJ+zAwWNA6ZqA6bZANHFAwZqoYiiBQkDDEkCwAA/AwDhQRdTARHzA2sHl2cFAJMtK7evvdsBiZkUfxEEOQH7KQUhDp0JnwCS/SlXxQL3AZ0AtwW5AG8LbUEuFCaNLgFDAYD8AbUmAHUDDgRtACwCFgyhAAAKAj0CagPdA34EkQEgRQUhfAoABQBEABMANhICdwEABdUDa+8KxQIA9wqfJ7+xt+UBkSFBQgHpFH8RNMCJAAQAGwBaAkUChIsABjpTOpSNbQC4Oo860ACNOME63AClAOgAywE6gTo7Ofw5+Tt2iTpbO56JOm85GAFWATMBbAUvNV01njWtNWY1dTW2NcU1gjWRNdI14TWeNa017jX9NbI1wTYCNhE1xjXVNhY2JzXeNe02LjY9Ni41LSE2OjY9Njw2yTcIBJA8VzY4Nt03IDcPNsogN4k3MAoEsDxnNiQ3GTdsOo03IULUQwdC4EMLHA8PCZsobShRVQYA6X8A6bABFCnXAukBowC9BbcAbwNzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgBFLWZAu0BhQCjBcEAbykBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUABavAj626xQAJP0A3etzuf4NNRA7efy2Z9NQrCnC0OSyANz5BBIbJ5IFDR6miIavYS6tprjjmuKebxm5C74Q225X1pkaYYPb6f1DK4k3xMEBb9S2WMjEibTNWhsRJIA+vwNVEiXTE5iXs/wezV66oFLfp9NZGYW+Gk19J2+bCT6Ye2w6LDYdgzKMUabk595eLBCXANz9HUpWbATq9vqXVx9XDg+Pc9Xp4+bsS005SVM/BJBM4687WUuf+Uj9dEi8aDNaPxtpbDxcG1THTImUMZq4UCaaNYpsVqraNyKLJXDYsFZ/5jl7bLRtO88t7P3xZaAxhb5OdPMXqsSkp1WCieG8jXm1U99+blvLlXzPCS+M93VnJCiK+09LfaSaBAVBomyDgJua8dfUzR7ga34IvR2Nvj+A9heJ6lsl1KG4NkI1032Cnff1m1wof2B9oHJK4bi6JkEdSqeNeiuo6QoZZincoc73/TH9SXF8sCE7XyuYyW8WSgbGFCjPV0ihLKhdPs08Tx82fYAkLLc4I2wdl4apY7GU5lHRFzRWJep7Ww3wbeA3qmd59/86P4xuNaqDpygXt6M85glSBHOCGgJDnt+pN9bK7HApMguX6+06RZNjzVmcZJ+wcUrJ9//bpRNxNuKpNl9uFds+S9tdx7LaM5ZkIrPj6nIU9mnbFtVbs9s/uLgl8MVczAwet+iOEzzBlYW7RCMgE6gyNLeq6+1tIx4dpgZnd0DksJS5f+JNDpwwcPNXaaVspq1fbQajOrJgK0ofKtJ1Ne90L6VO4MOl5S886p7u6xo7OLjG8TGL+HU1JXGJgppg4nNbNJ5nlzSpuPYy21JUEcUA94PoFiZfjZue+QnyQ80ekOuZVkxx4g+cvhJfHgNl4hy1/a6+RKcKlar/J29y//EztlbVPHVUeQ1zX86eQVAjR/M3dA9w4W8LfaXp4EgM85wOWasli837PzVMOnsLzR+k3o75/lRPAJSE1xAKQzEi5v10ke+VBvRt1cwQRMd+U5mLCTGVd6XiZtgBG5cDi0w22GKcVNvHiu5LQbZEDVtz0onn7k5+heuKXVsZtSzilkLRAUmjMXEMB3J9YC50XBxPiz53SC+EhnPl9WsKCv92SM/OFFIMJZYfl0WW8tIO3UxYcwdMAj7FSmgrsZ2aAZO03BOhP1bNNZItyXYQFTpC3SG1VuPDqH9GkiCDmE+JwxyIVSO5siDErAOpEXFgjy6PQtOVDj+s6e1r8heWVvmZnTciuf4EiNZzCAd7SOMhXERIOlsHIMG399i9aLTy3m2hRLZjJVDNLS53iGIK11dPqQt0zBDyg6qc7YqkDm2M5Ve6dCWCaCbTXX2rToaIgz6+zh4lYUi/+6nqcFMAkQJKHYLK0wYk5N9szV6xihDbDDFr45lN1K4aCXBq/FitPSud9gLt5ZVn+ZqGX7cwm2z5EGMgfFpIFyhGGuDPmso6TItTMwny+7uPnLCf4W6goFQFV0oQSsc9VfMmVLcLr6ZetDZbaSFTLqnSO/bIPjA3/zAUoqgGFAEQS4IhuMzEp2I3jJzbzkk/IEmyax+rhZTwd6f+CGtwPixu8IvzACquPWPREu9ZvGkUzpRwvRRuaNN6cr0W1wWits9ICdYJ7ltbgMiSL3sTPeufgNcVqMVWFkCPDH4jG2jA0XcVgQj62Cb29v9f/z/+2KbYvIv/zzjpQAPkliaVDzNrW57TZ/ZOyZD0nlfMmAIBIAGAI0D3k/mdN4xr9v85ZbZbbqfH2jGd5hUqNZWwl5SPfoGmfElmazUIeNL1j/mkF7VNAzTq4jNt8JoQ11NQOcmhprXoxSxfRGJ9LDEOAQ+dmxAQH90iti9e2u/MoeuaGcDTHoC+xsmEeWmxEKefQuIzHbpw5Tc5cEocboAD09oipWQhtTO1wivf/O+DRe2rpl/E9wlrzBorjJsOeG1B/XPW4EaJEFdNlECEZga5ZoGRHXgYouGRuVkm8tDESiEyFNo+3s5M5puSdTyUL2llnINVHEt91XUNW4ewdMgJ4boJfEyt/iY5WXqbA+A2Fkt5Z0lutiWhe9nZIyIUjyXDC3UsaG1t+eNx6z4W/OYoTB7A6x+dNSTOi9AInctbESqm5gvOLww7OWXPrmHwVZasrl4eD113pm+JtT7JVOvnCXqdzzdTRHgJ0PiGTFYW5Gvt9R9LD6Lzfs0v/TZZHSmyVNq7viIHE6DBK7Qp07Iz55EM8SYtQvZf/obBniTWi5C2/ovHfw4VndkE5XYdjOhCMRjDeOEfXeN/CwfGduiUIfsoFeUxXeQXba7c7972XNv8w+dTjjUM0QeNAReW+J014dKAD/McQYXT7c0GQPIkn3Ll6R7gGjuiQoZD0TEeEqQpKoZ15g/0OPQI17QiSv9AUROa/V/TQN3dvLArec3RrsYlvBm1b8LWzltdugsC50lNKYLEp2a+ZZYqPejULRlOJh5zj/LVMyTDvwKhMxxwuDkxJ1QpoNI0OTWLom4Z71SNzI9TV1iXJrIu9Wcnd+MCaAw8o1jSXd94YU/1gnkrC9BUEOtQvEIQ7g0i6h+KL2JKk8Ydl7HruvgWMSAmNe+LshGhV4qnWHhO9/RIPQzY1tHRj2VqOyNsDpK0cww+56AdDC4gsWwY0XxoucIWIqs/GcwnWqlaT0KPr8mbK5U94/301i1WLt4YINTVvCFBrFZbIbY8eycOdeJ2teD5IfPLCRg7jjcFTwlMFNl9zdh/o3E/hHPwj7BWg0MU09pPrBLbrCgm54A6H+I6v27+jL5gkjWg/iYdks9jbfVP5y/n0dlgWEMlKasl7JvFZd56LfybW1eeaVO0gxTfXZwD8G4SI116yx7UKVRgui6Ya1YpixqXeNLc8IxtAwCU5IhwQgn+NqHnRaDv61CxKhOq4pOX7M6pkA+Pmpd4j1vn6ACUALoLLc4vpXci8VidLxzm7qFBe7s+quuJs6ETYmnpgS3LwSZxPIltgBDXz8M1k/W2ySNv2f9/NPhxLGK2D21dkHeSGmenRT3Yqcdl0m/h3OYr8V+lXNYGf8aCCpd4bWjE4QIPj7vUKN4Nrfs7ML6Y2OyS830JCnofg/k7lpFpt4SqZc5HGg1HCOrHvOdC8bP6FGDbE/VV0mX4IakzbdS/op+Kt3G24/8QbBV7y86sGSQ/vZzU8FXs7u6jIvwchsEP2BpIhW3G8uWNwa3HmjfH/ZjhhCWvluAcF+nMf14ClKg5hGgtPLJ98ueNAkc5Hs2WZlk2QHvfreCK1CCGO6nMZVSb99VM/ajr8WHTte9JSmkXq/i/U943HEbdzW6Re/S88dKgg8pGOLlAeNiqrcLkUR3/aClFpMXcOUP3rmETcWSfMXZE3TUOi8i+fqRnTYLflVx/Vb/6GJ7eIRZUA6k3RYR3iFSK9c4iDdNwJuZL2FKz/IK5VimcNWEqdXjSoxSgmF0UPlDoUlNrPcM7ftmA8Y9gKiqKEHuWN+AZRIwtVSxye2Kf8rM3lhJ5XcBXU9n4v0Oy1RU2M+4qM8AQPVwse8ErNSob5oFPWxuqZnVzo1qB/IBxkM3EVUKFUUlO3e51259GgNcJbCmlvrdjtoTW7rChm1wyCKzpCTwozUUEOIcWLneRLgMXh+SjGSFkAllzbGS5HK7LlfCMRNRDSvbQPjcXaenNYxCvu2Qyznz6StuxVj66SgI0T8B6/sfHAJYZaZ78thjOSIFumNWLQbeZixDCCC+v0YBtkxiBB3jefHqZ/dFHU+crbj6OvS1x/JDD7vlm7zOVPwpUC01nhxZuY/63E7g";const Yi=44032,bc=4352,Zc=4449,yc=4519,Zf=19,yf=21,hr=28,Gc=yf*hr,xw=Zf*Gc,Kw=Yi+xw,Ew=bc+Zf,Uw=Zc+yf,zw=yc+hr;function jr(e){return e>>24&255}function Gf(e){return e&16777215}let Pu,bZ,Ou,Wo;function Qw(){let e=df(Fw);Pu=new Map(uf(e).flatMap((g,t)=>g.map(I=>[I,t+1<<24]))),bZ=new Set(Ji(e)),Ou=new Map,Wo=new Map;for(let[g,t]of mf(e)){if(!bZ.has(g)&&t.length==2){let[I,n]=t,l=Wo.get(I);l||(l=new Map,Wo.set(I,l)),l.set(n,g)}Ou.set(g,t.reverse())}}function pf(e){return e>=Yi&&e<Kw}function Lw(e,g){if(e>=bc&&e<Ew&&g>=Zc&&g<Uw)return Yi+(e-bc)*Gc+(g-Zc)*hr;if(pf(e)&&g>yc&&g<zw&&(e-Yi)%hr==0)return e+(g-yc);{let t=Wo.get(e);return t&&(t=t.get(g),t)?t:-1}}function Bf(e){Pu||Qw();let g=[],t=[],I=!1;function n(l){let C=Pu.get(l);C&&(I=!0,l|=C),g.push(l)}for(let l of e)for(;;){if(l<128)g.push(l);else if(pf(l)){let C=l-Yi,s=C/Gc|0,r=C%Gc/hr|0,a=C%hr;n(bc+s),n(Zc+r),a>0&&n(yc+a)}else{let C=Ou.get(l);C?t.push(...C):n(l)}if(!t.length)break;l=t.pop()}if(I&&g.length>1){let l=jr(g[0]);for(let C=1;C<g.length;C++){let s=jr(g[C]);if(s==0||l<=s){l=s;continue}let r=C-1;for(;;){let a=g[r+1];if(g[r+1]=g[r],g[r]=a,!r||(l=jr(g[--r]),l<=s))break}l=jr(g[C])}}return g}function Tw(e){let g=[],t=[],I=-1,n=0;for(let l of e){let C=jr(l),s=Gf(l);if(I==-1)C==0?I=s:g.push(s);else if(n>0&&n>=C)C==0?(g.push(I,...t),t.length=0,I=s):t.push(s),n=C;else{let r=Lw(I,s);r>=0?I=r:n==0&&C==0?(g.push(I),I=s):(t.push(s),n=C)}}return I>=0&&g.push(I,...t),g}function ff(e){return Bf(e).map(Gf)}function Mw(e){return Tw(Bf(e))}const ZZ=45,Vf=".",Wf=65039,Sf=1,pc=e=>Array.from(e);function vi(e,g){return e.P.has(g)||e.Q.has(g)}class Dw extends Array{get is_emoji(){return!0}}let qu,Rf,wl,_u,kf,is,pd,vC,Gl,yZ,$u;function Eh(){if(qu)return;let e=df(Vw);const g=()=>Ji(e),t=()=>new Set(g()),I=(o,c)=>c.forEach(A=>o.add(A));qu=new Map(mf(e)),Rf=t(),wl=g(),_u=new Set(g().map(o=>wl[o])),wl=new Set(wl),kf=t(),t();let n=uf(e),l=e();const C=()=>{let o=new Set;return g().forEach(c=>I(o,n[c])),I(o,g()),o};is=wi(o=>{let c=wi(e).map(A=>A+96);if(c.length){let A=o>=l;c[0]-=32,c=mr(c),A&&(c=`Restricted[${c}]`);let b=C(),m=C(),Z=!e();return{N:c,P:b,Q:m,M:Z,R:A}}}),pd=t(),vC=new Map;let s=g().concat(pc(pd)).sort((o,c)=>o-c);s.forEach((o,c)=>{let A=e(),b=s[c]=A?s[c-A]:{V:[],M:new Map};b.V.push(o),pd.has(o)||vC.set(o,b)});for(let{V:o,M:c}of new Set(vC.values())){let A=[];for(let m of o){let Z=is.filter(h=>vi(h,m)),G=A.find(({G:h})=>Z.some(u=>h.has(u)));G||(G={G:new Set,V:[]},A.push(G)),G.V.push(m),I(G.G,Z)}let b=A.flatMap(m=>pc(m.G));for(let{G:m,V:Z}of A){let G=new Set(b.filter(h=>!m.has(h)));for(let h of Z)c.set(h,G)}}Gl=new Set;let r=new Set;const a=o=>Gl.has(o)?r.add(o):Gl.add(o);for(let o of is){for(let c of o.P)a(c);for(let c of o.Q)a(c)}for(let o of Gl)!vC.has(o)&&!r.has(o)&&vC.set(o,Sf);I(Gl,ff(Gl)),yZ=Yw(e).map(o=>Dw.from(o)).sort(Hw),$u=new Map;for(let o of yZ){let c=[$u];for(let A of o){let b=c.map(m=>{let Z=m.get(A);return Z||(Z=new Map,m.set(A,Z)),Z});A===Wf?c.push(...b):c=b}for(let A of c)A.V=o}}function Uh(e){return(Xf(e)?"":`${zh(AA([e]))} `)+bf(e)}function zh(e){return`"${e}"`}function jw(e){if(e.length>=4&&e[2]==ZZ&&e[3]==ZZ)throw new Error(`invalid label extension: "${mr(e.slice(0,4))}"`)}function Pw(e){for(let t=e.lastIndexOf(95);t>0;)if(e[--t]!==95)throw new Error("underscore allowed only at start")}function Ow(e){let g=e[0],t=mZ.get(g);if(t)throw si(`leading ${t}`);let I=e.length,n=-1;for(let l=1;l<I;l++){g=e[l];let C=mZ.get(g);if(C){if(n==l)throw si(`${t} + ${C}`);n=l+1,t=C}}if(n==I)throw si(`trailing ${t}`)}function AA(e,g=1/0,t=bf){let I=[];qw(e[0])&&I.push(""),e.length>g&&(g>>=1,e=[...e.slice(0,g),8230,...e.slice(-g)]);let n=0,l=e.length;for(let C=0;C<l;C++){let s=e[C];Xf(s)&&(I.push(mr(e.slice(n,C))),I.push(t(s)),n=C+1)}return I.push(mr(e.slice(n,l))),I.join("")}function qw(e){return Eh(),wl.has(e)}function Xf(e){return Eh(),kf.has(e)}function _w(e){return tY($w(e,Mw,lY))}function $w(e,g,t){if(!e)return[];Eh();let I=0;return e.split(Vf).map(n=>{let l=Nw(n),C={input:l,offset:I};I+=l.length+1;try{let s=C.tokens=nY(l,g,t),r=s.length,a;if(!r)throw new Error("empty label");let o=C.output=s.flat();if(Pw(o),!(C.emoji=r>1||s[0].is_emoji)&&o.every(A=>A<128))jw(o),a="ASCII";else{let A=s.flatMap(b=>b.is_emoji?[]:b);if(!A.length)a="Emoji";else{if(wl.has(o[0]))throw si("leading combining mark");for(let Z=1;Z<r;Z++){let G=s[Z];if(!G.is_emoji&&wl.has(G[0]))throw si(`emoji + combining mark: "${mr(s[Z-1])} + ${AA([G[0]])}"`)}Ow(o);let b=pc(new Set(A)),[m]=eY(b);IY(m,A),gY(m,b),a=m.N}}C.type=a}catch(s){C.error=s}return C})}function gY(e,g){let t,I=[];for(let n of g){let l=vC.get(n);if(l===Sf)return;if(l){let C=l.M.get(n);if(t=t?t.filter(s=>C.has(s)):pc(C),!t.length)return}else I.push(n)}if(t){for(let n of t)if(I.every(l=>vi(n,l)))throw new Error(`whole-script confusable: ${e.N}/${n.N}`)}}function eY(e){let g=is;for(let t of e){let I=g.filter(n=>vi(n,t));if(!I.length)throw is.some(n=>vi(n,t))?wf(g[0],t):Jf(t);if(g=I,I.length==1)break}return g}function tY(e){return e.map(({input:g,error:t,output:I})=>{if(t){let n=t.message;throw new Error(e.length==1?n:`Invalid label ${zh(AA(g,63))}: ${n}`)}return mr(I)}).join(Vf)}function Jf(e){return new Error(`disallowed character: ${Uh(e)}`)}function wf(e,g){let t=Uh(g),I=is.find(n=>n.P.has(g));return I&&(t=`${I.N} ${t}`),new Error(`illegal mixture: ${e.N} + ${t}`)}function si(e){return new Error(`illegal placement: ${e}`)}function IY(e,g){for(let t of g)if(!vi(e,t))throw wf(e,t);if(e.M){let t=ff(g);for(let I=1,n=t.length;I<n;I++)if(_u.has(t[I])){let l=I+1;for(let C;l<n&&_u.has(C=t[l]);l++)for(let s=I;s<l;s++)if(t[s]==C)throw new Error(`duplicate non-spacing marks: ${Uh(C)}`);if(l-I>hZ)throw new Error(`excessive non-spacing marks: ${zh(AA(t.slice(I-1,l)))} (${l-I}/${hZ})`);I=l}}}function nY(e,g,t){let I=[],n=[];for(e=e.slice().reverse();e.length;){let l=CY(e);if(l)n.length&&(I.push(g(n)),n=[]),I.push(t(l));else{let C=e.pop();if(Gl.has(C))n.push(C);else{let s=qu.get(C);if(s)n.push(...s);else if(!Rf.has(C))throw Jf(C)}}}return n.length&&I.push(g(n)),I}function lY(e){return e.filter(g=>g!=Wf)}function CY(e,g){let t=$u,I,n=e.length;for(;n&&(t=t.get(e[--n]),!!t);){let{V:l}=t;l&&(I=l,g&&g.push(...e.slice(n).reverse()),e.length=n)}return I}const Yf=new Uint8Array(32);Yf.fill(0);function GZ(e){return V(e.length!==0,"invalid ENS name; empty component","comp",e),e}function Qh(e){const g=yI(sY(e)),t=[];if(e.length===0)return t;let I=0;for(let n=0;n<g.length;n++)g[n]===46&&(t.push(GZ(g.slice(I,n))),I=n+1);return V(I<g.length,"invalid ENS name; empty component","name",e),t.push(GZ(g.slice(I))),t}function sY(e){try{if(e.length===0)throw new Error("empty label");return _w(e)}catch(g){V(!1,`invalid ENS name (${g.message})`,"name",e)}}function R9(e){try{return Qh(e).length!==0}catch{}return!1}function gm(e){V(typeof e=="string","invalid ENS name; not a string","name",e),V(e.length,"invalid ENS name (empty label)","name",e);let g=Yf;const t=Qh(e);for(;t.length;)g=Hg(pg([g,Hg(t.pop())]));return D(g)}function rY(e,g){const t=g??63;return V(t<=255,"DNS encoded label cannot exceed 255","length",t),D(pg(Qh(e).map(I=>{V(I.length<=t,`label ${JSON.stringify(e)} exceeds ${t} bytes`,"name",e);const n=new Uint8Array(I.length+1);return n.set(I,1),n[0]=n.length-1,n})))+"00"}const vf=new Uint8Array(32);vf.fill(0);const iY=BigInt(-1),Nf=BigInt(0),Hf=BigInt(1),aY=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function oY(e){const g=ng(e),t=g.length%32;return t?pg([g,vf.slice(t)]):D(g)}const cY=Il(Hf,32),AY=Il(Nf,32),pZ={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},Bd=["name","version","chainId","verifyingContract","salt"];function BZ(e){return function(g){return V(typeof g=="string",`invalid domain value for ${JSON.stringify(e)}`,`domain.${e}`,g),g}}const dY={name:BZ("name"),version:BZ("version"),chainId:function(e){const g=q(e,"domain.chainId");return V(g>=0,"invalid chain ID","domain.chainId",e),Number.isSafeInteger(g)?Number(g):Kt(g)},verifyingContract:function(e){try{return ag(e).toLowerCase()}catch{}V(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",e)},salt:function(e){const g=ng(e,"domain.salt");return V(g.length===32,'invalid domain value "salt"',"domain.salt",e),D(g)}};function fd(e){{const g=e.match(/^(u?)int(\d+)$/);if(g){const t=g[1]==="",I=parseInt(g[2]);V(I%8===0&&I!==0&&I<=256&&g[2]===String(I),"invalid numeric width","type",e);const n=Xl(aY,t?I-1:I),l=t?(n+Hf)*iY:Nf;return function(C){const s=q(C,"value");return V(s>=l&&s<=n,`value out-of-bounds for ${e}`,"value",s),Il(t?AB(s,256):s,32)}}}{const g=e.match(/^bytes(\d+)$/);if(g){const t=parseInt(g[1]);return V(t!==0&&t<=32&&g[1]===String(t),"invalid bytes width","type",e),function(I){const n=ng(I);return V(n.length===t,`invalid length for ${e}`,"value",I),oY(I)}}}switch(e){case"address":return function(g){return tn(ag(g),32)};case"bool":return function(g){return g?cY:AY};case"bytes":return function(g){return Hg(g)};case"string":return function(g){return dC(g)}}return null}function fZ(e,g){return`${e}(${g.map(({name:t,type:I})=>I+" "+t).join(",")})`}function go(e){const g=e.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return g?{base:g[1],index:g[2]+g[4],array:{base:g[1],prefix:g[1]+g[2],count:g[5]?parseInt(g[5]):-1}}:{base:e}}var $i,HI,Ns,Yc,Ff;const ot=class ot{constructor(g){k(this,Yc);R(this,"primaryType");k(this,$i,void 0);k(this,HI,void 0);k(this,Ns,void 0);p(this,HI,new Map),p(this,Ns,new Map);const t=new Map,I=new Map,n=new Map,l={};Object.keys(g).forEach(r=>{l[r]=g[r].map(({name:a,type:o})=>{let{base:c,index:A}=go(o);return c==="int"&&!g.int&&(c="int256"),c==="uint"&&!g.uint&&(c="uint256"),{name:a,type:c+(A||"")}}),t.set(r,new Set),I.set(r,[]),n.set(r,new Set)}),p(this,$i,JSON.stringify(l));for(const r in l){const a=new Set;for(const o of l[r]){V(!a.has(o.name),`duplicate variable name ${JSON.stringify(o.name)} in ${JSON.stringify(r)}`,"types",g),a.add(o.name);const c=go(o.type).base;V(c!==r,`circular type reference to ${JSON.stringify(c)}`,"types",g),!fd(c)&&(V(I.has(c),`unknown type ${JSON.stringify(c)}`,"types",g),I.get(c).push(r),t.get(r).add(c))}}const C=Array.from(I.keys()).filter(r=>I.get(r).length===0);V(C.length!==0,"missing primary type","types",g),V(C.length===1,`ambiguous primary types or unused types: ${C.map(r=>JSON.stringify(r)).join(", ")}`,"types",g),$(this,{primaryType:C[0]});function s(r,a){V(!a.has(r),`circular type reference to ${JSON.stringify(r)}`,"types",g),a.add(r);for(const o of t.get(r))if(I.has(o)){s(o,a);for(const c of a)n.get(c).add(o)}a.delete(r)}s(this.primaryType,new Set);for(const[r,a]of n){const o=Array.from(a);o.sort(),d(this,HI).set(r,fZ(r,l[r])+o.map(c=>fZ(c,l[c])).join(""))}}get types(){return JSON.parse(d(this,$i))}getEncoder(g){let t=d(this,Ns).get(g);return t||(t=E(this,Yc,Ff).call(this,g),d(this,Ns).set(g,t)),t}encodeType(g){const t=d(this,HI).get(g);return V(t,`unknown type: ${JSON.stringify(g)}`,"name",g),t}encodeData(g,t){return this.getEncoder(g)(t)}hashStruct(g,t){return Hg(this.encodeData(g,t))}encode(g){return this.encodeData(this.primaryType,g)}hash(g){return this.hashStruct(this.primaryType,g)}_visit(g,t,I){if(fd(g))return I(g,t);const n=go(g).array;if(n)return V(n.count===-1||n.count===t.length,`array length mismatch; expected length ${n.count}`,"value",t),t.map(C=>this._visit(n.prefix,C,I));const l=this.types[g];if(l)return l.reduce((C,{name:s,type:r})=>(C[s]=this._visit(r,t[s],I),C),{});V(!1,`unknown type: ${g}`,"type",g)}visit(g,t){return this._visit(this.primaryType,g,t)}static from(g){return new ot(g)}static getPrimaryType(g){return ot.from(g).primaryType}static hashStruct(g,t,I){return ot.from(t).hashStruct(g,I)}static hashDomain(g){const t=[];for(const I in g){if(g[I]==null)continue;const n=pZ[I];V(n,`invalid typed-data domain key: ${JSON.stringify(I)}`,"domain",g),t.push({name:I,type:n})}return t.sort((I,n)=>Bd.indexOf(I.name)-Bd.indexOf(n.name)),ot.hashStruct("EIP712Domain",{EIP712Domain:t},g)}static encode(g,t,I){return pg(["0x1901",ot.hashDomain(g),ot.from(t).hash(I)])}static hash(g,t,I){return Hg(ot.encode(g,t,I))}static async resolveNames(g,t,I,n){g=Object.assign({},g);for(const s in g)g[s]==null&&delete g[s];const l={};g.verifyingContract&&!Zg(g.verifyingContract,20)&&(l[g.verifyingContract]="0x");const C=ot.from(t);C.visit(I,(s,r)=>(s==="address"&&!Zg(r,20)&&(l[r]="0x"),r));for(const s in l)l[s]=await n(s);return g.verifyingContract&&l[g.verifyingContract]&&(g.verifyingContract=l[g.verifyingContract]),I=C.visit(I,(s,r)=>s==="address"&&l[r]?l[r]:r),{domain:g,value:I}}static getPayload(g,t,I){ot.hashDomain(g);const n={},l=[];Bd.forEach(r=>{const a=g[r];a!=null&&(n[r]=dY[r](a),l.push({name:r,type:pZ[r]}))});const C=ot.from(t);t=C.types;const s=Object.assign({},t);return V(s.EIP712Domain==null,"types must not contain EIP712Domain type","types.EIP712Domain",t),s.EIP712Domain=l,C.encode(I),{types:s,domain:n,primaryType:C.primaryType,message:C.visit(I,(r,a)=>{if(r.match(/^bytes(\d*)/))return D(ng(a));if(r.match(/^u?int/))return q(a).toString();switch(r){case"address":return a.toLowerCase();case"bool":return!!a;case"string":return V(typeof a=="string","invalid string","value",a),a}V(!1,"unsupported type","type",r)})}}};$i=new WeakMap,HI=new WeakMap,Ns=new WeakMap,Yc=new WeakSet,Ff=function(g){{const n=fd(g);if(n)return n}const t=go(g).array;if(t){const n=t.prefix,l=this.getEncoder(n);return C=>{V(t.count===-1||t.count===C.length,`array length mismatch; expected length ${t.count}`,"value",C);let s=C.map(l);return d(this,HI).has(n)&&(s=s.map(Hg)),Hg(pg(s))}}const I=this.types[g];if(I){const n=dC(d(this,HI).get(g));return l=>{const C=I.map(({name:s,type:r})=>{const a=this.getEncoder(r)(l[s]);return d(this,HI).has(r)?Hg(a):a});return C.unshift(n),pg(C)}}V(!1,`unknown type: ${g}`,"type",g)};let Ni=ot;function k9(e,g,t,I){return Af(Ni.hash(e,g,t),I)}function Be(e){const g=new Set;return e.forEach(t=>g.add(t)),Object.freeze(g)}const uY="external public payable override",mY=Be(uY.split(" ")),xf="constant external internal payable private public pure view override",hY=Be(xf.split(" ")),Kf="constructor error event fallback function receive struct",Ef=Be(Kf.split(" ")),Uf="calldata memory storage payable indexed",bY=Be(Uf.split(" ")),ZY="tuple returns",yY=[Kf,Uf,ZY,xf].join(" "),GY=Be(yY.split(" ")),pY={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},BY=new RegExp("^(\\s*)"),fY=new RegExp("^([0-9]+)"),VY=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),zf=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),Qf=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");var qg,Nt,ga,em;const vc=class vc{constructor(g){k(this,ga);k(this,qg,void 0);k(this,Nt,void 0);p(this,qg,0),p(this,Nt,g.slice())}get offset(){return d(this,qg)}get length(){return d(this,Nt).length-d(this,qg)}clone(){return new vc(d(this,Nt))}reset(){p(this,qg,0)}popKeyword(g){const t=this.peek();if(t.type!=="KEYWORD"||!g.has(t.text))throw new Error(`expected keyword ${t.text}`);return this.pop().text}popType(g){if(this.peek().type!==g){const t=this.peek();throw new Error(`expected ${g}; got ${t.type} ${JSON.stringify(t.text)}`)}return this.pop().text}popParen(){const g=this.peek();if(g.type!=="OPEN_PAREN")throw new Error("bad start");const t=E(this,ga,em).call(this,d(this,qg)+1,g.match+1);return p(this,qg,g.match+1),t}popParams(){const g=this.peek();if(g.type!=="OPEN_PAREN")throw new Error("bad start");const t=[];for(;d(this,qg)<g.match-1;){const I=this.peek().linkNext;t.push(E(this,ga,em).call(this,d(this,qg)+1,I)),p(this,qg,I)}return p(this,qg,g.match+1),t}peek(){if(d(this,qg)>=d(this,Nt).length)throw new Error("out-of-bounds");return d(this,Nt)[d(this,qg)]}peekKeyword(g){const t=this.peekType("KEYWORD");return t!=null&&g.has(t)?t:null}peekType(g){if(this.length===0)return null;const t=this.peek();return t.type===g?t.text:null}pop(){const g=this.peek();return Xr(this,qg)._++,g}toString(){const g=[];for(let t=d(this,qg);t<d(this,Nt).length;t++){const I=d(this,Nt)[t];g.push(`${I.type}:${I.text}`)}return`<TokenString ${g.join(" ")}>`}};qg=new WeakMap,Nt=new WeakMap,ga=new WeakSet,em=function(g=0,t=0){return new vc(d(this,Nt).slice(g,t).map(I=>Object.freeze(Object.assign({},I,{match:I.match-g,linkBack:I.linkBack-g,linkNext:I.linkNext-g}))))};let Dt=vc;function al(e){const g=[],t=C=>{const s=l<e.length?JSON.stringify(e[l]):"$EOI";throw new Error(`invalid token ${s} at ${l}: ${C}`)};let I=[],n=[],l=0;for(;l<e.length;){let C=e.substring(l),s=C.match(BY);s&&(l+=s[1].length,C=e.substring(l));const r={depth:I.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:l,value:-1};g.push(r);let a=pY[C[0]]||"";if(a){if(r.type=a,r.text=C[0],l++,a==="OPEN_PAREN")I.push(g.length-1),n.push(g.length-1);else if(a=="CLOSE_PAREN")I.length===0&&t("no matching open bracket"),r.match=I.pop(),g[r.match].match=g.length-1,r.depth--,r.linkBack=n.pop(),g[r.linkBack].linkNext=g.length-1;else if(a==="COMMA")r.linkBack=n.pop(),g[r.linkBack].linkNext=g.length-1,n.push(g.length-1);else if(a==="OPEN_BRACKET")r.type="BRACKET";else if(a==="CLOSE_BRACKET"){let o=g.pop().text;if(g.length>0&&g[g.length-1].type==="NUMBER"){const c=g.pop().text;o=c+o,g[g.length-1].value=Ig(c)}if(g.length===0||g[g.length-1].type!=="BRACKET")throw new Error("missing opening bracket");g[g.length-1].text+=o}continue}if(s=C.match(VY),s){if(r.text=s[1],l+=r.text.length,GY.has(r.text)){r.type="KEYWORD";continue}if(r.text.match(Qf)){r.type="TYPE";continue}r.type="ID";continue}if(s=C.match(fY),s){r.text=s[1],r.type="NUMBER",l+=r.text.length;continue}throw new Error(`unexpected token ${JSON.stringify(C[0])} at position ${l}`)}return new Dt(g.map(C=>Object.freeze(C)))}function VZ(e,g){let t=[];for(const I in g.keys())e.has(I)&&t.push(I);if(t.length>1)throw new Error(`conflicting types: ${t.join(", ")}`)}function dA(e,g){if(g.peekKeyword(Ef)){const t=g.pop().text;if(t!==e)throw new Error(`expected ${e}, got ${t}`)}return g.popType("ID")}function nn(e,g){const t=new Set;for(;;){const I=e.peekType("KEYWORD");if(I==null||g&&!g.has(I))break;if(e.pop(),t.has(I))throw new Error(`duplicate keywords: ${JSON.stringify(I)}`);t.add(I)}return Object.freeze(t)}function Lf(e){let g=nn(e,hY);return VZ(g,Be("constant payable nonpayable".split(" "))),VZ(g,Be("pure view payable nonpayable".split(" "))),g.has("view")?"view":g.has("pure")?"pure":g.has("payable")?"payable":g.has("nonpayable")?"nonpayable":g.has("constant")?"view":"nonpayable"}function PI(e,g){return e.popParams().map(t=>ne.from(t,g))}function Tf(e){if(e.peekType("AT")){if(e.pop(),e.peekType("NUMBER"))return q(e.pop().text);throw new Error("invalid gas")}return null}function uC(e){if(e.length)throw new Error(`unexpected tokens at offset ${e.offset}: ${e.toString()}`)}const WY=new RegExp(/^(.*)\[([0-9]*)\]$/);function WZ(e){const g=e.match(Qf);if(V(g,"invalid type","type",e),e==="uint")return"uint256";if(e==="int")return"int256";if(g[2]){const t=parseInt(g[2]);V(t!==0&&t<=32,"invalid bytes length","type",e)}else if(g[3]){const t=parseInt(g[3]);V(t!==0&&t<=256&&t%8===0,"invalid numeric width","type",e)}return e}const Rg={},Ee=Symbol.for("_ethers_internal"),SZ="_ParamTypeInternal",RZ="_ErrorInternal",kZ="_EventInternal",XZ="_ConstructorInternal",JZ="_FallbackInternal",wZ="_FunctionInternal",YZ="_StructInternal";var Hs,So;const ct=class ct{constructor(g,t,I,n,l,C,s,r){k(this,Hs);R(this,"name");R(this,"type");R(this,"baseType");R(this,"indexed");R(this,"components");R(this,"arrayLength");R(this,"arrayChildren");if(Za(g,Rg,"ParamType"),Object.defineProperty(this,Ee,{value:SZ}),C&&(C=Object.freeze(C.slice())),n==="array"){if(s==null||r==null)throw new Error("")}else if(s!=null||r!=null)throw new Error("");if(n==="tuple"){if(C==null)throw new Error("")}else if(C!=null)throw new Error("");$(this,{name:t,type:I,baseType:n,indexed:l,components:C,arrayLength:s,arrayChildren:r})}format(g){if(g==null&&(g="sighash"),g==="json"){const I=this.name||"";if(this.isArray()){const l=JSON.parse(this.arrayChildren.format("json"));return l.name=I,l.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(l)}const n={type:this.baseType==="tuple"?"tuple":this.type,name:I};return typeof this.indexed=="boolean"&&(n.indexed=this.indexed),this.isTuple()&&(n.components=this.components.map(l=>JSON.parse(l.format(g)))),JSON.stringify(n)}let t="";return this.isArray()?(t+=this.arrayChildren.format(g),t+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?t+="("+this.components.map(I=>I.format(g)).join(g==="full"?", ":",")+")":t+=this.type,g!=="sighash"&&(this.indexed===!0&&(t+=" indexed"),g==="full"&&this.name&&(t+=" "+this.name)),t}isArray(){return this.baseType==="array"}isTuple(){return this.baseType==="tuple"}isIndexable(){return this.indexed!=null}walk(g,t){if(this.isArray()){if(!Array.isArray(g))throw new Error("invalid array value");if(this.arrayLength!==-1&&g.length!==this.arrayLength)throw new Error("array is wrong length");const I=this;return g.map(n=>I.arrayChildren.walk(n,t))}if(this.isTuple()){if(!Array.isArray(g))throw new Error("invalid tuple value");if(g.length!==this.components.length)throw new Error("array is wrong length");const I=this;return g.map((n,l)=>I.components[l].walk(n,t))}return t(this.type,g)}async walkAsync(g,t){const I=[],n=[g];return E(this,Hs,So).call(this,I,g,t,l=>{n[0]=l}),I.length&&await Promise.all(I),n[0]}static from(g,t){if(ct.isParamType(g))return g;if(typeof g=="string")try{return ct.from(al(g),t)}catch{V(!1,"invalid param type","obj",g)}else if(g instanceof Dt){let s="",r="",a=null;nn(g,Be(["tuple"])).has("tuple")||g.peekType("OPEN_PAREN")?(r="tuple",a=g.popParams().map(Z=>ct.from(Z)),s=`tuple(${a.map(Z=>Z.format()).join(",")})`):(s=WZ(g.popType("TYPE")),r=s);let o=null,c=null;for(;g.length&&g.peekType("BRACKET");){const Z=g.pop();o=new ct(Rg,"",s,r,null,a,c,o),c=Z.value,s+=Z.text,r="array",a=null}let A=null;if(nn(g,bY).has("indexed")){if(!t)throw new Error("");A=!0}const m=g.peekType("ID")?g.pop().text:"";if(g.length)throw new Error("leftover tokens");return new ct(Rg,m,s,r,A,a,c,o)}const I=g.name;V(!I||typeof I=="string"&&I.match(zf),"invalid name","obj.name",I);let n=g.indexed;n!=null&&(V(t,"parameter cannot be indexed","obj.indexed",g.indexed),n=!!n);let l=g.type,C=l.match(WY);if(C){const s=parseInt(C[2]||"-1"),r=ct.from({type:C[1],components:g.components});return new ct(Rg,I||"",l,"array",n,null,s,r)}if(l==="tuple"||l.startsWith("tuple(")||l.startsWith("(")){const s=g.components!=null?g.components.map(a=>ct.from(a)):null;return new ct(Rg,I||"",l,"tuple",n,s,null,null)}return l=WZ(g.type),new ct(Rg,I||"",l,l,n,null,null,null)}static isParamType(g){return g&&g[Ee]===SZ}};Hs=new WeakSet,So=function(g,t,I,n){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(this.arrayLength!==-1&&t.length!==this.arrayLength)throw new Error("array is wrong length");const C=this.arrayChildren,s=t.slice();s.forEach((r,a)=>{var o;E(o=C,Hs,So).call(o,g,r,I,c=>{s[a]=c})}),n(s);return}if(this.isTuple()){const C=this.components;let s;if(Array.isArray(t))s=t.slice();else{if(t==null||typeof t!="object")throw new Error("invalid tuple value");s=C.map(r=>{if(!r.name)throw new Error("cannot use object value with unnamed components");if(!(r.name in t))throw new Error(`missing value for component ${r.name}`);return t[r.name]})}if(s.length!==this.components.length)throw new Error("array is wrong length");s.forEach((r,a)=>{var o;E(o=C[a],Hs,So).call(o,g,r,I,c=>{s[a]=c})}),n(s);return}const l=I(this.type,t);l.then?g.push(async function(){n(await l)}()):n(l)};let ne=ct;class mC{constructor(g,t,I){R(this,"type");R(this,"inputs");Za(g,Rg,"Fragment"),I=Object.freeze(I.slice()),$(this,{type:t,inputs:I})}static from(g){if(typeof g=="string"){try{mC.from(JSON.parse(g))}catch{}return mC.from(al(g))}if(g instanceof Dt)switch(g.peekKeyword(Ef)){case"constructor":return MI.from(g);case"error":return Ye.from(g);case"event":return oI.from(g);case"fallback":case"receive":return XI.from(g);case"function":return cI.from(g);case"struct":return sC.from(g)}else if(typeof g=="object"){switch(g.type){case"constructor":return MI.from(g);case"error":return Ye.from(g);case"event":return oI.from(g);case"fallback":case"receive":return XI.from(g);case"function":return cI.from(g);case"struct":return sC.from(g)}H(!1,`unsupported type: ${g.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}V(!1,"unsupported frgament object","obj",g)}static isConstructor(g){return MI.isFragment(g)}static isError(g){return Ye.isFragment(g)}static isEvent(g){return oI.isFragment(g)}static isFunction(g){return cI.isFragment(g)}static isStruct(g){return sC.isFragment(g)}}class uA extends mC{constructor(t,I,n,l){super(t,I,l);R(this,"name");V(typeof n=="string"&&n.match(zf),"invalid identifier","name",n),l=Object.freeze(l.slice()),$(this,{name:n})}}function Hi(e,g){return"("+g.map(t=>t.format(e)).join(e==="full"?", ":",")+")"}class Ye extends uA{constructor(g,t,I){super(g,"error",t,I),Object.defineProperty(this,Ee,{value:RZ})}get selector(){return dC(this.format("sighash")).substring(0,10)}format(g){if(g==null&&(g="sighash"),g==="json")return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(I=>JSON.parse(I.format(g)))});const t=[];return g!=="sighash"&&t.push("error"),t.push(this.name+Hi(g,this.inputs)),t.join(" ")}static from(g){if(Ye.isFragment(g))return g;if(typeof g=="string")return Ye.from(al(g));if(g instanceof Dt){const t=dA("error",g),I=PI(g);return uC(g),new Ye(Rg,t,I)}return new Ye(Rg,g.name,g.inputs?g.inputs.map(ne.from):[])}static isFragment(g){return g&&g[Ee]===RZ}}class oI extends uA{constructor(t,I,n,l){super(t,"event",I,n);R(this,"anonymous");Object.defineProperty(this,Ee,{value:kZ}),$(this,{anonymous:l})}get topicHash(){return dC(this.format("sighash"))}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(t)))});const I=[];return t!=="sighash"&&I.push("event"),I.push(this.name+Hi(t,this.inputs)),t!=="sighash"&&this.anonymous&&I.push("anonymous"),I.join(" ")}static getTopicHash(t,I){return I=(I||[]).map(l=>ne.from(l)),new oI(Rg,t,I,!1).topicHash}static from(t){if(oI.isFragment(t))return t;if(typeof t=="string")try{return oI.from(al(t))}catch{V(!1,"invalid event fragment","obj",t)}else if(t instanceof Dt){const I=dA("event",t),n=PI(t,!0),l=!!nn(t,Be(["anonymous"])).has("anonymous");return uC(t),new oI(Rg,I,n,l)}return new oI(Rg,t.name,t.inputs?t.inputs.map(I=>ne.from(I,!0)):[],!!t.anonymous)}static isFragment(t){return t&&t[Ee]===kZ}}class MI extends mC{constructor(t,I,n,l,C){super(t,I,n);R(this,"payable");R(this,"gas");Object.defineProperty(this,Ee,{value:XZ}),$(this,{payable:l,gas:C})}format(t){if(H(t!=null&&t!=="sighash","cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),t==="json")return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(t)))});const I=[`constructor${Hi(t,this.inputs)}`];return this.payable&&I.push("payable"),this.gas!=null&&I.push(`@${this.gas.toString()}`),I.join(" ")}static from(t){if(MI.isFragment(t))return t;if(typeof t=="string")try{return MI.from(al(t))}catch{V(!1,"invalid constuctor fragment","obj",t)}else if(t instanceof Dt){nn(t,Be(["constructor"]));const I=PI(t),n=!!nn(t,mY).has("payable"),l=Tf(t);return uC(t),new MI(Rg,"constructor",I,n,l)}return new MI(Rg,"constructor",t.inputs?t.inputs.map(ne.from):[],!!t.payable,t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[Ee]===XZ}}class XI extends mC{constructor(t,I,n){super(t,"fallback",I);R(this,"payable");Object.defineProperty(this,Ee,{value:JZ}),$(this,{payable:n})}format(t){const I=this.inputs.length===0?"receive":"fallback";if(t==="json"){const n=this.payable?"payable":"nonpayable";return JSON.stringify({type:I,stateMutability:n})}return`${I}()${this.payable?" payable":""}`}static from(t){if(XI.isFragment(t))return t;if(typeof t=="string")try{return XI.from(al(t))}catch{V(!1,"invalid fallback fragment","obj",t)}else if(t instanceof Dt){const I=t.toString(),n=t.peekKeyword(Be(["fallback","receive"]));if(V(n,"type must be fallback or receive","obj",I),t.popKeyword(Be(["fallback","receive"]))==="receive"){const r=PI(t);return V(r.length===0,"receive cannot have arguments","obj.inputs",r),nn(t,Be(["payable"])),uC(t),new XI(Rg,[],!0)}let C=PI(t);C.length?V(C.length===1&&C[0].type==="bytes","invalid fallback inputs","obj.inputs",C.map(r=>r.format("minimal")).join(", ")):C=[ne.from("bytes")];const s=Lf(t);if(V(s==="nonpayable"||s==="payable","fallback cannot be constants","obj.stateMutability",s),nn(t,Be(["returns"])).has("returns")){const r=PI(t);V(r.length===1&&r[0].type==="bytes","invalid fallback outputs","obj.outputs",r.map(a=>a.format("minimal")).join(", "))}return uC(t),new XI(Rg,C,s==="payable")}if(t.type==="receive")return new XI(Rg,[],!0);if(t.type==="fallback"){const I=[ne.from("bytes")],n=t.stateMutability==="payable";return new XI(Rg,I,n)}V(!1,"invalid fallback description","obj",t)}static isFragment(t){return t&&t[Ee]===JZ}}class cI extends uA{constructor(t,I,n,l,C,s){super(t,"function",I,l);R(this,"constant");R(this,"outputs");R(this,"stateMutability");R(this,"payable");R(this,"gas");Object.defineProperty(this,Ee,{value:wZ}),C=Object.freeze(C.slice()),$(this,{constant:n==="view"||n==="pure",gas:s,outputs:C,payable:n==="payable",stateMutability:n})}get selector(){return dC(this.format("sighash")).substring(0,10)}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(t))),outputs:this.outputs.map(n=>JSON.parse(n.format(t)))});const I=[];return t!=="sighash"&&I.push("function"),I.push(this.name+Hi(t,this.inputs)),t!=="sighash"&&(this.stateMutability!=="nonpayable"&&I.push(this.stateMutability),this.outputs&&this.outputs.length&&(I.push("returns"),I.push(Hi(t,this.outputs))),this.gas!=null&&I.push(`@${this.gas.toString()}`)),I.join(" ")}static getSelector(t,I){return I=(I||[]).map(l=>ne.from(l)),new cI(Rg,t,"view",I,[],null).selector}static from(t){if(cI.isFragment(t))return t;if(typeof t=="string")try{return cI.from(al(t))}catch{V(!1,"invalid function fragment","obj",t)}else if(t instanceof Dt){const n=dA("function",t),l=PI(t),C=Lf(t);let s=[];nn(t,Be(["returns"])).has("returns")&&(s=PI(t));const r=Tf(t);return uC(t),new cI(Rg,n,C,l,s,r)}let I=t.stateMutability;return I==null&&(I="payable",typeof t.constant=="boolean"?(I="view",t.constant||(I="payable",typeof t.payable=="boolean"&&!t.payable&&(I="nonpayable"))):typeof t.payable=="boolean"&&!t.payable&&(I="nonpayable")),new cI(Rg,t.name,I,t.inputs?t.inputs.map(ne.from):[],t.outputs?t.outputs.map(ne.from):[],t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[Ee]===wZ}}class sC extends uA{constructor(g,t,I){super(g,"struct",t,I),Object.defineProperty(this,Ee,{value:YZ})}format(){throw new Error("@TODO")}static from(g){if(typeof g=="string")try{return sC.from(al(g))}catch{V(!1,"invalid struct fragment","obj",g)}else if(g instanceof Dt){const t=dA("struct",g),I=PI(g);return uC(g),new sC(Rg,t,I)}return new sC(Rg,g.name,g.inputs?g.inputs.map(ne.from):[])}static isFragment(g){return g&&g[Ee]===YZ}}const jt=new Map;jt.set(0,"GENERIC_PANIC");jt.set(1,"ASSERT_FALSE");jt.set(17,"OVERFLOW");jt.set(18,"DIVIDE_BY_ZERO");jt.set(33,"ENUM_RANGE_ERROR");jt.set(34,"BAD_STORAGE_DATA");jt.set(49,"STACK_UNDERFLOW");jt.set(50,"ARRAY_RANGE_ERROR");jt.set(65,"OUT_OF_MEMORY");jt.set(81,"UNINITIALIZED_FUNCTION_CALL");const SY=new RegExp(/^bytes([0-9]*)$/),RY=new RegExp(/^(u?int)([0-9]*)$/);let Vd=null,vZ=1024;function kY(e,g,t,I){let n="missing revert data",l=null;const C=null;let s=null;if(t){n="execution reverted";const a=ng(t);if(t=D(t),a.length===0)n+=" (no data present; likely require(false) occurred",l="require(false)";else if(a.length%32!==4)n+=" (could not decode reason; invalid data length)";else if(D(a.slice(0,4))==="0x08c379a0")try{l=I.decode(["string"],a.slice(4))[0],s={signature:"Error(string)",name:"Error",args:[l]},n+=`: ${JSON.stringify(l)}`}catch{n+=" (could not decode reason; invalid string data)"}else if(D(a.slice(0,4))==="0x4e487b71")try{const o=Number(I.decode(["uint256"],a.slice(4))[0]);s={signature:"Panic(uint256)",name:"Panic",args:[o]},l=`Panic due to ${jt.get(o)||"UNKNOWN"}(${o})`,n+=`: ${l}`}catch{n+=" (could not decode panic code)"}else n+=" (unknown custom error)"}const r={to:g.to?ag(g.to):null,data:g.data||"0x"};return g.from&&(r.from=ag(g.from)),Bg(n,"CALL_EXCEPTION",{action:e,data:t,reason:l,transaction:r,invocation:C,revert:s})}var Rn,NC;const Nc=class Nc{constructor(){k(this,Rn)}getDefaultValue(g){const t=g.map(n=>E(this,Rn,NC).call(this,ne.from(n)));return new $a(t,"_").defaultValue()}encode(g,t){aB(t.length,g.length,"types/values length mismatch");const I=g.map(C=>E(this,Rn,NC).call(this,ne.from(C))),n=new $a(I,"_"),l=new Uu;return n.encode(l,t),l.data}decode(g,t,I){const n=g.map(C=>E(this,Rn,NC).call(this,ne.from(C)));return new $a(n,"_").decode(new cX(t,I,vZ))}static _setDefaultMaxInflation(g){V(typeof g=="number"&&Number.isInteger(g),"invalid defaultMaxInflation factor","value",g),vZ=g}static defaultAbiCoder(){return Vd==null&&(Vd=new Nc),Vd}static getBuiltinCallException(g,t,I){return kY(g,t,I,Nc.defaultAbiCoder())}};Rn=new WeakSet,NC=function(g){if(g.isArray())return new DJ(E(this,Rn,NC).call(this,g.arrayChildren),g.arrayLength,g.name);if(g.isTuple())return new $a(g.components.map(I=>E(this,Rn,NC).call(this,I)),g.name);switch(g.baseType){case"address":return new TJ(g.name);case"bool":return new jJ(g.name);case"string":return new Iw(g.name);case"bytes":return new PJ(g.name);case"":return new _J(g.name)}let t=g.type.match(RY);if(t){let I=parseInt(t[2]||"256");return V(I!==0&&I<=256&&I%8===0,"invalid "+t[1]+" bit length","param",g),new tw(I/8,t[1]==="int",g.name)}if(t=g.type.match(SY),t){let I=parseInt(t[1]);return V(I!==0&&I<=32,"invalid bytes length","param",g),new OJ(I,g.name)}V(!1,"invalid type","type",g.type)};let Fi=Nc;class XY{constructor(g,t,I){R(this,"fragment");R(this,"name");R(this,"signature");R(this,"topic");R(this,"args");const n=g.name,l=g.format();$(this,{fragment:g,name:n,signature:l,topic:t,args:I})}}class JY{constructor(g,t,I,n){R(this,"fragment");R(this,"name");R(this,"args");R(this,"signature");R(this,"selector");R(this,"value");const l=g.name,C=g.format();$(this,{fragment:g,name:l,args:I,signature:C,selector:t,value:n})}}class wY{constructor(g,t,I){R(this,"fragment");R(this,"name");R(this,"args");R(this,"signature");R(this,"selector");const n=g.name,l=g.format();$(this,{fragment:g,name:n,args:I,signature:l,selector:t})}}class NZ{constructor(g){R(this,"hash");R(this,"_isIndexed");$(this,{hash:g,_isIndexed:!0})}static isIndexed(g){return!!(g&&g._isIndexed)}}const HZ={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},FZ={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:e=>`reverted with reason string ${JSON.stringify(e)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:e=>{let g="unknown panic code";return e>=0&&e<=255&&HZ[e.toString()]&&(g=HZ[e.toString()]),`reverted with panic code 0x${e.toString(16)} (${g})`}}};var nI,lI,CI,re,Fs,Ro,xs,ko;const Vl=class Vl{constructor(g){k(this,Fs);k(this,xs);R(this,"fragments");R(this,"deploy");R(this,"fallback");R(this,"receive");k(this,nI,void 0);k(this,lI,void 0);k(this,CI,void 0);k(this,re,void 0);let t=[];typeof g=="string"?t=JSON.parse(g):t=g,p(this,CI,new Map),p(this,nI,new Map),p(this,lI,new Map);const I=[];for(const C of t)try{I.push(mC.from(C))}catch(s){console.log(`[Warning] Invalid Fragment ${JSON.stringify(C)}:`,s.message)}$(this,{fragments:Object.freeze(I)});let n=null,l=!1;p(this,re,this.getAbiCoder()),this.fragments.forEach((C,s)=>{let r;switch(C.type){case"constructor":if(this.deploy){console.log("duplicate definition - constructor");return}$(this,{deploy:C});return;case"fallback":C.inputs.length===0?l=!0:(V(!n||C.payable!==n.payable,"conflicting fallback fragments",`fragments[${s}]`,C),n=C,l=n.payable);return;case"function":r=d(this,CI);break;case"event":r=d(this,lI);break;case"error":r=d(this,nI);break;default:return}const a=C.format();r.has(a)||r.set(a,C)}),this.deploy||$(this,{deploy:MI.from("constructor()")}),$(this,{fallback:n,receive:l})}format(g){const t=g?"minimal":"full";return this.fragments.map(n=>n.format(t))}formatJson(){const g=this.fragments.map(t=>t.format("json"));return JSON.stringify(g.map(t=>JSON.parse(t)))}getAbiCoder(){return Fi.defaultAbiCoder()}getFunctionName(g){const t=E(this,Fs,Ro).call(this,g,null,!1);return V(t,"no matching function","key",g),t.name}hasFunction(g){return!!E(this,Fs,Ro).call(this,g,null,!1)}getFunction(g,t){return E(this,Fs,Ro).call(this,g,t||null,!0)}forEachFunction(g){const t=Array.from(d(this,CI).keys());t.sort((I,n)=>I.localeCompare(n));for(let I=0;I<t.length;I++){const n=t[I];g(d(this,CI).get(n),I)}}getEventName(g){const t=E(this,xs,ko).call(this,g,null,!1);return V(t,"no matching event","key",g),t.name}hasEvent(g){return!!E(this,xs,ko).call(this,g,null,!1)}getEvent(g,t){return E(this,xs,ko).call(this,g,t||null,!0)}forEachEvent(g){const t=Array.from(d(this,lI).keys());t.sort((I,n)=>I.localeCompare(n));for(let I=0;I<t.length;I++){const n=t[I];g(d(this,lI).get(n),I)}}getError(g,t){if(Zg(g)){const n=g.toLowerCase();if(FZ[n])return Ye.from(FZ[n].signature);for(const l of d(this,nI).values())if(n===l.selector)return l;return null}if(g.indexOf("(")===-1){const n=[];for(const[l,C]of d(this,nI))l.split("(")[0]===g&&n.push(C);if(n.length===0)return g==="Error"?Ye.from("error Error(string)"):g==="Panic"?Ye.from("error Panic(uint256)"):null;if(n.length>1){const l=n.map(C=>JSON.stringify(C.format())).join(", ");V(!1,`ambiguous error description (i.e. ${l})`,"name",g)}return n[0]}if(g=Ye.from(g).format(),g==="Error(string)")return Ye.from("error Error(string)");if(g==="Panic(uint256)")return Ye.from("error Panic(uint256)");const I=d(this,nI).get(g);return I||null}forEachError(g){const t=Array.from(d(this,nI).keys());t.sort((I,n)=>I.localeCompare(n));for(let I=0;I<t.length;I++){const n=t[I];g(d(this,nI).get(n),I)}}_decodeParams(g,t){return d(this,re).decode(g,t)}_encodeParams(g,t){return d(this,re).encode(g,t)}encodeDeploy(g){return this._encodeParams(this.deploy.inputs,g||[])}decodeErrorResult(g,t){if(typeof g=="string"){const I=this.getError(g);V(I,"unknown error","fragment",g),g=I}return V(Vg(t,0,4)===g.selector,`data signature does not match error ${g.name}.`,"data",t),this._decodeParams(g.inputs,Vg(t,4))}encodeErrorResult(g,t){if(typeof g=="string"){const I=this.getError(g);V(I,"unknown error","fragment",g),g=I}return pg([g.selector,this._encodeParams(g.inputs,t||[])])}decodeFunctionData(g,t){if(typeof g=="string"){const I=this.getFunction(g);V(I,"unknown function","fragment",g),g=I}return V(Vg(t,0,4)===g.selector,`data signature does not match function ${g.name}.`,"data",t),this._decodeParams(g.inputs,Vg(t,4))}encodeFunctionData(g,t){if(typeof g=="string"){const I=this.getFunction(g);V(I,"unknown function","fragment",g),g=I}return pg([g.selector,this._encodeParams(g.inputs,t||[])])}decodeFunctionResult(g,t){if(typeof g=="string"){const l=this.getFunction(g);V(l,"unknown function","fragment",g),g=l}let I="invalid length for result data";const n=ye(t);if(n.length%32===0)try{return d(this,re).decode(g.outputs,n)}catch{I="could not decode result data"}H(!1,I,"BAD_DATA",{value:D(n),info:{method:g.name,signature:g.format()}})}makeError(g,t){const I=ng(g,"data"),n=Fi.getBuiltinCallException("call",t,I),l="execution reverted (unknown custom error)";if(n.message.startsWith(l)){const s=D(I.slice(0,4)),r=this.getError(s);if(r)try{const a=d(this,re).decode(r.inputs,I.slice(4));n.revert={name:r.name,signature:r.format(),args:a},n.reason=n.revert.signature,n.message=`execution reverted: ${n.reason}`}catch{n.message="execution reverted (coult not decode custom error)"}}const C=this.parseTransaction(t);return C&&(n.invocation={method:C.name,signature:C.signature,args:C.args}),n}encodeFunctionResult(g,t){if(typeof g=="string"){const I=this.getFunction(g);V(I,"unknown function","fragment",g),g=I}return D(d(this,re).encode(g.outputs,t||[]))}encodeFilterTopics(g,t){if(typeof g=="string"){const l=this.getEvent(g);V(l,"unknown event","eventFragment",g),g=l}H(t.length<=g.inputs.length,`too many arguments for ${g.format()}`,"UNEXPECTED_ARGUMENT",{count:t.length,expectedCount:g.inputs.length});const I=[];g.anonymous||I.push(g.topicHash);const n=(l,C)=>l.type==="string"?dC(C):l.type==="bytes"?Hg(D(C)):(l.type==="bool"&&typeof C=="boolean"?C=C?"0x01":"0x00":l.type.match(/^u?int/)?C=Il(C):l.type.match(/^bytes/)?C=Ek(C,32):l.type==="address"&&d(this,re).encode(["address"],[C]),tn(D(C),32));for(t.forEach((l,C)=>{const s=g.inputs[C];if(!s.indexed){V(l==null,"cannot filter non-indexed parameters; must be null","contract."+s.name,l);return}l==null?I.push(null):s.baseType==="array"||s.baseType==="tuple"?V(!1,"filtering with tuples or arrays not supported","contract."+s.name,l):Array.isArray(l)?I.push(l.map(r=>n(s,r))):I.push(n(s,l))});I.length&&I[I.length-1]===null;)I.pop();return I}encodeEventLog(g,t){if(typeof g=="string"){const C=this.getEvent(g);V(C,"unknown event","eventFragment",g),g=C}const I=[],n=[],l=[];return g.anonymous||I.push(g.topicHash),V(t.length===g.inputs.length,"event arguments/values mismatch","values",t),g.inputs.forEach((C,s)=>{const r=t[s];if(C.indexed)if(C.type==="string")I.push(dC(r));else if(C.type==="bytes")I.push(Hg(r));else{if(C.baseType==="tuple"||C.baseType==="array")throw new Error("not implemented");I.push(d(this,re).encode([C.type],[r]))}else n.push(C),l.push(r)}),{data:d(this,re).encode(n,l),topics:I}}decodeEventLog(g,t,I){if(typeof g=="string"){const b=this.getEvent(g);V(b,"unknown event","eventFragment",g),g=b}if(I!=null&&!g.anonymous){const b=g.topicHash;V(Zg(I[0],32)&&I[0].toLowerCase()===b,"fragment/topic mismatch","topics[0]",I[0]),I=I.slice(1)}const n=[],l=[],C=[];g.inputs.forEach((b,m)=>{b.indexed?b.type==="string"||b.type==="bytes"||b.baseType==="tuple"||b.baseType==="array"?(n.push(ne.from({type:"bytes32",name:b.name})),C.push(!0)):(n.push(b),C.push(!1)):(l.push(b),C.push(!1))});const s=I!=null?d(this,re).decode(n,pg(I)):null,r=d(this,re).decode(l,t,!0),a=[],o=[];let c=0,A=0;return g.inputs.forEach((b,m)=>{let Z=null;if(b.indexed)if(s==null)Z=new NZ(null);else if(C[m])Z=new NZ(s[A++]);else try{Z=s[A++]}catch(G){Z=G}else try{Z=r[c++]}catch(G){Z=G}a.push(Z),o.push(b.name||null)}),ar.fromItems(a,o)}parseTransaction(g){const t=ng(g.data,"tx.data"),I=q(g.value!=null?g.value:0,"tx.value"),n=this.getFunction(D(t.slice(0,4)));if(!n)return null;const l=d(this,re).decode(n.inputs,t.slice(4));return new JY(n,n.selector,l,I)}parseCallResult(g){throw new Error("@TODO")}parseLog(g){const t=this.getEvent(g.topics[0]);return!t||t.anonymous?null:new XY(t,t.topicHash,this.decodeEventLog(t,g.data,g.topics))}parseError(g){const t=D(g),I=this.getError(Vg(t,0,4));if(!I)return null;const n=d(this,re).decode(I.inputs,Vg(t,4));return new wY(I,I.selector,n)}static from(g){return g instanceof Vl?g:typeof g=="string"?new Vl(JSON.parse(g)):typeof g.formatJson=="function"?new Vl(g.formatJson()):typeof g.format=="function"?new Vl(g.format("json")):new Vl(g)}};nI=new WeakMap,lI=new WeakMap,CI=new WeakMap,re=new WeakMap,Fs=new WeakSet,Ro=function(g,t,I){if(Zg(g)){const l=g.toLowerCase();for(const C of d(this,CI).values())if(l===C.selector)return C;return null}if(g.indexOf("(")===-1){const l=[];for(const[C,s]of d(this,CI))C.split("(")[0]===g&&l.push(s);if(t){const C=t.length>0?t[t.length-1]:null;let s=t.length,r=!0;Ae.isTyped(C)&&C.type==="overrides"&&(r=!1,s--);for(let a=l.length-1;a>=0;a--){const o=l[a].inputs.length;o!==s&&(!r||o!==s-1)&&l.splice(a,1)}for(let a=l.length-1;a>=0;a--){const o=l[a].inputs;for(let c=0;c<t.length;c++)if(Ae.isTyped(t[c])){if(c>=o.length){if(t[c].type==="overrides")continue;l.splice(a,1);break}if(t[c].type!==o[c].baseType){l.splice(a,1);break}}}}if(l.length===1&&t&&t.length!==l[0].inputs.length){const C=t[t.length-1];(C==null||Array.isArray(C)||typeof C!="object")&&l.splice(0,1)}if(l.length===0)return null;if(l.length>1&&I){const C=l.map(s=>JSON.stringify(s.format())).join(", ");V(!1,`ambiguous function description (i.e. matches ${C})`,"key",g)}return l[0]}const n=d(this,CI).get(cI.from(g).format());return n||null},xs=new WeakSet,ko=function(g,t,I){if(Zg(g)){const l=g.toLowerCase();for(const C of d(this,lI).values())if(l===C.topicHash)return C;return null}if(g.indexOf("(")===-1){const l=[];for(const[C,s]of d(this,lI))C.split("(")[0]===g&&l.push(s);if(t){for(let C=l.length-1;C>=0;C--)l[C].inputs.length<t.length&&l.splice(C,1);for(let C=l.length-1;C>=0;C--){const s=l[C].inputs;for(let r=0;r<t.length;r++)if(Ae.isTyped(t[r])&&t[r].type!==s[r].baseType){l.splice(C,1);break}}}if(l.length===0)return null;if(l.length>1&&I){const C=l.map(s=>JSON.stringify(s.format())).join(", ");V(!1,`ambiguous event description (i.e. matches ${C})`,"key",g)}return l[0]}const n=d(this,lI).get(oI.from(g).format());return n||null};let tm=Vl;const Mf=BigInt(0);function as(e){return e??null}function Yg(e){return e==null?null:e.toString()}class xZ{constructor(g,t,I){R(this,"gasPrice");R(this,"maxFeePerGas");R(this,"maxPriorityFeePerGas");$(this,{gasPrice:as(g),maxFeePerGas:as(t),maxPriorityFeePerGas:as(I)})}toJSON(){const{gasPrice:g,maxFeePerGas:t,maxPriorityFeePerGas:I}=this;return{_type:"FeeData",gasPrice:Yg(g),maxFeePerGas:Yg(t),maxPriorityFeePerGas:Yg(I)}}}function Bc(e){const g={};e.to&&(g.to=e.to),e.from&&(g.from=e.from),e.data&&(g.data=D(e.data));const t="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const n of t)!(n in e)||e[n]==null||(g[n]=q(e[n],`request.${n}`));const I="type,nonce".split(/,/);for(const n of I)!(n in e)||e[n]==null||(g[n]=Ig(e[n],`request.${n}`));return e.accessList&&(g.accessList=fC(e.accessList)),e.authorizationList&&(g.authorizationList=e.authorizationList.slice()),"blockTag"in e&&(g.blockTag=e.blockTag),"enableCcipRead"in e&&(g.enableCcipRead=!!e.enableCcipRead),"customData"in e&&(g.customData=e.customData),"blobVersionedHashes"in e&&e.blobVersionedHashes&&(g.blobVersionedHashes=e.blobVersionedHashes.slice()),"kzg"in e&&(g.kzg=e.kzg),"blobWrapperVersion"in e&&(g.blobWrapperVersion=e.blobWrapperVersion),"blobs"in e&&e.blobs&&(g.blobs=e.blobs.map(n=>Rh(n)?D(n):Object.assign({},n))),g}var FI;class YY{constructor(g,t){R(this,"provider");R(this,"number");R(this,"hash");R(this,"timestamp");R(this,"parentHash");R(this,"parentBeaconBlockRoot");R(this,"nonce");R(this,"difficulty");R(this,"gasLimit");R(this,"gasUsed");R(this,"stateRoot");R(this,"receiptsRoot");R(this,"blobGasUsed");R(this,"excessBlobGas");R(this,"miner");R(this,"prevRandao");R(this,"extraData");R(this,"baseFeePerGas");k(this,FI,void 0);p(this,FI,g.transactions.map(I=>typeof I!="string"?new xi(I,t):I)),$(this,{provider:t,hash:as(g.hash),number:g.number,timestamp:g.timestamp,parentHash:g.parentHash,parentBeaconBlockRoot:g.parentBeaconBlockRoot,nonce:g.nonce,difficulty:g.difficulty,gasLimit:g.gasLimit,gasUsed:g.gasUsed,blobGasUsed:g.blobGasUsed,excessBlobGas:g.excessBlobGas,miner:g.miner,prevRandao:as(g.prevRandao),extraData:g.extraData,baseFeePerGas:as(g.baseFeePerGas),stateRoot:g.stateRoot,receiptsRoot:g.receiptsRoot})}get transactions(){return d(this,FI).map(g=>typeof g=="string"?g:g.hash)}get prefetchedTransactions(){const g=d(this,FI).slice();return g.length===0?[]:(H(typeof g[0]=="object","transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),g)}toJSON(){const{baseFeePerGas:g,difficulty:t,extraData:I,gasLimit:n,gasUsed:l,hash:C,miner:s,prevRandao:r,nonce:a,number:o,parentHash:c,parentBeaconBlockRoot:A,stateRoot:b,receiptsRoot:m,timestamp:Z,transactions:G}=this;return{_type:"Block",baseFeePerGas:Yg(g),difficulty:Yg(t),extraData:I,gasLimit:Yg(n),gasUsed:Yg(l),blobGasUsed:Yg(this.blobGasUsed),excessBlobGas:Yg(this.excessBlobGas),hash:C,miner:s,prevRandao:r,nonce:a,number:o,parentHash:c,timestamp:Z,parentBeaconBlockRoot:A,stateRoot:b,receiptsRoot:m,transactions:G}}[Symbol.iterator](){let g=0;const t=this.transactions;return{next:()=>g<this.length?{value:t[g++],done:!1}:{value:void 0,done:!0}}}get length(){return d(this,FI).length}get date(){return this.timestamp==null?null:new Date(this.timestamp*1e3)}async getTransaction(g){let t;if(typeof g=="number")t=d(this,FI)[g];else{const I=g.toLowerCase();for(const n of d(this,FI))if(typeof n=="string"){if(n!==I)continue;t=n;break}else{if(n.hash!==I)continue;t=n;break}}if(t==null)throw new Error("no such tx");return typeof t=="string"?await this.provider.getTransaction(t):t}getPrefetchedTransaction(g){const t=this.prefetchedTransactions;if(typeof g=="number")return t[g];g=g.toLowerCase();for(const I of t)if(I.hash===g)return I;V(!1,"no matching transaction","indexOrHash",g)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return vY(this)}}FI=new WeakMap;class Ba{constructor(g,t){R(this,"provider");R(this,"transactionHash");R(this,"blockHash");R(this,"blockNumber");R(this,"removed");R(this,"address");R(this,"data");R(this,"topics");R(this,"index");R(this,"transactionIndex");this.provider=t;const I=Object.freeze(g.topics.slice());$(this,{transactionHash:g.transactionHash,blockHash:g.blockHash,blockNumber:g.blockNumber,removed:g.removed,address:g.address,data:g.data,topics:I,index:g.index,transactionIndex:g.transactionIndex})}toJSON(){const{address:g,blockHash:t,blockNumber:I,data:n,index:l,removed:C,topics:s,transactionHash:r,transactionIndex:a}=this;return{_type:"log",address:g,blockHash:t,blockNumber:I,data:n,index:l,removed:C,topics:s,transactionHash:r,transactionIndex:a}}async getBlock(){const g=await this.provider.getBlock(this.blockHash);return H(!!g,"failed to find transaction","UNKNOWN_ERROR",{}),g}async getTransaction(){const g=await this.provider.getTransaction(this.transactionHash);return H(!!g,"failed to find transaction","UNKNOWN_ERROR",{}),g}async getTransactionReceipt(){const g=await this.provider.getTransactionReceipt(this.transactionHash);return H(!!g,"failed to find transaction receipt","UNKNOWN_ERROR",{}),g}removedEvent(){return NY(this)}}var ea;class Df{constructor(g,t){R(this,"provider");R(this,"to");R(this,"from");R(this,"contractAddress");R(this,"hash");R(this,"index");R(this,"blockHash");R(this,"blockNumber");R(this,"logsBloom");R(this,"gasUsed");R(this,"blobGasUsed");R(this,"cumulativeGasUsed");R(this,"gasPrice");R(this,"blobGasPrice");R(this,"type");R(this,"status");R(this,"root");k(this,ea,void 0);p(this,ea,Object.freeze(g.logs.map(n=>new Ba(n,t))));let I=Mf;g.effectiveGasPrice!=null?I=g.effectiveGasPrice:g.gasPrice!=null&&(I=g.gasPrice),$(this,{provider:t,to:g.to,from:g.from,contractAddress:g.contractAddress,hash:g.hash,index:g.index,blockHash:g.blockHash,blockNumber:g.blockNumber,logsBloom:g.logsBloom,gasUsed:g.gasUsed,cumulativeGasUsed:g.cumulativeGasUsed,blobGasUsed:g.blobGasUsed,gasPrice:I,blobGasPrice:g.blobGasPrice,type:g.type,status:g.status,root:g.root})}get logs(){return d(this,ea)}toJSON(){const{to:g,from:t,contractAddress:I,hash:n,index:l,blockHash:C,blockNumber:s,logsBloom:r,logs:a,status:o,root:c}=this;return{_type:"TransactionReceipt",blockHash:C,blockNumber:s,contractAddress:I,cumulativeGasUsed:Yg(this.cumulativeGasUsed),from:t,gasPrice:Yg(this.gasPrice),blobGasUsed:Yg(this.blobGasUsed),blobGasPrice:Yg(this.blobGasPrice),gasUsed:Yg(this.gasUsed),hash:n,index:l,logs:a,logsBloom:r,root:c,status:o,to:g}}get length(){return this.logs.length}[Symbol.iterator](){let g=0;return{next:()=>g<this.length?{value:this.logs[g++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const g=await this.provider.getBlock(this.blockHash);if(g==null)throw new Error("TODO");return g}async getTransaction(){const g=await this.provider.getTransaction(this.hash);if(g==null)throw new Error("TODO");return g}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return Pf(this)}reorderedEvent(g){return H(!g||g.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),jf(this,g)}}ea=new WeakMap;var kn;const d0=class d0{constructor(g,t){R(this,"provider");R(this,"blockNumber");R(this,"blockHash");R(this,"index");R(this,"hash");R(this,"type");R(this,"to");R(this,"from");R(this,"nonce");R(this,"gasLimit");R(this,"gasPrice");R(this,"maxPriorityFeePerGas");R(this,"maxFeePerGas");R(this,"maxFeePerBlobGas");R(this,"data");R(this,"value");R(this,"chainId");R(this,"signature");R(this,"accessList");R(this,"blobVersionedHashes");R(this,"authorizationList");k(this,kn,void 0);this.provider=t,this.blockNumber=g.blockNumber!=null?g.blockNumber:null,this.blockHash=g.blockHash!=null?g.blockHash:null,this.hash=g.hash,this.index=g.index,this.type=g.type,this.from=g.from,this.to=g.to||null,this.gasLimit=g.gasLimit,this.nonce=g.nonce,this.data=g.data,this.value=g.value,this.gasPrice=g.gasPrice,this.maxPriorityFeePerGas=g.maxPriorityFeePerGas!=null?g.maxPriorityFeePerGas:null,this.maxFeePerGas=g.maxFeePerGas!=null?g.maxFeePerGas:null,this.maxFeePerBlobGas=g.maxFeePerBlobGas!=null?g.maxFeePerBlobGas:null,this.chainId=g.chainId,this.signature=g.signature,this.accessList=g.accessList!=null?g.accessList:null,this.blobVersionedHashes=g.blobVersionedHashes!=null?g.blobVersionedHashes:null,this.authorizationList=g.authorizationList!=null?g.authorizationList:null,p(this,kn,-1)}toJSON(){const{blockNumber:g,blockHash:t,index:I,hash:n,type:l,to:C,from:s,nonce:r,data:a,signature:o,accessList:c,blobVersionedHashes:A}=this;return{_type:"TransactionResponse",accessList:c,blockNumber:g,blockHash:t,blobVersionedHashes:A,chainId:Yg(this.chainId),data:a,from:s,gasLimit:Yg(this.gasLimit),gasPrice:Yg(this.gasPrice),hash:n,maxFeePerGas:Yg(this.maxFeePerGas),maxPriorityFeePerGas:Yg(this.maxPriorityFeePerGas),maxFeePerBlobGas:Yg(this.maxFeePerBlobGas),nonce:r,signature:o,to:C,index:I,type:l,value:Yg(this.value)}}async getBlock(){let g=this.blockNumber;if(g==null){const I=await this.getTransaction();I&&(g=I.blockNumber)}if(g==null)return null;const t=this.provider.getBlock(g);if(t==null)throw new Error("TODO");return t}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(this.blockNumber==null){const{tx:t,blockNumber:I}=await Ze({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return t==null||t.blockNumber==null?0:I-t.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(g,t){const I=g??1,n=t??0;let l=d(this,kn),C=-1,s=l===-1;const r=async()=>{if(s)return null;const{blockNumber:A,nonce:b}=await Ze({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(b<this.nonce){l=A;return}if(s)return null;const m=await this.getTransaction();if(!(m&&m.blockNumber!=null))for(C===-1&&(C=l-3,C<d(this,kn)&&(C=d(this,kn)));C<=A;){if(s)return null;const Z=await this.provider.getBlock(C,!0);if(Z==null)return;for(const G of Z)if(G===this.hash)return;for(let G=0;G<Z.length;G++){const h=await Z.getTransaction(G);if(h.from===this.from&&h.nonce===this.nonce){if(s)return null;const u=await this.provider.getTransactionReceipt(h.hash);if(u==null||A-u.blockNumber+1<I)return;let y="replaced";h.data===this.data&&h.to===this.to&&h.value===this.value?y="repriced":h.data==="0x"&&h.from===h.to&&h.value===Mf&&(y="cancelled"),H(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:y==="replaced"||y==="cancelled",reason:y,replacement:h.replaceableTransaction(l),hash:h.hash,receipt:u})}}C++}},a=A=>{if(A==null||A.status!==0)return A;H(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:A.to,from:A.from,data:""},receipt:A})},o=await this.provider.getTransactionReceipt(this.hash);if(I===0)return a(o);if(o){if(I===1||await o.confirmations()>=I)return a(o)}else if(await r(),I===0)return null;return await new Promise((A,b)=>{const m=[],Z=()=>{m.forEach(h=>h())};if(m.push(()=>{s=!0}),n>0){const h=setTimeout(()=>{Z(),b(Bg("wait for transaction timeout","TIMEOUT"))},n);m.push(()=>{clearTimeout(h)})}const G=async h=>{if(await h.confirmations()>=I){Z();try{A(a(h))}catch(u){b(u)}}};if(m.push(()=>{this.provider.off(this.hash,G)}),this.provider.on(this.hash,G),l>=0){const h=async()=>{try{await r()}catch(u){if(te(u,"TRANSACTION_REPLACED")){Z(),b(u);return}}s||this.provider.once("block",h)};m.push(()=>{this.provider.off("block",h)}),this.provider.once("block",h)}})}isMined(){return this.blockHash!=null}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}removedEvent(){return H(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Pf(this)}reorderedEvent(g){return H(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),H(!g||g.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),jf(this,g)}replaceableTransaction(g){V(Number.isInteger(g)&&g>=0,"invalid startBlock","startBlock",g);const t=new d0(this,this.provider);return p(t,kn,g),t}};kn=new WeakMap;let xi=d0;function vY(e){return{orphan:"drop-block",hash:e.hash,number:e.number}}function jf(e,g){return{orphan:"reorder-transaction",tx:e,other:g}}function Pf(e){return{orphan:"drop-transaction",tx:e}}function NY(e){return{orphan:"drop-log",log:{transactionHash:e.transactionHash,blockHash:e.blockHash,blockNumber:e.blockNumber,address:e.address,data:e.data,topics:Object.freeze(e.topics.slice()),index:e.index}}}class Lh extends Ba{constructor(t,I,n){super(t,t.provider);R(this,"interface");R(this,"fragment");R(this,"args");const l=I.decodeEventLog(n,t.data,t.topics);$(this,{args:l,fragment:n,interface:I})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class Of extends Ba{constructor(t,I){super(t,t.provider);R(this,"error");$(this,{error:I})}}var Ks;class HY extends Df{constructor(t,I,n){super(n,I);k(this,Ks,void 0);p(this,Ks,t)}get logs(){return super.logs.map(t=>{const I=t.topics.length?d(this,Ks).getEvent(t.topics[0]):null;if(I)try{return new Lh(t,d(this,Ks),I)}catch(n){return new Of(t,n)}return t})}}Ks=new WeakMap;var ta;class Th extends xi{constructor(t,I,n){super(n,I);k(this,ta,void 0);p(this,ta,t)}async wait(t,I){const n=await super.wait(t,I);return n==null?null:new HY(d(this,ta),this.provider,n)}}ta=new WeakMap;class qf extends dB{constructor(t,I,n,l){super(t,I,n);R(this,"log");$(this,{log:l})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class FY extends qf{constructor(g,t,I,n,l){super(g,t,I,new Lh(l,g.interface,n));const C=g.interface.decodeEventLog(n,this.log.data,this.log.topics);$(this,{args:C,fragment:n})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const KZ=BigInt(0);function _f(e){return e&&typeof e.call=="function"}function $f(e){return e&&typeof e.estimateGas=="function"}function mA(e){return e&&typeof e.resolveName=="function"}function gV(e){return e&&typeof e.sendTransaction=="function"}function eV(e){if(e!=null){if(mA(e))return e;if(e.provider)return e.provider}}var Ia;class xY{constructor(g,t,I){k(this,Ia,void 0);R(this,"fragment");if($(this,{fragment:t}),t.inputs.length<I.length)throw new Error("too many arguments");const n=hC(g.runner,"resolveName"),l=mA(n)?n:null;p(this,Ia,async function(){const C=await Promise.all(t.inputs.map((s,r)=>I[r]==null?null:s.walkAsync(I[r],(o,c)=>o==="address"?Array.isArray(c)?Promise.all(c.map(A=>pe(A,l))):pe(c,l):c)));return g.interface.encodeFilterTopics(t,C)}())}getTopicFilter(){return d(this,Ia)}}Ia=new WeakMap;function hC(e,g){return e==null?null:typeof e[g]=="function"?e:e.provider&&typeof e.provider[g]=="function"?e.provider:null}function Yl(e){return e==null?null:e.provider||null}async function tV(e,g){const t=Ae.dereference(e,"overrides");V(typeof t=="object","invalid overrides parameter","overrides",e);const I=Bc(t);return V(I.to==null||(g||[]).indexOf("to")>=0,"cannot override to","overrides.to",I.to),V(I.data==null||(g||[]).indexOf("data")>=0,"cannot override data","overrides.data",I.data),I.from&&(I.from=I.from),I}async function KY(e,g,t){const I=hC(e,"resolveName"),n=mA(I)?I:null;return await Promise.all(g.map((l,C)=>l.walkAsync(t[C],(s,r)=>(r=Ae.dereference(r,s),s==="address"?pe(r,n):r))))}function EY(e){const g=async function(C){const s=await tV(C,["data"]);s.to=await e.getAddress(),s.from&&(s.from=await pe(s.from,eV(e.runner)));const r=e.interface,a=q(s.value||KZ,"overrides.value")===KZ,o=(s.data||"0x")==="0x";r.fallback&&!r.fallback.payable&&r.receive&&!o&&!a&&V(!1,"cannot send data to receive or send value to non-payable fallback","overrides",C),V(r.fallback||o,"cannot send data to receive-only contract","overrides.data",s.data);const c=r.receive||r.fallback&&r.fallback.payable;return V(c||a,"cannot send value to non-payable fallback","overrides.value",s.value),V(r.fallback||o,"cannot send data to receive-only contract","overrides.data",s.data),s},t=async function(C){const s=hC(e.runner,"call");H(_f(s),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const r=await g(C);try{return await s.call(r)}catch(a){throw Sh(a)&&a.data?e.interface.makeError(a.data,r):a}},I=async function(C){const s=e.runner;H(gV(s),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const r=await s.sendTransaction(await g(C)),a=Yl(e.runner);return new Th(e.interface,a,r)},n=async function(C){const s=hC(e.runner,"estimateGas");return H($f(s),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await s.estimateGas(await g(C))},l=async C=>await I(C);return $(l,{_contract:e,estimateGas:n,populateTransaction:g,send:I,staticCall:t}),l}function UY(e,g){const t=function(...a){const o=e.interface.getFunction(g,a);return H(o,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:g,args:a}}),o},I=async function(...a){const o=t(...a);let c={};if(o.inputs.length+1===a.length&&(c=await tV(a.pop()),c.from&&(c.from=await pe(c.from,eV(e.runner)))),o.inputs.length!==a.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const A=await KY(e.runner,o.inputs,a);return Object.assign({},c,await Ze({to:e.getAddress(),data:e.interface.encodeFunctionData(o,A)}))},n=async function(...a){const o=await s(...a);return o.length===1?o[0]:o},l=async function(...a){const o=e.runner;H(gV(o),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const c=await o.sendTransaction(await I(...a)),A=Yl(e.runner);return new Th(e.interface,A,c)},C=async function(...a){const o=hC(e.runner,"estimateGas");return H($f(o),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await o.estimateGas(await I(...a))},s=async function(...a){const o=hC(e.runner,"call");H(_f(o),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const c=await I(...a);let A="0x";try{A=await o.call(c)}catch(m){throw Sh(m)&&m.data?e.interface.makeError(m.data,c):m}const b=t(...a);return e.interface.decodeFunctionResult(b,A)},r=async(...a)=>t(...a).constant?await n(...a):await l(...a);return $(r,{name:e.interface.getFunctionName(g),_contract:e,_key:g,getFragment:t,estimateGas:C,populateTransaction:I,send:l,staticCall:n,staticCallResult:s}),Object.defineProperty(r,"fragment",{configurable:!1,enumerable:!0,get:()=>{const a=e.interface.getFunction(g);return H(a,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:g}}),a}}),r}function zY(e,g){const t=function(...n){const l=e.interface.getEvent(g,n);return H(l,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:g,args:n}}),l},I=function(...n){return new xY(e,t(...n),n)};return $(I,{name:e.interface.getEventName(g),_contract:e,_key:g,getFragment:t}),Object.defineProperty(I,"fragment",{configurable:!1,enumerable:!0,get:()=>{const n=e.interface.getEvent(g);return H(n,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:g}}),n}}),I}const fc=Symbol.for("_ethersInternal_contract"),IV=new WeakMap;function QY(e,g){IV.set(e[fc],g)}function Te(e){return IV.get(e[fc])}function LY(e){return e&&typeof e=="object"&&"getTopicFilter"in e&&typeof e.getTopicFilter=="function"&&e.fragment}async function Mh(e,g){let t,I=null;if(Array.isArray(g)){const l=function(C){if(Zg(C,32))return C;const s=e.interface.getEvent(C);return V(s,"unknown fragment","name",C),s.topicHash};t=g.map(C=>C==null?null:Array.isArray(C)?C.map(l):l(C))}else g==="*"?t=[null]:typeof g=="string"?Zg(g,32)?t=[g]:(I=e.interface.getEvent(g),V(I,"unknown fragment","event",g),t=[I.topicHash]):LY(g)?t=await g.getTopicFilter():"fragment"in g?(I=g.fragment,t=[I.topicHash]):V(!1,"unknown event name","event",g);t=t.map(l=>{if(l==null)return null;if(Array.isArray(l)){const C=Array.from(new Set(l.map(s=>s.toLowerCase())).values());return C.length===1?C[0]:(C.sort(),C)}return l.toLowerCase()});const n=t.map(l=>l==null?"null":Array.isArray(l)?l.join("|"):l).join("&");return{fragment:I,tag:n,topics:t}}async function Pr(e,g){const{subs:t}=Te(e);return t.get((await Mh(e,g)).tag)||null}async function EZ(e,g,t){const I=Yl(e.runner);H(I,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:g});const{fragment:n,tag:l,topics:C}=await Mh(e,t),{addr:s,subs:r}=Te(e);let a=r.get(l);if(!a){const c={address:s||e,topics:C},A=G=>{let h=n;if(h==null)try{h=e.interface.getEvent(G.topics[0])}catch{}if(h){const u=h,y=n?e.interface.decodeEventLog(n,G.data,G.topics):[];nm(e,t,y,W=>new FY(e,W,t,u,G))}else nm(e,t,[],u=>new qf(e,u,t,G))};let b=[];a={tag:l,listeners:[],start:()=>{b.length||b.push(I.on(c,A))},stop:async()=>{if(b.length==0)return;let G=b;b=[],await Promise.all(G),I.off(c,A)}},r.set(l,a)}return a}let Im=Promise.resolve();async function TY(e,g,t,I){await Im;const n=await Pr(e,g);if(!n)return!1;const l=n.listeners.length;return n.listeners=n.listeners.filter(({listener:C,once:s})=>{const r=Array.from(t);I&&r.push(I(s?null:C));try{C.call(e,...r)}catch{}return!s}),n.listeners.length===0&&(n.stop(),Te(e).subs.delete(n.tag)),l>0}async function nm(e,g,t,I){try{await Im}catch{}const n=TY(e,g,t,I);return Im=n,await n}const eo=["then"];var A9;const ri=class ri{constructor(g,t,I,n){R(this,"target");R(this,"interface");R(this,"runner");R(this,"filters");R(this,A9);R(this,"fallback");V(typeof g=="string"||sf(g),"invalid value for Contract target","target",g),I==null&&(I=null);const l=tm.from(t);$(this,{target:g,runner:I,interface:l}),Object.defineProperty(this,fc,{value:{}});let C,s=null,r=null;if(n){const c=Yl(I);r=new Th(this.interface,c,n)}let a=new Map;if(typeof g=="string")if(Zg(g))s=g,C=Promise.resolve(g);else{const c=hC(I,"resolveName");if(!mA(c))throw Bg("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});C=c.resolveName(g).then(A=>{if(A==null)throw Bg("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:g});return Te(this).addr=A,A})}else C=g.getAddress().then(c=>{if(c==null)throw new Error("TODO");return Te(this).addr=c,c});QY(this,{addrPromise:C,addr:s,deployTx:r,subs:a});const o=new Proxy({},{get:(c,A,b)=>{if(typeof A=="symbol"||eo.indexOf(A)>=0)return Reflect.get(c,A,b);try{return this.getEvent(A)}catch(m){if(!te(m,"INVALID_ARGUMENT")||m.argument!=="key")throw m}},has:(c,A)=>eo.indexOf(A)>=0?Reflect.has(c,A):Reflect.has(c,A)||this.interface.hasEvent(String(A))});return $(this,{filters:o}),$(this,{fallback:l.receive||l.fallback?EY(this):null}),new Proxy(this,{get:(c,A,b)=>{if(typeof A=="symbol"||A in c||eo.indexOf(A)>=0)return Reflect.get(c,A,b);try{return c.getFunction(A)}catch(m){if(!te(m,"INVALID_ARGUMENT")||m.argument!=="key")throw m}},has:(c,A)=>typeof A=="symbol"||A in c||eo.indexOf(A)>=0?Reflect.has(c,A):c.interface.hasFunction(A)})}connect(g){return new ri(this.target,this.interface,g)}attach(g){return new ri(g,this.interface,this.runner)}async getAddress(){return await Te(this).addrPromise}async getDeployedCode(){const g=Yl(this.runner);H(g,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const t=await g.getCode(await this.getAddress());return t==="0x"?null:t}async waitForDeployment(){const g=this.deploymentTransaction();if(g)return await g.wait(),this;if(await this.getDeployedCode()!=null)return this;const I=Yl(this.runner);return H(I!=null,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((n,l)=>{const C=async()=>{try{if(await this.getDeployedCode()!=null)return n(this);I.once("block",C)}catch(s){l(s)}};C()})}deploymentTransaction(){return Te(this).deployTx}getFunction(g){return typeof g!="string"&&(g=g.format()),UY(this,g)}getEvent(g){return typeof g!="string"&&(g=g.format()),zY(this,g)}async queryTransaction(g){throw new Error("@TODO")}async queryFilter(g,t,I){t==null&&(t=0),I==null&&(I="latest");const{addr:n,addrPromise:l}=Te(this),C=n||await l,{fragment:s,topics:r}=await Mh(this,g),a={address:C,topics:r,fromBlock:t,toBlock:I},o=Yl(this.runner);return H(o,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await o.getLogs(a)).map(c=>{let A=s;if(A==null)try{A=this.interface.getEvent(c.topics[0])}catch{}if(A)try{return new Lh(c,this.interface,A)}catch(b){return new Of(c,b)}return new Ba(c,o)})}async on(g,t){const I=await EZ(this,"on",g);return I.listeners.push({listener:t,once:!1}),I.start(),this}async once(g,t){const I=await EZ(this,"once",g);return I.listeners.push({listener:t,once:!0}),I.start(),this}async emit(g,...t){return await nm(this,g,t,null)}async listenerCount(g){if(g){const n=await Pr(this,g);return n?n.listeners.length:0}const{subs:t}=Te(this);let I=0;for(const{listeners:n}of t.values())I+=n.length;return I}async listeners(g){if(g){const n=await Pr(this,g);return n?n.listeners.map(({listener:l})=>l):[]}const{subs:t}=Te(this);let I=[];for(const{listeners:n}of t.values())I=I.concat(n.map(({listener:l})=>l));return I}async off(g,t){const I=await Pr(this,g);if(!I)return this;if(t){const n=I.listeners.map(({listener:l})=>l).indexOf(t);n>=0&&I.listeners.splice(n,1)}return(t==null||I.listeners.length===0)&&(I.stop(),Te(this).subs.delete(I.tag)),this}async removeAllListeners(g){if(g){const t=await Pr(this,g);if(!t)return this;t.stop(),Te(this).subs.delete(t.tag)}else{const{subs:t}=Te(this);for(const{tag:I,stop:n}of t.values())n(),t.delete(I)}return this}async addListener(g,t){return await this.on(g,t)}async removeListener(g,t){return await this.off(g,t)}static buildClass(g){class t extends ri{constructor(n,l=null){super(n,g,l)}}return t}static from(g,t,I){return I==null&&(I=null),new this(g,t,I)}};A9=fc;let lm=ri;function MY(){return lm}class rC extends MY(){}function Wd(e){return e.match(/^ipfs:\/\/ipfs\//i)?e=e.substring(12):e.match(/^ipfs:\/\//i)?e=e.substring(7):V(!1,"unsupported IPFS format","link",e),`https://gateway.ipfs.io/ipfs/${e}`}class DY{constructor(g){R(this,"name");$(this,{name:g})}connect(g){return this}supportsCoinType(g){return!1}async encodeAddress(g,t){throw new Error("unsupported coin")}async decodeAddress(g,t){throw new Error("unsupported coin")}}const nV=new RegExp("^(ipfs)://(.*)$","i"),UZ=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),nV,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];var Xn,Ml,Jn,HC,Hc,lV;const $C=class $C{constructor(g,t,I){k(this,Jn);R(this,"provider");R(this,"address");R(this,"name");k(this,Xn,void 0);k(this,Ml,void 0);$(this,{provider:g,address:t,name:I}),p(this,Xn,null),p(this,Ml,new rC(t,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],g))}async supportsWildcard(){return d(this,Xn)==null&&p(this,Xn,(async()=>{try{return await d(this,Ml).supportsInterface("0x9061b923")}catch(g){if(te(g,"CALL_EXCEPTION"))return!1;throw p(this,Xn,null),g}})()),await d(this,Xn)}async getAddress(g){if(g==null&&(g=60),g===60)try{const l=await E(this,Jn,HC).call(this,"addr(bytes32)");return l==null||l===ki?null:l}catch(l){if(te(l,"CALL_EXCEPTION"))return null;throw l}if(g>=0&&g<2147483648){let l=g+2147483648;const C=await E(this,Jn,HC).call(this,"addr(bytes32,uint)",[l]);if(Zg(C,20))return ag(C)}let t=null;for(const l of this.provider.plugins)if(l instanceof DY&&l.supportsCoinType(g)){t=l;break}if(t==null)return null;const I=await E(this,Jn,HC).call(this,"addr(bytes32,uint)",[g]);if(I==null||I==="0x")return null;const n=await t.decodeAddress(g,I);if(n!=null)return n;H(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${g})`,info:{coinType:g,data:I}})}async getText(g){const t=await E(this,Jn,HC).call(this,"text(bytes32,string)",[g]);return t==null||t==="0x"?null:t}async getContentHash(){const g=await E(this,Jn,HC).call(this,"contenthash(bytes32)");if(g==null||g==="0x")return null;const t=g.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(t){const n=t[1]==="e3010170"?"ipfs":"ipns",l=parseInt(t[4],16);if(t[5].length===l*2)return`${n}://${Lk("0x"+t[2])}`}const I=g.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(I&&I[1].length===64)return`bzz://${I[1]}`;H(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:g}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const g=[{type:"name",value:this.name}];try{const t=await this.getText("avatar");if(t==null)return g.push({type:"!avatar",value:""}),{url:null,linkage:g};g.push({type:"avatar",value:t});for(let I=0;I<UZ.length;I++){const n=t.match(UZ[I]);if(n==null)continue;const l=n[1].toLowerCase();switch(l){case"https":case"data":return g.push({type:"url",value:t}),{linkage:g,url:t};case"ipfs":{const C=Wd(t);return g.push({type:"ipfs",value:t}),g.push({type:"url",value:C}),{linkage:g,url:C}}case"erc721":case"erc1155":{const C=l==="erc721"?"tokenURI(uint256)":"uri(uint256)";g.push({type:l,value:t});const s=await this.getAddress();if(s==null)return g.push({type:"!owner",value:""}),{url:null,linkage:g};const r=(n[2]||"").split("/");if(r.length!==2)return g.push({type:`!${l}caip`,value:n[2]||""}),{url:null,linkage:g};const a=r[1],o=new rC(r[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if(l==="erc721"){const Z=await o.ownerOf(a);if(s!==Z)return g.push({type:"!owner",value:Z}),{url:null,linkage:g};g.push({type:"owner",value:Z})}else if(l==="erc1155"){const Z=await o.balanceOf(s,a);if(!Z)return g.push({type:"!balance",value:"0"}),{url:null,linkage:g};g.push({type:"balance",value:Z.toString()})}let c=await o[C](a);if(c==null||c==="0x")return g.push({type:"!metadata-url",value:""}),{url:null,linkage:g};g.push({type:"metadata-url-base",value:c}),l==="erc1155"&&(c=c.replace("{id}",Il(a,32).substring(2)),g.push({type:"metadata-url-expanded",value:c})),c.match(/^ipfs:/i)&&(c=Wd(c)),g.push({type:"metadata-url",value:c});let A={};const b=await new In(c).send();b.assertOk();try{A=b.bodyJson}catch{try{g.push({type:"!metadata",value:b.bodyText})}catch{const h=b.body;return h&&g.push({type:"!metadata",value:D(h)}),{url:null,linkage:g}}return{url:null,linkage:g}}if(!A)return g.push({type:"!metadata",value:""}),{url:null,linkage:g};g.push({type:"metadata",value:JSON.stringify(A)});let m=A.image;if(typeof m!="string")return g.push({type:"!imageUrl",value:""}),{url:null,linkage:g};if(!m.match(/^(https:\/\/|data:)/i)){if(m.match(nV)==null)return g.push({type:"!imageUrl-ipfs",value:m}),{url:null,linkage:g};g.push({type:"imageUrl-ipfs",value:m}),m=Wd(m)}return g.push({type:"url",value:m}),{linkage:g,url:m}}}}}catch{}return{linkage:g,url:null}}static async getEnsAddress(g){const t=await g.getNetwork(),I=t.getPlugin("org.ethers.plugins.network.Ens");return H(I,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:t}}),I.address}static async fromName(g,t){var n;let I=t;for(;;){if(I===""||I==="."||t!=="eth"&&I==="eth")return null;const l=await E(n=$C,Hc,lV).call(n,g,I);if(l!=null){const C=new $C(g,l,t);return I!==t&&!await C.supportsWildcard()?null:C}I=I.split(".").slice(1).join(".")}}};Xn=new WeakMap,Ml=new WeakMap,Jn=new WeakSet,HC=async function(g,t){t=(t||[]).slice();const I=d(this,Ml).interface;t.unshift(gm(this.name));let n=null;await this.supportsWildcard()&&(n=I.getFunction(g),H(n,"missing fragment","UNKNOWN_ERROR",{info:{funcName:g}}),t=[rY(this.name,255),I.encodeFunctionData(n,t)],g="resolve(bytes,bytes)"),t.push({enableCcipRead:!0});try{const l=await d(this,Ml)[g](...t);return n?I.decodeFunctionResult(n,l)[0]:l}catch(l){if(!te(l,"CALL_EXCEPTION"))throw l}return null},Hc=new WeakSet,lV=async function(g,t){const I=await $C.getEnsAddress(g);try{const l=await new rC(I,["function resolver(bytes32) view returns (address)"],g).resolver(gm(t),{enableCcipRead:!0});return l===ki?null:l}catch(n){throw n}return null},k($C,Hc);let Vc=$C;const zZ=BigInt(0);function rg(e,g){return function(t){return t==null?g:e(t)}}function Ki(e,g){return t=>{if(g&&t==null)return null;if(!Array.isArray(t))throw new Error("not an array");return t.map(I=>e(I))}}function fa(e,g){return t=>{const I={};for(const n in e){let l=n;if(g&&n in g&&!(l in t)){for(const C of g[n])if(C in t){l=C;break}}try{const C=e[n](t[l]);C!==void 0&&(I[n]=C)}catch(C){const s=C instanceof Error?C.message:"not-an-error";H(!1,`invalid value for value.${n} (${s})`,"BAD_DATA",{value:t})}}return I}}function jY(e){switch(e){case!0:case"true":return!0;case!1:case"false":return!1}V(!1,`invalid boolean; ${JSON.stringify(e)}`,"value",e)}function br(e){return V(Zg(e,!0),"invalid data","value",e),e}function ee(e){return V(Zg(e,32),"invalid hash","value",e),e}const PY=fa({address:ag,blockHash:ee,blockNumber:Ig,data:br,index:Ig,removed:rg(jY,!1),topics:Ki(ee),transactionHash:ee,transactionIndex:Ig},{index:["logIndex"]});function OY(e){return PY(e)}const qY=fa({hash:rg(ee),parentHash:ee,parentBeaconBlockRoot:rg(ee,null),number:Ig,timestamp:Ig,nonce:rg(br),difficulty:q,gasLimit:q,gasUsed:q,stateRoot:rg(ee,null),receiptsRoot:rg(ee,null),blobGasUsed:rg(q,null),excessBlobGas:rg(q,null),miner:rg(ag),prevRandao:rg(ee,null),extraData:br,baseFeePerGas:rg(q)},{prevRandao:["mixHash"]});function _Y(e){const g=qY(e);return g.transactions=e.transactions.map(t=>typeof t=="string"?t:CV(t)),g}const $Y=fa({transactionIndex:Ig,blockNumber:Ig,transactionHash:ee,address:ag,topics:Ki(ee),data:br,index:Ig,blockHash:ee},{index:["logIndex"]});function gv(e){return $Y(e)}const ev=fa({to:rg(ag,null),from:rg(ag,null),contractAddress:rg(ag,null),index:Ig,root:rg(D),gasUsed:q,blobGasUsed:rg(q,null),logsBloom:rg(br),blockHash:ee,hash:ee,logs:Ki(gv),blockNumber:Ig,cumulativeGasUsed:q,effectiveGasPrice:rg(q),blobGasPrice:rg(q,null),status:rg(Ig),type:rg(Ig,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function tv(e){return ev(e)}function CV(e){e.to&&q(e.to)===zZ&&(e.to="0x0000000000000000000000000000000000000000");const g=fa({hash:ee,index:rg(Ig,void 0),type:t=>t==="0x"||t==null?0:Ig(t),accessList:rg(fC,null),blobVersionedHashes:rg(Ki(ee,!0),null),authorizationList:rg(Ki(t=>{let I;if(t.signature)I=t.signature;else{let n=t.yParity;n==="0x1b"?n=0:n==="0x1c"&&(n=1),I=Object.assign({},t,{yParity:n})}return{address:ag(t.address),chainId:q(t.chainId),nonce:q(t.nonce),signature:xe.from(I)}},!1),null),blockHash:rg(ee,null),blockNumber:rg(Ig,null),transactionIndex:rg(Ig,null),from:ag,gasPrice:rg(q),maxPriorityFeePerGas:rg(q),maxFeePerGas:rg(q),maxFeePerBlobGas:rg(q,null),gasLimit:q,to:rg(ag,null),value:q,nonce:Ig,data:br,creates:rg(ag,null),chainId:rg(q,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(e);if(g.to==null&&g.creates==null&&(g.creates=LJ(g)),(e.type===1||e.type===2)&&e.accessList==null&&(g.accessList=[]),e.signature?g.signature=xe.from(e.signature):g.signature=xe.from(e),g.chainId==null){const t=g.signature.legacyChainId;t!=null&&(g.chainId=t)}return g.blockHash&&q(g.blockHash)===zZ&&(g.blockHash=null),g}const Iv="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";class Sr{constructor(g){R(this,"name");$(this,{name:g})}clone(){return new Sr(this.name)}}class hA extends Sr{constructor(t,I){t==null&&(t=0);super(`org.ethers.network.plugins.GasCost#${t||0}`);R(this,"effectiveBlock");R(this,"txBase");R(this,"txCreate");R(this,"txDataZero");R(this,"txDataNonzero");R(this,"txAccessListStorageKey");R(this,"txAccessListAddress");const n={effectiveBlock:t};function l(C,s){let r=(I||{})[C];r==null&&(r=s),V(typeof r=="number",`invalud value for ${C}`,"costs",I),n[C]=r}l("txBase",21e3),l("txCreate",32e3),l("txDataZero",4),l("txDataNonzero",16),l("txAccessListStorageKey",1900),l("txAccessListAddress",2400),$(this,n)}clone(){return new hA(this.effectiveBlock,this)}}class bA extends Sr{constructor(t,I){super("org.ethers.plugins.network.Ens");R(this,"address");R(this,"targetNetwork");$(this,{address:t||Iv,targetNetwork:I??1})}clone(){return new bA(this.address,this.targetNetwork)}}var Dl;const u0=class u0 extends Sr{constructor(t){super("org.ethers.plugins.network.FeeData");k(this,Dl,void 0);p(this,Dl,t)}get feeDataFunc(){return d(this,Dl)}async getFeeData(t){return await d(this,Dl).call(this,t)}clone(){return new u0(d(this,Dl))}};Dl=new WeakMap;let QZ=u0;var na,la;class nv extends Sr{constructor(t,I){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin");k(this,na,void 0);k(this,la,void 0);p(this,na,t),p(this,la,I)}get url(){return d(this,na)}get processFunc(){return d(this,la)}clone(){return this}}na=new WeakMap,la=new WeakMap;const Sd=new Map;var Es,Us,wn;const gs=class gs{constructor(g,t){k(this,Es,void 0);k(this,Us,void 0);k(this,wn,void 0);p(this,Es,g),p(this,Us,q(t)),p(this,wn,new Map)}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return d(this,Es)}set name(g){p(this,Es,g)}get chainId(){return d(this,Us)}set chainId(g){p(this,Us,q(g,"chainId"))}matches(g){if(g==null)return!1;if(typeof g=="string"){try{return this.chainId===q(g)}catch{}return this.name===g}if(typeof g=="number"||typeof g=="bigint"){try{return this.chainId===q(g)}catch{}return!1}if(typeof g=="object"){if(g.chainId!=null){try{return this.chainId===q(g.chainId)}catch{}return!1}return g.name!=null?this.name===g.name:!1}return!1}get plugins(){return Array.from(d(this,wn).values())}attachPlugin(g){if(d(this,wn).get(g.name))throw new Error(`cannot replace existing plugin: ${g.name} `);return d(this,wn).set(g.name,g.clone()),this}getPlugin(g){return d(this,wn).get(g)||null}getPlugins(g){return this.plugins.filter(t=>t.name.split("#")[0]===g)}clone(){const g=new gs(this.name,this.chainId);return this.plugins.forEach(t=>{g.attachPlugin(t.clone())}),g}computeIntrinsicGas(g){const t=this.getPlugin("org.ethers.plugins.network.GasCost")||new hA;let I=t.txBase;if(g.to==null&&(I+=t.txCreate),g.data)for(let n=2;n<g.data.length;n+=2)g.data.substring(n,n+2)==="00"?I+=t.txDataZero:I+=t.txDataNonzero;if(g.accessList){const n=fC(g.accessList);for(const l in n)I+=t.txAccessListAddress+t.txAccessListStorageKey*n[l].storageKeys.length}return I}static from(g){if(lv(),g==null)return gs.from("mainnet");if(typeof g=="number"&&(g=BigInt(g)),typeof g=="string"||typeof g=="bigint"){const t=Sd.get(g);if(t)return t();if(typeof g=="bigint")return new gs("unknown",g);V(!1,"unknown network","network",g)}if(typeof g.clone=="function")return g.clone();if(typeof g=="object"){V(typeof g.name=="string"&&typeof g.chainId=="number","invalid network object name or chainId","network",g);const t=new gs(g.name,g.chainId);return(g.ensAddress||g.ensNetwork!=null)&&t.attachPlugin(new bA(g.ensAddress,g.ensNetwork)),t}V(!1,"invalid network","network",g)}static register(g,t){typeof g=="number"&&(g=BigInt(g));const I=Sd.get(g);I&&V(!1,`conflicting network for ${JSON.stringify(I.name)}`,"nameOrChainId",g),Sd.set(g,t)}};Es=new WeakMap,Us=new WeakMap,wn=new WeakMap;let uI=gs;function LZ(e,g){const t=String(e);if(!t.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${e}`);const I=t.split(".");if(I.length===1&&I.push(""),I.length!==2)throw new Error(`invalid gwei value: ${e}`);for(;I[1].length<g;)I[1]+="0";if(I[1].length>9){let n=BigInt(I[1].substring(0,9));I[1].substring(9).match(/^0+$/)||n++,I[1]=n.toString()}return BigInt(I[0]+I[1])}function TZ(e){return new nv(e,async(g,t,I)=>{I.setHeader("User-Agent","ethers");let n;try{const[l,C]=await Promise.all([I.send(),g()]);n=l;const s=n.bodyJson.standard;return{gasPrice:C.gasPrice,maxFeePerGas:LZ(s.maxFee,9),maxPriorityFeePerGas:LZ(s.maxPriorityFee,9)}}catch(l){H(!1,`error encountered with polygon gas station (${JSON.stringify(I.url)})`,"SERVER_ERROR",{request:I,response:n,error:l})}})}let MZ=!1;function lv(){if(MZ)return;MZ=!0;function e(g,t,I){const n=function(){const l=new uI(g,t);return I.ensNetwork!=null&&l.attachPlugin(new bA(null,I.ensNetwork)),l.attachPlugin(new hA),(I.plugins||[]).forEach(C=>{l.attachPlugin(C)}),l};uI.register(g,n),uI.register(t,n),I.altNames&&I.altNames.forEach(l=>{uI.register(l,n)})}e("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),e("ropsten",3,{ensNetwork:3}),e("rinkeby",4,{ensNetwork:4}),e("goerli",5,{ensNetwork:5}),e("kovan",42,{ensNetwork:42}),e("sepolia",11155111,{ensNetwork:11155111}),e("holesky",17e3,{ensNetwork:17e3}),e("classic",61,{}),e("classicKotti",6,{}),e("arbitrum",42161,{ensNetwork:1}),e("arbitrum-goerli",421613,{}),e("arbitrum-sepolia",421614,{}),e("base",8453,{ensNetwork:1}),e("base-goerli",84531,{}),e("base-sepolia",84532,{}),e("bnb",56,{ensNetwork:1}),e("bnbt",97,{}),e("filecoin",314,{}),e("filecoin-calibration",314159,{}),e("linea",59144,{ensNetwork:1}),e("linea-goerli",59140,{}),e("linea-sepolia",59141,{}),e("matic",137,{ensNetwork:1,plugins:[TZ("https://gasstation.polygon.technology/v2")]}),e("matic-amoy",80002,{}),e("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[TZ("https://gasstation-testnet.polygon.technology/v2")]}),e("optimism",10,{ensNetwork:1,plugins:[]}),e("optimism-goerli",420,{}),e("optimism-sepolia",11155420,{}),e("xdai",100,{ensNetwork:1})}function Cm(e){return JSON.parse(JSON.stringify(e))}var xI,At,Yn,sI,zs,Xo;class Cv{constructor(g){k(this,zs);k(this,xI,void 0);k(this,At,void 0);k(this,Yn,void 0);k(this,sI,void 0);p(this,xI,g),p(this,At,null),p(this,Yn,4e3),p(this,sI,-2)}get pollingInterval(){return d(this,Yn)}set pollingInterval(g){p(this,Yn,g)}start(){d(this,At)||(p(this,At,d(this,xI)._setTimeout(E(this,zs,Xo).bind(this),d(this,Yn))),E(this,zs,Xo).call(this))}stop(){d(this,At)&&(d(this,xI)._clearTimeout(d(this,At)),p(this,At,null))}pause(g){this.stop(),g&&p(this,sI,-2)}resume(){this.start()}}xI=new WeakMap,At=new WeakMap,Yn=new WeakMap,sI=new WeakMap,zs=new WeakSet,Xo=async function(){try{const g=await d(this,xI).getBlockNumber();if(d(this,sI)===-2){p(this,sI,g);return}if(g!==d(this,sI)){for(let t=d(this,sI)+1;t<=g;t++){if(d(this,At)==null)return;await d(this,xI).emit("block",t)}p(this,sI,g)}}catch{}d(this,At)!=null&&p(this,At,d(this,xI)._setTimeout(E(this,zs,Xo).bind(this),d(this,Yn)))};var jl,Pl,vn;class Dh{constructor(g){k(this,jl,void 0);k(this,Pl,void 0);k(this,vn,void 0);p(this,jl,g),p(this,vn,!1),p(this,Pl,t=>{this._poll(t,d(this,jl))})}async _poll(g,t){throw new Error("sub-classes must override this")}start(){d(this,vn)||(p(this,vn,!0),d(this,Pl).call(this,-2),d(this,jl).on("block",d(this,Pl)))}stop(){d(this,vn)&&(p(this,vn,!1),d(this,jl).off("block",d(this,Pl)))}pause(g){this.stop()}resume(){this.start()}}jl=new WeakMap,Pl=new WeakMap,vn=new WeakMap;var Qs,KI;class sv extends Dh{constructor(t,I){super(t);k(this,Qs,void 0);k(this,KI,void 0);p(this,Qs,I),p(this,KI,-2)}pause(t){t&&p(this,KI,-2),super.pause(t)}async _poll(t,I){const n=await I.getBlock(d(this,Qs));n!=null&&(d(this,KI)===-2?p(this,KI,n.number):n.number>d(this,KI)&&(I.emit(d(this,Qs),n.number),p(this,KI,n.number)))}}Qs=new WeakMap,KI=new WeakMap;var Fc;class rv extends Dh{constructor(t,I){super(t);k(this,Fc,void 0);p(this,Fc,Cm(I))}async _poll(t,I){throw new Error("@TODO")}}Fc=new WeakMap;var Ls;class iv extends Dh{constructor(t,I){super(t);k(this,Ls,void 0);p(this,Ls,I)}async _poll(t,I){const n=await I.getTransactionReceipt(d(this,Ls));n&&I.emit(d(this,Ls),n)}}Ls=new WeakMap;var EI,Ts,Ms,Nn,dt,xc,sV;class jh{constructor(g,t){k(this,xc);k(this,EI,void 0);k(this,Ts,void 0);k(this,Ms,void 0);k(this,Nn,void 0);k(this,dt,void 0);p(this,EI,g),p(this,Ts,Cm(t)),p(this,Ms,E(this,xc,sV).bind(this)),p(this,Nn,!1),p(this,dt,-2)}start(){d(this,Nn)||(p(this,Nn,!0),d(this,dt)===-2&&d(this,EI).getBlockNumber().then(g=>{p(this,dt,g)}),d(this,EI).on("block",d(this,Ms)))}stop(){d(this,Nn)&&(p(this,Nn,!1),d(this,EI).off("block",d(this,Ms)))}pause(g){this.stop(),g&&p(this,dt,-2)}resume(){this.start()}}EI=new WeakMap,Ts=new WeakMap,Ms=new WeakMap,Nn=new WeakMap,dt=new WeakMap,xc=new WeakSet,sV=async function(g){if(d(this,dt)===-2)return;const t=Cm(d(this,Ts));t.fromBlock=d(this,dt)+1,t.toBlock=g;const I=await d(this,EI).getLogs(t);if(I.length===0){d(this,dt)<g-60&&p(this,dt,g-60);return}for(const n of I)d(this,EI).emit(d(this,Ts),n),p(this,dt,n.blockNumber)};const av=BigInt(2),ov=10;function to(e){return e&&typeof e.then=="function"}function Jo(e,g){return e+":"+JSON.stringify(g,(t,I)=>{if(I==null)return"null";if(typeof I=="bigint")return`bigint:${I.toString()}`;if(typeof I=="string")return I.toLowerCase();if(typeof I=="object"&&!Array.isArray(I)){const n=Object.keys(I);return n.sort(),n.reduce((l,C)=>(l[C]=I[C],l),{})}return I})}class rV{constructor(g){R(this,"name");$(this,{name:g})}start(){}stop(){}pause(g){}resume(){}}function cv(e){return JSON.parse(JSON.stringify(e))}function sm(e){return e=Array.from(new Set(e).values()),e.sort(),e}async function Rd(e,g){if(e==null)throw new Error("invalid event");if(Array.isArray(e)&&(e={topics:e}),typeof e=="string")switch(e){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:e,tag:e}}if(Zg(e,32)){const t=e.toLowerCase();return{type:"transaction",tag:Jo("tx",{hash:t}),hash:t}}if(e.orphan){const t=e;return{type:"orphan",tag:Jo("orphan",t),filter:cv(t)}}if(e.address||e.topics){const t=e,I={topics:(t.topics||[]).map(n=>n==null?null:Array.isArray(n)?sm(n.map(l=>l.toLowerCase())):n.toLowerCase())};if(t.address){const n=[],l=[],C=s=>{Zg(s)?n.push(s):l.push((async()=>{n.push(await pe(s,g))})())};Array.isArray(t.address)?t.address.forEach(C):C(t.address),l.length&&await Promise.all(l),I.address=sm(n.map(s=>s.toLowerCase()))}return{filter:I,tag:Jo("event",I),type:"event"}}V(!1,"unknown ProviderEvent","event",e)}function kd(){return new Date().getTime()}const Av={cacheTimeout:250,pollingInterval:4e3};var ie,Hn,ae,Ds,Pe,Ol,Fn,UI,Ca,ut,js,Ps,me,Le,sa,rm,ra,im,ql,Or,ia,am,_l,qr,Os,wo;class dv{constructor(g,t){k(this,me);k(this,sa);k(this,ra);k(this,ql);k(this,ia);k(this,_l);k(this,Os);k(this,ie,void 0);k(this,Hn,void 0);k(this,ae,void 0);k(this,Ds,void 0);k(this,Pe,void 0);k(this,Ol,void 0);k(this,Fn,void 0);k(this,UI,void 0);k(this,Ca,void 0);k(this,ut,void 0);k(this,js,void 0);k(this,Ps,void 0);if(p(this,Ps,Object.assign({},Av,t||{})),g==="any")p(this,Ol,!0),p(this,Pe,null);else if(g){const I=uI.from(g);p(this,Ol,!1),p(this,Pe,Promise.resolve(I)),setTimeout(()=>{this.emit("network",I,null)},0)}else p(this,Ol,!1),p(this,Pe,null);p(this,UI,-1),p(this,Fn,new Map),p(this,ie,new Map),p(this,Hn,new Map),p(this,ae,null),p(this,Ds,!1),p(this,Ca,1),p(this,ut,new Map),p(this,js,!1)}get pollingInterval(){return d(this,Ps).pollingInterval}get provider(){return this}get plugins(){return Array.from(d(this,Hn).values())}attachPlugin(g){if(d(this,Hn).get(g.name))throw new Error(`cannot replace existing plugin: ${g.name} `);return d(this,Hn).set(g.name,g.connect(this)),this}getPlugin(g){return d(this,Hn).get(g)||null}get disableCcipRead(){return d(this,js)}set disableCcipRead(g){p(this,js,!!g)}async ccipReadFetch(g,t,I){if(this.disableCcipRead||I.length===0||g.to==null)return null;const n=g.to.toLowerCase(),l=t.toLowerCase(),C=[];for(let s=0;s<I.length;s++){const r=I[s],a=r.replace("{sender}",n).replace("{data}",l),o=new In(a);r.indexOf("{data}")===-1&&(o.body={data:l,sender:n}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:o,index:s,urls:I});let c="unknown error",A;try{A=await o.send()}catch(b){C.push(b.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:o,result:{error:b}});continue}try{const b=A.bodyJson;if(b.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:o,result:b}),b.data;b.message&&(c=b.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:o,result:b})}catch{}H(A.statusCode<400||A.statusCode>=500,`response not found during CCIP fetch: ${c}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:g,info:{url:r,errorMessage:c}}),C.push(c)}H(!1,`error encountered during CCIP fetch: ${C.map(s=>JSON.stringify(s)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:g,info:{urls:I,errorMessages:C}})}_wrapBlock(g,t){return new YY(_Y(g),this)}_wrapLog(g,t){return new Ba(OY(g),this)}_wrapTransactionReceipt(g,t){return new Df(tv(g),this)}_wrapTransactionResponse(g,t){return new xi(CV(g),this)}_detectNetwork(){H(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(g){H(!1,`unsupported method: ${g.method}`,"UNSUPPORTED_OPERATION",{operation:g.method,info:g})}async getBlockNumber(){const g=Ig(await E(this,me,Le).call(this,{method:"getBlockNumber"}),"%response");return d(this,UI)>=0&&p(this,UI,g),g}_getAddress(g){return pe(g,this)}_getBlockTag(g){if(g==null)return"latest";switch(g){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return g}if(Zg(g))return Zg(g,32)?g:Kt(g);if(typeof g=="bigint"&&(g=Ig(g,"blockTag")),typeof g=="number")return g>=0?Kt(g):d(this,UI)>=0?Kt(d(this,UI)+g):this.getBlockNumber().then(t=>Kt(t+g));V(!1,"invalid blockTag","blockTag",g)}_getFilter(g){const t=(g.topics||[]).map(r=>r==null?null:Array.isArray(r)?sm(r.map(a=>a.toLowerCase())):r.toLowerCase()),I="blockHash"in g?g.blockHash:void 0,n=(r,a,o)=>{let c;switch(r.length){case 0:break;case 1:c=r[0];break;default:r.sort(),c=r}if(I&&(a!=null||o!=null))throw new Error("invalid filter");const A={};return c&&(A.address=c),t.length&&(A.topics=t),a&&(A.fromBlock=a),o&&(A.toBlock=o),I&&(A.blockHash=I),A};let l=[];if(g.address)if(Array.isArray(g.address))for(const r of g.address)l.push(this._getAddress(r));else l.push(this._getAddress(g.address));let C;"fromBlock"in g&&(C=this._getBlockTag(g.fromBlock));let s;return"toBlock"in g&&(s=this._getBlockTag(g.toBlock)),l.filter(r=>typeof r!="string").length||C!=null&&typeof C!="string"||s!=null&&typeof s!="string"?Promise.all([Promise.all(l),C,s]).then(r=>n(r[0],r[1],r[2])):n(l,C,s)}_getTransactionRequest(g){const t=Bc(g),I=[];if(["to","from"].forEach(n=>{if(t[n]==null)return;const l=pe(t[n],this);to(l)?I.push(async function(){t[n]=await l}()):t[n]=l}),t.blockTag!=null){const n=this._getBlockTag(t.blockTag);to(n)?I.push(async function(){t.blockTag=await n}()):t.blockTag=n}return I.length?async function(){return await Promise.all(I),t}():t}async getNetwork(){if(d(this,Pe)==null){const n=(async()=>{try{const l=await this._detectNetwork();return this.emit("network",l,null),l}catch(l){throw d(this,Pe)===n&&p(this,Pe,null),l}})();return p(this,Pe,n),(await n).clone()}const g=d(this,Pe),[t,I]=await Promise.all([g,this._detectNetwork()]);return t.chainId!==I.chainId&&(d(this,Ol)?(this.emit("network",I,t),d(this,Pe)===g&&p(this,Pe,Promise.resolve(I))):H(!1,`network changed: ${t.chainId} => ${I.chainId} `,"NETWORK_ERROR",{event:"changed"})),t.clone()}async getFeeData(){const g=await this.getNetwork(),t=async()=>{const{_block:n,gasPrice:l,priorityFee:C}=await Ze({_block:E(this,ia,am).call(this,"latest",!1),gasPrice:(async()=>{try{const o=await E(this,me,Le).call(this,{method:"getGasPrice"});return q(o,"%response")}catch{}return null})(),priorityFee:(async()=>{try{const o=await E(this,me,Le).call(this,{method:"getPriorityFee"});return q(o,"%response")}catch{}return null})()});let s=null,r=null;const a=this._wrapBlock(n,g);return a&&a.baseFeePerGas&&(r=C??BigInt("1000000000"),s=a.baseFeePerGas*av+r),new xZ(l,s,r)},I=g.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(I){const n=new In(I.url),l=await I.processFunc(t,this,n);return new xZ(l.gasPrice,l.maxFeePerGas,l.maxPriorityFeePerGas)}return await t()}async estimateGas(g){let t=this._getTransactionRequest(g);return to(t)&&(t=await t),q(await E(this,me,Le).call(this,{method:"estimateGas",transaction:t}),"%response")}async call(g){const{tx:t,blockTag:I}=await Ze({tx:this._getTransactionRequest(g),blockTag:this._getBlockTag(g.blockTag)});return await E(this,ra,im).call(this,E(this,sa,rm).call(this,t,I,g.enableCcipRead?0:-1))}async getBalance(g,t){return q(await E(this,ql,Or).call(this,{method:"getBalance"},g,t),"%response")}async getTransactionCount(g,t){return Ig(await E(this,ql,Or).call(this,{method:"getTransactionCount"},g,t),"%response")}async getCode(g,t){return D(await E(this,ql,Or).call(this,{method:"getCode"},g,t))}async getStorage(g,t,I){const n=q(t,"position");return D(await E(this,ql,Or).call(this,{method:"getStorage",position:n},g,I))}async broadcastTransaction(g){const{blockNumber:t,hash:I,network:n}=await Ze({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:g}),network:this.getNetwork()}),l=hc.from(g);if(l.hash!==I)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(l,n).replaceableTransaction(t)}async getBlock(g,t){const{network:I,params:n}=await Ze({network:this.getNetwork(),params:E(this,ia,am).call(this,g,!!t)});return n==null?null:this._wrapBlock(n,I)}async getTransaction(g){const{network:t,params:I}=await Ze({network:this.getNetwork(),params:E(this,me,Le).call(this,{method:"getTransaction",hash:g})});return I==null?null:this._wrapTransactionResponse(I,t)}async getTransactionReceipt(g){const{network:t,params:I}=await Ze({network:this.getNetwork(),params:E(this,me,Le).call(this,{method:"getTransactionReceipt",hash:g})});if(I==null)return null;if(I.gasPrice==null&&I.effectiveGasPrice==null){const n=await E(this,me,Le).call(this,{method:"getTransaction",hash:g});if(n==null)throw new Error("report this; could not find tx or effectiveGasPrice");I.effectiveGasPrice=n.gasPrice}return this._wrapTransactionReceipt(I,t)}async getTransactionResult(g){const{result:t}=await Ze({network:this.getNetwork(),result:E(this,me,Le).call(this,{method:"getTransactionResult",hash:g})});return t==null?null:D(t)}async getLogs(g){let t=this._getFilter(g);to(t)&&(t=await t);const{network:I,params:n}=await Ze({network:this.getNetwork(),params:E(this,me,Le).call(this,{method:"getLogs",filter:t})});return n.map(l=>this._wrapLog(l,I))}_getProvider(g){H(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(g){return await Vc.fromName(this,g)}async getAvatar(g){const t=await this.getResolver(g);return t?await t.getAvatar():null}async resolveName(g){const t=await this.getResolver(g);return t?await t.getAddress():null}async lookupAddress(g){g=ag(g);const t=gm(g.substring(2).toLowerCase()+".addr.reverse");try{const I=await Vc.getEnsAddress(this),l=await new rC(I,["function resolver(bytes32) view returns (address)"],this).resolver(t);if(l==null||l===ki)return null;const s=await new rC(l,["function name(bytes32) view returns (string)"],this).name(t);return await this.resolveName(s)!==g?null:s}catch(I){if(te(I,"BAD_DATA")&&I.value==="0x"||te(I,"CALL_EXCEPTION"))return null;throw I}return null}async waitForTransaction(g,t,I){const n=t??1;return n===0?this.getTransactionReceipt(g):new Promise(async(l,C)=>{let s=null;const r=async a=>{try{const o=await this.getTransactionReceipt(g);if(o!=null&&a-o.blockNumber+1>=n){l(o),s&&(clearTimeout(s),s=null);return}}catch(o){console.log("EEE",o)}this.once("block",r)};I!=null&&(s=setTimeout(()=>{s!=null&&(s=null,this.off("block",r),C(Bg("timeout","TIMEOUT",{reason:"timeout"})))},I)),r(await this.getBlockNumber())})}async waitForBlock(g){H(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(g){const t=d(this,ut).get(g);t&&(t.timer&&clearTimeout(t.timer),d(this,ut).delete(g))}_setTimeout(g,t){t==null&&(t=0);const I=Xr(this,Ca)._++,n=()=>{d(this,ut).delete(I),g()};if(this.paused)d(this,ut).set(I,{timer:null,func:n,time:t});else{const l=setTimeout(n,t);d(this,ut).set(I,{timer:l,func:n,time:kd()})}return I}_forEachSubscriber(g){for(const t of d(this,ie).values())g(t.subscriber)}_getSubscriber(g){switch(g.type){case"debug":case"error":case"network":return new rV(g.type);case"block":{const t=new Cv(this);return t.pollingInterval=this.pollingInterval,t}case"safe":case"finalized":return new sv(this,g.type);case"event":return new jh(this,g.filter);case"transaction":return new iv(this,g.hash);case"orphan":return new rv(this,g.filter)}throw new Error(`unsupported event: ${g.type}`)}_recoverSubscriber(g,t){for(const I of d(this,ie).values())if(I.subscriber===g){I.started&&I.subscriber.stop(),I.subscriber=t,I.started&&t.start(),d(this,ae)!=null&&t.pause(d(this,ae));break}}async on(g,t){const I=await E(this,Os,wo).call(this,g);return I.listeners.push({listener:t,once:!1}),I.started||(I.subscriber.start(),I.started=!0,d(this,ae)!=null&&I.subscriber.pause(d(this,ae))),this}async once(g,t){const I=await E(this,Os,wo).call(this,g);return I.listeners.push({listener:t,once:!0}),I.started||(I.subscriber.start(),I.started=!0,d(this,ae)!=null&&I.subscriber.pause(d(this,ae))),this}async emit(g,...t){const I=await E(this,_l,qr).call(this,g,t);if(!I||I.listeners.length===0)return!1;const n=I.listeners.length;return I.listeners=I.listeners.filter(({listener:l,once:C})=>{const s=new dB(this,C?null:l,g);try{l.call(this,...t,s)}catch{}return!C}),I.listeners.length===0&&(I.started&&I.subscriber.stop(),d(this,ie).delete(I.tag)),n>0}async listenerCount(g){if(g){const I=await E(this,_l,qr).call(this,g);return I?I.listeners.length:0}let t=0;for(const{listeners:I}of d(this,ie).values())t+=I.length;return t}async listeners(g){if(g){const I=await E(this,_l,qr).call(this,g);return I?I.listeners.map(({listener:n})=>n):[]}let t=[];for(const{listeners:I}of d(this,ie).values())t=t.concat(I.map(({listener:n})=>n));return t}async off(g,t){const I=await E(this,_l,qr).call(this,g);if(!I)return this;if(t){const n=I.listeners.map(({listener:l})=>l).indexOf(t);n>=0&&I.listeners.splice(n,1)}return(!t||I.listeners.length===0)&&(I.started&&I.subscriber.stop(),d(this,ie).delete(I.tag)),this}async removeAllListeners(g){if(g){const{tag:t,started:I,subscriber:n}=await E(this,Os,wo).call(this,g);I&&n.stop(),d(this,ie).delete(t)}else for(const[t,{started:I,subscriber:n}]of d(this,ie))I&&n.stop(),d(this,ie).delete(t);return this}async addListener(g,t){return await this.on(g,t)}async removeListener(g,t){return this.off(g,t)}get destroyed(){return d(this,Ds)}destroy(){this.removeAllListeners();for(const g of d(this,ut).keys())this._clearTimeout(g);p(this,Ds,!0)}get paused(){return d(this,ae)!=null}set paused(g){!!g!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(g){if(p(this,UI,-1),d(this,ae)!=null){if(d(this,ae)==!!g)return;H(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(t=>t.pause(g)),p(this,ae,!!g);for(const t of d(this,ut).values())t.timer&&clearTimeout(t.timer),t.time=kd()-t.time}resume(){if(d(this,ae)!=null){this._forEachSubscriber(g=>g.resume()),p(this,ae,null);for(const g of d(this,ut).values()){let t=g.time;t<0&&(t=0),g.time=kd(),setTimeout(g.func,t)}}}}ie=new WeakMap,Hn=new WeakMap,ae=new WeakMap,Ds=new WeakMap,Pe=new WeakMap,Ol=new WeakMap,Fn=new WeakMap,UI=new WeakMap,Ca=new WeakMap,ut=new WeakMap,js=new WeakMap,Ps=new WeakMap,me=new WeakSet,Le=async function(g){const t=d(this,Ps).cacheTimeout;if(t<0)return await this._perform(g);const I=Jo(g.method,g);let n=d(this,Fn).get(I);return n||(n=this._perform(g),d(this,Fn).set(I,n),setTimeout(()=>{d(this,Fn).get(I)===n&&d(this,Fn).delete(I)},t)),await n},sa=new WeakSet,rm=async function(g,t,I){H(I<ov,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},g,{blockTag:t,enableCcipRead:!0})});const n=Bc(g);try{return D(await this._perform({method:"call",transaction:n,blockTag:t}))}catch(l){if(!this.disableCcipRead&&Sh(l)&&l.data&&I>=0&&t==="latest"&&n.to!=null&&Vg(l.data,0,4)==="0x556f1830"){const C=l.data,s=await pe(n.to,this);let r;try{r=Zv(Vg(l.data,4))}catch(c){H(!1,c.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:n,info:{data:C}})}H(r.sender.toLowerCase()===s.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:C,reason:"OffchainLookup",transaction:n,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:r.errorArgs}});const a=await this.ccipReadFetch(n,r.calldata,r.urls);H(a!=null,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:n,info:{data:l.data,errorArgs:r.errorArgs}});const o={to:s,data:pg([r.selector,bv([a,r.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:o});try{const c=await E(this,sa,rm).call(this,o,t,I+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},o),result:c}),c}catch(c){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},o),error:c}),c}}throw l}},ra=new WeakSet,im=async function(g){const{value:t}=await Ze({network:this.getNetwork(),value:g});return t},ql=new WeakSet,Or=async function(g,t,I){let n=this._getAddress(t),l=this._getBlockTag(I);return(typeof n!="string"||typeof l!="string")&&([n,l]=await Promise.all([n,l])),await E(this,ra,im).call(this,E(this,me,Le).call(this,Object.assign(g,{address:n,blockTag:l})))},ia=new WeakSet,am=async function(g,t){if(Zg(g,32))return await E(this,me,Le).call(this,{method:"getBlock",blockHash:g,includeTransactions:t});let I=this._getBlockTag(g);return typeof I!="string"&&(I=await I),await E(this,me,Le).call(this,{method:"getBlock",blockTag:I,includeTransactions:t})},_l=new WeakSet,qr=async function(g,t){let I=await Rd(g,this);return I.type==="event"&&t&&t.length>0&&t[0].removed===!0&&(I=await Rd({orphan:"drop-log",log:t[0]},this)),d(this,ie).get(I.tag)||null},Os=new WeakSet,wo=async function(g){const t=await Rd(g,this),I=t.tag;let n=d(this,ie).get(I);return n||(n={subscriber:this._getSubscriber(t),tag:I,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},d(this,ie).set(I,n)),n};function uv(e,g){try{const t=om(e,g);if(t)return uc(t)}catch{}return null}function om(e,g){if(e==="0x")return null;try{const t=Ig(Vg(e,g,g+32)),I=Ig(Vg(e,t,t+32));return Vg(e,t+32,t+32+I)}catch{}return null}function DZ(e){const g=Kg(e);if(g.length>32)throw new Error("internal; should not happen");const t=new Uint8Array(32);return t.set(g,32-g.length),t}function mv(e){if(e.length%32===0)return e;const g=new Uint8Array(Math.ceil(e.length/32)*32);return g.set(e),g}const hv=new Uint8Array([]);function bv(e){const g=[];let t=0;for(let I=0;I<e.length;I++)g.push(hv),t+=32;for(let I=0;I<e.length;I++){const n=ng(e[I]);g[I]=DZ(t),g.push(DZ(n.length)),g.push(mv(n)),t+=32+Math.ceil(n.length/32)*32}return pg(g)}const jZ="0x0000000000000000000000000000000000000000000000000000000000000000";function Zv(e){const g={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};H(ss(e)>=5*32,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const t=Vg(e,0,32);H(Vg(t,0,12)===Vg(jZ,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),g.sender=Vg(t,12);try{const I=[],n=Ig(Vg(e,32,64)),l=Ig(Vg(e,n,n+32)),C=Vg(e,n+32);for(let s=0;s<l;s++){const r=uv(C,s*32);if(r==null)throw new Error("abort");I.push(r)}g.urls=I}catch{H(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const I=om(e,64);if(I==null)throw new Error("abort");g.calldata=I}catch{H(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}H(Vg(e,100,128)===Vg(jZ,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),g.selector=Vg(e,96,100);try{const I=om(e,128);if(I==null)throw new Error("abort");g.extraData=I}catch{H(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return g.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(I=>g[I]),g}function ml(e,g){if(e.provider)return e.provider;H(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:g})}async function PZ(e,g){let t=Bc(g);if(t.to!=null&&(t.to=pe(t.to,e)),t.from!=null){const I=t.from;t.from=Promise.all([e.getAddress(),pe(I,e)]).then(([n,l])=>(V(n.toLowerCase()===l.toLowerCase(),"transaction from mismatch","tx.from",l),n))}else t.from=e.getAddress();return await Ze(t)}class iV{constructor(g){R(this,"provider");$(this,{provider:g||null})}async getNonce(g){return ml(this,"getTransactionCount").getTransactionCount(await this.getAddress(),g)}async populateCall(g){return await PZ(this,g)}async populateTransaction(g){const t=ml(this,"populateTransaction"),I=await PZ(this,g);I.nonce==null&&(I.nonce=await this.getNonce("pending")),I.gasLimit==null&&(I.gasLimit=await this.estimateGas(I));const n=await this.provider.getNetwork();if(I.chainId!=null){const C=q(I.chainId);V(C===n.chainId,"transaction chainId mismatch","tx.chainId",g.chainId)}else I.chainId=n.chainId;const l=I.maxFeePerGas!=null||I.maxPriorityFeePerGas!=null;if(I.gasPrice!=null&&(I.type===2||l)?V(!1,"eip-1559 transaction do not support gasPrice","tx",g):(I.type===0||I.type===1)&&l&&V(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",g),(I.type===2||I.type==null)&&I.maxFeePerGas!=null&&I.maxPriorityFeePerGas!=null)I.type=2;else if(I.type===0||I.type===1){const C=await t.getFeeData();H(C.gasPrice!=null,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),I.gasPrice==null&&(I.gasPrice=C.gasPrice)}else{const C=await t.getFeeData();if(I.type==null)if(C.maxFeePerGas!=null&&C.maxPriorityFeePerGas!=null)if(I.authorizationList&&I.authorizationList.length?I.type=4:I.type=2,I.gasPrice!=null){const s=I.gasPrice;delete I.gasPrice,I.maxFeePerGas=s,I.maxPriorityFeePerGas=s}else I.maxFeePerGas==null&&(I.maxFeePerGas=C.maxFeePerGas),I.maxPriorityFeePerGas==null&&(I.maxPriorityFeePerGas=C.maxPriorityFeePerGas);else C.gasPrice!=null?(H(!l,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),I.gasPrice==null&&(I.gasPrice=C.gasPrice),I.type=0):H(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else(I.type===2||I.type===3||I.type===4)&&(I.maxFeePerGas==null&&(I.maxFeePerGas=C.maxFeePerGas),I.maxPriorityFeePerGas==null&&(I.maxPriorityFeePerGas=C.maxPriorityFeePerGas))}return await Ze(I)}async populateAuthorization(g){const t=Object.assign({},g);return t.chainId==null&&(t.chainId=(await ml(this,"getNetwork").getNetwork()).chainId),t.nonce==null&&(t.nonce=await this.getNonce()),t}async estimateGas(g){return ml(this,"estimateGas").estimateGas(await this.populateCall(g))}async call(g){return ml(this,"call").call(await this.populateCall(g))}async resolveName(g){return await ml(this,"resolveName").resolveName(g)}async sendTransaction(g){const t=ml(this,"sendTransaction"),I=await this.populateTransaction(g);delete I.from;const n=hc.from(I);return await t.broadcastTransaction(await this.signTransaction(n))}authorize(g){H(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}}var qs,Yo;const m0=class m0 extends iV{constructor(t,I){super(I);k(this,qs);R(this,"address");$(this,{address:t})}async getAddress(){return this.address}connect(t){return new m0(this.address,t)}async signTransaction(t){E(this,qs,Yo).call(this,"transactions","signTransaction")}async signMessage(t){E(this,qs,Yo).call(this,"messages","signMessage")}async signTypedData(t,I,n){E(this,qs,Yo).call(this,"typed-data","signTypedData")}};qs=new WeakSet,Yo=function(t,I){H(!1,`VoidSigner cannot sign ${t}`,"UNSUPPORTED_OPERATION",{operation:I})};let OZ=m0;function yv(e){return JSON.parse(JSON.stringify(e))}var he,rI,$l,xn,gC,_s,aa,cm,oa,Am;class aV{constructor(g){k(this,aa);k(this,oa);k(this,he,void 0);k(this,rI,void 0);k(this,$l,void 0);k(this,xn,void 0);k(this,gC,void 0);k(this,_s,void 0);p(this,he,g),p(this,rI,null),p(this,$l,E(this,aa,cm).bind(this)),p(this,xn,!1),p(this,gC,null),p(this,_s,!1)}_subscribe(g){throw new Error("subclasses must override this")}_emitResults(g,t){throw new Error("subclasses must override this")}_recover(g){throw new Error("subclasses must override this")}start(){d(this,xn)||(p(this,xn,!0),E(this,aa,cm).call(this,-2))}stop(){d(this,xn)&&(p(this,xn,!1),p(this,_s,!0),E(this,oa,Am).call(this),d(this,he).off("block",d(this,$l)))}pause(g){g&&E(this,oa,Am).call(this),d(this,he).off("block",d(this,$l))}resume(){this.start()}}he=new WeakMap,rI=new WeakMap,$l=new WeakMap,xn=new WeakMap,gC=new WeakMap,_s=new WeakMap,aa=new WeakSet,cm=async function(g){try{d(this,rI)==null&&p(this,rI,this._subscribe(d(this,he)));let t=null;try{t=await d(this,rI)}catch(l){if(!te(l,"UNSUPPORTED_OPERATION")||l.operation!=="eth_newFilter")throw l}if(t==null){p(this,rI,null),d(this,he)._recoverSubscriber(this,this._recover(d(this,he)));return}const I=await d(this,he).getNetwork();if(d(this,gC)||p(this,gC,I),d(this,gC).chainId!==I.chainId)throw new Error("chaid changed");if(d(this,_s))return;const n=await d(this,he).send("eth_getFilterChanges",[t]);await this._emitResults(d(this,he),n)}catch(t){console.log("@TODO",t)}d(this,he).once("block",d(this,$l))},oa=new WeakSet,Am=function(){const g=d(this,rI);g&&(p(this,rI,null),g.then(t=>{d(this,he).destroyed||d(this,he).send("eth_uninstallFilter",[t])}))};var eC;class Gv extends aV{constructor(t,I){super(t);k(this,eC,void 0);p(this,eC,yv(I))}_recover(t){return new jh(t,d(this,eC))}async _subscribe(t){return await t.send("eth_newFilter",[d(this,eC)])}async _emitResults(t,I){for(const n of I)t.emit(d(this,eC),t._wrapLog(n,t._network))}}eC=new WeakMap;class pv extends aV{async _subscribe(g){return await g.send("eth_newPendingTransactionFilter",[])}async _emitResults(g,t){for(const I of t)g.emit("pending",I)}}const Bv="bigint,boolean,function,number,string,symbol".split(/,/g);function vo(e){if(e==null||Bv.indexOf(typeof e)>=0||typeof e.getAddress=="function")return e;if(Array.isArray(e))return e.map(vo);if(typeof e=="object")return Object.keys(e).reduce((g,t)=>(g[t]=e[t],g),{});throw new Error(`should not happen: ${e} (${typeof e})`)}function fv(e){return new Promise(g=>{setTimeout(g,e)})}function JC(e){return e&&e.toLowerCase()}function qZ(e){return e&&typeof e.pollingInterval=="number"}const oV={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class Xd extends iV{constructor(t,I){super(t);R(this,"address");I=ag(I),$(this,{address:I})}connect(t){H(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(t){return await this.populateCall(t)}async sendUncheckedTransaction(t){const I=vo(t),n=[];if(I.from){const C=I.from;n.push((async()=>{const s=await pe(C,this.provider);V(s!=null&&s.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),I.from=s})())}else I.from=this.address;if(I.gasLimit==null&&n.push((async()=>{I.gasLimit=await this.provider.estimateGas({...I,from:this.address})})()),I.to!=null){const C=I.to;n.push((async()=>{I.to=await pe(C,this.provider)})())}n.length&&await Promise.all(n);const l=this.provider.getRpcTransaction(I);return this.provider.send("eth_sendTransaction",[l])}async sendTransaction(t){const I=await this.provider.getBlockNumber(),n=await this.sendUncheckedTransaction(t);return await new Promise((l,C)=>{const s=[1e3,100];let r=0;const a=async()=>{try{const o=await this.provider.getTransaction(n);if(o!=null){l(o.replaceableTransaction(I));return}}catch(o){if(te(o,"CANCELLED")||te(o,"BAD_DATA")||te(o,"NETWORK_ERROR")||te(o,"UNSUPPORTED_OPERATION")){o.info==null&&(o.info={}),o.info.sendTransactionHash=n,C(o);return}if(te(o,"INVALID_ARGUMENT")&&(r++,o.info==null&&(o.info={}),o.info.sendTransactionHash=n,r>10)){C(o);return}this.provider.emit("error",Bg("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:o}))}this.provider._setTimeout(()=>{a()},s.pop()||4e3)};a()})}async signTransaction(t){const I=vo(t);if(I.from){const l=await pe(I.from,this.provider);V(l!=null&&l.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),I.from=l}else I.from=this.address;const n=this.provider.getRpcTransaction(I);return await this.provider.send("eth_signTransaction",[n])}async signMessage(t){const I=typeof t=="string"?yI(t):t;return await this.provider.send("personal_sign",[D(I),this.address.toLowerCase()])}async signTypedData(t,I,n){const l=vo(n),C=await Ni.resolveNames(t,I,l,async s=>{const r=await pe(s);return V(r!=null,"TypedData does not support null address","value",s),r});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(Ni.getPayload(C.domain,I,C.value))])}async unlock(t){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),t,null])}async _legacySignMessage(t){const I=typeof t=="string"?yI(t):t;return await this.provider.send("eth_sign",[this.address.toLowerCase(),D(I)])}}var tC,$s,zI,iI,Ht,mt,Xe,ca,dm;class Vv extends dv{constructor(t,I){super(t,I);k(this,ca);k(this,tC,void 0);k(this,$s,void 0);k(this,zI,void 0);k(this,iI,void 0);k(this,Ht,void 0);k(this,mt,void 0);k(this,Xe,void 0);p(this,$s,1),p(this,tC,Object.assign({},oV,I||{})),p(this,zI,[]),p(this,iI,null),p(this,mt,null),p(this,Xe,null);{let l=null;const C=new Promise(s=>{l=s});p(this,Ht,{promise:C,resolve:l})}const n=this._getOption("staticNetwork");typeof n=="boolean"?(V(!n||t!=="any","staticNetwork cannot be used on special network 'any'","options",I),n&&t!=null&&p(this,mt,uI.from(t))):n&&(V(t==null||n.matches(t),"staticNetwork MUST match network object","options",I),p(this,mt,n))}_getOption(t){return d(this,tC)[t]}get _network(){return H(d(this,mt),"network is not available yet","NETWORK_ERROR"),d(this,mt)}async _perform(t){if(t.method==="call"||t.method==="estimateGas"){let n=t.transaction;if(n&&n.type!=null&&q(n.type)&&n.maxFeePerGas==null&&n.maxPriorityFeePerGas==null){const l=await this.getFeeData();l.maxFeePerGas==null&&l.maxPriorityFeePerGas==null&&(t=Object.assign({},t,{transaction:Object.assign({},n,{type:void 0})}))}}const I=this.getRpcRequest(t);return I!=null?await this.send(I.method,I.args):super._perform(t)}async _detectNetwork(){const t=this._getOption("staticNetwork");if(t)if(t===!0){if(d(this,mt))return d(this,mt)}else return t;return d(this,Xe)?await d(this,Xe):this.ready?(p(this,Xe,(async()=>{try{const I=uI.from(q(await this.send("eth_chainId",[])));return p(this,Xe,null),I}catch(I){throw p(this,Xe,null),I}})()),await d(this,Xe)):(p(this,Xe,(async()=>{const I={id:Xr(this,$s)._++,method:"eth_chainId",params:[],jsonrpc:"2.0"};this.emit("debug",{action:"sendRpcPayload",payload:I});let n;try{n=(await this._send(I))[0],p(this,Xe,null)}catch(l){throw p(this,Xe,null),this.emit("debug",{action:"receiveRpcError",error:l}),l}if(this.emit("debug",{action:"receiveRpcResult",result:n}),"result"in n)return uI.from(q(n.result));throw this.getRpcError(I,n)})()),await d(this,Xe))}_start(){d(this,Ht)==null||d(this,Ht).resolve==null||(d(this,Ht).resolve(),p(this,Ht,null),(async()=>{for(;d(this,mt)==null&&!this.destroyed;)try{p(this,mt,await this._detectNetwork())}catch(t){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",Bg("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:t}})),await fv(1e3)}E(this,ca,dm).call(this)})())}async _waitUntilReady(){if(d(this,Ht)!=null)return await d(this,Ht).promise}_getSubscriber(t){return t.type==="pending"?new pv(this):t.type==="event"?this._getOption("polling")?new jh(this,t.filter):new Gv(this,t.filter):t.type==="orphan"&&t.filter.orphan==="drop-log"?new rV("orphan"):super._getSubscriber(t)}get ready(){return d(this,Ht)==null}getRpcTransaction(t){const I={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(n=>{if(t[n]==null)return;let l=n;n==="gasLimit"&&(l="gas"),I[l]=Kt(q(t[n],`tx.${n}`))}),["from","to","data"].forEach(n=>{t[n]!=null&&(I[n]=D(t[n]))}),t.accessList&&(I.accessList=fC(t.accessList)),t.blobVersionedHashes&&(I.blobVersionedHashes=t.blobVersionedHashes.map(n=>n.toLowerCase())),t.authorizationList&&(I.authorizationList=t.authorizationList.map(n=>{const l=cf(n);return{address:l.address,nonce:Kt(l.nonce),chainId:Kt(l.chainId),yParity:Kt(l.signature.yParity),r:Kt(l.signature.r),s:Kt(l.signature.s)}})),I}getRpcRequest(t){switch(t.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[JC(t.address),t.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[JC(t.address),t.blockTag]};case"getCode":return{method:"eth_getCode",args:[JC(t.address),t.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[JC(t.address),"0x"+t.position.toString(16),t.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[t.signedTransaction]};case"getBlock":if("blockTag"in t)return{method:"eth_getBlockByNumber",args:[t.blockTag,!!t.includeTransactions]};if("blockHash"in t)return{method:"eth_getBlockByHash",args:[t.blockHash,!!t.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[t.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[t.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(t.transaction),t.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(t.transaction)]};case"getLogs":return t.filter&&t.filter.address!=null&&(Array.isArray(t.filter.address)?t.filter.address=t.filter.address.map(JC):t.filter.address=JC(t.filter.address)),{method:"eth_getLogs",args:[t.filter]}}return null}getRpcError(t,I){const{method:n}=t,{error:l}=I;if(n==="eth_estimateGas"&&l.message){const r=l.message;if(!r.match(/revert/i)&&r.match(/insufficient funds/i))return Bg("insufficient funds","INSUFFICIENT_FUNDS",{transaction:t.params[0],info:{payload:t,error:l}});if(r.match(/nonce/i)&&r.match(/too low/i))return Bg("nonce has already been used","NONCE_EXPIRED",{transaction:t.params[0],info:{payload:t,error:l}})}if(n==="eth_call"||n==="eth_estimateGas"){const r=um(l),a=Fi.getBuiltinCallException(n==="eth_call"?"call":"estimateGas",t.params[0],r?r.data:null);return a.info={error:l,payload:t},a}const C=JSON.stringify(Wv(l));if(typeof l.message=="string"&&l.message.match(/user denied|ethers-user-denied/i))return Bg("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[n]||"unknown",reason:"rejected",info:{payload:t,error:l}});if(n==="eth_sendRawTransaction"||n==="eth_sendTransaction"){const r=t.params[0];if(C.match(/insufficient funds|base fee exceeds gas limit/i))return Bg("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:r,info:{error:l}});if(C.match(/nonce/i)&&C.match(/too low/i))return Bg("nonce has already been used","NONCE_EXPIRED",{transaction:r,info:{error:l}});if(C.match(/replacement transaction/i)&&C.match(/underpriced/i))return Bg("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:r,info:{error:l}});if(C.match(/only replay-protected/i))return Bg("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:n,info:{transaction:r,info:{error:l}}})}let s=!!C.match(/the method .* does not exist/i);return s||l&&l.details&&l.details.startsWith("Unauthorized method:")&&(s=!0),s?Bg("unsupported operation","UNSUPPORTED_OPERATION",{operation:t.method,info:{error:l,payload:t}}):Bg("could not coalesce error","UNKNOWN_ERROR",{error:l,payload:t})}send(t,I){if(this.destroyed)return Promise.reject(Bg("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t}));const n=Xr(this,$s)._++,l=new Promise((C,s)=>{d(this,zI).push({resolve:C,reject:s,payload:{method:t,params:I,id:n,jsonrpc:"2.0"}})});return E(this,ca,dm).call(this),l}async getSigner(t){t==null&&(t=0);const I=this.send("eth_accounts",[]);if(typeof t=="number"){const l=await I;if(t>=l.length)throw new Error("no such account");return new Xd(this,l[t])}const{accounts:n}=await Ze({network:this.getNetwork(),accounts:I});t=ag(t);for(const l of n)if(ag(l)===t)return new Xd(this,t);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(I=>new Xd(this,I))}destroy(){d(this,iI)&&(clearTimeout(d(this,iI)),p(this,iI,null));for(const{payload:t,reject:I}of d(this,zI))I(Bg("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t.method}));p(this,zI,[]),super.destroy()}}tC=new WeakMap,$s=new WeakMap,zI=new WeakMap,iI=new WeakMap,Ht=new WeakMap,mt=new WeakMap,Xe=new WeakMap,ca=new WeakSet,dm=function(){if(d(this,iI))return;const t=this._getOption("batchMaxCount")===1?0:this._getOption("batchStallTime");p(this,iI,setTimeout(()=>{p(this,iI,null);const I=d(this,zI);for(p(this,zI,[]);I.length;){const n=[I.shift()];for(;I.length&&n.length!==d(this,tC).batchMaxCount;)if(n.push(I.shift()),JSON.stringify(n.map(C=>C.payload)).length>d(this,tC).batchMaxSize){I.unshift(n.pop());break}(async()=>{const l=n.length===1?n[0].payload:n.map(C=>C.payload);this.emit("debug",{action:"sendRpcPayload",payload:l});try{const C=await this._send(l);this.emit("debug",{action:"receiveRpcResult",result:C});for(const{resolve:s,reject:r,payload:a}of n){if(this.destroyed){r(Bg("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:a.method}));continue}const o=C.filter(c=>c.id===a.id)[0];if(o==null){const c=Bg("missing response for request","BAD_DATA",{value:C,info:{payload:a}});this.emit("error",c),r(c);continue}if("error"in o){r(this.getRpcError(a,o));continue}s(o.result)}}catch(C){this.emit("debug",{action:"receiveRpcError",error:C});for(const{reject:s}of n)s(C)}})()}},t))};var Kn;class cV extends Vv{constructor(t,I){super(t,I);k(this,Kn,void 0);let n=this._getOption("pollingInterval");n==null&&(n=oV.pollingInterval),p(this,Kn,n)}_getSubscriber(t){const I=super._getSubscriber(t);return qZ(I)&&(I.pollingInterval=d(this,Kn)),I}get pollingInterval(){return d(this,Kn)}set pollingInterval(t){if(!Number.isInteger(t)||t<0)throw new Error("invalid interval");p(this,Kn,t),this._forEachSubscriber(I=>{qZ(I)&&(I.pollingInterval=d(this,Kn))})}}Kn=new WeakMap;var gr;class AV extends cV{constructor(t,I,n){t==null&&(t="http://localhost:8545");super(I,n);k(this,gr,void 0);typeof t=="string"?p(this,gr,new In(t)):p(this,gr,t.clone())}_getConnection(){return d(this,gr).clone()}async send(t,I){return await this._start(),await super.send(t,I)}async _send(t){const I=this._getConnection();I.body=JSON.stringify(t),I.setHeader("content-type","application/json");const n=await I.send();n.assertOk();let l=n.bodyJson;return Array.isArray(l)||(l=[l]),l}}gr=new WeakMap;function um(e){if(e==null)return null;if(typeof e.message=="string"&&e.message.match(/revert/i)&&Zg(e.data))return{message:e.message,data:e.data};if(typeof e=="object"){for(const g in e){const t=um(e[g]);if(t)return t}return null}if(typeof e=="string")try{return um(JSON.parse(e))}catch{}return null}function mm(e,g){if(e!=null){if(typeof e.message=="string"&&g.push(e.message),typeof e=="object")for(const t in e)mm(e[t],g);if(typeof e=="string")try{return mm(JSON.parse(e),g)}catch{}}}function Wv(e){const g=[];return mm(e,g),g}var er,tr;const Wl=class Wl extends cV{constructor(t,I,n){const l=Object.assign({},n??{},{batchMaxCount:1});V(t&&t.request,"invalid EIP-1193 provider","ethereum",t);super(I,l);k(this,er,void 0);k(this,tr,void 0);p(this,tr,null),n&&n.providerInfo&&p(this,tr,n.providerInfo),p(this,er,async(C,s)=>{const r={method:C,params:s};this.emit("debug",{action:"sendEip1193Request",payload:r});try{const a=await t.request(r);return this.emit("debug",{action:"receiveEip1193Result",result:a}),a}catch(a){const o=new Error(a.message);throw o.code=a.code,o.data=a.data,o.payload=r,this.emit("debug",{action:"receiveEip1193Error",error:o}),o}})}get providerInfo(){return d(this,tr)}async send(t,I){return await this._start(),await super.send(t,I)}async _send(t){V(!Array.isArray(t),"EIP-1193 does not support batch request","payload",t);try{const I=await d(this,er).call(this,t.method,t.params||[]);return[{id:t.id,result:I}]}catch(I){return[{id:t.id,error:{code:I.code,data:I.data,message:I.message}}]}}getRpcError(t,I){switch(I=JSON.parse(JSON.stringify(I)),I.error.code||-1){case 4001:I.error.message=`ethers-user-denied: ${I.error.message}`;break;case 4200:I.error.message=`ethers-unsupported: ${I.error.message}`;break}return super.getRpcError(t,I)}async hasSigner(t){t==null&&(t=0);const I=await this.send("eth_accounts",[]);return typeof t=="number"?I.length>t:(t=t.toLowerCase(),I.filter(n=>n.toLowerCase()===t).length!==0)}async getSigner(t){if(t==null&&(t=0),!await this.hasSigner(t))try{await d(this,er).call(this,"eth_requestAccounts",[])}catch(I){const n=I.payload;throw this.getRpcError(n,{id:n.id,error:I})}return await super.getSigner(t)}static async discover(t){if(t==null&&(t={}),t.provider)return new Wl(t.provider);const I=t.window?t.window:typeof window<"u"?window:null;if(I==null)return null;const n=t.anyProvider;if(n&&I.ethereum)return new Wl(I.ethereum);if(!("addEventListener"in I&&"dispatchEvent"in I&&"removeEventListener"in I))return null;const l=t.timeout?t.timeout:300;return l===0?null:await new Promise((C,s)=>{let r=[];const a=A=>{r.push(A.detail),n&&o()},o=()=>{if(clearTimeout(c),r.length)if(t&&t.filter){const A=t.filter(r.map(b=>Object.assign({},b.info)));if(A==null)C(null);else if(A instanceof Wl)C(A);else{let b=null;if(A.uuid&&(b=r.filter(Z=>A.uuid===Z.info.uuid)[0]),b){const{provider:m,info:Z}=b;C(new Wl(m,void 0,{providerInfo:Z}))}else s(Bg("filter returned unknown info","UNSUPPORTED_OPERATION",{value:A}))}}else{const{provider:A,info:b}=r[0];C(new Wl(A,void 0,{providerInfo:b}))}else C(null);I.removeEventListener("eip6963:announceProvider",a)},c=setTimeout(()=>{o()},l);I.addEventListener("eip6963:announceProvider",a),I.dispatchEvent(new Event("eip6963:requestProvider"))})}};er=new WeakMap,tr=new WeakMap;let Ei=Wl;const Sv="0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0",Rv=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"gatekeeper",type:"address"},{indexed:!1,internalType:"bool",name:"status",type:"bool"}],name:"GatekeeperUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Paused",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"ticketId",type:"uint256"},{indexed:!1,internalType:"string",name:"eventName",type:"string"},{indexed:!0,internalType:"address",name:"seller",type:"address"},{indexed:!1,internalType:"uint256",name:"price",type:"uint256"},{indexed:!1,internalType:"uint256",name:"eventDate",type:"uint256"}],name:"TicketCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"ticketId",type:"uint256"},{indexed:!0,internalType:"address",name:"buyer",type:"address"}],name:"TicketDownloaded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"ticketId",type:"uint256"},{indexed:!0,internalType:"address",name:"buyer",type:"address"},{indexed:!1,internalType:"uint256",name:"price",type:"uint256"}],name:"TicketPurchased",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"ticketId",type:"uint256"},{indexed:!0,internalType:"address",name:"buyer",type:"address"},{indexed:!1,internalType:"uint256",name:"refundAmount",type:"uint256"}],name:"TicketRefunded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"ticketId",type:"uint256"},{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"address",name:"executedBy",type:"address"}],name:"TicketTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"ticketId",type:"uint256"},{indexed:!0,internalType:"address",name:"buyer",type:"address"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"TicketUsed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Unpaused",type:"event"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"ticketId",type:"uint256"}],name:"buyTicket",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"string",name:"eventName",type:"string"},{internalType:"string",name:"organizer",type:"string"},{internalType:"uint256",name:"eventDate",type:"uint256"},{internalType:"uint256",name:"saleEndDate",type:"uint256"},{internalType:"uint256",name:"price",type:"uint256"},{internalType:"uint256",name:"totalTickets",type:"uint256"},{internalType:"string",name:"posterCID",type:"string"},{internalType:"string",name:"ticketCID",type:"string"}],name:"createSale",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"ticketId",type:"uint256"}],name:"downloadTicket",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"",type:"string"}],name:"eventToTicketId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getAvailableTickets",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getMyTickets",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"ticketId",type:"uint256"}],name:"getTicket",outputs:[{components:[{internalType:"uint256",name:"ticketId",type:"uint256"},{internalType:"string",name:"eventName",type:"string"},{internalType:"string",name:"organizer",type:"string"},{internalType:"uint256",name:"eventDate",type:"uint256"},{internalType:"uint256",name:"saleEndDate",type:"uint256"},{internalType:"uint256",name:"price",type:"uint256"},{internalType:"string",name:"posterUrl",type:"string"},{internalType:"string",name:"ticketImageUrl",type:"string"},{internalType:"address",name:"seller",type:"address"},{internalType:"address",name:"buyer",type:"address"},{internalType:"bool",name:"isSold",type:"bool"},{internalType:"bool",name:"isDownloaded",type:"bool"},{internalType:"bool",name:"isRefunded",type:"bool"},{internalType:"bool",name:"isSecondHand",type:"bool"},{internalType:"uint256",name:"totalTickets",type:"uint256"},{internalType:"uint256",name:"availableTickets",type:"uint256"}],internalType:"struct TicketSale.Ticket",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"ticketId",type:"uint256"}],name:"getTicketEntryTime",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"string",name:"",type:"string"}],name:"hasBoughtTicketForEvent",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"ticketId",type:"uint256"}],name:"hasTicketBeenUsed",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"isGatekeeper",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"ticketId",type:"uint256"}],name:"markTicketUsed",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"ticketId",type:"uint256"}],name:"organizerTransferTicket",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"pause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"ticketId",type:"uint256"},{internalType:"uint256",name:"newTotalTickets",type:"uint256"}],name:"resetTicketQuantities",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"gatekeeper",type:"address"},{internalType:"bool",name:"status",type:"bool"}],name:"setGatekeeper",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"ticketEntryTime",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"tickets",outputs:[{internalType:"uint256",name:"ticketId",type:"uint256"},{internalType:"string",name:"eventName",type:"string"},{internalType:"string",name:"organizer",type:"string"},{internalType:"uint256",name:"eventDate",type:"uint256"},{internalType:"uint256",name:"saleEndDate",type:"uint256"},{internalType:"uint256",name:"price",type:"uint256"},{internalType:"string",name:"posterUrl",type:"string"},{internalType:"string",name:"ticketImageUrl",type:"string"},{internalType:"address",name:"seller",type:"address"},{internalType:"address",name:"buyer",type:"address"},{internalType:"bool",name:"isSold",type:"bool"},{internalType:"bool",name:"isDownloaded",type:"bool"},{internalType:"bool",name:"isRefunded",type:"bool"},{internalType:"bool",name:"isSecondHand",type:"bool"},{internalType:"uint256",name:"totalTickets",type:"uint256"},{internalType:"uint256",name:"availableTickets",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unpause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"updateExpiredTickets",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"userHasPurchased",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"userPurchases",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"ticketId",type:"uint256"}],name:"verifyTicket",outputs:[{internalType:"bool",name:"isValid",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"}],kv="localhost",Xv="2026-01-30T18:15:31.882Z",Lt={address:Sv,abi:Rv,network:kv,deployedAt:Xv},Ph=Lt.address,dV=typeof Lt.abi=="string"?JSON.parse(Lt.abi):Lt.abi;console.log("Contract address from JSON:",Ph);console.log("Contract version:",Lt.version||"No version");const Jv={sepolia:{chainId:"0xaa36a7",chainName:"Sepolia Test Network",rpcUrls:["https://sepolia.infura.io/v3/"],blockExplorerUrls:["https://sepolia.etherscan.io/"],nativeCurrency:{name:"SepoliaETH",symbol:"ETH",decimals:18}},localhost:{chainId:"0x7a69",chainName:"Localhost",rpcUrls:["http://127.0.0.1:8545"],blockExplorerUrls:[],nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18}}};function OI(){return typeof window.ethereum<"u"&&window.ethereum.isMetaMask}async function wv(){if(!OI())throw new Error("MetaMask is not installed. Please install MetaMask to continue.");try{return(await window.ethereum.request({method:"eth_requestAccounts"}))[0]}catch(e){throw e.code===4001?new Error("User rejected the connection request."):new Error("Failed to connect wallet: "+e.message)}}async function Yv(){if(!OI())return null;try{const e=await window.ethereum.request({method:"eth_accounts"});return e.length>0?e[0]:null}catch(e){return console.error("Error getting current account:",e),null}}async function Io(){if(!OI())throw new Error("MetaMask is not installed");try{return await window.ethereum.request({method:"eth_chainId"})}catch(e){throw new Error("Failed to get chain ID: "+e.message)}}async function _Z(e){if(!OI())throw new Error("MetaMask is not installed");const g=Jv[e];if(!g)throw new Error(`Network ${e} not supported`);try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:g.chainId}]})}catch(t){if(t.code===4902)try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[g]})}catch(I){throw new Error("Failed to add network: "+I.message)}else throw new Error("Failed to switch network: "+t.message)}}async function gl(){if(!window.ethereum)throw new Error("MetaMask is not installed");try{const e=new Ei(window.ethereum);await e.getBlockNumber();const g=await e.getSigner();return new rC(Ph,dV,g)}catch(e){throw e.message.includes("circuit breaker")||e.message.includes("Execution prevented")?new Error("MetaMask circuit breaker is open. Please wait a moment and try again, or refresh the page."):e}}function mI(){{const e=new AV("http://127.0.0.1:8545");return new rC(Ph,dV,e)}}function vv(){return new AV("http://127.0.0.1:8545")}function gt(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}function Wc(e,g=4){return e?parseFloat(fB(e)).toFixed(g):"0"}function $Z(e){return aX(e)}function Nv(e){return OI()?(window.ethereum.on("accountsChanged",e),()=>{window.ethereum.removeListener("accountsChanged",e)}):()=>{}}function Hv(e){return OI()?(window.ethereum.on("chainChanged",e),()=>{window.ethereum.removeListener("chainChanged",e)}):()=>{}}function wC(e){switch(e){case"0xaa36a7":return"Sepolia";case"0x539":return"Localhost";case"0x7a69":return"Localhost";case"0x1":return"Mainnet";default:return"Unknown"}}function no(e){return["0xaa36a7","0x539","0x7a69"].includes(e)}const uV=B.createContext(),ft=()=>{const e=B.useContext(uV);if(!e)throw new Error("useWeb3 must be used within a Web3Provider");return e},Fv=({children:e})=>{const[g,t]=B.useState(null),[I,n]=B.useState(null),[l,C]=B.useState(!1),[s,r]=B.useState(!1),[a,o]=B.useState("");B.useEffect(()=>{(async()=>{if(OI())try{const Z=await Yv(),G=await Io();if(Z&&(t(Z),n(G),C(!0),o(wC(G)),!no(G)))try{await _Z("localhost");const h=await Io();n(h),o(wC(h)),K.success("Switched to Localhost network")}catch{K.error("Please switch to Localhost or Sepolia in MetaMask")}}catch(Z){console.error("Error checking connection:",Z)}})()},[]),B.useEffect(()=>{if(!OI())return;const m=u=>{u.length===0?(t(null),C(!1),K.error("Wallet disconnected")):(t(u[0]),C(!0),K.success("Wallet connected"))},Z=u=>{n(u),o(wC(u)),no(u)?K.success(`Switched to ${wC(u)}`):K.error("Unsupported network. Please switch to Sepolia or Localhost.")},G=Nv(m),h=Hv(Z);return()=>{G(),h()}},[]);const b={account:g,chainId:I,isConnected:l,isLoading:s,networkName:a,connect:async()=>{if(!OI()){K.error("MetaMask is not installed. Please install MetaMask to continue.");return}r(!0);try{const m=await wv(),Z=await Io();if(t(m),n(Z),C(!0),o(wC(Z)),no(Z))K.success("Wallet connected successfully");else try{await _Z("localhost");const G=await Io();n(G),o(wC(G)),K.success("Switched to Localhost network")}catch{K.error("Please switch to Sepolia or Localhost network")}}catch(m){K.error(m.message)}finally{r(!1)}},disconnect:()=>{t(null),n(null),C(!1),o(""),K.success("Wallet disconnected")},isSupportedNetwork:no(I)};return i.jsx(uV.Provider,{value:b,children:e})};function mV(e,g){return function(){return e.apply(g,arguments)}}const{toString:xv}=Object.prototype,{getPrototypeOf:Oh}=Object,{iterator:ZA,toStringTag:hV}=Symbol,yA=(e=>g=>{const t=xv.call(g);return e[t]||(e[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Pt=e=>(e=e.toLowerCase(),g=>yA(g)===e),GA=e=>g=>typeof g===e,{isArray:Rr}=Array,Zr=GA("undefined");function Va(e){return e!==null&&!Zr(e)&&e.constructor!==null&&!Zr(e.constructor)&&Ke(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const bV=Pt("ArrayBuffer");function Kv(e){let g;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?g=ArrayBuffer.isView(e):g=e&&e.buffer&&bV(e.buffer),g}const Ev=GA("string"),Ke=GA("function"),ZV=GA("number"),Wa=e=>e!==null&&typeof e=="object",Uv=e=>e===!0||e===!1,No=e=>{if(yA(e)!=="object")return!1;const g=Oh(e);return(g===null||g===Object.prototype||Object.getPrototypeOf(g)===null)&&!(hV in e)&&!(ZA in e)},zv=e=>{if(!Wa(e)||Va(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Qv=Pt("Date"),Lv=Pt("File"),Tv=Pt("Blob"),Mv=Pt("FileList"),Dv=e=>Wa(e)&&Ke(e.pipe),jv=e=>{let g;return e&&(typeof FormData=="function"&&e instanceof FormData||Ke(e.append)&&((g=yA(e))==="formdata"||g==="object"&&Ke(e.toString)&&e.toString()==="[object FormData]"))},Pv=Pt("URLSearchParams"),[Ov,qv,_v,$v]=["ReadableStream","Request","Response","Headers"].map(Pt),gN=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Sa(e,g,{allOwnKeys:t=!1}={}){if(e===null||typeof e>"u")return;let I,n;if(typeof e!="object"&&(e=[e]),Rr(e))for(I=0,n=e.length;I<n;I++)g.call(null,e[I],I,e);else{if(Va(e))return;const l=t?Object.getOwnPropertyNames(e):Object.keys(e),C=l.length;let s;for(I=0;I<C;I++)s=l[I],g.call(null,e[s],s,e)}}function yV(e,g){if(Va(e))return null;g=g.toLowerCase();const t=Object.keys(e);let I=t.length,n;for(;I-- >0;)if(n=t[I],g===n.toLowerCase())return n;return null}const vl=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),GV=e=>!Zr(e)&&e!==vl;function hm(){const{caseless:e,skipUndefined:g}=GV(this)&&this||{},t={},I=(n,l)=>{const C=e&&yV(t,l)||l;No(t[C])&&No(n)?t[C]=hm(t[C],n):No(n)?t[C]=hm({},n):Rr(n)?t[C]=n.slice():(!g||!Zr(n))&&(t[C]=n)};for(let n=0,l=arguments.length;n<l;n++)arguments[n]&&Sa(arguments[n],I);return t}const eN=(e,g,t,{allOwnKeys:I}={})=>(Sa(g,(n,l)=>{t&&Ke(n)?e[l]=mV(n,t):e[l]=n},{allOwnKeys:I}),e),tN=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),IN=(e,g,t,I)=>{e.prototype=Object.create(g.prototype,I),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:g.prototype}),t&&Object.assign(e.prototype,t)},nN=(e,g,t,I)=>{let n,l,C;const s={};if(g=g||{},e==null)return g;do{for(n=Object.getOwnPropertyNames(e),l=n.length;l-- >0;)C=n[l],(!I||I(C,e,g))&&!s[C]&&(g[C]=e[C],s[C]=!0);e=t!==!1&&Oh(e)}while(e&&(!t||t(e,g))&&e!==Object.prototype);return g},lN=(e,g,t)=>{e=String(e),(t===void 0||t>e.length)&&(t=e.length),t-=g.length;const I=e.indexOf(g,t);return I!==-1&&I===t},CN=e=>{if(!e)return null;if(Rr(e))return e;let g=e.length;if(!ZV(g))return null;const t=new Array(g);for(;g-- >0;)t[g]=e[g];return t},sN=(e=>g=>e&&g instanceof e)(typeof Uint8Array<"u"&&Oh(Uint8Array)),rN=(e,g)=>{const I=(e&&e[ZA]).call(e);let n;for(;(n=I.next())&&!n.done;){const l=n.value;g.call(e,l[0],l[1])}},iN=(e,g)=>{let t;const I=[];for(;(t=e.exec(g))!==null;)I.push(t);return I},aN=Pt("HTMLFormElement"),oN=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,I,n){return I.toUpperCase()+n}),gy=(({hasOwnProperty:e})=>(g,t)=>e.call(g,t))(Object.prototype),cN=Pt("RegExp"),pV=(e,g)=>{const t=Object.getOwnPropertyDescriptors(e),I={};Sa(t,(n,l)=>{let C;(C=g(n,l,e))!==!1&&(I[l]=C||n)}),Object.defineProperties(e,I)},AN=e=>{pV(e,(g,t)=>{if(Ke(e)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const I=e[t];if(Ke(I)){if(g.enumerable=!1,"writable"in g){g.writable=!1;return}g.set||(g.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},dN=(e,g)=>{const t={},I=n=>{n.forEach(l=>{t[l]=!0})};return Rr(e)?I(e):I(String(e).split(g)),t},uN=()=>{},mN=(e,g)=>e!=null&&Number.isFinite(e=+e)?e:g;function hN(e){return!!(e&&Ke(e.append)&&e[hV]==="FormData"&&e[ZA])}const bN=e=>{const g=new Array(10),t=(I,n)=>{if(Wa(I)){if(g.indexOf(I)>=0)return;if(Va(I))return I;if(!("toJSON"in I)){g[n]=I;const l=Rr(I)?[]:{};return Sa(I,(C,s)=>{const r=t(C,n+1);!Zr(r)&&(l[s]=r)}),g[n]=void 0,l}}return I};return t(e,0)},ZN=Pt("AsyncFunction"),yN=e=>e&&(Wa(e)||Ke(e))&&Ke(e.then)&&Ke(e.catch),BV=((e,g)=>e?setImmediate:g?((t,I)=>(vl.addEventListener("message",({source:n,data:l})=>{n===vl&&l===t&&I.length&&I.shift()()},!1),n=>{I.push(n),vl.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Ke(vl.postMessage)),GN=typeof queueMicrotask<"u"?queueMicrotask.bind(vl):typeof process<"u"&&process.nextTick||BV,pN=e=>e!=null&&Ke(e[ZA]),w={isArray:Rr,isArrayBuffer:bV,isBuffer:Va,isFormData:jv,isArrayBufferView:Kv,isString:Ev,isNumber:ZV,isBoolean:Uv,isObject:Wa,isPlainObject:No,isEmptyObject:zv,isReadableStream:Ov,isRequest:qv,isResponse:_v,isHeaders:$v,isUndefined:Zr,isDate:Qv,isFile:Lv,isBlob:Tv,isRegExp:cN,isFunction:Ke,isStream:Dv,isURLSearchParams:Pv,isTypedArray:sN,isFileList:Mv,forEach:Sa,merge:hm,extend:eN,trim:gN,stripBOM:tN,inherits:IN,toFlatObject:nN,kindOf:yA,kindOfTest:Pt,endsWith:lN,toArray:CN,forEachEntry:rN,matchAll:iN,isHTMLForm:aN,hasOwnProperty:gy,hasOwnProp:gy,reduceDescriptors:pV,freezeMethods:AN,toObjectSet:dN,toCamelCase:oN,noop:uN,toFiniteNumber:mN,findKey:yV,global:vl,isContextDefined:GV,isSpecCompliantForm:hN,toJSONObject:bN,isAsyncFn:ZN,isThenable:yN,setImmediate:BV,asap:GN,isIterable:pN};function lg(e,g,t,I,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",g&&(this.code=g),t&&(this.config=t),I&&(this.request=I),n&&(this.response=n,this.status=n.status?n.status:null)}w.inherits(lg,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:w.toJSONObject(this.config),code:this.code,status:this.status}}});const fV=lg.prototype,VV={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{VV[e]={value:e}});Object.defineProperties(lg,VV);Object.defineProperty(fV,"isAxiosError",{value:!0});lg.from=(e,g,t,I,n,l)=>{const C=Object.create(fV);w.toFlatObject(e,C,function(o){return o!==Error.prototype},a=>a!=="isAxiosError");const s=e&&e.message?e.message:"Error",r=g==null&&e?e.code:g;return lg.call(C,s,r,t,I,n),e&&C.cause==null&&Object.defineProperty(C,"cause",{value:e,configurable:!0}),C.name=e&&e.name||"Error",l&&Object.assign(C,l),C};const BN=null;function bm(e){return w.isPlainObject(e)||w.isArray(e)}function WV(e){return w.endsWith(e,"[]")?e.slice(0,-2):e}function ey(e,g,t){return e?e.concat(g).map(function(n,l){return n=WV(n),!t&&l?"["+n+"]":n}).join(t?".":""):g}function fN(e){return w.isArray(e)&&!e.some(bm)}const VN=w.toFlatObject(w,{},null,function(g){return/^is[A-Z]/.test(g)});function pA(e,g,t){if(!w.isObject(e))throw new TypeError("target must be an object");g=g||new FormData,t=w.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Z,G){return!w.isUndefined(G[Z])});const I=t.metaTokens,n=t.visitor||o,l=t.dots,C=t.indexes,r=(t.Blob||typeof Blob<"u"&&Blob)&&w.isSpecCompliantForm(g);if(!w.isFunction(n))throw new TypeError("visitor must be a function");function a(m){if(m===null)return"";if(w.isDate(m))return m.toISOString();if(w.isBoolean(m))return m.toString();if(!r&&w.isBlob(m))throw new lg("Blob is not supported. Use a Buffer instead.");return w.isArrayBuffer(m)||w.isTypedArray(m)?r&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function o(m,Z,G){let h=m;if(m&&!G&&typeof m=="object"){if(w.endsWith(Z,"{}"))Z=I?Z:Z.slice(0,-2),m=JSON.stringify(m);else if(w.isArray(m)&&fN(m)||(w.isFileList(m)||w.endsWith(Z,"[]"))&&(h=w.toArray(m)))return Z=WV(Z),h.forEach(function(y,W){!(w.isUndefined(y)||y===null)&&g.append(C===!0?ey([Z],W,l):C===null?Z:Z+"[]",a(y))}),!1}return bm(m)?!0:(g.append(ey(G,Z,l),a(m)),!1)}const c=[],A=Object.assign(VN,{defaultVisitor:o,convertValue:a,isVisitable:bm});function b(m,Z){if(!w.isUndefined(m)){if(c.indexOf(m)!==-1)throw Error("Circular reference detected in "+Z.join("."));c.push(m),w.forEach(m,function(h,u){(!(w.isUndefined(h)||h===null)&&n.call(g,h,w.isString(u)?u.trim():u,Z,A))===!0&&b(h,Z?Z.concat(u):[u])}),c.pop()}}if(!w.isObject(e))throw new TypeError("data must be an object");return b(e),g}function ty(e){const g={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(I){return g[I]})}function qh(e,g){this._pairs=[],e&&pA(e,this,g)}const SV=qh.prototype;SV.append=function(g,t){this._pairs.push([g,t])};SV.toString=function(g){const t=g?function(I){return g.call(this,I,ty)}:ty;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function WN(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function RV(e,g,t){if(!g)return e;const I=t&&t.encode||WN;w.isFunction(t)&&(t={serialize:t});const n=t&&t.serialize;let l;if(n?l=n(g,t):l=w.isURLSearchParams(g)?g.toString():new qh(g,t).toString(I),l){const C=e.indexOf("#");C!==-1&&(e=e.slice(0,C)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}class SN{constructor(){this.handlers=[]}use(g,t,I){return this.handlers.push({fulfilled:g,rejected:t,synchronous:I?I.synchronous:!1,runWhen:I?I.runWhen:null}),this.handlers.length-1}eject(g){this.handlers[g]&&(this.handlers[g]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(g){w.forEach(this.handlers,function(I){I!==null&&g(I)})}}const Iy=SN,kV={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},RN=typeof URLSearchParams<"u"?URLSearchParams:qh,kN=typeof FormData<"u"?FormData:null,XN=typeof Blob<"u"?Blob:null,JN={isBrowser:!0,classes:{URLSearchParams:RN,FormData:kN,Blob:XN},protocols:["http","https","file","blob","url","data"]},_h=typeof window<"u"&&typeof document<"u",Zm=typeof navigator=="object"&&navigator||void 0,wN=_h&&(!Zm||["ReactNative","NativeScript","NS"].indexOf(Zm.product)<0),YN=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),vN=_h&&window.location.href||"http://localhost",NN=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:_h,hasStandardBrowserEnv:wN,hasStandardBrowserWebWorkerEnv:YN,navigator:Zm,origin:vN},Symbol.toStringTag,{value:"Module"})),ce={...NN,...JN};function HN(e,g){return pA(e,new ce.classes.URLSearchParams,{visitor:function(t,I,n,l){return ce.isNode&&w.isBuffer(t)?(this.append(I,t.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...g})}function FN(e){return w.matchAll(/\w+|\[(\w*)]/g,e).map(g=>g[0]==="[]"?"":g[1]||g[0])}function xN(e){const g={},t=Object.keys(e);let I;const n=t.length;let l;for(I=0;I<n;I++)l=t[I],g[l]=e[l];return g}function XV(e){function g(t,I,n,l){let C=t[l++];if(C==="__proto__")return!0;const s=Number.isFinite(+C),r=l>=t.length;return C=!C&&w.isArray(n)?n.length:C,r?(w.hasOwnProp(n,C)?n[C]=[n[C],I]:n[C]=I,!s):((!n[C]||!w.isObject(n[C]))&&(n[C]=[]),g(t,I,n[C],l)&&w.isArray(n[C])&&(n[C]=xN(n[C])),!s)}if(w.isFormData(e)&&w.isFunction(e.entries)){const t={};return w.forEachEntry(e,(I,n)=>{g(FN(I),n,t,0)}),t}return null}function KN(e,g,t){if(w.isString(e))try{return(g||JSON.parse)(e),w.trim(e)}catch(I){if(I.name!=="SyntaxError")throw I}return(t||JSON.stringify)(e)}const $h={transitional:kV,adapter:["xhr","http","fetch"],transformRequest:[function(g,t){const I=t.getContentType()||"",n=I.indexOf("application/json")>-1,l=w.isObject(g);if(l&&w.isHTMLForm(g)&&(g=new FormData(g)),w.isFormData(g))return n?JSON.stringify(XV(g)):g;if(w.isArrayBuffer(g)||w.isBuffer(g)||w.isStream(g)||w.isFile(g)||w.isBlob(g)||w.isReadableStream(g))return g;if(w.isArrayBufferView(g))return g.buffer;if(w.isURLSearchParams(g))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),g.toString();let s;if(l){if(I.indexOf("application/x-www-form-urlencoded")>-1)return HN(g,this.formSerializer).toString();if((s=w.isFileList(g))||I.indexOf("multipart/form-data")>-1){const r=this.env&&this.env.FormData;return pA(s?{"files[]":g}:g,r&&new r,this.formSerializer)}}return l||n?(t.setContentType("application/json",!1),KN(g)):g}],transformResponse:[function(g){const t=this.transitional||$h.transitional,I=t&&t.forcedJSONParsing,n=this.responseType==="json";if(w.isResponse(g)||w.isReadableStream(g))return g;if(g&&w.isString(g)&&(I&&!this.responseType||n)){const C=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(g,this.parseReviver)}catch(s){if(C)throw s.name==="SyntaxError"?lg.from(s,lg.ERR_BAD_RESPONSE,this,null,this.response):s}}return g}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ce.classes.FormData,Blob:ce.classes.Blob},validateStatus:function(g){return g>=200&&g<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};w.forEach(["delete","get","head","post","put","patch"],e=>{$h.headers[e]={}});const g0=$h,EN=w.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),UN=e=>{const g={};let t,I,n;return e&&e.split(`
`).forEach(function(C){n=C.indexOf(":"),t=C.substring(0,n).trim().toLowerCase(),I=C.substring(n+1).trim(),!(!t||g[t]&&EN[t])&&(t==="set-cookie"?g[t]?g[t].push(I):g[t]=[I]:g[t]=g[t]?g[t]+", "+I:I)}),g},ny=Symbol("internals");function zr(e){return e&&String(e).trim().toLowerCase()}function Ho(e){return e===!1||e==null?e:w.isArray(e)?e.map(Ho):String(e)}function zN(e){const g=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let I;for(;I=t.exec(e);)g[I[1]]=I[2];return g}const QN=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Jd(e,g,t,I,n){if(w.isFunction(I))return I.call(this,g,t);if(n&&(g=t),!!w.isString(g)){if(w.isString(I))return g.indexOf(I)!==-1;if(w.isRegExp(I))return I.test(g)}}function LN(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(g,t,I)=>t.toUpperCase()+I)}function TN(e,g){const t=w.toCamelCase(" "+g);["get","set","has"].forEach(I=>{Object.defineProperty(e,I+t,{value:function(n,l,C){return this[I].call(this,g,n,l,C)},configurable:!0})})}class BA{constructor(g){g&&this.set(g)}set(g,t,I){const n=this;function l(s,r,a){const o=zr(r);if(!o)throw new Error("header name must be a non-empty string");const c=w.findKey(n,o);(!c||n[c]===void 0||a===!0||a===void 0&&n[c]!==!1)&&(n[c||r]=Ho(s))}const C=(s,r)=>w.forEach(s,(a,o)=>l(a,o,r));if(w.isPlainObject(g)||g instanceof this.constructor)C(g,t);else if(w.isString(g)&&(g=g.trim())&&!QN(g))C(UN(g),t);else if(w.isObject(g)&&w.isIterable(g)){let s={},r,a;for(const o of g){if(!w.isArray(o))throw TypeError("Object iterator must return a key-value pair");s[a=o[0]]=(r=s[a])?w.isArray(r)?[...r,o[1]]:[r,o[1]]:o[1]}C(s,t)}else g!=null&&l(t,g,I);return this}get(g,t){if(g=zr(g),g){const I=w.findKey(this,g);if(I){const n=this[I];if(!t)return n;if(t===!0)return zN(n);if(w.isFunction(t))return t.call(this,n,I);if(w.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(g,t){if(g=zr(g),g){const I=w.findKey(this,g);return!!(I&&this[I]!==void 0&&(!t||Jd(this,this[I],I,t)))}return!1}delete(g,t){const I=this;let n=!1;function l(C){if(C=zr(C),C){const s=w.findKey(I,C);s&&(!t||Jd(I,I[s],s,t))&&(delete I[s],n=!0)}}return w.isArray(g)?g.forEach(l):l(g),n}clear(g){const t=Object.keys(this);let I=t.length,n=!1;for(;I--;){const l=t[I];(!g||Jd(this,this[l],l,g,!0))&&(delete this[l],n=!0)}return n}normalize(g){const t=this,I={};return w.forEach(this,(n,l)=>{const C=w.findKey(I,l);if(C){t[C]=Ho(n),delete t[l];return}const s=g?LN(l):String(l).trim();s!==l&&delete t[l],t[s]=Ho(n),I[s]=!0}),this}concat(...g){return this.constructor.concat(this,...g)}toJSON(g){const t=Object.create(null);return w.forEach(this,(I,n)=>{I!=null&&I!==!1&&(t[n]=g&&w.isArray(I)?I.join(", "):I)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([g,t])=>g+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(g){return g instanceof this?g:new this(g)}static concat(g,...t){const I=new this(g);return t.forEach(n=>I.set(n)),I}static accessor(g){const I=(this[ny]=this[ny]={accessors:{}}).accessors,n=this.prototype;function l(C){const s=zr(C);I[s]||(TN(n,C),I[s]=!0)}return w.isArray(g)?g.forEach(l):l(g),this}}BA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);w.reduceDescriptors(BA.prototype,({value:e},g)=>{let t=g[0].toUpperCase()+g.slice(1);return{get:()=>e,set(I){this[t]=I}}});w.freezeMethods(BA);const Tt=BA;function wd(e,g){const t=this||g0,I=g||t,n=Tt.from(I.headers);let l=I.data;return w.forEach(e,function(s){l=s.call(t,l,n.normalize(),g?g.status:void 0)}),n.normalize(),l}function JV(e){return!!(e&&e.__CANCEL__)}function kr(e,g,t){lg.call(this,e??"canceled",lg.ERR_CANCELED,g,t),this.name="CanceledError"}w.inherits(kr,lg,{__CANCEL__:!0});function wV(e,g,t){const I=t.config.validateStatus;!t.status||!I||I(t.status)?e(t):g(new lg("Request failed with status code "+t.status,[lg.ERR_BAD_REQUEST,lg.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function MN(e){const g=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return g&&g[1]||""}function DN(e,g){e=e||10;const t=new Array(e),I=new Array(e);let n=0,l=0,C;return g=g!==void 0?g:1e3,function(r){const a=Date.now(),o=I[l];C||(C=a),t[n]=r,I[n]=a;let c=l,A=0;for(;c!==n;)A+=t[c++],c=c%e;if(n=(n+1)%e,n===l&&(l=(l+1)%e),a-C<g)return;const b=o&&a-o;return b?Math.round(A*1e3/b):void 0}}function jN(e,g){let t=0,I=1e3/g,n,l;const C=(a,o=Date.now())=>{t=o,n=null,l&&(clearTimeout(l),l=null),e(...a)};return[(...a)=>{const o=Date.now(),c=o-t;c>=I?C(a,o):(n=a,l||(l=setTimeout(()=>{l=null,C(n)},I-c)))},()=>n&&C(n)]}const Sc=(e,g,t=3)=>{let I=0;const n=DN(50,250);return jN(l=>{const C=l.loaded,s=l.lengthComputable?l.total:void 0,r=C-I,a=n(r),o=C<=s;I=C;const c={loaded:C,total:s,progress:s?C/s:void 0,bytes:r,rate:a||void 0,estimated:a&&s&&o?(s-C)/a:void 0,event:l,lengthComputable:s!=null,[g?"download":"upload"]:!0};e(c)},t)},ly=(e,g)=>{const t=e!=null;return[I=>g[0]({lengthComputable:t,total:e,loaded:I}),g[1]]},Cy=e=>(...g)=>w.asap(()=>e(...g)),PN=ce.hasStandardBrowserEnv?((e,g)=>t=>(t=new URL(t,ce.origin),e.protocol===t.protocol&&e.host===t.host&&(g||e.port===t.port)))(new URL(ce.origin),ce.navigator&&/(msie|trident)/i.test(ce.navigator.userAgent)):()=>!0,ON=ce.hasStandardBrowserEnv?{write(e,g,t,I,n,l,C){if(typeof document>"u")return;const s=[`${e}=${encodeURIComponent(g)}`];w.isNumber(t)&&s.push(`expires=${new Date(t).toUTCString()}`),w.isString(I)&&s.push(`path=${I}`),w.isString(n)&&s.push(`domain=${n}`),l===!0&&s.push("secure"),w.isString(C)&&s.push(`SameSite=${C}`),document.cookie=s.join("; ")},read(e){if(typeof document>"u")return null;const g=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return g?decodeURIComponent(g[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function qN(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function _N(e,g){return g?e.replace(/\/?\/$/,"")+"/"+g.replace(/^\/+/,""):e}function YV(e,g,t){let I=!qN(g);return e&&(I||t==!1)?_N(e,g):g}const sy=e=>e instanceof Tt?{...e}:e;function bC(e,g){g=g||{};const t={};function I(a,o,c,A){return w.isPlainObject(a)&&w.isPlainObject(o)?w.merge.call({caseless:A},a,o):w.isPlainObject(o)?w.merge({},o):w.isArray(o)?o.slice():o}function n(a,o,c,A){if(w.isUndefined(o)){if(!w.isUndefined(a))return I(void 0,a,c,A)}else return I(a,o,c,A)}function l(a,o){if(!w.isUndefined(o))return I(void 0,o)}function C(a,o){if(w.isUndefined(o)){if(!w.isUndefined(a))return I(void 0,a)}else return I(void 0,o)}function s(a,o,c){if(c in g)return I(a,o);if(c in e)return I(void 0,a)}const r={url:l,method:l,data:l,baseURL:C,transformRequest:C,transformResponse:C,paramsSerializer:C,timeout:C,timeoutMessage:C,withCredentials:C,withXSRFToken:C,adapter:C,responseType:C,xsrfCookieName:C,xsrfHeaderName:C,onUploadProgress:C,onDownloadProgress:C,decompress:C,maxContentLength:C,maxBodyLength:C,beforeRedirect:C,transport:C,httpAgent:C,httpsAgent:C,cancelToken:C,socketPath:C,responseEncoding:C,validateStatus:s,headers:(a,o,c)=>n(sy(a),sy(o),c,!0)};return w.forEach(Object.keys({...e,...g}),function(o){const c=r[o]||n,A=c(e[o],g[o],o);w.isUndefined(A)&&c!==s||(t[o]=A)}),t}const vV=e=>{const g=bC({},e);let{data:t,withXSRFToken:I,xsrfHeaderName:n,xsrfCookieName:l,headers:C,auth:s}=g;if(g.headers=C=Tt.from(C),g.url=RV(YV(g.baseURL,g.url,g.allowAbsoluteUrls),e.params,e.paramsSerializer),s&&C.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),w.isFormData(t)){if(ce.hasStandardBrowserEnv||ce.hasStandardBrowserWebWorkerEnv)C.setContentType(void 0);else if(w.isFunction(t.getHeaders)){const r=t.getHeaders(),a=["content-type","content-length"];Object.entries(r).forEach(([o,c])=>{a.includes(o.toLowerCase())&&C.set(o,c)})}}if(ce.hasStandardBrowserEnv&&(I&&w.isFunction(I)&&(I=I(g)),I||I!==!1&&PN(g.url))){const r=n&&l&&ON.read(l);r&&C.set(n,r)}return g},$N=typeof XMLHttpRequest<"u",gH=$N&&function(e){return new Promise(function(t,I){const n=vV(e);let l=n.data;const C=Tt.from(n.headers).normalize();let{responseType:s,onUploadProgress:r,onDownloadProgress:a}=n,o,c,A,b,m;function Z(){b&&b(),m&&m(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let G=new XMLHttpRequest;G.open(n.method.toUpperCase(),n.url,!0),G.timeout=n.timeout;function h(){if(!G)return;const y=Tt.from("getAllResponseHeaders"in G&&G.getAllResponseHeaders()),S={data:!s||s==="text"||s==="json"?G.responseText:G.response,status:G.status,statusText:G.statusText,headers:y,config:e,request:G};wV(function(f){t(f),Z()},function(f){I(f),Z()},S),G=null}"onloadend"in G?G.onloadend=h:G.onreadystatechange=function(){!G||G.readyState!==4||G.status===0&&!(G.responseURL&&G.responseURL.indexOf("file:")===0)||setTimeout(h)},G.onabort=function(){G&&(I(new lg("Request aborted",lg.ECONNABORTED,e,G)),G=null)},G.onerror=function(W){const S=W&&W.message?W.message:"Network Error",J=new lg(S,lg.ERR_NETWORK,e,G);J.event=W||null,I(J),G=null},G.ontimeout=function(){let W=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const S=n.transitional||kV;n.timeoutErrorMessage&&(W=n.timeoutErrorMessage),I(new lg(W,S.clarifyTimeoutError?lg.ETIMEDOUT:lg.ECONNABORTED,e,G)),G=null},l===void 0&&C.setContentType(null),"setRequestHeader"in G&&w.forEach(C.toJSON(),function(W,S){G.setRequestHeader(S,W)}),w.isUndefined(n.withCredentials)||(G.withCredentials=!!n.withCredentials),s&&s!=="json"&&(G.responseType=n.responseType),a&&([A,m]=Sc(a,!0),G.addEventListener("progress",A)),r&&G.upload&&([c,b]=Sc(r),G.upload.addEventListener("progress",c),G.upload.addEventListener("loadend",b)),(n.cancelToken||n.signal)&&(o=y=>{G&&(I(!y||y.type?new kr(null,e,G):y),G.abort(),G=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const u=MN(n.url);if(u&&ce.protocols.indexOf(u)===-1){I(new lg("Unsupported protocol "+u+":",lg.ERR_BAD_REQUEST,e));return}G.send(l||null)})},eH=(e,g)=>{const{length:t}=e=e?e.filter(Boolean):[];if(g||t){let I=new AbortController,n;const l=function(a){if(!n){n=!0,s();const o=a instanceof Error?a:this.reason;I.abort(o instanceof lg?o:new kr(o instanceof Error?o.message:o))}};let C=g&&setTimeout(()=>{C=null,l(new lg(`timeout ${g} of ms exceeded`,lg.ETIMEDOUT))},g);const s=()=>{e&&(C&&clearTimeout(C),C=null,e.forEach(a=>{a.unsubscribe?a.unsubscribe(l):a.removeEventListener("abort",l)}),e=null)};e.forEach(a=>a.addEventListener("abort",l));const{signal:r}=I;return r.unsubscribe=()=>w.asap(s),r}},tH=eH,IH=function*(e,g){let t=e.byteLength;if(!g||t<g){yield e;return}let I=0,n;for(;I<t;)n=I+g,yield e.slice(I,n),I=n},nH=async function*(e,g){for await(const t of lH(e))yield*IH(t,g)},lH=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const g=e.getReader();try{for(;;){const{done:t,value:I}=await g.read();if(t)break;yield I}}finally{await g.cancel()}},ry=(e,g,t,I)=>{const n=nH(e,g);let l=0,C,s=r=>{C||(C=!0,I&&I(r))};return new ReadableStream({async pull(r){try{const{done:a,value:o}=await n.next();if(a){s(),r.close();return}let c=o.byteLength;if(t){let A=l+=c;t(A)}r.enqueue(new Uint8Array(o))}catch(a){throw s(a),a}},cancel(r){return s(r),n.return()}},{highWaterMark:2})},iy=64*1024,{isFunction:lo}=w,CH=(({Request:e,Response:g})=>({Request:e,Response:g}))(w.global),{ReadableStream:ay,TextEncoder:oy}=w.global,cy=(e,...g)=>{try{return!!e(...g)}catch{return!1}},sH=e=>{e=w.merge.call({skipUndefined:!0},CH,e);const{fetch:g,Request:t,Response:I}=e,n=g?lo(g):typeof fetch=="function",l=lo(t),C=lo(I);if(!n)return!1;const s=n&&lo(ay),r=n&&(typeof oy=="function"?(m=>Z=>m.encode(Z))(new oy):async m=>new Uint8Array(await new t(m).arrayBuffer())),a=l&&s&&cy(()=>{let m=!1;const Z=new t(ce.origin,{body:new ay,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!Z}),o=C&&s&&cy(()=>w.isReadableStream(new I("").body)),c={stream:o&&(m=>m.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!c[m]&&(c[m]=(Z,G)=>{let h=Z&&Z[m];if(h)return h.call(Z);throw new lg(`Response type '${m}' is not supported`,lg.ERR_NOT_SUPPORT,G)})});const A=async m=>{if(m==null)return 0;if(w.isBlob(m))return m.size;if(w.isSpecCompliantForm(m))return(await new t(ce.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(w.isArrayBufferView(m)||w.isArrayBuffer(m))return m.byteLength;if(w.isURLSearchParams(m)&&(m=m+""),w.isString(m))return(await r(m)).byteLength},b=async(m,Z)=>{const G=w.toFiniteNumber(m.getContentLength());return G??A(Z)};return async m=>{let{url:Z,method:G,data:h,signal:u,cancelToken:y,timeout:W,onDownloadProgress:S,onUploadProgress:J,responseType:f,headers:X,withCredentials:U="same-origin",fetchOptions:Y}=vV(m),N=g||fetch;f=f?(f+"").toLowerCase():"text";let j=tH([u,y&&y.toAbortSignal()],W),_=null;const tg=j&&j.unsubscribe&&(()=>{j.unsubscribe()});let F;try{if(J&&a&&G!=="get"&&G!=="head"&&(F=await b(X,h))!==0){let z=new t(Z,{method:"POST",body:h,duplex:"half"}),M;if(w.isFormData(h)&&(M=z.headers.get("content-type"))&&X.setContentType(M),z.body){const[hg,wg]=ly(F,Sc(Cy(J)));h=ry(z.body,iy,hg,wg)}}w.isString(U)||(U=U?"include":"omit");const T=l&&"credentials"in t.prototype,gg={...Y,signal:j,method:G.toUpperCase(),headers:X.normalize().toJSON(),body:h,duplex:"half",credentials:T?U:void 0};_=l&&new t(Z,gg);let x=await(l?N(_,Y):N(Z,gg));const L=o&&(f==="stream"||f==="response");if(o&&(S||L&&tg)){const z={};["status","statusText","headers"].forEach(Ue=>{z[Ue]=x[Ue]});const M=w.toFiniteNumber(x.headers.get("content-length")),[hg,wg]=S&&ly(M,Sc(Cy(S),!0))||[];x=new I(ry(x.body,iy,hg,()=>{wg&&wg(),tg&&tg()}),z)}f=f||"text";let v=await c[w.findKey(c,f)||"text"](x,m);return!L&&tg&&tg(),await new Promise((z,M)=>{wV(z,M,{data:v,headers:Tt.from(x.headers),status:x.status,statusText:x.statusText,config:m,request:_})})}catch(T){throw tg&&tg(),T&&T.name==="TypeError"&&/Load failed|fetch/i.test(T.message)?Object.assign(new lg("Network Error",lg.ERR_NETWORK,m,_),{cause:T.cause||T}):lg.from(T,T&&T.code,m,_)}}},rH=new Map,NV=e=>{let g=e&&e.env||{};const{fetch:t,Request:I,Response:n}=g,l=[I,n,t];let C=l.length,s=C,r,a,o=rH;for(;s--;)r=l[s],a=o.get(r),a===void 0&&o.set(r,a=s?new Map:sH(g)),o=a;return a};NV();const e0={http:BN,xhr:gH,fetch:{get:NV}};w.forEach(e0,(e,g)=>{if(e){try{Object.defineProperty(e,"name",{value:g})}catch{}Object.defineProperty(e,"adapterName",{value:g})}});const Ay=e=>`- ${e}`,iH=e=>w.isFunction(e)||e===null||e===!1;function aH(e,g){e=w.isArray(e)?e:[e];const{length:t}=e;let I,n;const l={};for(let C=0;C<t;C++){I=e[C];let s;if(n=I,!iH(I)&&(n=e0[(s=String(I)).toLowerCase()],n===void 0))throw new lg(`Unknown adapter '${s}'`);if(n&&(w.isFunction(n)||(n=n.get(g))))break;l[s||"#"+C]=n}if(!n){const C=Object.entries(l).map(([r,a])=>`adapter ${r} `+(a===!1?"is not supported by the environment":"is not available in the build"));let s=t?C.length>1?`since :
`+C.map(Ay).join(`
`):" "+Ay(C[0]):"as no adapter specified";throw new lg("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n}const HV={getAdapter:aH,adapters:e0};function Yd(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new kr(null,e)}function dy(e){return Yd(e),e.headers=Tt.from(e.headers),e.data=wd.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),HV.getAdapter(e.adapter||g0.adapter,e)(e).then(function(I){return Yd(e),I.data=wd.call(e,e.transformResponse,I),I.headers=Tt.from(I.headers),I},function(I){return JV(I)||(Yd(e),I&&I.response&&(I.response.data=wd.call(e,e.transformResponse,I.response),I.response.headers=Tt.from(I.response.headers))),Promise.reject(I)})}const FV="1.13.2",fA={};["object","boolean","number","function","string","symbol"].forEach((e,g)=>{fA[e]=function(I){return typeof I===e||"a"+(g<1?"n ":" ")+e}});const uy={};fA.transitional=function(g,t,I){function n(l,C){return"[Axios v"+FV+"] Transitional option '"+l+"'"+C+(I?". "+I:"")}return(l,C,s)=>{if(g===!1)throw new lg(n(C," has been removed"+(t?" in "+t:"")),lg.ERR_DEPRECATED);return t&&!uy[C]&&(uy[C]=!0,console.warn(n(C," has been deprecated since v"+t+" and will be removed in the near future"))),g?g(l,C,s):!0}};fA.spelling=function(g){return(t,I)=>(console.warn(`${I} is likely a misspelling of ${g}`),!0)};function oH(e,g,t){if(typeof e!="object")throw new lg("options must be an object",lg.ERR_BAD_OPTION_VALUE);const I=Object.keys(e);let n=I.length;for(;n-- >0;){const l=I[n],C=g[l];if(C){const s=e[l],r=s===void 0||C(s,l,e);if(r!==!0)throw new lg("option "+l+" must be "+r,lg.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new lg("Unknown option "+l,lg.ERR_BAD_OPTION)}}const Fo={assertOptions:oH,validators:fA},_t=Fo.validators;class Rc{constructor(g){this.defaults=g||{},this.interceptors={request:new Iy,response:new Iy}}async request(g,t){try{return await this._request(g,t)}catch(I){if(I instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const l=n.stack?n.stack.replace(/^.+\n/,""):"";try{I.stack?l&&!String(I.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(I.stack+=`
`+l):I.stack=l}catch{}}throw I}}_request(g,t){typeof g=="string"?(t=t||{},t.url=g):t=g||{},t=bC(this.defaults,t);const{transitional:I,paramsSerializer:n,headers:l}=t;I!==void 0&&Fo.assertOptions(I,{silentJSONParsing:_t.transitional(_t.boolean),forcedJSONParsing:_t.transitional(_t.boolean),clarifyTimeoutError:_t.transitional(_t.boolean)},!1),n!=null&&(w.isFunction(n)?t.paramsSerializer={serialize:n}:Fo.assertOptions(n,{encode:_t.function,serialize:_t.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Fo.assertOptions(t,{baseUrl:_t.spelling("baseURL"),withXsrfToken:_t.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let C=l&&w.merge(l.common,l[t.method]);l&&w.forEach(["delete","get","head","post","put","patch","common"],m=>{delete l[m]}),t.headers=Tt.concat(C,l);const s=[];let r=!0;this.interceptors.request.forEach(function(Z){typeof Z.runWhen=="function"&&Z.runWhen(t)===!1||(r=r&&Z.synchronous,s.unshift(Z.fulfilled,Z.rejected))});const a=[];this.interceptors.response.forEach(function(Z){a.push(Z.fulfilled,Z.rejected)});let o,c=0,A;if(!r){const m=[dy.bind(this),void 0];for(m.unshift(...s),m.push(...a),A=m.length,o=Promise.resolve(t);c<A;)o=o.then(m[c++],m[c++]);return o}A=s.length;let b=t;for(;c<A;){const m=s[c++],Z=s[c++];try{b=m(b)}catch(G){Z.call(this,G);break}}try{o=dy.call(this,b)}catch(m){return Promise.reject(m)}for(c=0,A=a.length;c<A;)o=o.then(a[c++],a[c++]);return o}getUri(g){g=bC(this.defaults,g);const t=YV(g.baseURL,g.url,g.allowAbsoluteUrls);return RV(t,g.params,g.paramsSerializer)}}w.forEach(["delete","get","head","options"],function(g){Rc.prototype[g]=function(t,I){return this.request(bC(I||{},{method:g,url:t,data:(I||{}).data}))}});w.forEach(["post","put","patch"],function(g){function t(I){return function(l,C,s){return this.request(bC(s||{},{method:g,headers:I?{"Content-Type":"multipart/form-data"}:{},url:l,data:C}))}}Rc.prototype[g]=t(),Rc.prototype[g+"Form"]=t(!0)});const xo=Rc;class t0{constructor(g){if(typeof g!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(l){t=l});const I=this;this.promise.then(n=>{if(!I._listeners)return;let l=I._listeners.length;for(;l-- >0;)I._listeners[l](n);I._listeners=null}),this.promise.then=n=>{let l;const C=new Promise(s=>{I.subscribe(s),l=s}).then(n);return C.cancel=function(){I.unsubscribe(l)},C},g(function(l,C,s){I.reason||(I.reason=new kr(l,C,s),t(I.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(g){if(this.reason){g(this.reason);return}this._listeners?this._listeners.push(g):this._listeners=[g]}unsubscribe(g){if(!this._listeners)return;const t=this._listeners.indexOf(g);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const g=new AbortController,t=I=>{g.abort(I)};return this.subscribe(t),g.signal.unsubscribe=()=>this.unsubscribe(t),g.signal}static source(){let g;return{token:new t0(function(n){g=n}),cancel:g}}}const cH=t0;function AH(e){return function(t){return e.apply(null,t)}}function dH(e){return w.isObject(e)&&e.isAxiosError===!0}const ym={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(ym).forEach(([e,g])=>{ym[g]=e});const uH=ym;function xV(e){const g=new xo(e),t=mV(xo.prototype.request,g);return w.extend(t,xo.prototype,g,{allOwnKeys:!0}),w.extend(t,g,null,{allOwnKeys:!0}),t.create=function(n){return xV(bC(e,n))},t}const Eg=xV(g0);Eg.Axios=xo;Eg.CanceledError=kr;Eg.CancelToken=cH;Eg.isCancel=JV;Eg.VERSION=FV;Eg.toFormData=pA;Eg.AxiosError=lg;Eg.Cancel=Eg.CanceledError;Eg.all=function(g){return Promise.all(g)};Eg.spread=AH;Eg.isAxiosError=dH;Eg.mergeConfig=bC;Eg.AxiosHeaders=Tt;Eg.formToJSON=e=>XV(w.isHTMLForm(e)?new FormData(e):e);Eg.getAdapter=HV.getAdapter;Eg.HttpStatusCode=uH;Eg.default=Eg;const I0=Eg,mH="http://localhost:5000/api",qe=I0.create({baseURL:mH,headers:{"Content-Type":"application/json"}});qe.interceptors.request.use(e=>{const g=localStorage.getItem("authToken");return g&&(e.headers.Authorization=`Bearer ${g}`),e});const st={setToken:e=>{e?localStorage.setItem("authToken",e):localStorage.removeItem("authToken")},verifyToken:async e=>{var g;try{return(await qe.post("/auth/verify",{token:e})).data}catch(t){throw((g=t.response)==null?void 0:g.data)||t}},login:async(e,g,t)=>{var I;try{return(await qe.post("/auth/login",{walletAddress:e,signature:g,message:t})).data}catch(n){throw((I=n.response)==null?void 0:I.data)||n}},register:async(e,g,t,I)=>{var n;try{return(await qe.post("/auth/register",{walletAddress:e,signature:g,message:t,...I})).data}catch(l){throw((n=l.response)==null?void 0:n.data)||l}},getUserByWallet:async e=>{try{return(await qe.get(`/auth/user/${e}`)).data}catch(g){return console.warn("Could not fetch username:",g),{username:"Unknown"}}},getProfile:async()=>{var e;try{return(await qe.get("/users/profile")).data}catch(g){throw((e=g.response)==null?void 0:e.data)||g}},updateProfile:async e=>{var g;try{return(await qe.put("/users/profile",e)).data}catch(t){throw((g=t.response)==null?void 0:g.data)||t}},becomeOrganizer:async e=>{var g;try{return(await qe.put("/users/profile",{isOrganizer:!0,organizerInfo:e})).data}catch(t){throw((g=t.response)==null?void 0:g.data)||t}}},KV=B.createContext(),ol=()=>{const e=B.useContext(KV);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},hH=({children:e})=>{const{account:g,isConnected:t}=ft(),[I,n]=B.useState(null),[l,C]=B.useState(!1),[s,r]=B.useState(!1),[a,o]=B.useState(null),[c,A]=B.useState(!1),[b,m]=B.useState(null);B.useEffect(()=>{const Y=localStorage.getItem("authToken");Y&&Z(Y)},[]),B.useEffect(()=>{t&&g&&!l&&!b?h():!t&&l&&W()},[t,g]);const Z=async Y=>{try{r(!0);const N=await st.verifyToken(Y);N.success?(n(N.data.user),C(!0),st.setToken(Y)):W()}catch(N){console.error("Token verification failed:",N),W()}finally{r(!1)}},G=async Y=>{if(!window.ethereum)throw new Error("MetaMask not installed");return await(await new Ei(window.ethereum).getSigner()).signMessage(Y)},h=async()=>{if(g)try{r(!0),o(null);const Y=`Sign this message to authenticate with NFT Ticketing System.

Wallet: ${g}
Timestamp: ${Date.now()}`,N=await G(Y);try{const j=await st.login(g,N,Y);j.success&&(n(j.data.user),C(!0),st.setToken(j.data.token),m(null),A(!1))}catch{console.log("User not found, prompting registration..."),m({address:g,signature:N,message:Y}),A(!0)}}catch(Y){console.error("Authentication failed:",Y),o(Y.message||"Authentication failed")}finally{r(!1)}},u=async(Y,N,j)=>{try{r(!0),o(null);const _=await st.login(Y,N,j);if(_.success)return n(_.data.user),C(!0),st.setToken(_.data.token),_.data}catch(_){throw console.error("Login failed:",_),o(_.message||"Login failed"),_}finally{r(!1)}},y=async(Y={})=>{if(!b)throw new Error("No pending authentication found. Please connect wallet first.");try{r(!0),o(null);const N=await st.register(b.address,b.signature,b.message,Y);if(N.success)return n(N.data.user),C(!0),st.setToken(N.data.token),m(null),A(!1),N.data}catch(N){throw console.error("Registration failed:",N),o(N.message||"Registration failed"),N}finally{r(!1)}},W=()=>{n(null),C(!1),o(null),m(null),A(!1),st.setToken(null)},U={user:I,isAuthenticated:l,isLoading:s,error:a,login:u,register:y,logout:W,updateProfile:async Y=>{try{r(!0),o(null);const N=await st.updateProfile(Y);if(N.success)return n(N.data.user),N.data}catch(N){throw console.error("Profile update failed:",N),o(N.message||"Profile update failed"),N}finally{r(!1)}},becomeOrganizer:async Y=>{try{r(!0),o(null);const N=await st.becomeOrganizer(Y);if(N.success)return n(N.data.user),N.data}catch(N){throw console.error("Become organizer failed:",N),o(N.message||"Failed to become organizer"),N}finally{r(!1)}},refreshUser:async()=>{if(l)try{const Y=await st.getProfile();Y.success&&n(Y.data.user)}catch(Y){console.error("Failed to refresh user data:",Y)}},handleWalletLogin:h,signMessage:G,showRegisterModal:c,setShowRegisterModal:A,cancelRegistration:()=>{m(null),A(!1)}};return i.jsx(KV.Provider,{value:U,children:e})};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var bH={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZH=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),eg=(e,g)=>{const t=B.forwardRef(({color:I="currentColor",size:n=24,strokeWidth:l=2,absoluteStrokeWidth:C,className:s="",children:r,...a},o)=>B.createElement("svg",{ref:o,...bH,width:n,height:n,stroke:I,strokeWidth:C?Number(l)*24/Number(n):l,className:["lucide",`lucide-${ZH(e)}`,s].join(" "),...a},[...g.map(([c,A])=>B.createElement(c,A)),...Array.isArray(r)?r:[r]]));return t.displayName=`${e}`,t};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kc=eg("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n0=eg("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EV=eg("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gm=eg("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VA=eg("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yH=eg("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GH=eg("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nl=eg("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const my=eg("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZC=eg("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pH=eg("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UV=eg("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ui=eg("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BH=eg("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fH=eg("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zV=eg("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pm=eg("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VH=eg("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hy=eg("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WH=eg("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const by=eg("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SH=eg("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RH=eg("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dg=eg("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kH=eg("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zy=eg("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QV=eg("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XH=eg("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JH=eg("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wH=eg("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l0=eg("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YH=eg("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xc=eg("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vd=eg("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bm=eg("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yy=eg("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vH=eg("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GI=eg("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gy=eg("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const py=eg("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=eg("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const By=eg("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fy=eg("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vy=eg("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=eg("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yC=eg("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zi=eg("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=eg("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NH=eg("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),HH=()=>{const{showRegisterModal:e,register:g,cancelRegistration:t,isLoading:I}=ol(),[n,l]=B.useState("customer"),[C,s]=B.useState({username:"",email:"",phone:"",companyName:""});if(!e)return null;const r=o=>{const{name:c,value:A}=o.target;s(b=>({...b,[c]:A}))},a=async o=>{if(o.preventDefault(),!C.username.trim()){K.error("Please enter a username");return}if(n==="organizer"&&!C.companyName.trim()){K.error("Organizers must provide a Company/Organization name");return}try{const c=n==="organizer",A={username:C.username,email:C.email,phone:C.phone,isOrganizer:c,organizerInfo:c?{companyName:C.companyName,verified:!1}:void 0};await g(A),K.success(`Welcome! You are registered as a ${c?"Organizer":"Customer"}`),l("customer"),s({username:"",email:"",phone:"",companyName:""})}catch(c){console.error("Registration failed:",c)}};return i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full overflow-hidden transform transition-all scale-100",children:[i.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Complete Registration"}),i.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:i.jsx(C0,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"p-6",children:[i.jsx("p",{className:"text-gray-600 mb-6 text-sm text-center",children:"Your wallet is connected! Please set up your profile to continue."}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[i.jsxs("button",{type:"button",onClick:()=>l("customer"),className:`p-4 rounded-xl border-2 flex flex-col items-center justify-center space-y-2 transition-all ${n==="customer"?"border-primary-600 bg-primary-50 text-primary-700":"border-gray-200 hover:border-gray-300 text-gray-600"}`,children:[i.jsx(Ve,{className:`w-8 h-8 ${n==="customer"?"text-primary-600":"text-gray-400"}`}),i.jsx("span",{className:"font-semibold",children:"Customer"}),i.jsx("span",{className:"text-xs text-center opacity-80",children:"I want to buy tickets"})]}),i.jsxs("button",{type:"button",onClick:()=>l("organizer"),className:`p-4 rounded-xl border-2 flex flex-col items-center justify-center space-y-2 transition-all ${n==="organizer"?"border-purple-600 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300 text-gray-600"}`,children:[i.jsx(yH,{className:`w-8 h-8 ${n==="organizer"?"text-purple-600":"text-gray-400"}`}),i.jsx("span",{className:"font-semibold",children:"Organizer"}),i.jsx("span",{className:"text-xs text-center opacity-80",children:"I want to sell tickets"})]})]}),i.jsxs("form",{onSubmit:a,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username *"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",name:"username",value:C.username,onChange:r,className:"input-field pl-10",placeholder:"How should we call you?",required:!0}),i.jsx(Ve,{className:"w-4 h-4 text-gray-400 absolute left-3 top-3"})]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",i.jsx("span",{className:"text-gray-400 font-normal",children:"(Optional)"})]}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"tel",name:"phone",value:C.phone,onChange:r,className:"input-field pl-10",placeholder:"+1 234 567 8900"}),i.jsx(l0,{className:"w-4 h-4 text-gray-400 absolute left-3 top-3"})]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email Address ",i.jsx("span",{className:"text-gray-400 font-normal",children:"(Optional)"})]}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"email",name:"email",value:C.email,onChange:r,className:"input-field pl-10",placeholder:"For ticket receipts"}),i.jsx(QV,{className:"w-4 h-4 text-gray-400 absolute left-3 top-3"})]})]}),n==="organizer"&&i.jsxs("div",{className:"animate-fade-in",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Organization / Company Name *"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",name:"companyName",value:C.companyName,onChange:r,className:"input-field pl-10 border-purple-200 focus:ring-purple-500 focus:border-purple-500",placeholder:"Event Company Ltd.",required:n==="organizer"}),i.jsx(GH,{className:"w-4 h-4 text-gray-400 absolute left-3 top-3"})]}),i.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"* Organizers have access to the Event Creation Dashboard."})]}),i.jsxs("div",{className:"flex space-x-3 pt-4",children:[i.jsx("button",{type:"button",onClick:t,className:"flex-1 btn-outline",disabled:I,children:"Cancel"}),i.jsx("button",{type:"submit",className:`flex-1 flex items-center justify-center space-x-2 text-white font-medium py-2 px-4 rounded-lg transition-colors ${n==="organizer"?"bg-purple-600 hover:bg-purple-700":"bg-primary-600 hover:bg-primary-700"}`,disabled:I,children:I?i.jsx(Dg,{className:"w-5 h-5 animate-spin"}):i.jsxs(i.Fragment,{children:[i.jsx(pH,{className:"w-5 h-5"}),i.jsx("span",{children:"Complete Registration"})]})})]})]})]})]})})},FH=({children:e})=>{const{account:g,isConnected:t,connect:I,isSupportedNetwork:n}=ft(),{user:l,logout:C}=ol(),s=pI(),r=BC(),[a,o]=B.useState("0.00"),[c,A]=B.useState(!1),[b,m]=B.useState(!1);B.useEffect(()=>{const u=()=>{m(window.scrollY>10)};return window.addEventListener("scroll",u),()=>window.removeEventListener("scroll",u)},[]),B.useEffect(()=>{const u=async()=>{if(t&&g&&window.ethereum)try{const S=await new Ei(window.ethereum).getBalance(g);o(parseFloat(fB(S)).toFixed(4))}catch(W){console.error("Error fetching balance:",W)}};u();const y=setInterval(u,1e4);return()=>clearInterval(y)},[t,g]);const G=(()=>{const u=[{name:"Home",href:"/",icon:WH},{name:"Browse Tickets",href:"/tickets",icon:Qn}];return t?(u.push({name:"My Tickets",href:"/my-tickets",icon:Qn}),u.push({name:"Profile",href:"/profile",icon:UV}),l!=null&&l.isOrganizer?(u.push({name:"Create Sale",href:"/create-sale",icon:YH}),u.push({name:"Manage Transfers",href:"/organizer/transfers",icon:Gm}),u.push({name:"Verify Ticket",href:"/organizer/verify",icon:GI})):u.push({name:"Verify Ticket",href:"/verify",icon:GI})):u.push({name:"Verify Ticket",href:"/verify",icon:GI}),u})(),h=u=>r.pathname===u;return i.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col font-sans text-gray-900",children:[i.jsx(HH,{}),i.jsxs("header",{className:`fixed top-0 w-full z-50 transition-all duration-300 ${b?"bg-white/90 backdrop-blur-md shadow-md border-b border-gray-200/50 py-2":"bg-white border-b border-gray-200 py-4"}`,children:[i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("div",{className:"flex items-center",children:i.jsxs($g,{to:"/",className:"flex items-center space-x-2 group",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-600 to-primary-700 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-primary-500/30 transition-all duration-300",children:i.jsx(Qn,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-xl font-bold text-gray-900 leading-none tracking-tight",children:"NFT Tickets"}),i.jsx("span",{className:"text-[10px] font-semibold text-primary-600 tracking-wider uppercase",children:"Blockchain Event Access"})]})]})}),i.jsx("nav",{className:"hidden md:flex items-center space-x-1 bg-gray-100/50 p-1 rounded-full border border-gray-200/50",children:G.map(u=>{const y=u.icon,W=h(u.href);return i.jsxs($g,{to:u.href,className:`flex items-center space-x-2 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 ${W?"bg-white text-primary-700 shadow-sm ring-1 ring-black/5":"text-gray-500 hover:text-gray-900 hover:bg-white/60"}`,children:[i.jsx(y,{className:`w-4 h-4 ${W?"text-primary-600":"text-gray-400"}`}),i.jsx("span",{children:u.name})]},u.name)})}),i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx("div",{className:"hidden md:flex items-center",children:t?i.jsxs("div",{className:"flex items-center space-x-3",children:[!n&&i.jsxs("div",{className:"flex items-center px-3 py-1.5 bg-red-50 text-red-600 text-xs font-medium rounded-full border border-red-100",children:[i.jsx(kc,{className:"w-3 h-3 mr-1.5"}),"Wrong Network"]}),i.jsxs("div",{className:"flex items-center bg-white border border-gray-200 rounded-full pl-3 pr-1 py-1 shadow-sm hover:shadow-md transition-shadow",children:[i.jsxs("div",{className:"flex items-center mr-3 border-r border-gray-200 pr-3",children:[i.jsx("div",{className:"bg-yellow-100 p-1 rounded-full mr-2",children:i.jsx(BH,{className:"w-3 h-3 text-yellow-600"})}),i.jsxs("span",{className:"text-sm font-bold text-gray-800",children:[a," ETH"]})]}),i.jsxs($g,{to:"/profile",className:"flex items-center space-x-2 bg-gray-50 hover:bg-gray-100 px-3 py-1.5 rounded-full transition-colors",children:[i.jsx("div",{className:"w-5 h-5 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full flex items-center justify-center text-[10px] text-white font-bold",children:l!=null&&l.username?l.username.charAt(0).toUpperCase():i.jsx(Ve,{className:"w-3 h-3"})}),i.jsx("span",{className:"text-xs font-medium text-gray-600 font-mono",children:gt(g)})]})]}),i.jsxs("button",{onClick:()=>{C(),s("/login")},className:"flex items-center space-x-2 px-3 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-full transition-colors",children:[i.jsx(Zy,{className:"w-4 h-4"}),i.jsx("span",{children:"Logout"})]})]}):i.jsxs("button",{onClick:I,className:"flex items-center space-x-2 bg-gray-900 hover:bg-black text-white px-5 py-2.5 rounded-full text-sm font-medium transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5",children:[i.jsx(yC,{className:"w-4 h-4"}),i.jsx("span",{children:"Connect Wallet"})]})}),i.jsx("button",{onClick:()=>A(!c),className:"md:hidden p-2 rounded-lg text-gray-500 hover:bg-gray-100 transition-colors",children:c?i.jsx(C0,{className:"w-6 h-6"}):i.jsx(wH,{className:"w-6 h-6"})})]})]})}),c&&i.jsxs("div",{className:"md:hidden absolute top-full left-0 w-full bg-white border-b border-gray-200 shadow-xl py-4 px-4 space-y-4 animate-in slide-in-from-top-2 duration-200",children:[i.jsx("div",{className:"flex flex-col space-y-1",children:G.map(u=>{const y=u.icon;return i.jsxs($g,{to:u.href,onClick:()=>A(!1),className:`flex items-center space-x-3 px-4 py-3 rounded-xl transition-colors ${h(u.href)?"bg-primary-50 text-primary-700 font-medium":"text-gray-600 hover:bg-gray-50"}`,children:[i.jsx(y,{className:"w-5 h-5"}),i.jsx("span",{children:u.name})]},u.name)})}),i.jsx("div",{className:"pt-4 border-t border-gray-100",children:t?i.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"text-gray-500 text-sm",children:"Balance"}),i.jsxs("span",{className:"font-bold text-gray-900",children:[a," ETH"]})]}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"text-gray-500 text-sm",children:"Account"}),i.jsx("span",{className:"font-mono text-sm bg-white px-2 py-1 rounded border border-gray-200",children:gt(g)})]}),i.jsx($g,{to:"/profile",onClick:()=>A(!1),className:"flex items-center justify-center w-full py-2 bg-white border border-gray-200 rounded-lg text-sm font-medium text-gray-700 mt-2",children:"View Profile"}),i.jsxs("button",{onClick:()=>{C(),s("/login"),A(!1)},className:"flex items-center justify-center w-full py-2 bg-red-50 border border-red-200 rounded-lg text-sm font-medium text-red-600 mt-2",children:[i.jsx(Zy,{className:"w-4 h-4 mr-2"}),"Logout"]})]}):i.jsxs("button",{onClick:()=>{I(),A(!1)},className:"w-full flex justify-center items-center space-x-2 bg-primary-600 text-white px-4 py-3 rounded-xl font-medium",children:[i.jsx(yC,{className:"w-5 h-5"}),i.jsx("span",{children:"Connect Wallet"})]})})]})]}),i.jsx("main",{className:"flex-grow pt-24 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto w-full",children:e}),i.jsx("footer",{className:"bg-white border-t border-gray-200 mt-auto",children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-8",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[i.jsx("div",{className:"w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center",children:i.jsx(Qn,{className:"w-4 h-4 text-white"})}),i.jsx("span",{className:"text-lg font-bold text-gray-900",children:"NFT Tickets"})]}),i.jsx("p",{className:"text-gray-500 text-sm leading-relaxed max-w-xs",children:"The future of event ticketing. Secure, transparent, and verifiable on the Ethereum blockchain."})]}),i.jsxs("div",{className:"flex flex-col space-y-3",children:[i.jsx("h4",{className:"font-bold text-gray-900",children:"Quick Links"}),i.jsx($g,{to:"/tickets",className:"text-gray-500 hover:text-primary-600 text-sm",children:"Browse Events"}),i.jsx($g,{to:"/verify",className:"text-gray-500 hover:text-primary-600 text-sm",children:"Verify Ticket"}),i.jsx($g,{to:"/profile",className:"text-gray-500 hover:text-primary-600 text-sm",children:"My Profile"})]}),i.jsxs("div",{className:"flex flex-col space-y-3",children:[i.jsx("h4",{className:"font-bold text-gray-900",children:"Smart Contract"}),i.jsx("p",{className:"text-xs text-gray-400 font-mono bg-gray-50 p-3 rounded-lg border border-gray-100 break-all",children:Lt==null?void 0:Lt.address}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),i.jsx("span",{className:"text-xs text-green-700 font-medium",children:"System Operational"})]})]})]}),i.jsxs("div",{className:"border-t border-gray-100 pt-8 flex flex-col md:flex-row justify-between items-center text-sm text-gray-400",children:[i.jsxs("p",{children:[" ",new Date().getFullYear()," NFT Ticketing System. All rights reserved."]}),i.jsx("p",{className:"mt-2 md:mt-0",children:"Powered by Ethereum & IPFS"})]})]})})]})},xH=()=>{const{user:e,isConnected:g}=ol();return i.jsxs("div",{className:"space-y-16",children:[i.jsxs("section",{className:"text-center space-y-6 py-12",children:[i.jsxs("h1",{className:"text-5xl font-extrabold text-gray-900 tracking-tight",children:["The Future of ",i.jsx("span",{className:"text-primary-600",children:"Event Ticketing"})]}),i.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Secure, transparent, and resale-proof tickets powered by Blockchain technology. Buy, sell, and verify tickets instantly with zero fraud."}),i.jsxs("div",{className:"flex justify-center gap-4",children:[g&&(e!=null&&e.isOrganizer)?i.jsx($g,{to:"/create-sale",className:"btn-primary text-lg px-8 py-3",children:"Create New Event"}):i.jsx($g,{to:"/tickets",className:"btn-primary text-lg px-8 py-3",children:"Browse Events"}),i.jsx($g,{to:"/verify",className:"btn-outline text-lg px-8 py-3 bg-white",children:"Verify Ticket"})]})]}),i.jsxs("section",{className:"grid md:grid-cols-3 gap-8",children:[i.jsxs("div",{className:"card text-center p-6 hover:shadow-lg transition-shadow",children:[i.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-4",children:i.jsx(GI,{className:"w-6 h-6 text-blue-600"})}),i.jsx("h3",{className:"text-xl font-bold mb-2",children:"100% Secure"}),i.jsx("p",{className:"text-gray-600",children:"Eliminate fake tickets forever. Every ticket is a unique NFT verified on the blockchain."})]}),i.jsxs("div",{className:"card text-center p-6 hover:shadow-lg transition-shadow",children:[i.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mx-auto mb-4",children:i.jsx(NH,{className:"w-6 h-6 text-purple-600"})}),i.jsx("h3",{className:"text-xl font-bold mb-2",children:"Instant Transfers"}),i.jsx("p",{className:"text-gray-600",children:"Buy and resell tickets instantly without middlemen or hidden processing fees."})]}),i.jsxs("div",{className:"card text-center p-6 hover:shadow-lg transition-shadow",children:[i.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-4",children:i.jsx(VH,{className:"w-6 h-6 text-green-600"})}),i.jsx("h3",{className:"text-xl font-bold mb-2",children:"Global Access"}),i.jsx("p",{className:"text-gray-600",children:"Connect your wallet and access events worldwide. No account creation barriers."})]})]})]})},LV="9dbcf1382bf8cee85c2d",TV="e1e428ea1a068e26489f7d25be70101d0c767f97843be1d1f1c61f5a3887bf56",fm=["https://ipfs.io/ipfs/","https://dweb.link/ipfs/","https://ipfs.fleek.co/ipfs/","https://nftstorage.link/ipfs/","https://ipfs.filebase.io/ipfs/","https://gateway.pinata.cloud/ipfs/","https://cloudflare-ipfs.com/ipfs/"],MV={}.VITE_NFT_STORAGE_TOKEN,Vm=e=>!e||/your_.*_key/i.test(String(e))||/your_.*_token/i.test(String(e)),KH=!Vm(LV)&&!Vm(TV),EH=!Vm(MV);async function UH(e){try{const g=new FormData;g.append("file",e);const t=JSON.stringify({name:e.name,keyvalues:{type:"ticket-image"}});g.append("pinataMetadata",t);const I=JSON.stringify({cidVersion:0});return g.append("pinataOptions",I),(await I0.post("https://api.pinata.cloud/pinning/pinFileToIPFS",g,{headers:{"Content-Type":"multipart/form-data",pinata_api_key:LV,pinata_secret_api_key:TV}})).data.IpfsHash}catch(g){throw console.error("Error uploading image to Pinata:",g),new Error("Failed to upload image to IPFS")}}async function zH(e){try{const g=new FormData;return g.append("file",e),(await I0.post("https://api.nft.storage/upload",g,{headers:{Authorization:`Bearer ${MV}`,"Content-Type":"multipart/form-data"}})).data.value.cid}catch(g){throw console.error("Error uploading image to NFT.Storage:",g),new Error("Failed to upload image to IPFS")}}async function Wy(e){return KH?await UH(e):EH?await zH(e):(console.warn("No IPFS service configured. Using mock CID for development."),`QmMock${Date.now()}${Math.random().toString(36).substr(2,9)}`)}function DV(e,g=0){const t=e.replace("ipfs://","");return`${fm[g]||fm[0]}${t}`}function QH(e){const g=e.replace("ipfs://","");return fm.map(t=>`${t}${g}`)}function LH(e,g=10){const t=["image/jpeg","image/jpg","image/png","image/gif","image/webp"],I=g*1024*1024;if(!t.includes(e.type))throw new Error("Invalid file type. Only JPEG, PNG, GIF, and WebP images are allowed.");if(e.size>I)throw new Error(`File size too large. Maximum size is ${g}MB.`);return!0}function TH(e){return new Promise((g,t)=>{const I=new FileReader;I.readAsDataURL(e),I.onload=()=>g(I.result),I.onerror=n=>t(n)})}const MH=()=>{const e=pI(),{account:g,isConnected:t,isSupportedNetwork:I}=ft(),{user:n}=ol(),[l,C]=B.useState(!1),[s,r]=B.useState(!1),[a,o]=B.useState({eventName:"",organizer:(n==null?void 0:n.username)||"",eventDate:"",saleEndDate:"",price:"",totalTickets:"",posterFile:null,ticketFile:null}),[c,A]=B.useState({poster:null,ticket:null});B.useEffect(()=>{n&&!n.isOrganizer&&(K.error("Access denied. Only organizers can create events."),e("/"))},[n,e]);const b=G=>{const{name:h,value:u}=G.target;o(y=>({...y,[h]:u}))},m=async(G,h)=>{const u=G.target.files[0];if(u)try{LH(u);const y=await TH(u);o(W=>({...W,[`${h}File`]:u})),A(W=>({...W,[h]:y})),K.success(`${h} uploaded successfully`)}catch(y){K.error(y.message)}},Z=async G=>{if(G.preventDefault(),!t||!I){K.error("Please connect your wallet and switch to the correct network");return}if(!(n!=null&&n.isOrganizer)){K.error("You must be an organizer to create an event");return}if(!a.posterFile||!a.ticketFile){K.error("Please upload both poster and ticket images");return}const h=Math.floor(new Date(a.eventDate).getTime()/1e3),u=Math.floor(new Date(a.saleEndDate).getTime()/1e3),y=Math.floor(Date.now()/1e3);if(console.log("Date validation:",{currentTime:y,eventTimestamp:h,saleEndTimestamp:u,eventDate:new Date(a.eventDate).toLocaleString(),saleEndDate:new Date(a.saleEndDate).toLocaleString(),currentDate:new Date().toLocaleString()}),!h||!u||Number.isNaN(h)||Number.isNaN(u)){K.error("Please provide valid dates");return}if(u>=h){K.error("Sale end date must be before the event date");return}if(u<=y){const S=y-u,J=Math.floor(S/3600),f=Math.floor(S%3600/60);K.error(`Sale end date must be in the future. Your date is ${J}h ${f}m in the past.`);return}if(h<=y){K.error("Event date must be in the future");return}const W=y+3600;if(u<W){K.error("Sale end date must be at least 1 hour in the future");return}if(!a.price||Number(a.price)<=0){K.error("Price must be greater than 0");return}if(!a.totalTickets||Number(a.totalTickets)<=0){K.error("Total tickets must be greater than 0");return}C(!0);try{K.loading("Uploading images to IPFS...",{id:"upload"});const[S,J]=await Promise.all([Wy(a.posterFile),Wy(a.ticketFile)]);console.log("IPFS Upload Results:",{posterCID:S,ticketCID:J}),K.success("Images uploaded successfully!",{id:"upload"});let f,X=0;const U=3;for(;X<U;)try{f=await gl();break}catch(j){if(X++,j.message.includes("circuit breaker")||j.message.includes("Execution prevented"))if(X<U){K.loading(`MetaMask circuit breaker detected. Retrying in ${X*2} seconds...`,{id:"retry"}),await new Promise(_=>setTimeout(_,X*2e3));continue}else throw new Error("MetaMask circuit breaker is open. Please wait a few minutes and try again, or refresh the page and reconnect your wallet.");throw j}K.loading("Creating ticket sale...",{id:"create"}),console.log("Creating sale with data:",{eventName:a.eventName,organizer:a.organizer,eventTimestamp:h,saleEndTimestamp:u,price:$Z(a.price),totalTickets:Number(a.totalTickets),posterCID:S,ticketCID:J}),console.log("Contract address:",f.target),console.log("Current timestamp:",Math.floor(Date.now()/1e3)),console.log("Event timestamp:",h),console.log("Sale end timestamp:",u);try{const j=await f.eventToTicketId(a.eventName);if(console.log("Existing ticket ID for event:",j.toString()),j.toString()!=="0"){K.error("An event with this name already exists. Please use a different name.");return}}catch(j){console.log("Could not check existing event:",j.message)}console.log("Attempting transaction with no gas limits...");const Y=await f.createSale(a.eventName,a.organizer,h,u,$Z(a.price),Number(a.totalTickets),S,J);console.log("Transaction submitted:",Y.hash),K.loading("Waiting for confirmation...",{id:"create"});const N=await Y.wait();console.log("Transaction confirmed:",N),K.success("Ticket sale created successfully!",{id:"create"}),o({eventName:"",organizer:(n==null?void 0:n.username)||"",eventDate:"",saleEndDate:"",price:"",totalTickets:"",posterFile:null,ticketFile:null}),A({poster:null,ticket:null});try{window.dispatchEvent(new CustomEvent("ticketsUpdated",{detail:{action:"created"}}))}catch{}setTimeout(()=>{window.location.href="/tickets"},1500)}catch(S){console.error("Error creating sale:",S),S.message.includes("circuit breaker")||S.message.includes("Execution prevented")?(r(!0),K.error("MetaMask circuit breaker is open. Please use the reset button above or refresh the page.")):S.message.includes("User rejected")?K.error("Transaction was cancelled by user"):S.message.includes("insufficient funds")?K.error("Insufficient funds for transaction"):S.message.includes("network")?K.error("Network error. Please check your connection and try again."):S.message.includes("Internal JSON-RPC error")?(K.error("Blockchain error. Please try again or check your network connection."),console.log("Full error details:",S)):S.message.includes("gas")?K.error("Gas estimation failed. Please try again."):S.message.includes("Sale end date must be in the future")?K.error("Sale end date must be in the future. Please choose a later date."):S.message.includes("Event date must be in the future")?K.error("Event date must be in the future. Please choose a later date."):S.message.includes("Sale must end before event")?K.error("Sale end date must be before the event date."):S.message.includes("Event already exists")?K.error("An event with this name already exists. Please choose a different name."):(console.error("Full error details:",S),K.error(S.message||"Failed to create ticket sale"))}finally{C(!1)}};return t?I?i.jsx("div",{className:"max-w-2xl mx-auto",children:i.jsxs("div",{className:"card",children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Create Ticket Sale"}),s&&i.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx(n0,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"text-sm font-medium text-yellow-800 mb-2",children:"MetaMask Circuit Breaker Active"}),i.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"MetaMask has temporarily blocked requests due to too many failed attempts. This usually happens when the local blockchain isn't running or there are network issues."}),i.jsxs("div",{className:"flex space-x-3",children:[i.jsxs("button",{onClick:()=>{r(!1),K.success("Circuit breaker state cleared. Please try again.")},className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",children:[i.jsx(Xc,{className:"w-4 h-4 mr-2"}),"Clear State"]}),i.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Refresh Page"})]})]})]})}),i.jsxs("form",{onSubmit:Z,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"label",children:[i.jsx(Ve,{className:"w-4 h-4 inline mr-2"}),"Event Name"]}),i.jsx("input",{type:"text",name:"eventName",value:a.eventName,onChange:b,className:"input-field",placeholder:"e.g., Rock Concert 2024",required:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"label",children:[i.jsx(Ve,{className:"w-4 h-4 inline mr-2"}),"Organizer"]}),i.jsx("input",{type:"text",name:"organizer",value:a.organizer,onChange:b,className:"input-field",placeholder:"e.g., Music Events Inc",required:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"label",children:[i.jsx(nl,{className:"w-4 h-4 inline mr-2"}),"Event Date"]}),i.jsx("input",{type:"datetime-local",name:"eventDate",value:a.eventDate,onChange:b,className:"input-field",required:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"label",children:[i.jsx(nl,{className:"w-4 h-4 inline mr-2"}),"Sale End Date"]}),i.jsx("input",{type:"datetime-local",name:"saleEndDate",value:a.saleEndDate,onChange:b,className:"input-field",required:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"label",children:[i.jsx(zV,{className:"w-4 h-4 inline mr-2"}),"Price (ETH)"]}),i.jsx("input",{type:"number",name:"price",value:a.price,onChange:b,className:"input-field",placeholder:"0.1",step:"0.001",min:"0",required:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"label",children:[i.jsx(Ve,{className:"w-4 h-4 inline mr-2"}),"Total Available Tickets"]}),i.jsx("input",{type:"number",name:"totalTickets",value:a.totalTickets,onChange:b,className:"input-field",placeholder:"100",min:"1",required:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"label",children:[i.jsx(by,{className:"w-4 h-4 inline mr-2"}),"Event Poster"]}),i.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[i.jsx("input",{type:"file",accept:"image/*",onChange:G=>m(G,"poster"),className:"hidden",id:"poster-upload"}),i.jsx("label",{htmlFor:"poster-upload",className:"cursor-pointer",children:c.poster?i.jsxs("div",{className:"space-y-4",children:[i.jsx("img",{src:c.poster,alt:"Poster preview",className:"max-h-48 mx-auto rounded-lg"}),i.jsx("p",{className:"text-sm text-gray-600",children:"Click to change poster"})]}):i.jsxs("div",{className:"space-y-2",children:[i.jsx(By,{className:"w-8 h-8 mx-auto text-gray-400"}),i.jsx("p",{className:"text-gray-600",children:"Click to upload event poster"}),i.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})})]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"label",children:[i.jsx(by,{className:"w-4 h-4 inline mr-2"}),"Ticket Image"]}),i.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[i.jsx("input",{type:"file",accept:"image/*",onChange:G=>m(G,"ticket"),className:"hidden",id:"ticket-upload"}),i.jsx("label",{htmlFor:"ticket-upload",className:"cursor-pointer",children:c.ticket?i.jsxs("div",{className:"space-y-4",children:[i.jsx("img",{src:c.ticket,alt:"Ticket preview",className:"max-h-48 mx-auto rounded-lg"}),i.jsx("p",{className:"text-sm text-gray-600",children:"Click to change ticket image"})]}):i.jsxs("div",{className:"space-y-2",children:[i.jsx(By,{className:"w-8 h-8 mx-auto text-gray-400"}),i.jsx("p",{className:"text-gray-600",children:"Click to upload ticket image"}),i.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})})]})]}),i.jsx("button",{type:"submit",disabled:l,className:"w-full btn-primary flex items-center justify-center space-x-2",children:l?i.jsxs(i.Fragment,{children:[i.jsx(Dg,{className:"w-5 h-5 animate-spin"}),i.jsx("span",{children:"Creating Sale..."})]}):i.jsx("span",{children:"Create Ticket Sale"})})]})]})}):i.jsx("div",{className:"max-w-2xl mx-auto text-center",children:i.jsxs("div",{className:"card",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Wrong Network"}),i.jsx("p",{className:"text-gray-600 mb-6",children:"Please switch to Sepolia or Localhost network to create ticket sales."})]})}):i.jsx("div",{className:"max-w-2xl mx-auto text-center",children:i.jsxs("div",{className:"card",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Connect Your Wallet"}),i.jsx("p",{className:"text-gray-600 mb-6",children:"You need to connect your wallet to create ticket sales."}),i.jsx("button",{onClick:()=>window.location.reload(),className:"btn-primary",children:"Connect Wallet"})]})})},jV=({cid:e,alt:g="IPFS Image",className:t="",fallbackSrc:I=null,onError:n=null,onLoad:l=null,...C})=>{const[s,r]=B.useState(0),[a,o]=B.useState(!0),[c,A]=B.useState(!1),[b,m]=B.useState([]);B.useEffect(()=>{if(!e){A(!0),o(!1);return}const u=QH(e);m(u),r(0),A(!1),o(!0)},[e]);const Z=async()=>{const u=s+1;u<b.length?(r(u),o(!0)):(A(!0),o(!1),n&&n())},G=()=>{o(!1),A(!1),l&&l()};if(!e)return i.jsx("div",{className:`flex items-center justify-center bg-gray-200 ${t}`,children:i.jsx(kc,{className:"w-8 h-8 text-gray-400"})});if(c)return i.jsx("div",{className:`flex items-center justify-center bg-gray-200 ${t}`,children:i.jsxs("div",{className:"text-center",children:[i.jsx(kc,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Image unavailable"})]})});const h=b[s];return i.jsxs("div",{className:`relative ${t}`,children:[a&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-200 z-10",children:i.jsx(Dg,{className:"w-6 h-6 animate-spin text-gray-400"})}),i.jsx("img",{src:h,alt:g,onError:Z,onLoad:G,className:`${t} ${a?"opacity-0":"opacity-100"} transition-opacity duration-200`,...C}),I&&c&&i.jsx("img",{src:I,alt:g,className:t,...C})]})},DH=()=>{const e=pI(),[g,t]=B.useState([]),[I,n]=B.useState(!0),[l,C]=B.useState("");B.useEffect(()=>{r(),s();const o=c=>{var A;((A=c.detail)==null?void 0:A.action)==="created"&&r()};return window.addEventListener("ticketsUpdated",o),()=>{const c=mI();c&&c.removeAllListeners("TicketCreated"),window.removeEventListener("ticketsUpdated",o)}},[]);const s=async()=>{try{mI().on("TicketCreated",(c,A,b,m,Z)=>{console.log("New Event Created on Blockchain:",A),r()})}catch(o){console.error("Listener setup failed:",o)}},r=async()=>{try{n(!0);const o=mI(),c=await o.getAvailableTickets();console.log("Available Ticket IDs found:",c);const A=[];for(let b=c.length-1;b>=0;b--)try{const m=c[b],Z=await o.getTicket(m);!Z.isSold&&!Z.isRefunded&&A.push({id:Z.ticketId.toString(),eventName:Z.eventName,organizer:Z.organizer,eventDate:new Date(Number(Z.eventDate)*1e3),saleEndDate:new Date(Number(Z.saleEndDate)*1e3),price:Z.price,posterUrl:Z.posterUrl,availableTickets:Z.availableTickets.toString(),totalTickets:Z.totalTickets.toString()})}catch(m){console.warn(`Failed to load ticket ID ${c[b]}`,m)}t(A)}catch(o){console.error("Error loading tickets:",o)}finally{n(!1)}},a=g.filter(o=>o.eventName.toLowerCase().includes(l.toLowerCase())||o.organizer.toLowerCase().includes(l.toLowerCase()));return i.jsxs("div",{className:"max-w-7xl mx-auto",children:[i.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8 gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Upcoming Events"}),i.jsx("p",{className:"text-gray-600 mt-2",children:"Discover and book unique NFT tickets"})]}),i.jsxs("div",{className:"relative w-full md:w-96",children:[i.jsx("input",{type:"text",placeholder:"Search events or organizers...",value:l,onChange:o=>C(o.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),i.jsx(Bm,{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]})]}),I?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx(Dg,{className:"w-8 h-8 animate-spin text-primary-600"})}):a.length>0?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(o=>i.jsxs("div",{onClick:()=>e(`/ticket/${o.id}`),className:"card hover:shadow-lg transition-shadow cursor-pointer group",children:[i.jsxs("div",{className:"aspect-video bg-gray-100 rounded-lg mb-4 overflow-hidden relative",children:[i.jsx(jV,{cid:o.posterUrl,alt:o.eventName,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),i.jsxs("div",{className:"absolute top-2 right-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-md text-sm font-semibold text-primary-700",children:[Wc(o.price)," ETH"]})]}),i.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2 line-clamp-1",children:o.eventName}),i.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(nl,{className:"w-4 h-4 mr-2"}),i.jsx("span",{children:o.eventDate.toLocaleDateString()})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx(XH,{className:"w-4 h-4 mr-2"}),i.jsxs("span",{className:"line-clamp-1",children:["By ",o.organizer]})]}),i.jsxs("div",{className:"flex items-center text-primary-600",children:[i.jsx(py,{className:"w-4 h-4 mr-2"}),i.jsxs("span",{children:[o.availableTickets," / ",o.totalTickets," available"]})]})]}),i.jsx("button",{className:"w-full mt-4 btn-primary",children:"View Details"})]},o.id))}):i.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border-2 border-dashed border-gray-300",children:[i.jsx(py,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No events found"}),i.jsx("p",{className:"text-gray-500",children:"Check back later for new ticket releases."})]})]})},jH=({ticket:e,onUpdate:g})=>{const{account:t,isConnected:I,isSupportedNetwork:n}=ft(),[l,C]=B.useState(!1),[s,r]=B.useState(e.totalTickets),[a,o]=B.useState(!1),c=()=>e.seller&&t&&e.seller.toLowerCase()===t.toLowerCase(),A=async()=>{if(!I||!n){K.error("Please connect your wallet and switch to the correct network");return}if(!c()){K.error("Only the ticket seller can reset quantities");return}if(s<=0){K.error("Total tickets must be greater than 0");return}if(s<e.totalTickets-e.availableTickets){K.error("New total cannot be less than tickets already sold");return}C(!0);try{const b=await gl();K.loading("Resetting ticket quantities...",{id:"reset"});const m=await b.resetTicketQuantities(e.id,s);K.loading("Waiting for confirmation...",{id:"reset"}),await m.wait(),K.success("Ticket quantities reset successfully!",{id:"reset"}),o(!1),r(e.totalTickets),g&&g()}catch(b){console.error("Error resetting ticket quantities:",b),K.error(b.message||"Failed to reset ticket quantities")}finally{C(!1)}};return c()?i.jsxs("div",{className:"card",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[i.jsx(Xc,{className:"w-5 h-5 mr-2"}),"Ticket Quantity Management"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Current Status"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-gray-600",children:"Total Tickets:"}),i.jsx("p",{className:"font-semibold",children:Number(e.totalTickets||0)})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-gray-600",children:"Available:"}),i.jsx("p",{className:"font-semibold",children:Number(e.availableTickets||0)})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-gray-600",children:"Sold:"}),i.jsx("p",{className:"font-semibold",children:Number(e.totalTickets||0)-Number(e.availableTickets||0)})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-gray-600",children:"Remaining:"}),i.jsx("p",{className:"font-semibold",children:Number(e.availableTickets||0)})]})]})]}),a?i.jsxs("div",{className:"space-y-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[i.jsxs("div",{className:"flex items-start",children:[i.jsx(n0,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Reset Ticket Quantities"}),i.jsx("p",{className:"text-sm text-yellow-700 mb-4",children:"This will reset the total number of tickets available for sale. The new total must be at least as many as tickets already sold."})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Total Tickets"}),i.jsx("input",{type:"number",value:s,onChange:b=>r(parseInt(b.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:e.totalTickets-e.availableTickets,placeholder:"Enter new total tickets"}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Minimum: ",e.totalTickets-e.availableTickets," (tickets already sold)"]})]}),i.jsxs("div",{className:"flex space-x-3",children:[i.jsx("button",{onClick:A,disabled:l,className:"flex-1 btn-primary flex items-center justify-center space-x-2",children:l?i.jsxs(i.Fragment,{children:[i.jsx(Dg,{className:"w-5 h-5 animate-spin"}),i.jsx("span",{children:"Resetting..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(ZC,{className:"w-5 h-5"}),i.jsx("span",{children:"Confirm Reset"})]})}),i.jsx("button",{onClick:()=>{o(!1),r(e.totalTickets)},className:"flex-1 btn-outline",disabled:l,children:"Cancel"})]})]}):i.jsxs("button",{onClick:()=>o(!0),className:"w-full btn-outline flex items-center justify-center space-x-2",children:[i.jsx(Xc,{className:"w-5 h-5"}),i.jsx("span",{children:"Reset Ticket Quantities"})]})]})]}):null},PH=()=>{const{id:e}=$p(),g=pI(),{account:t,isConnected:I,isSupportedNetwork:n}=ft(),[l,C]=B.useState(null),[s,r]=B.useState(!0),[a,o]=B.useState(!1),[c,A]=B.useState(!1),[b,m]=B.useState(!1),[Z,G]=B.useState(null),[h,u]=B.useState(null),[y,W]=B.useState(null),[S,J]=B.useState(!1);B.useEffect(()=>(e&&(X(),f()),()=>{mI().removeAllListeners("TicketPurchased")}),[e,t]);const f=()=>{try{mI().on("TicketPurchased",(z,M,hg)=>{console.log("Real-time update: Ticket purchased!",z,M),X()})}catch(v){console.error("Failed to setup event listener",v)}},X=async()=>{try{l||r(!0),u(null);const v=mI();let z;try{z=await v.getTicket(e)}catch(M){if(M.message.includes("Ticket does not exist")){u("Ticket not found. It may have been deleted or the ID is invalid."),K.error("Ticket not found");return}throw M}if(C({id:e,eventName:z.eventName,organizer:z.organizer,eventDate:new Date(Number(z.eventDate)*1e3),saleEndDate:new Date(Number(z.saleEndDate)*1e3),price:z.price.toString(),posterUrl:z.posterUrl,ticketImageUrl:z.ticketImageUrl,seller:z.seller,buyer:z.buyer,isSold:z.isSold,isDownloaded:z.isDownloaded,isRefunded:z.isRefunded,isSecondHand:z.isSecondHand,totalTickets:Number(z.totalTickets),availableTickets:Number(z.availableTickets)}),t&&z.eventName)try{const M=await v.hasBoughtTicketForEvent(t,z.eventName);J(M)}catch(M){console.warn("Failed to check ticket ownership:",M)}await U()}catch(v){console.error("Error loading ticket:",v),u("Failed to load ticket details"),K.error("Failed to load ticket details")}finally{r(!1)}},U=async()=>{try{const v=mI();let z=v.filters.TicketDownloaded(e),M=await v.queryFilter(z);if(M.length===0&&(z=v.filters.TicketPurchased(e),M=await v.queryFilter(z)),M.length>0){const hg=M[M.length-1];W(hg.transactionHash)}}catch(v){console.log("Could not load transaction hash:",v.message)}},Y=async()=>{if(!I||!n){K.error("Please connect your wallet and switch to the correct network");return}if(S){K.error("You already have a ticket for this event!");return}o(!0);try{const v=await gl();K.loading("Purchasing ticket...",{id:"purchase"});const z=await v.buyTicket(e,{value:BigInt(l.price)});K.loading("Waiting for confirmation...",{id:"purchase"}),await z.wait(),K.success("Ticket purchased successfully!",{id:"purchase"}),console.log("Purchase transaction completed:",z.hash);try{(await fetch("http://localhost:5000/api/purchases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ticketId:parseInt(e),walletAddress:t,purchaseTxHash:z.hash,eventName:l.eventName,organizer:l.organizer,eventDate:l.eventDate,posterUrl:l.posterUrl,ticketImageUrl:l.ticketImageUrl,price:l.price,seller:l.seller})})).ok||console.warn("Failed to store purchase information in backend")}catch(M){console.warn("Backend error:",M)}await X();try{window.dispatchEvent(new CustomEvent("ticketsUpdated",{detail:{ticketId:e,action:"purchased"}}))}catch{}}catch(v){console.error("Error purchasing ticket:",v),v.message.includes("You already have a ticket")?K.error("You already own a ticket for this event!"):K.error(v.message||"Failed to purchase ticket")}finally{o(!1)}},N=async()=>{if(!I||!n){K.error("Please connect your wallet and switch to the correct network");return}A(!0);try{K.loading("Downloading ticket...",{id:"download"});const z=await(await gl()).downloadTicket(e);K.loading("Waiting for confirmation...",{id:"download"});const M=await z.wait();W(z.hash),K.success("Ticket downloaded successfully! NFT minted to your wallet.",{id:"download"}),await X();try{window.dispatchEvent(new CustomEvent("ticketsUpdated",{detail:{ticketId:e,action:"downloaded",txHash:z==null?void 0:z.hash}}))}catch{}}catch(v){console.error("Error downloading ticket:",v),K.error(v.message||"Failed to download ticket")}finally{A(!1)}},j=async()=>{if(!I||!n){K.error("Please connect your wallet and switch to the correct network");return}m(!0);try{const z=await(await gl()).verifyTicket(e);G(z),z?K.success("Ticket verification successful!"):K.error("Ticket verification failed")}catch(v){console.error("Error verifying ticket:",v),K.error(v.message||"Failed to verify ticket"),G(!1)}finally{m(!1)}},_=v=>v.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),tg=()=>new Date<l.saleEndDate,F=()=>l.buyer&&t&&l.buyer.toLowerCase()===t.toLowerCase(),T=()=>l.seller&&t&&l.seller.toLowerCase()===t.toLowerCase(),gg=()=>I&&n&&tg()&&!l.isSold&&!l.isRefunded&&Number(l.availableTickets||0)>0&&!S,x=()=>I&&n&&l.isSold&&F()&&!l.isDownloaded&&!l.isRefunded,L=()=>I&&n&&l.isDownloaded;return s&&!l?i.jsx("div",{className:"flex items-center justify-center min-h-64",children:i.jsxs("div",{className:"text-center",children:[i.jsx(Dg,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary-600"}),i.jsx("p",{className:"text-gray-600",children:"Loading ticket details..."})]})}):h||!l?i.jsx("div",{className:"text-center",children:i.jsxs("div",{className:"card max-w-md mx-auto",children:[i.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Ticket Not Found"}),i.jsx("p",{className:"text-gray-600 mb-6",children:"The ticket you're looking for doesn't exist or has been removed."}),i.jsx("button",{onClick:()=>g("/tickets"),className:"btn-primary",children:"Back to Events"})]})}):i.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[i.jsxs("button",{onClick:()=>g("/tickets"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[i.jsx(EV,{className:"w-4 h-4"}),i.jsx("span",{children:"Back to Events"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"card",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Event Poster"}),i.jsx("div",{className:"aspect-video bg-gray-200 rounded-lg overflow-hidden",children:i.jsx(jV,{cid:l.posterUrl,alt:l.eventName,className:"w-full h-full object-cover",fallbackSrc:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDMyMCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMjAiIGhlaWdodD0iMTgwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xNjAgODBDMTYwIDgwIDE2MCA4MCAxNjAgODBDMTYwIDgwIDE2MCA4MCAxNjAgODBaIiBmaWxsPSIjOUNBM0FGIi8+Cjx0ZXh0IHg9IjE2MCIgeT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNkI3MjgwIiBmb250LWZhbWlseT0ic3lzdGVtLXVpIiBmb250LXNpemU9IjE0Ij5JbWFnZSBub3QgZm91bmQ8L3RleHQ+Cjwvc3ZnPgo="})})]}),i.jsxs("div",{className:"card",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ticket Design"}),i.jsx("div",{className:"aspect-video bg-gray-200 rounded-lg overflow-hidden",children:i.jsx("img",{src:DV(l.ticketImageUrl.replace("ipfs://","")),alt:`${l.eventName} Ticket`,className:"w-full h-full object-cover",onError:v=>{v.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDMyMCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMjAiIGhlaWdodD0iMTgwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xNjAgODBDMTYwIDgwIDE2MCA4MCAxNjAgODBDMTYwIDgwIDE2MCA4MCAxNjAgODBaIiBmaWxsPSIjOUNBM0FGIi8+Cjx0ZXh0IHg9IjE2MCIgeT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNkI3MjgwIiBmb250LWZhbWlseT0ic3lzdGVtLXVpIiBmb250LXNpemU9IjE0Ij5JbWFnZSBub3QgZm91bmQ8L3RleHQ+Cjwvc3ZnPgo="}})})]})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"card",children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:l.eventName}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center text-gray-600",children:[i.jsx(Ve,{className:"w-5 h-5 mr-3"}),i.jsx("span",{className:"font-medium",children:"Organizer:"}),i.jsx("span",{className:"ml-2",children:l.organizer})]}),i.jsxs("div",{className:"flex items-center text-gray-600",children:[i.jsx(nl,{className:"w-5 h-5 mr-3"}),i.jsx("span",{className:"font-medium",children:"Event Date:"}),i.jsx("span",{className:"ml-2",children:_(l.eventDate)})]}),i.jsxs("div",{className:"flex items-center text-gray-600",children:[i.jsx(Ui,{className:"w-5 h-5 mr-3"}),i.jsx("span",{className:"font-medium",children:"Sale Ends:"}),i.jsx("span",{className:"ml-2",children:_(l.saleEndDate)})]}),i.jsxs("div",{className:"flex items-center text-gray-600",children:[i.jsx(zV,{className:"w-5 h-5 mr-3"}),i.jsx("span",{className:"font-medium",children:"Price:"}),i.jsxs("span",{className:"ml-2 text-xl font-bold text-primary-600",children:[Wc(l.price)," ETH"]})]}),i.jsxs("div",{className:"flex items-center text-gray-600",children:[i.jsx(Ve,{className:"w-5 h-5 mr-3"}),i.jsx("span",{className:"font-medium",children:"Available Tickets:"}),i.jsxs("span",{className:"ml-2 font-semibold",children:[Number(l.availableTickets||0)," / ",Number(l.totalTickets||0)]})]})]})]}),i.jsxs("div",{className:"card",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ticket Status"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Sale Status:"}),i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${tg()?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:tg()?"Active":"Ended"})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Purchase Status:"}),i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l.isSold?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:l.isSold?"Sold":"Available"})]}),l.isSold&&i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Download Status:"}),i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l.isDownloaded?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:l.isDownloaded?"Downloaded":"Pending Download"})]}),l.isSold&&i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Transfer Status:"}),i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l.isSecondHand?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:l.isSecondHand?"Non-Transferable (Limit Reached)":"Transferable"})]}),l.isRefunded&&i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Refund Status:"}),i.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Refunded"})]}),S&&i.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg flex items-start gap-2",children:[i.jsx(kc,{className:"w-5 h-5 text-yellow-600 shrink-0 mt-0.5"}),i.jsxs("div",{className:"text-sm text-yellow-800",children:[i.jsx("span",{className:"font-semibold",children:"Wallet Limit Reached:"})," You already own a ticket for ",i.jsx("strong",{children:l.eventName}),". You cannot buy another one unless you transfer your existing ticket."]})]})]})]}),i.jsxs("div",{className:"card",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actions"}),i.jsxs("div",{className:"space-y-3",children:[gg()&&i.jsx("button",{onClick:Y,disabled:a,className:"w-full btn-primary flex items-center justify-center space-x-2",children:a?i.jsxs(i.Fragment,{children:[i.jsx(Dg,{className:"w-5 h-5 animate-spin"}),i.jsx("span",{children:"Processing..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(Gy,{className:"w-5 h-5"}),i.jsx("span",{children:"Buy Ticket"})]})}),S&&!l.isSold&&i.jsxs("button",{disabled:!0,className:"w-full bg-gray-100 text-gray-400 border border-gray-200 font-medium py-2 rounded-lg cursor-not-allowed flex items-center justify-center gap-2",children:[i.jsx(Gy,{className:"w-5 h-5"}),i.jsx("span",{children:"Limit Reached (1 Per Wallet)"})]}),x()&&i.jsx("button",{onClick:N,disabled:c,className:"w-full btn-primary flex items-center justify-center space-x-2",children:c?i.jsxs(i.Fragment,{children:[i.jsx(Dg,{className:"w-5 h-5 animate-spin"}),i.jsx("span",{children:"Downloading..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(pm,{className:"w-5 h-5"}),i.jsx("span",{children:"Download Ticket"})]})}),L()&&i.jsx("button",{onClick:j,disabled:b,className:"w-full btn-outline flex items-center justify-center space-x-2",children:b?i.jsxs(i.Fragment,{children:[i.jsx(Dg,{className:"w-5 h-5 animate-spin"}),i.jsx("span",{children:"Verifying..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(GI,{className:"w-5 h-5"}),i.jsx("span",{children:"Verify Ticket"})]})}),l.isDownloaded&&F()&&i.jsxs("button",{onClick:()=>g(`/ticket/${e}/print`),className:"w-full btn-outline flex items-center justify-center space-x-2",children:[i.jsx(pm,{className:"w-5 h-5"}),i.jsx("span",{children:"Print Ticket"})]}),Z!==null&&i.jsxs("div",{className:`p-3 rounded-lg flex items-center space-x-2 ${Z?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[Z?i.jsx(ZC,{className:"w-5 h-5"}):i.jsx(zi,{className:"w-5 h-5"}),i.jsx("span",{children:Z?"Ticket is valid!":"Ticket verification failed"})]}),!I&&i.jsx("div",{className:"text-center text-gray-500 py-4",children:"Connect your wallet to interact with tickets"}),I&&!n&&i.jsx("div",{className:"text-center text-red-500 py-4",children:"Please switch to Sepolia or Localhost network"})]})]}),l.isDownloaded&&i.jsxs("div",{className:"card",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ticket Details"}),i.jsxs("div",{className:"space-y-3 text-sm",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Ticket Number:"}),i.jsxs("span",{className:"font-mono font-semibold",children:["#",l.id]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Contract Address:"}),i.jsx("span",{className:"font-mono text-xs",children:gt(Lt==null?void 0:Lt.address)})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Token ID:"}),i.jsx("span",{className:"font-mono font-semibold",children:l.id})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Buyer Address:"}),i.jsx("span",{className:"font-mono text-xs",children:gt(l.buyer)})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Transaction Hash:"}),i.jsx("span",{className:"font-mono text-xs text-blue-600",children:y?`${y.slice(0,10)}...`:"N/A"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Network:"}),i.jsx("span",{className:"font-semibold",children:"Localhost (31337)"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Block Explorer:"}),i.jsx("span",{className:"text-blue-600 text-xs",children:"Local Network"})]})]})]}),i.jsxs("div",{className:"card",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Seller Information"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("span",{className:"text-gray-600",children:"Seller:"}),i.jsx("span",{className:"font-mono text-sm",children:gt(l.seller)})]})]}),T()&&i.jsx(jH,{ticket:l,onUpdate:X})]})]})]})},OH=()=>{const{isConnected:e,isSupportedNetwork:g}=ft(),[t]=D2(),[I,n]=B.useState(""),[l,C]=B.useState(""),[s,r]=B.useState(!1),[a,o]=B.useState(null),[c,A]=B.useState(null),[b,m]=B.useState("ticketId");B.useEffect(()=>{const h=t.get("id");h&&n(h)},[t]);const Z=async h=>{if(h.preventDefault(),!e||!g){K.error("Please connect your wallet and switch to the correct network");return}if(b==="ticketId"&&!I.trim()){K.error("Please enter a ticket ID");return}if(b==="transactionHash"&&!l.trim()){K.error("Please enter a transaction hash");return}r(!0),o(null),A(null);try{const u=await gl();let y=!1,W=null;if(b==="ticketId"){if(y=await u.verifyTicket(I),y)try{const S=await u.getTicket(I);W={ticketId:I,eventName:S.eventName,organizer:S.organizer,eventDate:new Date(Number(S.eventDate)*1e3),price:S.price.toString(),seller:S.seller,buyer:S.buyer,isDownloaded:S.isDownloaded,totalTickets:Number(S.totalTickets),availableTickets:Number(S.availableTickets)}}catch(S){console.error("Error fetching ticket details:",S)}}else try{const S=vv();if(console.log("Provider:",S),!S)throw new Error("Provider not available");console.log("Getting transaction for hash:",l);const J=await S.getTransaction(l);if(console.log("Transaction found:",J),!J)throw new Error("Transaction not found");console.log("Getting transaction receipt...");const f=await S.getTransactionReceipt(l);if(console.log("Transaction receipt found:",f),!f)throw new Error("Transaction receipt not found");const X=mI();console.log("Read-only contract:",X),console.log("Receipt logs:",f.logs);const U=f.logs.filter(Y=>{try{const N=X.interface.parseLog(Y);return console.log("Decoded log:",N),N.name==="TicketDownloaded"||N.name==="TicketPurchased"}catch(N){return console.log("Error parsing log:",N),!1}});if(console.log("Filtered events:",U),U.length>0){const Y=X.interface.parseLog(U[0]),N=Y.args.ticketId.toString();if(console.log("Found ticket ID:",N),console.log("Event type:",Y.name),y=await u.verifyTicket(N),y){const j=await u.getTicket(N);W={ticketId:N,transactionHash:l,eventName:j.eventName,organizer:j.organizer,eventDate:new Date(Number(j.eventDate)*1e3),price:j.price.toString(),seller:j.seller,buyer:j.buyer,isDownloaded:j.isDownloaded,totalTickets:Number(j.totalTickets),availableTickets:Number(j.availableTickets)}}}else throw new Error("No TicketDownloaded or TicketPurchased event found in this transaction")}catch(S){throw console.error("Error verifying by transaction hash:",S),new Error("Invalid transaction hash or transaction does not contain a ticket purchase/download event")}o(y),A(W),y?K.success("Ticket verification successful!"):K.error("Ticket verification failed")}catch(u){console.error("Error verifying ticket:",u),K.error(u.message||"Failed to verify ticket"),o(!1)}finally{r(!1)}},G=h=>h.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return i.jsx("div",{className:"max-w-2xl mx-auto",children:i.jsxs("div",{className:"card",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(GI,{className:"w-8 h-8 text-primary-600"})}),i.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Verify Ticket"}),i.jsx("p",{className:"text-gray-600",children:"Verify the authenticity and ownership of an NFT ticket"})]}),e?g?i.jsxs("form",{onSubmit:Z,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"label",children:"Verification Method"}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsxs("label",{className:"flex items-center",children:[i.jsx("input",{type:"radio",name:"verificationMethod",value:"ticketId",checked:b==="ticketId",onChange:h=>m(h.target.value),className:"mr-2"}),i.jsx("span",{children:"By Ticket ID"})]}),i.jsxs("label",{className:"flex items-center",children:[i.jsx("input",{type:"radio",name:"verificationMethod",value:"transactionHash",checked:b==="transactionHash",onChange:h=>m(h.target.value),className:"mr-2"}),i.jsx("span",{children:"By Transaction Hash"})]})]})]}),b==="ticketId"&&i.jsxs("div",{children:[i.jsxs("label",{className:"label",children:[i.jsx(Bm,{className:"w-4 h-4 inline mr-2"}),"Ticket ID"]}),i.jsx("input",{type:"text",value:I,onChange:h=>n(h.target.value),className:"input-field",placeholder:"Enter ticket ID to verify"})]}),b==="transactionHash"&&i.jsxs("div",{children:[i.jsxs("label",{className:"label",children:[i.jsx(Bm,{className:"w-4 h-4 inline mr-2"}),"Transaction Hash"]}),i.jsx("input",{type:"text",value:l,onChange:h=>C(h.target.value),className:"input-field",placeholder:"Enter transaction hash to verify"}),i.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Enter the transaction hash from when the ticket was purchased or downloaded"})]}),i.jsx("button",{type:"submit",disabled:s,className:"w-full btn-primary flex items-center justify-center space-x-2",children:s?i.jsxs(i.Fragment,{children:[i.jsx(Dg,{className:"w-5 h-5 animate-spin"}),i.jsx("span",{children:"Verifying..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(GI,{className:"w-5 h-5"}),i.jsx("span",{children:"Verify Ticket"})]})})]}):i.jsx("div",{className:"text-center py-8",children:i.jsx("div",{className:"text-red-500 mb-4",children:"Please switch to Sepolia or Localhost network"})}):i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"text-gray-500 mb-4",children:"Connect your wallet to verify tickets"}),i.jsx("button",{onClick:()=>window.location.reload(),className:"btn-primary",children:"Connect Wallet"})]}),a!==null&&i.jsx("div",{className:"mt-8",children:i.jsxs("div",{className:`p-6 rounded-lg ${a?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[i.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[a?i.jsx(ZC,{className:"w-8 h-8 text-green-600"}):i.jsx(zi,{className:"w-8 h-8 text-red-600"}),i.jsxs("div",{children:[i.jsx("h3",{className:`text-xl font-semibold ${a?"text-green-800":"text-red-800"}`,children:a?"Ticket Verified!":"Verification Failed"}),i.jsx("p",{className:`${a?"text-green-600":"text-red-600"}`,children:a?"This ticket is authentic and owned by your wallet":"This ticket is invalid or not owned by your wallet"})]})]}),c&&i.jsxs("div",{className:"bg-white rounded-lg p-4 space-y-3",children:[i.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Ticket Details"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(nl,{className:"w-4 h-4 text-gray-500"}),i.jsx("span",{className:"text-gray-600",children:"Event:"}),i.jsx("span",{className:"font-medium",children:c.eventName})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Ve,{className:"w-4 h-4 text-gray-500"}),i.jsx("span",{className:"text-gray-600",children:"Organizer:"}),i.jsx("span",{className:"font-medium",children:c.organizer})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(nl,{className:"w-4 h-4 text-gray-500"}),i.jsx("span",{className:"text-gray-600",children:"Date:"}),i.jsx("span",{className:"font-medium",children:G(c.eventDate)})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("span",{className:"text-gray-600",children:"Status:"}),i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${c.isDownloaded?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:c.isDownloaded?"Downloaded":"Pending Download"})]}),c.ticketId&&i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("span",{className:"text-gray-600",children:"Ticket ID:"}),i.jsx("span",{className:"font-mono text-sm",children:c.ticketId})]}),c.transactionHash&&i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("span",{className:"text-gray-600",children:"Transaction Hash:"}),i.jsxs("span",{className:"font-mono text-xs text-blue-600",children:[c.transactionHash.slice(0,10),"...",c.transactionHash.slice(-8)]})]}),c.totalTickets!==void 0&&i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("span",{className:"text-gray-600",children:"Total Tickets:"}),i.jsx("span",{className:"font-medium",children:c.totalTickets})]}),c.availableTickets!==void 0&&i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("span",{className:"text-gray-600",children:"Available:"}),i.jsx("span",{className:"font-medium",children:c.availableTickets})]})]}),i.jsx("div",{className:"pt-3 border-t border-gray-200",children:i.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[i.jsxs("div",{children:["Seller: ",gt(c.seller)]}),i.jsxs("div",{children:["Buyer: ",gt(c.buyer)]})]})})]})]})}),i.jsxs("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:[i.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"How to Verify"}),i.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[i.jsx("li",{children:" Enter the ticket ID you want to verify"}),i.jsx("li",{children:" Make sure you're connected with the wallet that owns the ticket"}),i.jsx("li",{children:" The system will check if the ticket is valid and owned by you"}),i.jsx("li",{children:" Only downloaded tickets can be verified"})]})]})]})})};function Wm(){return Wm=Object.assign?Object.assign.bind():function(e){for(var g=1;g<arguments.length;g++){var t=arguments[g];for(var I in t)({}).hasOwnProperty.call(t,I)&&(e[I]=t[I])}return e},Wm.apply(null,arguments)}function Qi(e){"@babel/helpers - typeof";return Qi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},Qi(e)}function qH(e,g){if(Qi(e)!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var I=t.call(e,g||"default");if(Qi(I)!="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(e)}function _H(e){var g=qH(e,"string");return Qi(g)=="symbol"?g:g+""}function $H(e,g,t){return(g=_H(g))in e?Object.defineProperty(e,g,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[g]=t,e}function g1(e){if(Array.isArray(e))return e}function e1(e,g){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var I,n,l,C,s=[],r=!0,a=!1;try{if(l=(t=t.call(e)).next,g===0){if(Object(t)!==t)return;r=!1}else for(;!(r=(I=l.call(t)).done)&&(s.push(I.value),s.length!==g);r=!0);}catch(o){a=!0,n=o}finally{try{if(!r&&t.return!=null&&(C=t.return(),Object(C)!==C))return}finally{if(a)throw n}}return s}}function Sy(e,g){(g==null||g>e.length)&&(g=e.length);for(var t=0,I=Array(g);t<g;t++)I[t]=e[t];return I}function t1(e,g){if(e){if(typeof e=="string")return Sy(e,g);var t={}.toString.call(e).slice(8,-1);return t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set"?Array.from(e):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Sy(e,g):void 0}}function I1(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n1(e,g){return g1(e)||e1(e,g)||t1(e,g)||I1()}function l1(e,g){if(e==null)return{};var t={};for(var I in e)if({}.hasOwnProperty.call(e,I)){if(g.indexOf(I)!==-1)continue;t[I]=e[I]}return t}function C1(e,g){if(e==null)return{};var t,I,n=l1(e,g);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(I=0;I<l.length;I++)t=l[I],g.indexOf(t)===-1&&{}.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var PV={exports:{}},mg={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pg=typeof Symbol=="function"&&Symbol.for,s0=Pg?Symbol.for("react.element"):60103,r0=Pg?Symbol.for("react.portal"):60106,WA=Pg?Symbol.for("react.fragment"):60107,SA=Pg?Symbol.for("react.strict_mode"):60108,RA=Pg?Symbol.for("react.profiler"):60114,kA=Pg?Symbol.for("react.provider"):60109,XA=Pg?Symbol.for("react.context"):60110,i0=Pg?Symbol.for("react.async_mode"):60111,JA=Pg?Symbol.for("react.concurrent_mode"):60111,wA=Pg?Symbol.for("react.forward_ref"):60112,YA=Pg?Symbol.for("react.suspense"):60113,s1=Pg?Symbol.for("react.suspense_list"):60120,vA=Pg?Symbol.for("react.memo"):60115,NA=Pg?Symbol.for("react.lazy"):60116,r1=Pg?Symbol.for("react.block"):60121,i1=Pg?Symbol.for("react.fundamental"):60117,a1=Pg?Symbol.for("react.responder"):60118,o1=Pg?Symbol.for("react.scope"):60119;function nt(e){if(typeof e=="object"&&e!==null){var g=e.$$typeof;switch(g){case s0:switch(e=e.type,e){case i0:case JA:case WA:case RA:case SA:case YA:return e;default:switch(e=e&&e.$$typeof,e){case XA:case wA:case NA:case vA:case kA:return e;default:return g}}case r0:return g}}}function OV(e){return nt(e)===JA}mg.AsyncMode=i0;mg.ConcurrentMode=JA;mg.ContextConsumer=XA;mg.ContextProvider=kA;mg.Element=s0;mg.ForwardRef=wA;mg.Fragment=WA;mg.Lazy=NA;mg.Memo=vA;mg.Portal=r0;mg.Profiler=RA;mg.StrictMode=SA;mg.Suspense=YA;mg.isAsyncMode=function(e){return OV(e)||nt(e)===i0};mg.isConcurrentMode=OV;mg.isContextConsumer=function(e){return nt(e)===XA};mg.isContextProvider=function(e){return nt(e)===kA};mg.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===s0};mg.isForwardRef=function(e){return nt(e)===wA};mg.isFragment=function(e){return nt(e)===WA};mg.isLazy=function(e){return nt(e)===NA};mg.isMemo=function(e){return nt(e)===vA};mg.isPortal=function(e){return nt(e)===r0};mg.isProfiler=function(e){return nt(e)===RA};mg.isStrictMode=function(e){return nt(e)===SA};mg.isSuspense=function(e){return nt(e)===YA};mg.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===WA||e===JA||e===RA||e===SA||e===YA||e===s1||typeof e=="object"&&e!==null&&(e.$$typeof===NA||e.$$typeof===vA||e.$$typeof===kA||e.$$typeof===XA||e.$$typeof===wA||e.$$typeof===i1||e.$$typeof===a1||e.$$typeof===o1||e.$$typeof===r1)};mg.typeOf=nt;/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Ry=Object.getOwnPropertySymbols,c1=Object.prototype.hasOwnProperty,A1=Object.prototype.propertyIsEnumerable;function d1(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function u1(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var g={},t=0;t<10;t++)g["_"+String.fromCharCode(t)]=t;var I=Object.getOwnPropertyNames(g).map(function(l){return g[l]});if(I.join("")!=="0123456789")return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(l){n[l]=l}),Object.keys(Object.assign({},n)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}u1();var m1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",h1=m1;Function.call.bind(Object.prototype.hasOwnProperty);var b1=h1;function qV(){}function _V(){}_V.resetWarningCache=qV;var Z1=function(){function e(I,n,l,C,s,r){if(r!==b1){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}e.isRequired=e;function g(){return e}var t={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:g,element:e,elementType:e,instanceOf:g,node:e,objectOf:g,oneOf:g,oneOfType:g,shape:g,exact:g,checkPropTypes:_V,resetWarningCache:qV};return t.PropTypes=t,t};PV.exports=Z1();var YC=PV.exports;function y1(e,g){var t=atob(e);if(g){for(var I=new Uint8Array(t.length),n=0,l=t.length;n<l;++n)I[n]=t.charCodeAt(n);return String.fromCharCode.apply(null,new Uint16Array(I.buffer))}return t}function G1(e,g,t){var I=g===void 0?null:g,n=t===void 0?!1:t,l=y1(e,n),C=l.indexOf(`
`,10)+1,s=l.substring(C)+(I?"//# sourceMappingURL="+I:""),r=new Blob([s],{type:"application/javascript"});return URL.createObjectURL(r)}function p1(e,g,t){var I;return function(l){return I=I||G1(e,g,t),new Worker(I,l)}}var B1=p1("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldEF1Z21lbnRlZE5hbWVzcGFjZShuKSB7CgkJaWYgKG4uX19lc01vZHVsZSkgcmV0dXJuIG47CgkJdmFyIGEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgkJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCQl2YXIgZCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobiwgayk7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBrLCBkLmdldCA/IGQgOiB7CgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuIG5ba107CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiBhOwoJfQoKCXZhciBCaW5hcnlCaXRtYXAkMSA9IHt9OwoKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBFeGNlcHRpb24kMSA9IHt9OwoKCWZ1bmN0aW9uIGZpeFByb3RvKHRhcmdldCwgcHJvdG90eXBlKSB7CgkgIHZhciBzZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZjsKCSAgc2V0UHJvdG90eXBlT2YgPyBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvdHlwZSkgOiB0YXJnZXQuX19wcm90b19fID0gcHJvdG90eXBlOwoJfQoJZnVuY3Rpb24gZml4U3RhY2sodGFyZ2V0LCBmbikgewoJICBpZiAoZm4gPT09IHZvaWQgMCkgewoJICAgIGZuID0gdGFyZ2V0LmNvbnN0cnVjdG9yOwoJICB9CgoJICB2YXIgY2FwdHVyZVN0YWNrVHJhY2UgPSBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZTsKCSAgY2FwdHVyZVN0YWNrVHJhY2UgJiYgY2FwdHVyZVN0YWNrVHJhY2UodGFyZ2V0LCBmbik7Cgl9CgoJdmFyIF9fZXh0ZW5kcyRrID0gZnVuY3Rpb24gKCkgewoJICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CgkgICAgICBfX3Byb3RvX186IFtdCgkgICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICBkLl9fcHJvdG9fXyA9IGI7CgkgICAgfSB8fCBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0KCSAgICB9OwoKCSAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgfTsKCgkgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgoJICAgIGZ1bmN0aW9uIF9fKCkgewoJICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7CgkgICAgfQoKCSAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgIH07Cgl9KCk7CgoJdmFyIEN1c3RvbUVycm9yID0gZnVuY3Rpb24gKF9zdXBlcikgewoJICBfX2V4dGVuZHMkayhDdXN0b21FcnJvciwgX3N1cGVyKTsKCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKG1lc3NhZ2UpIHsKCSAgICB2YXIgX25ld1RhcmdldCA9IHRoaXMuY29uc3RydWN0b3I7CgoJICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7CgoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpcywgJ25hbWUnLCB7CgkgICAgICB2YWx1ZTogX25ld1RhcmdldC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmaXhQcm90byhfdGhpcywgX25ld1RhcmdldC5wcm90b3R5cGUpOwoJICAgIGZpeFN0YWNrKF90aGlzKTsKCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCgkgIHJldHVybiBDdXN0b21FcnJvcjsKCX0oRXJyb3IpOwoKCXZhciBfX3NwcmVhZEFycmF5cyA9IGZ1bmN0aW9uICgpIHsKCSAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKCSAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7IHMgKz0gYXJndW1lbnRzJDFbaV0ubGVuZ3RoOyB9CgoJICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspIHsgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspIHsgcltrXSA9IGFbal07IH0gfQoKCSAgcmV0dXJuIHI7Cgl9OwoJZnVuY3Rpb24gY3VzdG9tRXJyb3JGYWN0b3J5KGZuLCBwYXJlbnQpIHsKCSAgaWYgKHBhcmVudCA9PT0gdm9pZCAwKSB7CgkgICAgcGFyZW50ID0gRXJyb3I7CgkgIH0KCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKCkgewoJICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKCgkgICAgdmFyIGFyZ3MgPSBbXTsKCgkgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzJDFbX2ldOwoJICAgIH0KCgkgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEN1c3RvbUVycm9yKSkgeyByZXR1cm4gbmV3IChDdXN0b21FcnJvci5iaW5kLmFwcGx5KEN1c3RvbUVycm9yLCBfX3NwcmVhZEFycmF5cyhbdm9pZCAwXSwgYXJncykpKSgpOyB9CgkgICAgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3MpOwoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbmFtZScsIHsKCSAgICAgIHZhbHVlOiBmbi5uYW1lIHx8IHBhcmVudC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTsKCSAgICBmaXhTdGFjayh0aGlzLCBDdXN0b21FcnJvcik7CgkgIH0KCgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhDdXN0b21FcnJvciwgewoJICAgIHByb3RvdHlwZTogewoJICAgICAgdmFsdWU6IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSwgewoJICAgICAgICBjb25zdHJ1Y3RvcjogewoJICAgICAgICAgIHZhbHVlOiBDdXN0b21FcnJvciwKCSAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKCSAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICAgICAgfQoJICAgICAgfSkKCSAgICB9CgkgIH0pOwoJfQoKCXZhciBjdXN0b21FcnJvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlfX3Byb3RvX186IG51bGwsCgkJQ3VzdG9tRXJyb3I6IEN1c3RvbUVycm9yLAoJCWN1c3RvbUVycm9yRmFjdG9yeTogY3VzdG9tRXJyb3JGYWN0b3J5Cgl9KTsKCgl2YXIgcmVxdWlyZSQkMCA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UoY3VzdG9tRXJyb3IpOwoKCXZhciBfX2V4dGVuZHMkaiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIHRzX2N1c3RvbV9lcnJvcl8xID0gcmVxdWlyZSQkMDsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRqKEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICAvKioKCSAgICAgKiBBbGxvd3MgRXhjZXB0aW9uIHRvIGJlIGNvbnN0cnVjdGVkIGRpcmVjdGx5CgkgICAgICogd2l0aCBzb21lIG1lc3NhZ2UgYW5kIHByb3RvdHlwZSBkZWZpbml0aW9uLgoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEV4Y2VwdGlvbihtZXNzYWdlKSB7CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBFeGNlcHRpb24ucHJvdG90eXBlLmdldEtpbmQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBleCA9IHRoaXMuY29uc3RydWN0b3I7CgkgICAgICAgIHJldHVybiBleC5raW5kOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSXQncyB0eXBlZCBhcyBzdHJpbmcgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGFuZCBvdmVycmlkZW4uCgkgICAgICovCgkgICAgRXhjZXB0aW9uLmtpbmQgPSAnRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRXhjZXB0aW9uOwoJfSh0c19jdXN0b21fZXJyb3JfMS5DdXN0b21FcnJvcikpOwoJRXhjZXB0aW9uJDEuZGVmYXVsdCA9IEV4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSQ5ID0gRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCkgewoJICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7CgkgICAgfQoJICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0lsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbjsKCX0oRXhjZXB0aW9uXzEkOS5kZWZhdWx0KSk7CglJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMS5kZWZhdWx0ID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJ5Qml0bWFwJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgQmluYXJ5Qml0bWFwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEJpbmFyeUJpdG1hcChiaW5hcml6ZXIpIHsKCSAgICAgICAgdGhpcy5iaW5hcml6ZXIgPSBiaW5hcml6ZXI7CgkgICAgICAgIGlmIChiaW5hcml6ZXIgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhLmRlZmF1bHQoJ0JpbmFyaXplciBtdXN0IGJlIG5vbi1udWxsLicpOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gVGhlIHdpZHRoIG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIGJpdG1hcC4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29udmVydHMgb25lIHJvdyBvZiBsdW1pbmFuY2UgZGF0YSB0byAxIGJpdCBkYXRhLiBNYXkgYWN0dWFsbHkgZG8gdGhlIGNvbnZlcnNpb24sIG9yIHJldHVybgoJICAgICAqIGNhY2hlZCBkYXRhLiBDYWxsZXJzIHNob3VsZCBhc3N1bWUgdGhpcyBtZXRob2QgaXMgZXhwZW5zaXZlIGFuZCBjYWxsIGl0IGFzIHNlbGRvbSBhcyBwb3NzaWJsZS4KCSAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMUQgYmFyY29kZXMgYW5kIG1heSBjaG9vc2UgdG8gYXBwbHkgc2hhcnBlbmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB5IFRoZSByb3cgdG8gZmV0Y2gsIHdoaWNoIG11c3QgYmUgaW4gWzAsIGJpdG1hcCBoZWlnaHQpCgkgICAgICogQHBhcmFtIHJvdyBBbiBvcHRpb25hbCBwcmVhbGxvY2F0ZWQgYXJyYXkuIElmIG51bGwgb3IgdG9vIHNtYWxsLCBpdCB3aWxsIGJlIGlnbm9yZWQuCgkgICAgICogICAgICAgICAgICBJZiB1c2VkLCB0aGUgQmluYXJpemVyIHdpbGwgY2FsbCBCaXRBcnJheS5jbGVhcigpLiBBbHdheXMgdXNlIHRoZSByZXR1cm5lZCBvYmplY3QuCgkgICAgICogQHJldHVybiBUaGUgYXJyYXkgb2YgYml0cyBmb3IgdGhpcyByb3cgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgcm93IGNhbid0IGJlIGJpbmFyaXplZAoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUuZ2V0QmxhY2tSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEJsYWNrUm93KHksIHJvdyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBhIDJEIGFycmF5IG9mIGx1bWluYW5jZSBkYXRhIHRvIDEgYml0LiBBcyBhYm92ZSwgYXNzdW1lIHRoaXMgbWV0aG9kIGlzIGV4cGVuc2l2ZQoJICAgICAqIGFuZCBkbyBub3QgY2FsbCBpdCByZXBlYXRlZGx5LiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMkQgYmFyY29kZXMgYW5kIG1heSBvcgoJICAgICAqIG1heSBub3QgYXBwbHkgc2hhcnBlbmluZy4gVGhlcmVmb3JlLCBhIHJvdyBmcm9tIHRoaXMgbWF0cml4IG1heSBub3QgYmUgaWRlbnRpY2FsIHRvIG9uZQoJICAgICAqIGZldGNoZWQgdXNpbmcgZ2V0QmxhY2tSb3coKSwgc28gZG9uJ3QgbWl4IGFuZCBtYXRjaCBiZXR3ZWVuIHRoZW0uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIFRoZSAyRCBhcnJheSBvZiBiaXRzIGZvciB0aGUgaW1hZ2UgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgaW1hZ2UgY2FuJ3QgYmUgYmluYXJpemVkIHRvIG1ha2UgYSBtYXRyaXgKCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEJsYWNrTWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBUaGUgbWF0cml4IGlzIGNyZWF0ZWQgb24gZGVtYW5kIHRoZSBmaXJzdCB0aW1lIGl0IGlzIHJlcXVlc3RlZCwgdGhlbiBjYWNoZWQuIFRoZXJlIGFyZSB0d28KCSAgICAgICAgLy8gcmVhc29ucyBmb3IgdGhpczoKCSAgICAgICAgLy8gMS4gVGhpcyB3b3JrIHdpbGwgbmV2ZXIgYmUgZG9uZSBpZiB0aGUgY2FsbGVyIG9ubHkgaW5zdGFsbHMgMUQgUmVhZGVyIG9iamVjdHMsIG9yIGlmIGEKCSAgICAgICAgLy8gICAgMUQgUmVhZGVyIGZpbmRzIGEgYmFyY29kZSBiZWZvcmUgdGhlIDJEIFJlYWRlcnMgcnVuLgoJICAgICAgICAvLyAyLiBUaGlzIHdvcmsgd2lsbCBvbmx5IGJlIGRvbmUgb25jZSBldmVuIGlmIHRoZSBjYWxsZXIgaW5zdGFsbHMgbXVsdGlwbGUgMkQgUmVhZGVycy4KCSAgICAgICAgaWYgKHRoaXMubWF0cml4ID09PSBudWxsIHx8IHRoaXMubWF0cml4ID09PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gdGhpcy5iaW5hcml6ZXIuZ2V0QmxhY2tNYXRyaXgoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5tYXRyaXg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhpcyBiaXRtYXAgY2FuIGJlIGNyb3BwZWQuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5pc0Nyb3BTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggY3JvcHBlZCBpbWFnZSBkYXRhLiBJbXBsZW1lbnRhdGlvbnMgbWF5IGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlCgkgICAgICogb3JpZ2luYWwgZGF0YSByYXRoZXIgdGhhbiBhIGNvcHkuIE9ubHkgY2FsbGFibGUgaWYgaXNDcm9wU3VwcG9ydGVkKCkgaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBsZWZ0IFRoZSBsZWZ0IGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0V2lkdGgoKSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB0b3AgY29vcmRpbmF0ZSwgd2hpY2ggbXVzdCBiZSBpbiBbMCxnZXRIZWlnaHQoKSkKCSAgICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZSB0byBjcm9wLgoJICAgICAqIEByZXR1cm4gQSBjcm9wcGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBuZXdTb3VyY2UgPSB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5jcm9wKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIGJpdG1hcCBzdXBwb3J0cyBjb3VudGVyLWNsb2Nrd2lzZSByb3RhdGlvbi4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmlzUm90YXRlU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkuaXNSb3RhdGVTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpOwoJICAgICAgICByZXR1cm4gbmV3IEJpbmFyeUJpdG1hcCh0aGlzLmJpbmFyaXplci5jcmVhdGVCaW5hcml6ZXIobmV3U291cmNlKSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIHJvdGF0ZWQgaW1hZ2UgZGF0YSBieSA0NSBkZWdyZWVzIGNvdW50ZXJjbG9ja3dpc2UuCgkgICAgICogT25seSBjYWxsYWJsZSBpZiB7QGxpbmsgI2lzUm90YXRlU3VwcG9ydGVkKCl9IGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIEEgcm90YXRlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxhY2tNYXRyaXgoKS50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlIC8qOiBOb3RGb3VuZEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICByZXR1cm4gJyc7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaW5hcnlCaXRtYXA7Cgl9KCkpOwoJdmFyIF9kZWZhdWx0JDMgPSBCaW5hcnlCaXRtYXAkMS5kZWZhdWx0ID0gQmluYXJ5Qml0bWFwOwoKCXZhciBIeWJyaWRCaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBCaW5hcml6ZXIkMSA9IHt9OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJpemVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogVGhpcyBjbGFzcyBoaWVyYXJjaHkgcHJvdmlkZXMgYSBzZXQgb2YgbWV0aG9kcyB0byBjb252ZXJ0IGx1bWluYW5jZSBkYXRhIHRvIDEgYml0IGRhdGEuCgkgKiBJdCBhbGxvd3MgdGhlIGFsZ29yaXRobSB0byB2YXJ5IHBvbHltb3JwaGljYWxseSwgZm9yIGV4YW1wbGUgYWxsb3dpbmcgYSB2ZXJ5IGV4cGVuc2l2ZQoJICogdGhyZXNob2xkaW5nIHRlY2huaXF1ZSBmb3Igc2VydmVycyBhbmQgYSBmYXN0IG9uZSBmb3IgbW9iaWxlLiBJdCBhbHNvIHBlcm1pdHMgdGhlIGltcGxlbWVudGF0aW9uCgkgKiB0byB2YXJ5LCBlLmcuIGEgSk5JIHZlcnNpb24gZm9yIEFuZHJvaWQgYW5kIGEgSmF2YSBmYWxsYmFjayB2ZXJzaW9uIGZvciBvdGhlciBwbGF0Zm9ybXMuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpbmFyaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBCaW5hcml6ZXIoc291cmNlKSB7CgkgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOwoJICAgIH0KCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEx1bWluYW5jZVNvdXJjZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlOwoJICAgIH07CgkgICAgQmluYXJpemVyLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgcmV0dXJuIEJpbmFyaXplcjsKCX0oKSk7CglCaW5hcml6ZXIkMS5kZWZhdWx0ID0gQmluYXJpemVyOwoKCXZhciBCaXRBcnJheSQxID0ge307CgoJdmFyIEFycmF5cyQxID0ge307CgoJdmFyIFN5c3RlbSQxID0ge307CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN5c3RlbSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIFN5c3RlbSgpIHsKCSAgICB9CgkgICAgLy8gcHVibGljIHN0YXRpYyB2b2lkIGFycmF5Y29weShPYmplY3Qgc3JjLCBpbnQgc3JjUG9zLCBPYmplY3QgZGVzdCwgaW50IGRlc3RQb3MsIGludCBsZW5ndGgpCgkgICAgLyoqCgkgICAgICogTWFrZXMgYSBjb3B5IG9mIGEgYXJyYXkuCgkgICAgICovCgkgICAgU3lzdGVtLmFycmF5Y29weSA9IGZ1bmN0aW9uIChzcmMsIHNyY1BvcywgZGVzdCwgZGVzdFBvcywgbGVuZ3RoKSB7CgkgICAgICAgIC8vIFRPRE86IGJldHRlciB1c2Ugc3BsaXQgb3Igc2V0PwoJICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKCSAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdGltZSBpbiBtaWxsaXNlY29uZHMuCgkgICAgICovCgkgICAgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTsKCSAgICB9OwoJICAgIHJldHVybiBTeXN0ZW07Cgl9KCkpOwoJU3lzdGVtJDEuZGVmYXVsdCA9IFN5c3RlbTsKCgl2YXIgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyRoID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDggPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaChJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbi5raW5kID0gJ0luZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ4LmRlZmF1bHQpKTsKCUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uXzEgPSBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZyhBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKGluZGV4LCBtZXNzYWdlKSB7CgkgICAgICAgIGlmIChpbmRleCA9PT0gdm9pZCAwKSB7IGluZGV4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5pbmRleCA9IGluZGV4OwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24ua2luZCA9ICdBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb247Cgl9KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KSk7CglBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoKCXZhciBfX3ZhbHVlcyQ3ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5cyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtXzEkNSA9IFN5c3RlbSQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDkgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMSA9IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxOwoJdmFyIEFycmF5cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBcnJheXMoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQgYXJyYXkKCSAgICAgKiBvZiBpbnRzLgoJICAgICAqCgkgICAgICogQHBhcmFtIGEgdGhlIGFycmF5IHRvIGJlIGZpbGxlZAoJICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGJlIHN0b3JlZCBpbiBhbGwgZWxlbWVudHMgb2YgdGhlIGFycmF5CgkgICAgICovCgkgICAgQXJyYXlzLmZpbGwgPSBmdW5jdGlvbiAoYSwgdmFsKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKQoJICAgICAgICAgICAgYVtpXSA9IHZhbDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQKCSAgICAgKiByYW5nZSBvZiB0aGUgc3BlY2lmaWVkIGFycmF5IG9mIGludHMuICBUaGUgcmFuZ2UgdG8gYmUgZmlsbGVkCgkgICAgICogZXh0ZW5kcyBmcm9tIGluZGV4IHtAY29kZSBmcm9tSW5kZXh9LCBpbmNsdXNpdmUsIHRvIGluZGV4CgkgICAgICoge0Bjb2RlIHRvSW5kZXh9LCBleGNsdXNpdmUuICAoSWYge0Bjb2RlIGZyb21JbmRleD09dG9JbmRleH0sIHRoZQoJICAgICAqIHJhbmdlIHRvIGJlIGZpbGxlZCBpcyBlbXB0eS4pCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYSB0aGUgYXJyYXkgdG8gYmUgZmlsbGVkCgkgICAgICogQHBhcmFtIGZyb21JbmRleCB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgKGluY2x1c2l2ZSkgdG8gYmUKCSAgICAgKiAgICAgICAgZmlsbGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZQoJICAgICAqIEBwYXJhbSB0b0luZGV4IHRoZSBpbmRleCBvZiB0aGUgbGFzdCBlbGVtZW50IChleGNsdXNpdmUpIHRvIGJlCgkgICAgICogICAgICAgIGZpbGxlZCB3aXRoIHRoZSBzcGVjaWZpZWQgdmFsdWUKCSAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBiZSBzdG9yZWQgaW4gYWxsIGVsZW1lbnRzIG9mIHRoZSBhcnJheQoJICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPiB0b0luZGV4fQoJICAgICAqIEB0aHJvd3MgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPCAwfSBvcgoJICAgICAqICAgICAgICAge0Bjb2RlIHRvSW5kZXggPiBhLmxlbmd0aH0KCSAgICAgKi8KCSAgICBBcnJheXMuZmlsbFdpdGhpbiA9IGZ1bmN0aW9uIChhLCBmcm9tSW5kZXgsIHRvSW5kZXgsIHZhbCkgewoJICAgICAgICBBcnJheXMucmFuZ2VDaGVjayhhLmxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleDsgaSA8IHRvSW5kZXg7IGkrKykKCSAgICAgICAgICAgIGFbaV0gPSB2YWw7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDaGVja3MgdGhhdCB7QGNvZGUgZnJvbUluZGV4fSBhbmQge0Bjb2RlIHRvSW5kZXh9IGFyZSBpbgoJICAgICAqIHRoZSByYW5nZSBhbmQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiB0aGV5IGFyZW4ndC4KCSAgICAgKi8KCSAgICBBcnJheXMucmFuZ2VDaGVjayA9IGZ1bmN0aW9uIChhcnJheUxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KSB7CgkgICAgICAgIGlmIChmcm9tSW5kZXggPiB0b0luZGV4KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOS5kZWZhdWx0KCdmcm9tSW5kZXgoJyArIGZyb21JbmRleCArICcpID4gdG9JbmRleCgnICsgdG9JbmRleCArICcpJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGZyb21JbmRleCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KGZyb21JbmRleCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvSW5kZXggPiBhcnJheUxlbmd0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbl8xLmRlZmF1bHQodG9JbmRleCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEFycmF5cy5hc0xpc3QgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGFyZ3M7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlID0gZnVuY3Rpb24gKHJvd3MsIGNvbHMsIHZhbHVlKSB7CgkgICAgICAgIHZhciBhcnIgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiByb3dzIH0pOwoJICAgICAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlSW50MzJBcnJheSA9IGZ1bmN0aW9uIChyb3dzLCBjb2xzLCB2YWx1ZSkgewoJICAgICAgICB2YXIgYXJyID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogcm93cyB9KTsKCSAgICAgICAgcmV0dXJuIGFyci5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIEludDMyQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuZXF1YWxzID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHsKCSAgICAgICAgaWYgKCFmaXJzdCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIGlmICghc2Vjb25kKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKCFmaXJzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoIXNlY29uZC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZmlyc3QubGVuZ3RoICE9PSBzZWNvbmQubGVuZ3RoKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gZmlyc3QubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgaWYgKGZpcnN0W2ldICE9PSBzZWNvbmRbaV0pIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICBBcnJheXMuaGFzaENvZGUgPSBmdW5jdGlvbiAoYSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgaWYgKGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSAxOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgYV8xID0gX192YWx1ZXMkNyhhKSwgYV8xXzEgPSBhXzEubmV4dCgpOyAhYV8xXzEuZG9uZTsgYV8xXzEgPSBhXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBhXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGVsZW1lbnQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChhXzFfMSAmJiAhYV8xXzEuZG9uZSAmJiAoX2EgPSBhXzEucmV0dXJuKSkgX2EuY2FsbChhXzEpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBBcnJheXMuZmlsbFVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAoYSwgdmFsdWUpIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgIT09IGEubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGFbaV0gPSB2YWx1ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZiA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbmV3TGVuZ3RoKSB7CgkgICAgICAgIHJldHVybiBvcmlnaW5hbC5zbGljZSgwLCBuZXdMZW5ndGgpOwoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZlVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAob3JpZ2luYWwsIG5ld0xlbmd0aCkgewoJICAgICAgICBpZiAob3JpZ2luYWwubGVuZ3RoIDw9IG5ld0xlbmd0aCkgewoJICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgICAgIG5ld0FycmF5LnNldChvcmlnaW5hbCk7CgkgICAgICAgICAgICByZXR1cm4gbmV3QXJyYXk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9yaWdpbmFsLnNsaWNlKDAsIG5ld0xlbmd0aCk7CgkgICAgfTsKCSAgICBBcnJheXMuY29weU9mUmFuZ2UgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGZyb20sIHRvKSB7CgkgICAgICAgIHZhciBuZXdMZW5ndGggPSB0byAtIGZyb207CgkgICAgICAgIHZhciBjb3B5ID0gbmV3IEludDMyQXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgU3lzdGVtXzEkNS5kZWZhdWx0LmFycmF5Y29weShvcmlnaW5hbCwgZnJvbSwgY29weSwgMCwgbmV3TGVuZ3RoKTsKCSAgICAgICAgcmV0dXJuIGNvcHk7CgkgICAgfTsKCSAgICAvKgoJICAgICogUmV0dXJucyB0aGUgaW5kZXggb2Ygb2YgdGhlIGVsZW1lbnQgaW4gYSBzb3J0ZWQgYXJyYXkgb3IgKC1uLTEpIHdoZXJlIG4gaXMgdGhlIGluc2VydGlvbiBwb2ludAoJICAgICogZm9yIHRoZSBuZXcgZWxlbWVudC4KCSAgICAqIFBhcmFtZXRlcnM6CgkgICAgKiAgICAgYXIgLSBBIHNvcnRlZCBhcnJheQoJICAgICogICAgIGVsIC0gQW4gZWxlbWVudCB0byBzZWFyY2ggZm9yCgkgICAgKiAgICAgY29tcGFyYXRvciAtIEEgY29tcGFyYXRvciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHRha2VzIHR3byBhcmd1bWVudHM6IChhLCBiKSBhbmQgcmV0dXJuczoKCSAgICAqICAgICAgICBhIG5lZ2F0aXZlIG51bWJlciAgaWYgYSBpcyBsZXNzIHRoYW4gYjsKCSAgICAqICAgICAgICAwIGlmIGEgaXMgZXF1YWwgdG8gYjsKCSAgICAqICAgICAgICBhIHBvc2l0aXZlIG51bWJlciBvZiBhIGlzIGdyZWF0ZXIgdGhhbiBiLgoJICAgICogVGhlIGFycmF5IG1heSBjb250YWluIGR1cGxpY2F0ZSBlbGVtZW50cy4gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiBvbmUgZXF1YWwgZWxlbWVudHMgaW4gdGhlIGFycmF5LAoJICAgICogdGhlIHJldHVybmVkIHZhbHVlIGNhbiBiZSB0aGUgaW5kZXggb2YgYW55IG9uZSBvZiB0aGUgZXF1YWwgZWxlbWVudHMuCgkgICAgKgoJICAgICogaHR0cDovL2pzZmlkZGxlLm5ldC9hcnl6aG92L3BrZnN0NTUwLwoJICAgICovCgkgICAgQXJyYXlzLmJpbmFyeVNlYXJjaCA9IGZ1bmN0aW9uIChhciwgZWwsIGNvbXBhcmF0b3IpIHsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY29tcGFyYXRvcikgewoJICAgICAgICAgICAgY29tcGFyYXRvciA9IEFycmF5cy5udW1iZXJDb21wYXJhdG9yOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtID0gMDsKCSAgICAgICAgdmFyIG4gPSBhci5sZW5ndGggLSAxOwoJICAgICAgICB3aGlsZSAobSA8PSBuKSB7CgkgICAgICAgICAgICB2YXIgayA9IChuICsgbSkgPj4gMTsKCSAgICAgICAgICAgIHZhciBjbXAgPSBjb21wYXJhdG9yKGVsLCBhcltrXSk7CgkgICAgICAgICAgICBpZiAoY21wID4gMCkgewoJICAgICAgICAgICAgICAgIG0gPSBrICsgMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA8IDApIHsKCSAgICAgICAgICAgICAgICBuID0gayAtIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gLW0gLSAxOwoJICAgIH07CgkgICAgQXJyYXlzLm51bWJlckNvbXBhcmF0b3IgPSBmdW5jdGlvbiAoYSwgYikgewoJICAgICAgICByZXR1cm4gYSAtIGI7CgkgICAgfTsKCSAgICByZXR1cm4gQXJyYXlzOwoJfSgpKTsKCUFycmF5cyQxLmRlZmF1bHQgPSBBcnJheXM7CgoJdmFyIEludGVnZXIkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnRlZ2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogUG9ueWZpbGwgZm9yIEphdmEncyBJbnRlZ2VyIGNsYXNzLgoJICovCgl2YXIgSW50ZWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBJbnRlZ2VyKCkgewoJICAgIH0KCSAgICBJbnRlZ2VyLm51bWJlck9mVHJhaWxpbmdaZXJvcyA9IGZ1bmN0aW9uIChpKSB7CgkgICAgICAgIHZhciB5OwoJICAgICAgICBpZiAoaSA9PT0gMCkKCSAgICAgICAgICAgIHJldHVybiAzMjsKCSAgICAgICAgdmFyIG4gPSAzMTsKCSAgICAgICAgeSA9IGkgPDwgMTY7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDE2OwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgeSA9IGkgPDwgODsKCSAgICAgICAgaWYgKHkgIT09IDApIHsKCSAgICAgICAgICAgIG4gLT0gODsKCSAgICAgICAgICAgIGkgPSB5OwoJICAgICAgICB9CgkgICAgICAgIHkgPSBpIDw8IDQ7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDQ7CgkgICAgICAgICAgICBpID0geTsKCSAgICAgICAgfQoJICAgICAgICB5ID0gaSA8PCAyOwoJICAgICAgICBpZiAoeSAhPT0gMCkgewoJICAgICAgICAgICAgbiAtPSAyOwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG4gLSAoKGkgPDwgMSkgPj4+IDMxKTsKCSAgICB9OwoJICAgIEludGVnZXIubnVtYmVyT2ZMZWFkaW5nWmVyb3MgPSBmdW5jdGlvbiAoaSkgewoJICAgICAgICAvLyBIRCwgRmlndXJlIDUtNgoJICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDMyOwoJICAgICAgICB9CgkgICAgICAgIHZhciBuID0gMTsKCSAgICAgICAgaWYgKGkgPj4+IDE2ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDE2OwoJICAgICAgICAgICAgaSA8PD0gMTY7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGkgPj4+IDI0ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDg7CgkgICAgICAgICAgICBpIDw8PSA4OwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID4+PiAyOCA9PT0gMCkgewoJICAgICAgICAgICAgbiArPSA0OwoJICAgICAgICAgICAgaSA8PD0gNDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaSA+Pj4gMzAgPT09IDApIHsKCSAgICAgICAgICAgIG4gKz0gMjsKCSAgICAgICAgICAgIGkgPDw9IDI7CgkgICAgICAgIH0KCSAgICAgICAgbiAtPSBpID4+PiAzMTsKCSAgICAgICAgcmV0dXJuIG47CgkgICAgfTsKCSAgICBJbnRlZ2VyLnRvSGV4U3RyaW5nID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgcmV0dXJuIGkudG9TdHJpbmcoMTYpOwoJICAgIH07CgkgICAgSW50ZWdlci50b0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChpbnROdW1iZXIpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZyhwYXJzZUludChTdHJpbmcoaW50TnVtYmVyKSwgMikpOwoJICAgIH07CgkgICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4gVGhpcyBmdW5jdGlvbiBpcyBzb21ldGltZXMgcmVmZXJyZWQgdG8gYXMgdGhlIHBvcHVsYXRpb24gY291bnQuCgkgICAgLy8gUmV0dXJuczoKCSAgICAvLyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4KCSAgICBJbnRlZ2VyLmJpdENvdW50ID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgLy8gSEQsIEZpZ3VyZSA1LTIKCSAgICAgICAgaSA9IGkgLSAoKGkgPj4+IDEpICYgMHg1NTU1NTU1NSk7CgkgICAgICAgIGkgPSAoaSAmIDB4MzMzMzMzMzMpICsgKChpID4+PiAyKSAmIDB4MzMzMzMzMzMpOwoJICAgICAgICBpID0gKGkgKyAoaSA+Pj4gNCkpICYgMHgwZjBmMGYwZjsKCSAgICAgICAgaSA9IGkgKyAoaSA+Pj4gOCk7CgkgICAgICAgIGkgPSBpICsgKGkgPj4+IDE2KTsKCSAgICAgICAgcmV0dXJuIGkgJiAweDNmOwoJICAgIH07CgkgICAgSW50ZWdlci50cnVuY0RpdmlzaW9uID0gZnVuY3Rpb24gKGRpdmlkZW5kLCBkaXZpc29yKSB7CgkgICAgICAgIHJldHVybiBNYXRoLnRydW5jKGRpdmlkZW5kIC8gZGl2aXNvcik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBBIHN0cmluZyB0byBhbiBpbnRlZ2VyLgoJICAgICAqIEBwYXJhbSBzIEEgc3RyaW5nIHRvIGNvbnZlcnQgaW50byBhIG51bWJlci4KCSAgICAgKiBAcGFyYW0gcmFkaXggQSB2YWx1ZSBiZXR3ZWVuIDIgYW5kIDM2IHRoYXQgc3BlY2lmaWVzIHRoZSBiYXNlIG9mIHRoZSBudW1iZXIgaW4gbnVtU3RyaW5nLiBJZiB0aGlzIGFyZ3VtZW50IGlzIG5vdCBzdXBwbGllZCwgc3RyaW5ncyB3aXRoIGEgcHJlZml4IG9mICcweCcgYXJlIGNvbnNpZGVyZWQgaGV4YWRlY2ltYWwuIEFsbCBvdGhlciBzdHJpbmdzIGFyZSBjb25zaWRlcmVkIGRlY2ltYWwuCgkgICAgICovCgkgICAgSW50ZWdlci5wYXJzZUludCA9IGZ1bmN0aW9uIChudW0sIHJhZGl4KSB7CgkgICAgICAgIGlmIChyYWRpeCA9PT0gdm9pZCAwKSB7IHJhZGl4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIHJldHVybiBwYXJzZUludChudW0sIHJhZGl4KTsKCSAgICB9OwoJICAgIEludGVnZXIuTUlOX1ZBTFVFXzMyX0JJVFMgPSAtMjE0NzQ4MzY0ODsKCSAgICBJbnRlZ2VyLk1BWF9WQUxVRSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgIHJldHVybiBJbnRlZ2VyOwoJfSgpKTsKCUludGVnZXIkMS5kZWZhdWx0ID0gSW50ZWdlcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdEFycmF5JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDggPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheXNfMSQxID0gQXJyYXlzJDE7Cgl2YXIgSW50ZWdlcl8xJDIgPSBJbnRlZ2VyJDE7Cgl2YXIgU3lzdGVtXzEkNCA9IFN5c3RlbSQxOwoJLyoqCgkgKiA8cD5BIHNpbXBsZSwgZmFzdCBhcnJheSBvZiBiaXRzLCByZXByZXNlbnRlZCBjb21wYWN0bHkgYnkgYW4gYXJyYXkgb2YgaW50cyBpbnRlcm5hbGx5LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgQml0QXJyYXkgLyppbXBsZW1lbnRzIENsb25lYWJsZSovID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHsKCSAgICAvLyAgIHRoaXMuc2l6ZSA9IDAKCSAgICAvLyAgIHRoaXMuYml0cyA9IG5ldyBJbnQzMkFycmF5KDEpCgkgICAgLy8gfQoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcihzaXplPzogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh1bmRlZmluZWQgPT09IHNpemUpIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gMAoJICAgIC8vICAgfSBlbHNlIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gc2l6ZQoJICAgIC8vICAgfQoJICAgIC8vICAgdGhpcy5iaXRzID0gdGhpcy5tYWtlQXJyYXkoc2l6ZSkKCSAgICAvLyB9CgkgICAgLy8gRm9yIHRlc3Rpbmcgb25seQoJICAgIGZ1bmN0aW9uIEJpdEFycmF5KHNpemUgLyppbnQqLywgYml0cykgewoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBzaXplKSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSAwOwoJICAgICAgICAgICAgdGhpcy5iaXRzID0gbmV3IEludDMyQXJyYXkoMSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSBzaXplOwoJICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gQml0QXJyYXkubWFrZUFycmF5KHNpemUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZTsKCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXRTaXplSW5CeXRlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKHRoaXMuc2l6ZSArIDcpIC8gOCk7CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZW5zdXJlQ2FwYWNpdHkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmIChzaXplID4gdGhpcy5iaXRzLmxlbmd0aCAqIDMyKSB7CgkgICAgICAgICAgICB2YXIgbmV3Qml0cyA9IEJpdEFycmF5Lm1ha2VBcnJheShzaXplKTsKCSAgICAgICAgICAgIFN5c3RlbV8xJDQuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5iaXRzLCAwLCBuZXdCaXRzLCAwLCB0aGlzLmJpdHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBpIGJpdCB0byBnZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGJpdCBpIGlzIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiAodGhpcy5iaXRzW01hdGguZmxvb3IoaSAvIDMyKV0gJiAoMSA8PCAoaSAmIDB4MUYpKSkgIT09IDA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHRoaXMuYml0c1tNYXRoLmZsb29yKGkgLyAzMildIHw9IDEgPDwgKGkgJiAweDFGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEZsaXBzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5mbGlwID0gZnVuY3Rpb24gKGkgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSBePSAxIDw8IChpICYgMHgxRik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBmaXJzdCBiaXQgdG8gY2hlY2sKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIGZpcnN0IGJpdCB0aGF0IGlzIHNldCwgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gaW5kZXgsIG9yIHNpemUgaWYgbm9uZSBhcmUgc2V0CgkgICAgICogIGF0IG9yIGJleW9uZCB0aGlzIGdpdmVuIGluZGV4CgkgICAgICogQHNlZSAjZ2V0TmV4dFVuc2V0KGludCkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0TmV4dFNldCA9IGZ1bmN0aW9uIChmcm9tIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLnNpemU7CgkgICAgICAgIGlmIChmcm9tID49IHNpemUpIHsKCSAgICAgICAgICAgIHJldHVybiBzaXplOwoJICAgICAgICB9CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IE1hdGguZmxvb3IoZnJvbSAvIDMyKTsKCSAgICAgICAgdmFyIGN1cnJlbnRCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgLy8gbWFzayBvZmYgbGVzc2VyIGJpdHMgZmlyc3QKCSAgICAgICAgY3VycmVudEJpdHMgJj0gfigoMSA8PCAoZnJvbSAmIDB4MUYpKSAtIDEpOwoJICAgICAgICB2YXIgbGVuZ3RoID0gYml0cy5sZW5ndGg7CgkgICAgICAgIHdoaWxlIChjdXJyZW50Qml0cyA9PT0gMCkgewoJICAgICAgICAgICAgaWYgKCsrYml0c09mZnNldCA9PT0gbGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHNpemU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjdXJyZW50Qml0cyA9IGJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBpbmRleCB0byBzdGFydCBsb29raW5nIGZvciB1bnNldCBiaXQKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgdW5zZXQgYml0LCBvciB7QGNvZGUgc2l6ZX0gaWYgbm9uZSBhcmUgdW5zZXQgdW50aWwgdGhlIGVuZAoJICAgICAqIEBzZWUgI2dldE5leHRTZXQoaW50KQoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXROZXh0VW5zZXQgPSBmdW5jdGlvbiAoZnJvbSAvKmludCovKSB7CgkgICAgICAgIHZhciBzaXplID0gdGhpcy5zaXplOwoJICAgICAgICBpZiAoZnJvbSA+PSBzaXplKSB7CgkgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIGJpdHNPZmZzZXQgPSBNYXRoLmZsb29yKGZyb20gLyAzMik7CgkgICAgICAgIHZhciBjdXJyZW50Qml0cyA9IH5iaXRzW2JpdHNPZmZzZXRdOwoJICAgICAgICAvLyBtYXNrIG9mZiBsZXNzZXIgYml0cyBmaXJzdAoJICAgICAgICBjdXJyZW50Qml0cyAmPSB+KCgxIDw8IChmcm9tICYgMHgxRikpIC0gMSk7CgkgICAgICAgIHZhciBsZW5ndGggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgd2hpbGUgKGN1cnJlbnRCaXRzID09PSAwKSB7CgkgICAgICAgICAgICBpZiAoKytiaXRzT2Zmc2V0ID09PSBsZW5ndGgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGN1cnJlbnRCaXRzID0gfmJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgYmxvY2sgb2YgMzIgYml0cywgc3RhcnRpbmcgYXQgYml0IGkuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gaSBmaXJzdCBiaXQgdG8gc2V0CgkgICAgICogQHBhcmFtIG5ld0JpdHMgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgbmV4dCAzMiBiaXRzLiBOb3RlIGFnYWluIHRoYXQgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdAoJICAgICAqIGNvcnJlc3BvbmRzIHRvIGJpdCBpLCB0aGUgbmV4dC1sZWFzdC1zaWduaWZpY2FudCB0byBpKzEsIGFuZCBzbyBvbi4KCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0QnVsayA9IGZ1bmN0aW9uIChpIC8qaW50Ki8sIG5ld0JpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgcmFuZ2Ugb2YgYml0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydCBzdGFydCBvZiByYW5nZSwgaW5jbHVzaXZlLgoJICAgICAqIEBwYXJhbSBlbmQgZW5kIG9mIHJhbmdlLCBleGNsdXNpdmUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQgLyppbnQqLywgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIGVuZC0tOyAvLyB3aWxsIGJlIGVhc2llciB0byB0cmVhdCB0aGlzIGFzIHRoZSBsYXN0IGFjdHVhbGx5IHNldCBiaXQgLS0gaW5jbHVzaXZlCgkgICAgICAgIHZhciBmaXJzdEludCA9IE1hdGguZmxvb3Ioc3RhcnQgLyAzMik7CgkgICAgICAgIHZhciBsYXN0SW50ID0gTWF0aC5mbG9vcihlbmQgLyAzMik7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICBmb3IgKHZhciBpID0gZmlyc3RJbnQ7IGkgPD0gbGFzdEludDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgZmlyc3RCaXQgPSBpID4gZmlyc3RJbnQgPyAwIDogc3RhcnQgJiAweDFGOwoJICAgICAgICAgICAgdmFyIGxhc3RCaXQgPSBpIDwgbGFzdEludCA/IDMxIDogZW5kICYgMHgxRjsKCSAgICAgICAgICAgIC8vIE9uZXMgZnJvbSBmaXJzdEJpdCB0byBsYXN0Qml0LCBpbmNsdXNpdmUKCSAgICAgICAgICAgIHZhciBtYXNrID0gKDIgPDwgbGFzdEJpdCkgLSAoMSA8PCBmaXJzdEJpdCk7CgkgICAgICAgICAgICBiaXRzW2ldIHw9IG1hc2s7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbWF4ID0gdGhpcy5iaXRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGJpdHNbaV0gPSAwOwoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBFZmZpY2llbnQgbWV0aG9kIHRvIGNoZWNrIGlmIGEgcmFuZ2Ugb2YgYml0cyBpcyBzZXQsIG9yIG5vdCBzZXQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnQgc3RhcnQgb2YgcmFuZ2UsIGluY2x1c2l2ZS4KCSAgICAgKiBAcGFyYW0gZW5kIGVuZCBvZiByYW5nZSwgZXhjbHVzaXZlCgkgICAgICogQHBhcmFtIHZhbHVlIGlmIHRydWUsIGNoZWNrcyB0aGF0IGJpdHMgaW4gcmFuZ2UgYXJlIHNldCwgb3RoZXJ3aXNlIGNoZWNrcyB0aGF0IHRoZXkgYXJlIG5vdCBzZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGFsbCBiaXRzIGFyZSBzZXQgb3Igbm90IHNldCBpbiByYW5nZSwgYWNjb3JkaW5nIHRvIHZhbHVlIGFyZ3VtZW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgZW5kIGlzIGxlc3MgdGhhbiBzdGFydCBvciB0aGUgcmFuZ2UgaXMgbm90IGNvbnRhaW5lZCBpbiB0aGUgYXJyYXkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuaXNSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCAvKmludCovLCBlbmQgLyppbnQqLywgdmFsdWUpIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGVtcHR5IHJhbmdlIG1hdGNoZXMKCSAgICAgICAgfQoJICAgICAgICBlbmQtLTsgLy8gd2lsbCBiZSBlYXNpZXIgdG8gdHJlYXQgdGhpcyBhcyB0aGUgbGFzdCBhY3R1YWxseSBzZXQgYml0IC0tIGluY2x1c2l2ZQoJICAgICAgICB2YXIgZmlyc3RJbnQgPSBNYXRoLmZsb29yKHN0YXJ0IC8gMzIpOwoJICAgICAgICB2YXIgbGFzdEludCA9IE1hdGguZmxvb3IoZW5kIC8gMzIpOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZpcnN0SW50OyBpIDw9IGxhc3RJbnQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGZpcnN0Qml0ID0gaSA+IGZpcnN0SW50ID8gMCA6IHN0YXJ0ICYgMHgxRjsKCSAgICAgICAgICAgIHZhciBsYXN0Qml0ID0gaSA8IGxhc3RJbnQgPyAzMSA6IGVuZCAmIDB4MUY7CgkgICAgICAgICAgICAvLyBPbmVzIGZyb20gZmlyc3RCaXQgdG8gbGFzdEJpdCwgaW5jbHVzaXZlCgkgICAgICAgICAgICB2YXIgbWFzayA9ICgyIDw8IGxhc3RCaXQpIC0gKDEgPDwgZmlyc3RCaXQpICYgMHhGRkZGRkZGRjsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiAmIDB4RkZGRkZGRkYgYWRkZWQgdG8gZGlzY2FyZCBhbnl0aGluZyBhZnRlciAzMiBiaXRzLCBhcyBFUyBoYXMgNTMgYml0cwoJICAgICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIGlmIHdlJ3JlIGxvb2tpbmcgZm9yIDFzIGFuZCB0aGUgbWFza2VkIGJpdHNbaV0gaXNuJ3QgYWxsIDFzIChpczogdGhhdCwKCSAgICAgICAgICAgIC8vIGVxdWFscyB0aGUgbWFzaywgb3Igd2UncmUgbG9va2luZyBmb3IgMHMgYW5kIHRoZSBtYXNrZWQgcG9ydGlvbiBpcyBub3QgYWxsIDBzCgkgICAgICAgICAgICBpZiAoKGJpdHNbaV0gJiBtYXNrKSAhPT0gKHZhbHVlID8gbWFzayA6IDApKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgICAgQml0QXJyYXkucHJvdG90eXBlLmFwcGVuZEJpdCA9IGZ1bmN0aW9uIChiaXQpIHsKCSAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eSh0aGlzLnNpemUgKyAxKTsKCSAgICAgICAgaWYgKGJpdCkgewoJICAgICAgICAgICAgdGhpcy5iaXRzW01hdGguZmxvb3IodGhpcy5zaXplIC8gMzIpXSB8PSAxIDw8ICh0aGlzLnNpemUgJiAweDFGKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLnNpemUrKzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFwcGVuZHMgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdHMsIGZyb20gdmFsdWUsIGluIG9yZGVyIGZyb20gbW9zdC1zaWduaWZpY2FudCB0bwoJICAgICAqIGxlYXN0LXNpZ25pZmljYW50LiBGb3IgZXhhbXBsZSwgYXBwZW5kaW5nIDYgYml0cyBmcm9tIDB4MDAwMDAxRSB3aWxsIGFwcGVuZCB0aGUgYml0cwoJICAgICAqIDAsIDEsIDEsIDEsIDEsIDAgaW4gdGhhdCBvcmRlci4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB2YWx1ZSB7QGNvZGUgaW50fSBjb250YWluaW5nIGJpdHMgdG8gYXBwZW5kCgkgICAgICogQHBhcmFtIG51bUJpdHMgYml0cyBmcm9tIHZhbHVlIHRvIGFwcGVuZAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5hcHBlbmRCaXRzID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICBpZiAobnVtQml0cyA8IDAgfHwgbnVtQml0cyA+IDMyKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOC5kZWZhdWx0KCdOdW0gYml0cyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMzInKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KHRoaXMuc2l6ZSArIG51bUJpdHMpOwoJICAgICAgICAvLyBjb25zdCBhcHBlbmRCaXQgPSB0aGlzLmFwcGVuZEJpdDsKCSAgICAgICAgZm9yICh2YXIgbnVtQml0c0xlZnQgPSBudW1CaXRzOyBudW1CaXRzTGVmdCA+IDA7IG51bUJpdHNMZWZ0LS0pIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KCgodmFsdWUgPj4gKG51bUJpdHNMZWZ0IC0gMSkpICYgMHgwMSkgPT09IDEpOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuYXBwZW5kQml0QXJyYXkgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdmFyIG90aGVyU2l6ZSA9IG90aGVyLnNpemU7CgkgICAgICAgIHRoaXMuZW5zdXJlQ2FwYWNpdHkodGhpcy5zaXplICsgb3RoZXJTaXplKTsKCSAgICAgICAgLy8gY29uc3QgYXBwZW5kQml0ID0gdGhpcy5hcHBlbmRCaXQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3RoZXJTaXplOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KG90aGVyLmdldChpKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gb3RoZXIuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDguZGVmYXVsdCgnU2l6ZXMgZG9uXCd0IG1hdGNoJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGJpdHMubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgLy8gVGhlIGxhc3QgaW50IGNvdWxkIGJlIGluY29tcGxldGUgKGkuZS4gbm90IGhhdmUgMzIgYml0cyBpbgoJICAgICAgICAgICAgLy8gaXQpIGJ1dCB0aGVyZSBpcyBubyBwcm9ibGVtIHNpbmNlIDAgWE9SIDAgPT0gMC4KCSAgICAgICAgICAgIGJpdHNbaV0gXj0gb3RoZXIuYml0c1tpXTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0T2Zmc2V0IGZpcnN0IGJpdCB0byBzdGFydCB3cml0aW5nCgkgICAgICogQHBhcmFtIGFycmF5IGFycmF5IHRvIHdyaXRlIGludG8uIEJ5dGVzIGFyZSB3cml0dGVuIG1vc3Qtc2lnbmlmaWNhbnQgYnl0ZSBmaXJzdC4gVGhpcyBpcyB0aGUgb3Bwb3NpdGUKCSAgICAgKiAgb2YgdGhlIGludGVybmFsIHJlcHJlc2VudGF0aW9uLCB3aGljaCBpcyBleHBvc2VkIGJ5IHtAbGluayAjZ2V0Qml0QXJyYXkoKX0KCSAgICAgKiBAcGFyYW0gb2Zmc2V0IHBvc2l0aW9uIGluIGFycmF5IHRvIHN0YXJ0IHdyaXRpbmcKCSAgICAgKiBAcGFyYW0gbnVtQnl0ZXMgaG93IG1hbnkgYnl0ZXMgdG8gd3JpdGUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uIChiaXRPZmZzZXQgLyppbnQqLywgYXJyYXksIG9mZnNldCAvKmludCovLCBudW1CeXRlcyAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQnl0ZXM7IGkrKykgewoJICAgICAgICAgICAgdmFyIHRoZUJ5dGUgPSAwOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4OyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXQoYml0T2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICB0aGVCeXRlIHw9IDEgPDwgKDcgLSBqKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhcnJheVtvZmZzZXQgKyBpXSA9IC8qKGJ5dGUpKi8gdGhlQnl0ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB1bmRlcmx5aW5nIGFycmF5IG9mIGludHMuIFRoZSBmaXJzdCBlbGVtZW50IGhvbGRzIHRoZSBmaXJzdCAzMiBiaXRzLCBhbmQgdGhlIGxlYXN0CgkgICAgICogICAgICAgICBzaWduaWZpY2FudCBiaXQgaXMgYml0IDAuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmdldEJpdEFycmF5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV2ZXJzZXMgYWxsIGJpdHMgaW4gdGhlIGFycmF5LgoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5yZXZlcnNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3Qml0cyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYml0cy5sZW5ndGgpOwoJICAgICAgICAvLyByZXZlcnNlIGFsbCBpbnQncyBmaXJzdAoJICAgICAgICB2YXIgbGVuID0gTWF0aC5mbG9vcigodGhpcy5zaXplIC0gMSkgLyAzMik7CgkgICAgICAgIHZhciBvbGRCaXRzTGVuID0gbGVuICsgMTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkQml0c0xlbjsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeCA9IGJpdHNbaV07CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDEpICYgMHg1NTU1NTU1NSkgfCAoKHggJiAweDU1NTU1NTU1KSA8PCAxKTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMikgJiAweDMzMzMzMzMzKSB8ICgoeCAmIDB4MzMzMzMzMzMpIDw8IDIpOwoJICAgICAgICAgICAgeCA9ICgoeCA+PiA0KSAmIDB4MGYwZjBmMGYpIHwgKCh4ICYgMHgwZjBmMGYwZikgPDwgNCk7CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDgpICYgMHgwMGZmMDBmZikgfCAoKHggJiAweDAwZmYwMGZmKSA8PCA4KTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMTYpICYgMHgwMDAwZmZmZikgfCAoKHggJiAweDAwMDBmZmZmKSA8PCAxNik7CgkgICAgICAgICAgICBuZXdCaXRzW2xlbiAtIGldID0gLyooaW50KSovIHg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm93IGNvcnJlY3QgdGhlIGludCdzIGlmIHRoZSBiaXQgc2l6ZSBpc24ndCBhIG11bHRpcGxlIG9mIDMyCgkgICAgICAgIGlmICh0aGlzLnNpemUgIT09IG9sZEJpdHNMZW4gKiAzMikgewoJICAgICAgICAgICAgdmFyIGxlZnRPZmZzZXQgPSBvbGRCaXRzTGVuICogMzIgLSB0aGlzLnNpemU7CgkgICAgICAgICAgICB2YXIgY3VycmVudEludCA9IG5ld0JpdHNbMF0gPj4+IGxlZnRPZmZzZXQ7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG9sZEJpdHNMZW47IGkrKykgewoJICAgICAgICAgICAgICAgIHZhciBuZXh0SW50ID0gbmV3Qml0c1tpXTsKCSAgICAgICAgICAgICAgICBjdXJyZW50SW50IHw9IG5leHRJbnQgPDwgKDMyIC0gbGVmdE9mZnNldCk7CgkgICAgICAgICAgICAgICAgbmV3Qml0c1tpIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICAgICAgICAgIGN1cnJlbnRJbnQgPSBuZXh0SW50ID4+PiBsZWZ0T2Zmc2V0OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbmV3Qml0c1tvbGRCaXRzTGVuIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICBCaXRBcnJheS5tYWtlQXJyYXkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW50MzJBcnJheShNYXRoLmZsb29yKChzaXplICsgMzEpIC8gMzIpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdEFycmF5KSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnNpemUgPT09IG90aGVyLnNpemUgJiYgQXJyYXlzXzEkMS5kZWZhdWx0LmVxdWFscyh0aGlzLmJpdHMsIG90aGVyLmJpdHMpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogdGhpcy5zaXplICsgQXJyYXlzXzEkMS5kZWZhdWx0Lmhhc2hDb2RlKHRoaXMuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gJyc7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBzaXplID0gdGhpcy5zaXplOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICBpZiAoKGkgJiAweDA3KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnICc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5nZXQoaSkgPyAnWCcgOiAnLic7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0QXJyYXkodGhpcy5zaXplLCB0aGlzLmJpdHMuc2xpY2UoKSk7CgkgICAgfTsKCSAgICByZXR1cm4gQml0QXJyYXk7Cgl9KCkpOwoJQml0QXJyYXkkMS5kZWZhdWx0ID0gQml0QXJyYXk7CgoJdmFyIEJpdE1hdHJpeCQxID0ge307CgoJdmFyIFN0cmluZ0J1aWxkZXIkMSA9IHt9OwoKCXZhciBTdHJpbmdVdGlscyQxID0ge307CgoJdmFyIERlY29kZUhpbnRUeXBlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERlY29kZUhpbnRUeXBlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIHR5cGUgb2YgaGludCB0aGF0IGEgY2FsbGVyIG1heSBwYXNzIHRvIGEgYmFyY29kZSByZWFkZXIgdG8gaGVscCBpdAoJICogbW9yZSBxdWlja2x5IG9yIGFjY3VyYXRlbHkgZGVjb2RlIGl0LiBJdCBpcyB1cCB0byBpbXBsZW1lbnRhdGlvbnMgdG8gZGVjaWRlIHdoYXQsCgkgKiBpZiBhbnl0aGluZywgdG8gZG8gd2l0aCB0aGUgaW5mb3JtYXRpb24gdGhhdCBpcyBzdXBwbGllZC4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBzZWUgUmVhZGVyI2RlY29kZShCaW5hcnlCaXRtYXAsamF2YS51dGlsLk1hcCkKCSAqLwoJdmFyIERlY29kZUhpbnRUeXBlOwoJKGZ1bmN0aW9uIChEZWNvZGVIaW50VHlwZSkgewoJICAgIC8qKgoJICAgICAqIFVuc3BlY2lmaWVkLCBhcHBsaWNhdGlvbi1zcGVjaWZpYyBoaW50LiBNYXBzIHRvIGFuIHVuc3BlY2lmaWVkIHtAbGluayBPYmplY3R9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJPVEhFUiJdID0gMF0gPSAiT1RIRVIiOyAvKihPYmplY3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJbWFnZSBpcyBhIHB1cmUgbW9ub2Nocm9tZSBpbWFnZSBvZiBhIGJhcmNvZGUuIERvZXNuJ3QgbWF0dGVyIHdoYXQgaXQgbWFwcyB0bzsKCSAgICAgKiB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlBVUkVfQkFSQ09ERSJdID0gMV0gPSAiUFVSRV9CQVJDT0RFIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEltYWdlIGlzIGtub3duIHRvIGJlIG9mIG9uZSBvZiBhIGZldyBwb3NzaWJsZSBmb3JtYXRzLgoJICAgICAqIE1hcHMgdG8gYSB7QGxpbmsgTGlzdH0gb2Yge0BsaW5rIEJhcmNvZGVGb3JtYXR9cy4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiUE9TU0lCTEVfRk9STUFUUyJdID0gMl0gPSAiUE9TU0lCTEVfRk9STUFUUyI7IC8qKExpc3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVuZCBtb3JlIHRpbWUgdG8gdHJ5IHRvIGZpbmQgYSBiYXJjb2RlOyBvcHRpbWl6ZSBmb3IgYWNjdXJhY3ksIG5vdCBzcGVlZC4KCSAgICAgKiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87IHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiVFJZX0hBUkRFUiJdID0gM10gPSAiVFJZX0hBUkRFUiI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVjaWZpZXMgd2hhdCBjaGFyYWN0ZXIgZW5jb2RpbmcgdG8gdXNlIHdoZW4gZGVjb2RpbmcsIHdoZXJlIGFwcGxpY2FibGUgKHR5cGUgU3RyaW5nKQoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJDSEFSQUNURVJfU0VUIl0gPSA0XSA9ICJDSEFSQUNURVJfU0VUIjsgLyooU3RyaW5nLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQWxsb3dlZCBsZW5ndGhzIG9mIGVuY29kZWQgZGF0YSAtLSByZWplY3QgYW55dGhpbmcgZWxzZS4gTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfTEVOR1RIUyJdID0gNV0gPSAiQUxMT1dFRF9MRU5HVEhTIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEFzc3VtZSBDb2RlIDM5IGNvZGVzIGVtcGxveSBhIGNoZWNrIGRpZ2l0LiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87CgkgICAgICogdXNlIHtAbGluayBCb29sZWFuI1RSVUV9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJBU1NVTUVfQ09ERV8zOV9DSEVDS19ESUdJVCJdID0gNl0gPSAiQVNTVU1FX0NPREVfMzlfQ0hFQ0tfRElHSVQiOyAvKihWb2lkLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQXNzdW1lIHRoZSBiYXJjb2RlIGlzIGJlaW5nIHByb2Nlc3NlZCBhcyBhIEdTMSBiYXJjb2RlLCBhbmQgbW9kaWZ5IGJlaGF2aW9yIGFzIG5lZWRlZC4KCSAgICAgKiBGb3IgZXhhbXBsZSB0aGlzIGFmZmVjdHMgRk5DMSBoYW5kbGluZyBmb3IgQ29kZSAxMjggKGFrYSBHUzEtMTI4KS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOwoJICAgICAqIHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiQVNTVU1FX0dTMSJdID0gN10gPSAiQVNTVU1FX0dTMSI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJZiB0cnVlLCByZXR1cm4gdGhlIHN0YXJ0IGFuZCBlbmQgZGlnaXRzIGluIGEgQ29kYWJhciBiYXJjb2RlIGluc3RlYWQgb2Ygc3RyaXBwaW5nIHRoZW0uIFRoZXkKCSAgICAgKiBhcmUgYWxwaGEsIHdoZXJlYXMgdGhlIHJlc3QgYXJlIG51bWVyaWMuIEJ5IGRlZmF1bHQsIHRoZXkgYXJlIHN0cmlwcGVkLCBidXQgdGhpcyBjYXVzZXMgdGhlbQoJICAgICAqIHRvIG5vdCBiZS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOyB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlJFVFVSTl9DT0RBQkFSX1NUQVJUX0VORCJdID0gOF0gPSAiUkVUVVJOX0NPREFCQVJfU1RBUlRfRU5EIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIFRoZSBjYWxsZXIgbmVlZHMgdG8gYmUgbm90aWZpZWQgdmlhIGNhbGxiYWNrIHdoZW4gYSBwb3NzaWJsZSB7QGxpbmsgUmVzdWx0UG9pbnR9CgkgICAgICogaXMgZm91bmQuIE1hcHMgdG8gYSB7QGxpbmsgUmVzdWx0UG9pbnRDYWxsYmFja30uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIk5FRURfUkVTVUxUX1BPSU5UX0NBTExCQUNLIl0gPSA5XSA9ICJORUVEX1JFU1VMVF9QT0lOVF9DQUxMQkFDSyI7IC8qKFJlc3VsdFBvaW50Q2FsbGJhY2suY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBBbGxvd2VkIGV4dGVuc2lvbiBsZW5ndGhzIGZvciBFQU4gb3IgVVBDIGJhcmNvZGVzLiBPdGhlciBmb3JtYXRzIHdpbGwgaWdub3JlIHRoaXMuCgkgICAgICogTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0gb2YgdGhlIGFsbG93ZWQgZXh0ZW5zaW9uIGxlbmd0aHMsIGZvciBleGFtcGxlIFsyXSwgWzVdLCBvciBbMiwgNV0uCgkgICAgICogSWYgaXQgaXMgb3B0aW9uYWwgdG8gaGF2ZSBhbiBleHRlbnNpb24sIGRvIG5vdCBzZXQgdGhpcyBoaW50LiBJZiB0aGlzIGlzIHNldCwKCSAgICAgKiBhbmQgYSBVUEMgb3IgRUFOIGJhcmNvZGUgaXMgZm91bmQgYnV0IGFuIGV4dGVuc2lvbiBpcyBub3QsIHRoZW4gbm8gcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQKCSAgICAgKiBhdCBhbGwuCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfRUFOX0VYVEVOU0lPTlMiXSA9IDEwXSA9ICJBTExPV0VEX0VBTl9FWFRFTlNJT05TIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8vIEVuZCBvZiBlbnVtZXJhdGlvbiB2YWx1ZXMuCgkgICAgLyoqCgkgICAgICogRGF0YSB0eXBlIHRoZSBoaW50IGlzIGV4cGVjdGluZy4KCSAgICAgKiBBbW9uZyB0aGUgcG9zc2libGUgdmFsdWVzIHRoZSB7QGxpbmsgVm9pZH0gc3RhbmRzIG91dCBhcyBiZWluZyB1c2VkIGZvcgoJICAgICAqIGhpbnRzIHRoYXQgZG8gbm90IGV4cGVjdCBhIHZhbHVlIHRvIGJlIHN1cHBsaWVkIChmbGFnIGhpbnRzKS4gU3VjaCBoaW50cwoJICAgICAqIHdpbGwgcG9zc2libHkgaGF2ZSB0aGVpciB2YWx1ZSBpZ25vcmVkLCBvciByZXBsYWNlZCBieSBhCgkgICAgICoge0BsaW5rIEJvb2xlYW4jVFJVRX0uIEhpbnQgc3VwcGxpZXJzIHNob3VsZCBwcm9iYWJseSB1c2UKCSAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBhcyBkaXJlY3RlZCBieSB0aGUgYWN0dWFsIGhpbnQgZG9jdW1lbnRhdGlvbi4KCSAgICAgKi8KCSAgICAvLyBwcml2YXRlIHZhbHVlVHlwZTogQ2xhc3M8Pz4KCSAgICAvLyBEZWNvZGVIaW50VHlwZSh2YWx1ZVR5cGU6IENsYXNzPD8+KSB7CgkgICAgLy8gICB0aGlzLnZhbHVlVHlwZSA9IHZhbHVlVHlwZQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgZ2V0VmFsdWVUeXBlKCk6IENsYXNzPD8+IHsKCSAgICAvLyAgIHJldHVybiB2YWx1ZVR5cGUKCSAgICAvLyB9Cgl9KShEZWNvZGVIaW50VHlwZSB8fCAoRGVjb2RlSGludFR5cGUgPSB7fSkpOwoJRGVjb2RlSGludFR5cGUkMS5kZWZhdWx0ID0gRGVjb2RlSGludFR5cGU7CgoJdmFyIENoYXJhY3RlclNldEVDSSA9IHt9OwoKCXZhciBGb3JtYXRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb3JtYXRFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDcgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRm9ybWF0RXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRmKEZvcm1hdEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBGb3JtYXRFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgRm9ybWF0RXhjZXB0aW9uLmdldEZvcm1hdEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEV4Y2VwdGlvbigpOwoJICAgIH07CgkgICAgRm9ybWF0RXhjZXB0aW9uLmtpbmQgPSAnRm9ybWF0RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRm9ybWF0RXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ3LmRlZmF1bHQpKTsKCUZvcm1hdEV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBGb3JtYXRFeGNlcHRpb247CgoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkvKgoJICogQ29weXJpZ2h0IDIwMDggWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCWV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHZvaWQgMDsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xID0gRm9ybWF0RXhjZXB0aW9uJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsqLwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJdmFyIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnM7CgkoZnVuY3Rpb24gKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMpIHsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwNDM3Il0gPSAwXSA9ICJDcDQzNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEiXSA9IDFdID0gIklTTzg4NTlfMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzIiXSA9IDJdID0gIklTTzg4NTlfMiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzMiXSA9IDNdID0gIklTTzg4NTlfMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzQiXSA9IDRdID0gIklTTzg4NTlfNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzUiXSA9IDVdID0gIklTTzg4NTlfNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzYiXSA9IDZdID0gIklTTzg4NTlfNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzciXSA9IDddID0gIklTTzg4NTlfNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzgiXSA9IDhdID0gIklTTzg4NTlfOCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzkiXSA9IDldID0gIklTTzg4NTlfOSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEwIl0gPSAxMF0gPSAiSVNPODg1OV8xMCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzExIl0gPSAxMV0gPSAiSVNPODg1OV8xMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEzIl0gPSAxMl0gPSAiSVNPODg1OV8xMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE0Il0gPSAxM10gPSAiSVNPODg1OV8xNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE1Il0gPSAxNF0gPSAiSVNPODg1OV8xNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE2Il0gPSAxNV0gPSAiSVNPODg1OV8xNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJTSklTIl0gPSAxNl0gPSAiU0pJUyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTAiXSA9IDE3XSA9ICJDcDEyNTAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQ3AxMjUxIl0gPSAxOF0gPSAiQ3AxMjUxIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwMTI1MiJdID0gMTldID0gIkNwMTI1MiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTYiXSA9IDIwXSA9ICJDcDEyNTYiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siVW5pY29kZUJpZ1VubWFya2VkIl0gPSAyMV0gPSAiVW5pY29kZUJpZ1VubWFya2VkIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIlVURjgiXSA9IDIyXSA9ICJVVEY4IjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkFTQ0lJIl0gPSAyM10gPSAiQVNDSUkiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQmlnNSJdID0gMjRdID0gIkJpZzUiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siR0IxODAzMCJdID0gMjVdID0gIkdCMTgwMzAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siRVVDX0tSIl0gPSAyNl0gPSAiRVVDX0tSIjsKCX0pKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgPSBleHBvcnRzLkNoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgfHwgKGV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHt9KSk7CgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIENoYXJhY3RlciBTZXQgRUNJLCBhY2NvcmRpbmcgdG8gIkV4dGVuZGVkIENoYW5uZWwgSW50ZXJwcmV0YXRpb25zIiA1LjMuMS4xCgkgKiBvZiBJU08gMTgwMDQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIENoYXJhY3RlclNldEVDSSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBDaGFyYWN0ZXJTZXRFQ0kodmFsdWVJZGVudGlmaWVyLCB2YWx1ZXNQYXJhbSwgbmFtZSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG90aGVyRW5jb2RpbmdOYW1lcyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDM7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgb3RoZXJFbmNvZGluZ05hbWVzW19pIC0gM10gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmFsdWVJZGVudGlmaWVyID0gdmFsdWVJZGVudGlmaWVyOwoJICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICBpZiAodHlwZW9mIHZhbHVlc1BhcmFtID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBJbnQzMkFycmF5LmZyb20oW3ZhbHVlc1BhcmFtXSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlc1BhcmFtOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzOwoJICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVfSURFTlRJRklFUl9UT19FQ0kuc2V0KHZhbHVlSWRlbnRpZmllciwgdGhpcyk7CgkgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQobmFtZSwgdGhpcyk7CgkgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlczsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgdmFyIHYgPSB2YWx1ZXNbaV07CgkgICAgICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVTX1RPX0VDSS5zZXQodiwgdGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIG90aGVyRW5jb2RpbmdOYW1lc18xID0gX192YWx1ZXMob3RoZXJFbmNvZGluZ05hbWVzKSwgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKTsgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZTsgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBvdGhlck5hbWUgPSBvdGhlckVuY29kaW5nTmFtZXNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQob3RoZXJOYW1lLCB0aGlzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKG90aGVyRW5jb2RpbmdOYW1lc18xXzEgJiYgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZSAmJiAoX2EgPSBvdGhlckVuY29kaW5nTmFtZXNfMS5yZXR1cm4pKSBfYS5jYWxsKG90aGVyRW5jb2RpbmdOYW1lc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgIH0KCSAgICAvLyBDaGFyYWN0ZXJTZXRFQ0kodmFsdWU6IG51bWJlciAvKmludCovKSB7CgkgICAgLy8gICB0aGlzKG5ldyBJbnQzMkFycmF5IHt2YWx1ZX0pCgkgICAgLy8gfQoJICAgIC8vIENoYXJhY3RlclNldEVDSSh2YWx1ZTogbnVtYmVyIC8qaW50Ki8sIFN0cmluZy4uLiBvdGhlckVuY29kaW5nTmFtZXMpIHsKCSAgICAvLyAgIHRoaXMudmFsdWVzID0gbmV3IEludDMyQXJyYXkge3ZhbHVlfQoJICAgIC8vICAgdGhpcy5vdGhlckVuY29kaW5nTmFtZXMgPSBvdGhlckVuY29kaW5nTmFtZXMKCSAgICAvLyB9CgkgICAgLy8gQ2hhcmFjdGVyU2V0RUNJKHZhbHVlczogSW50MzJBcnJheSwgU3RyaW5nLi4uIG90aGVyRW5jb2RpbmdOYW1lcykgewoJICAgIC8vICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMKCSAgICAvLyAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzCgkgICAgLy8gfQoJICAgIENoYXJhY3RlclNldEVDSS5wcm90b3R5cGUuZ2V0VmFsdWVJZGVudGlmaWVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUlkZW50aWZpZXI7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbMF07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmFsdWUgY2hhcmFjdGVyIHNldCBFQ0kgdmFsdWUKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBDaGFyYWN0ZXJTZXRFQ0l9IHJlcHJlc2VudGluZyBFQ0kgb2YgZ2l2ZW4gdmFsdWUsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwgYnV0CgkgICAgICogICB1bnN1cHBvcnRlZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIEVDSSB2YWx1ZSBpcyBpbnZhbGlkCgkgICAgICovCgkgICAgQ2hhcmFjdGVyU2V0RUNJLmdldENoYXJhY3RlclNldEVDSUJ5VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID49IDkwMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGNoYXJhY3RlclNldCA9IENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJLmdldCh2YWx1ZSk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNoYXJhY3RlclNldCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGNoYXJhY3RlclNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBuYW1lIGNoYXJhY3RlciBzZXQgRUNJIGVuY29kaW5nIG5hbWUKCSAgICAgKiBAcmV0dXJuIENoYXJhY3RlclNldEVDSSByZXByZXNlbnRpbmcgRUNJIGZvciBjaGFyYWN0ZXIgZW5jb2RpbmcsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwKCSAgICAgKiAgIGJ1dCB1bnN1cHBvcnRlZAoJICAgICAqLwoJICAgIENoYXJhY3RlclNldEVDSS5nZXRDaGFyYWN0ZXJTZXRFQ0lCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gQ2hhcmFjdGVyU2V0RUNJLk5BTUVfVE9fRUNJLmdldChuYW1lKTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgnaW5jb3JlY3QgdmFsdWUnKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY2hhcmFjdGVyU2V0OwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ2hhcmFjdGVyU2V0RUNJKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKSA9PT0gb3RoZXIuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlZBTFVFX0lERU5USUZJRVJfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSSA9IG5ldyBNYXAoKTsKCSAgICAvLyBFbnVtIG5hbWUgaXMgYSBKYXZhIGVuY29kaW5nIHZhbGlkIGZvciBqYXZhLmxhbmcgYW5kIGphdmEuaW8KCSAgICAvLyBUWVBFU0NSSVBUUE9SVDogY2hhbmdlZCB0aGUgbWFpbiBsYWJlbCBmb3IgSVNPIGFzIHRoZSBUZXh0RW5jb2RlciBkaWQgbm90IHJlY29nbml6ZWQgdGhlbSBpbiB0aGUgZm9ybSBmcm9tIGphdmEKCSAgICAvLyAoZWcgSVNPODg1OV8xIG11c3QgYmUgSVNPODg1OTEgb3IgSVNPODg1OS0xIG9yIElTTy04ODU5LTEpCgkgICAgLy8gbGF0ZXIgb246IHdlbGwsIGV4Y2VwdCAxNiB3aWNoIGRvZXMgbm90IHdvcmsgd2l0aCBJU084ODU5MTYgc28gdXNlZCBJU08tODg1OS0xIGZvcm0gZm9yIGRlZmF1bHQKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3A0MzcgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3A0MzcsIEludDMyQXJyYXkuZnJvbShbMCwgMl0pLCAnQ3A0MzcnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMSwgSW50MzJBcnJheS5mcm9tKFsxLCAzXSksICdJU08tODg1OS0xJywgJ0lTTzg4NTkxJywgJ0lTTzg4NTlfMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzIgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8yLCA0LCAnSVNPLTg4NTktMicsICdJU084ODU5MicsICdJU084ODU5XzInKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8zID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMywgNSwgJ0lTTy04ODU5LTMnLCAnSVNPODg1OTMnLCAnSVNPODg1OV8zJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzQsIDYsICdJU08tODg1OS00JywgJ0lTTzg4NTk0JywgJ0lTTzg4NTlfNCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV81LCA3LCAnSVNPLTg4NTktNScsICdJU084ODU5NScsICdJU084ODU5XzUnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV82ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfNiwgOCwgJ0lTTy04ODU5LTYnLCAnSVNPODg1OTYnLCAnSVNPODg1OV82Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzcsIDksICdJU08tODg1OS03JywgJ0lTTzg4NTk3JywgJ0lTTzg4NTlfNycpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV84LCAxMCwgJ0lTTy04ODU5LTgnLCAnSVNPODg1OTgnLCAnSVNPODg1OV84Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfOSA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzksIDExLCAnSVNPLTg4NTktOScsICdJU084ODU5OScsICdJU084ODU5XzknKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xMCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzEwLCAxMiwgJ0lTTy04ODU5LTEwJywgJ0lTTzg4NTkxMCcsICdJU084ODU5XzEwJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xMSwgMTMsICdJU08tODg1OS0xMScsICdJU084ODU5MTEnLCAnSVNPODg1OV8xMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzEzID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTMsIDE1LCAnSVNPLTg4NTktMTMnLCAnSVNPODg1OTEzJywgJ0lTTzg4NTlfMTMnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzE0LCAxNiwgJ0lTTy04ODU5LTE0JywgJ0lTTzg4NTkxNCcsICdJU084ODU5XzE0Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xNSwgMTcsICdJU08tODg1OS0xNScsICdJU084ODU5MTUnLCAnSVNPODg1OV8xNScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzE2ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTYsIDE4LCAnSVNPLTg4NTktMTYnLCAnSVNPODg1OTE2JywgJ0lTTzg4NTlfMTYnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuU0pJUyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5TSklTLCAyMCwgJ1NKSVMnLCAnU2hpZnRfSklTJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1MCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTAsIDIxLCAnQ3AxMjUwJywgJ3dpbmRvd3MtMTI1MCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5DcDEyNTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3AxMjUxLCAyMiwgJ0NwMTI1MScsICd3aW5kb3dzLTEyNTEnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3AxMjUyID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkNwMTI1MiwgMjMsICdDcDEyNTInLCAnd2luZG93cy0xMjUyJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1NiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTYsIDI0LCAnQ3AxMjU2JywgJ3dpbmRvd3MtMTI1NicpOwoJICAgIENoYXJhY3RlclNldEVDSS5Vbmljb2RlQmlnVW5tYXJrZWQgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVW5pY29kZUJpZ1VubWFya2VkLCAyNSwgJ1VuaWNvZGVCaWdVbm1hcmtlZCcsICdVVEYtMTZCRScsICdVbmljb2RlQmlnJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlVURjggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVVRGOCwgMjYsICdVVEY4JywgJ1VURi04Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkFTQ0lJID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkFTQ0lJLCBJbnQzMkFycmF5LmZyb20oWzI3LCAxNzBdKSwgJ0FTQ0lJJywgJ1VTLUFTQ0lJJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkJpZzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQmlnNSwgMjgsICdCaWc1Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkdCMTgwMzAgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuR0IxODAzMCwgMjksICdHQjE4MDMwJywgJ0dCMjMxMicsICdFVUNfQ04nLCAnR0JLJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkVVQ19LUiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5FVUNfS1IsIDMwLCAnRVVDX0tSJywgJ0VVQy1LUicpOwoJICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0k7Cgl9KCkpOwoJZXhwb3J0cy5kZWZhdWx0ID0gQ2hhcmFjdGVyU2V0RUNJOwoKCX0oQ2hhcmFjdGVyU2V0RUNJKSk7CgoJdmFyIFN0cmluZ0VuY29kaW5nJDEgPSB7fTsKCgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNiA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbi5raW5kID0gJ1Vuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCkpOwoJVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMS5kZWZhdWx0ID0gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ0VuY29kaW5nJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEgPSBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxOwoJdmFyIENoYXJhY3RlclNldEVDSV8xJDIgPSBDaGFyYWN0ZXJTZXRFQ0k7CgkvKioKCSAqIFJlc3BvbnNpYmxlIGZvciBlbi9kZWNvZGluZyBzdHJpbmdzLgoJICovCgl2YXIgU3RyaW5nRW5jb2RpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nRW5jb2RpbmcoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIERlY29kZXMgc29tZSBVaW50OEFycmF5IHRvIGEgc3RyaW5nIGZvcm1hdC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5kZWNvZGUgPSBmdW5jdGlvbiAoYnl0ZXMsIGVuY29kaW5nKSB7CgkgICAgICAgIHZhciBlbmNvZGluZ05hbWUgPSB0aGlzLmVuY29kaW5nTmFtZShlbmNvZGluZyk7CgkgICAgICAgIGlmICh0aGlzLmN1c3RvbURlY29kZXIpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbURlY29kZXIoYnl0ZXMsIGVuY29kaW5nTmFtZSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSW5jcmVhc2VzIGJyb3dzZXIgc3VwcG9ydC4KCSAgICAgICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy5zaG91bGREZWNvZGVPbkZhbGxiYWNrKGVuY29kaW5nTmFtZSkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUZhbGxiYWNrKGJ5dGVzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmdOYW1lKS5kZWNvZGUoYnl0ZXMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ2hlY2tzIGlmIHRoZSBkZWNvZGluZyBtZXRob2Qgc2hvdWxkIHVzZSB0aGUgZmFsbGJhY2sgZm9yIGRlY29kaW5nCgkgICAgICogb25jZSBOb2RlIFRleHREZWNvZGVyIGRvZXNuJ3Qgc3VwcG9ydCBhbGwgZW5jb2RpbmcgZm9ybWF0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBlbmNvZGluZ05hbWUKCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5zaG91bGREZWNvZGVPbkZhbGxiYWNrID0gZnVuY3Rpb24gKGVuY29kaW5nTmFtZSkgewoJICAgICAgICByZXR1cm4gIVN0cmluZ0VuY29kaW5nLmlzQnJvd3NlcigpICYmIGVuY29kaW5nTmFtZSA9PT0gJ0lTTy04ODU5LTEnOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRW5jb2RlcyBzb21lIHN0cmluZyBpbnRvIGEgVWludDhBcnJheS4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGUgPSBmdW5jdGlvbiAocywgZW5jb2RpbmcpIHsKCSAgICAgICAgdmFyIGVuY29kaW5nTmFtZSA9IHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKTsKCSAgICAgICAgaWYgKHRoaXMuY3VzdG9tRW5jb2RlcikgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRW5jb2RlcihzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEluY3JlYXNlcyBicm93c2VyIHN1cHBvcnQuCgkgICAgICAgIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVGYWxsYmFjayhzKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBUZXh0RW5jb2RlciBvbmx5IGVuY29kZXMgdG8gVVRGOCBieSBkZWZhdWx0IGFzIHNwZWNpZmllZCBieSBlbmNvZGluZy5zcGVjLndoYXR3Zy5vcmcKCSAgICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzQnJvd3NlciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHdpbmRvdykgPT09ICdbb2JqZWN0IFdpbmRvd10nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHN0cmluZyB2YWx1ZSBmcm9tIHNvbWUgZW5jb2RpbmcgY2hhcmFjdGVyIHNldC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGluZ05hbWUgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgcmV0dXJuIHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycKCSAgICAgICAgICAgID8gZW5jb2RpbmcKCSAgICAgICAgICAgIDogZW5jb2RpbmcuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBjaGFyYWN0ZXIgc2V0IGZyb20gc29tZSBlbmNvZGluZyBjaGFyYWN0ZXIgc2V0LgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmVuY29kaW5nQ2hhcmFjdGVyU2V0ID0gZnVuY3Rpb24gKGVuY29kaW5nKSB7CgkgICAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdCkgewoJICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlOYW1lKGVuY29kaW5nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJ1bnMgYSBmYWxsYmFjayBmb3IgdGhlIG5hdGl2ZSBkZWNvZGluZyBmdW5jaW9uLgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmRlY29kZUZhbGxiYWNrID0gZnVuY3Rpb24gKGJ5dGVzLCBlbmNvZGluZykgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gdGhpcy5lbmNvZGluZ0NoYXJhY3RlclNldChlbmNvZGluZyk7CgkgICAgICAgIGlmIChTdHJpbmdFbmNvZGluZy5pc0RlY29kZUZhbGxiYWNrU3VwcG9ydGVkKGNoYXJhY3RlclNldCkpIHsKCSAgICAgICAgICAgIHZhciBzID0gJyc7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoXzEgPSBieXRlcy5sZW5ndGg7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGggPSBieXRlc1tpXS50b1N0cmluZygxNik7CgkgICAgICAgICAgICAgICAgaWYgKGgubGVuZ3RoIDwgMikgewoJICAgICAgICAgICAgICAgICAgICBoID0gJzAnICsgaDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcyArPSAnJScgKyBoOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuVW5pY29kZUJpZ1VubWFya2VkKSkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQxNkFycmF5KGJ5dGVzLmJ1ZmZlcikpOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgiRW5jb2RpbmcgIiArIHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKSArICIgbm90IHN1cHBvcnRlZCBieSBmYWxsYmFjay4iKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzRGVjb2RlRmFsbGJhY2tTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgIHJldHVybiBjaGFyYWN0ZXJTZXQuZXF1YWxzKENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdC5VVEY4KSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuSVNPODg1OV8xKSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuQVNDSUkpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUnVucyBhIGZhbGxiYWNrIGZvciB0aGUgbmF0aXZlIGVuY29kaW5nIGZ1bmNpb24uCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNzE5Mjg0NS80MzY3NjgzCgkgICAgICovCgkgICAgU3RyaW5nRW5jb2RpbmcuZW5jb2RlRmFsbGJhY2sgPSBmdW5jdGlvbiAocykgewoJICAgICAgICB2YXIgZW5jb2RlZFVSSXN0cmluZyA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSk7CgkgICAgICAgIHZhciBjaGFyTGlzdCA9IGVuY29kZWRVUklzdHJpbmcuc3BsaXQoJycpOwoJICAgICAgICB2YXIgdWludEFycmF5ID0gW107CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckxpc3QubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHVpbnRBcnJheS5wdXNoKGNoYXJMaXN0W2ldLmNoYXJDb2RlQXQoMCkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh1aW50QXJyYXkpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0VuY29kaW5nOwoJfSgpKTsKCVN0cmluZ0VuY29kaW5nJDEuZGVmYXVsdCA9IFN0cmluZ0VuY29kaW5nOwoKCS8qCgkgKiBDb3B5cmlnaHQgKEMpIDIwMTAgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ1V0aWxzJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS5uaW8uY2hhcnNldC5DaGFyc2V0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQzID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSQxID0gQ2hhcmFjdGVyU2V0RUNJOwoJdmFyIFN0cmluZ0VuY29kaW5nXzEkMSA9IFN0cmluZ0VuY29kaW5nJDE7CgkvKioKCSAqIENvbW1vbiBzdHJpbmctcmVsYXRlZCBmdW5jdGlvbnMuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgQWxleCBEdXByZQoJICovCgl2YXIgU3RyaW5nVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nVXRpbHMoKSB7CgkgICAgfQoJICAgIC8vIFNISUZUX0pJUy5lcXVhbHNJZ25vcmVDYXNlKFBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcpIHx8CgkgICAgLy8gRVVDX0pQLmVxdWFsc0lnbm9yZUNhc2UoUExBVEZPUk1fREVGQVVMVF9FTkNPRElORyk7CgkgICAgU3RyaW5nVXRpbHMuY2FzdEFzTm9uVXRmOENoYXIgPSBmdW5jdGlvbiAoY29kZSwgZW5jb2RpbmcpIHsKCSAgICAgICAgaWYgKGVuY29kaW5nID09PSB2b2lkIDApIHsgZW5jb2RpbmcgPSBudWxsOyB9CgkgICAgICAgIC8vIElTTyA4ODU5LTEgaXMgdGhlIEphdmEgZGVmYXVsdCBhcyBVVEYtOCBpcyBKYXZhU2NyaXB0cwoJICAgICAgICAvLyB5b3UgY2FuIHNlZSB0aGlzIG1ldGhvZCBhcyBhIEphdmEgdmVyc2lvbiBvZiBTdHJpbmcuZnJvbUNoYXJDb2RlCgkgICAgICAgIHZhciBlID0gZW5jb2RpbmcgPyBlbmNvZGluZy5nZXROYW1lKCkgOiB0aGlzLklTTzg4NTkxOwoJICAgICAgICAvLyB1c2UgcGFzc2VkIGZvcm1hdCAoZnJvbUNoYXJDb2RlIHdpbGwgcmV0dXJuIFVURjggZW5jb2RpbmcpCgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoW2NvZGVdKSwgZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYnl0ZXMgYnl0ZXMgZW5jb2RpbmcgYSBzdHJpbmcsIHdob3NlIGVuY29kaW5nIHNob3VsZCBiZSBndWVzc2VkCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kZSBoaW50cyBpZiBhcHBsaWNhYmxlCgkgICAgICogQHJldHVybiBuYW1lIG9mIGd1ZXNzZWQgZW5jb2Rpbmc7IGF0IHRoZSBtb21lbnQgd2lsbCBvbmx5IGd1ZXNzIG9uZSBvZjoKCSAgICAgKiAge0BsaW5rICNTSElGVF9KSVN9LCB7QGxpbmsgI1VURjh9LCB7QGxpbmsgI0lTTzg4NTkxfSwgb3IgdGhlIHBsYXRmb3JtCgkgICAgICogIGRlZmF1bHQgZW5jb2RpbmcgaWYgbm9uZSBvZiB0aGVzZSBjYW4gcG9zc2libHkgYmUgY29ycmVjdAoJICAgICAqLwoJICAgIFN0cmluZ1V0aWxzLmd1ZXNzRW5jb2RpbmcgPSBmdW5jdGlvbiAoYnl0ZXMsIGhpbnRzKSB7CgkgICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpKSB7CgkgICAgICAgICAgICByZXR1cm4gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpLnRvU3RyaW5nKCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRm9yIG5vdywgbWVyZWx5IHRyaWVzIHRvIGRpc3Rpbmd1aXNoIElTTy04ODU5LTEsIFVURi04IGFuZCBTaGlmdF9KSVMsCgkgICAgICAgIC8vIHdoaWNoIHNob3VsZCBiZSBieSBmYXIgdGhlIG1vc3QgY29tbW9uIGVuY29kaW5ncy4KCSAgICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKCSAgICAgICAgdmFyIGNhbkJlSVNPODg1OTEgPSB0cnVlOwoJICAgICAgICB2YXIgY2FuQmVTaGlmdEpJUyA9IHRydWU7CgkgICAgICAgIHZhciBjYW5CZVVURjggPSB0cnVlOwoJICAgICAgICB2YXIgdXRmOEJ5dGVzTGVmdCA9IDA7CgkgICAgICAgIC8vIGludCB1dGY4TG93Q2hhcnMgPSAwCgkgICAgICAgIHZhciB1dGYyQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGYzQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGY0Qnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciBzamlzQnl0ZXNMZWZ0ID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNMb3dDaGFycyA9IDAKCSAgICAgICAgdmFyIHNqaXNLYXRha2FuYUNoYXJzID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNEb3VibGVCeXRlc0NoYXJzID0gMAoJICAgICAgICB2YXIgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgIHZhciBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgdmFyIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSAwOwoJICAgICAgICB2YXIgc2ppc01heERvdWJsZUJ5dGVzV29yZExlbmd0aCA9IDA7CgkgICAgICAgIC8vIGludCBpc29Mb3dDaGFycyA9IDAKCSAgICAgICAgLy8gaW50IGlzb0hpZ2hDaGFycyA9IDAKCSAgICAgICAgdmFyIGlzb0hpZ2hPdGhlciA9IDA7CgkgICAgICAgIHZhciB1dGY4Ym9tID0gYnl0ZXMubGVuZ3RoID4gMyAmJgoJICAgICAgICAgICAgYnl0ZXNbMF0gPT09IC8qKGJ5dGUpICovIDB4RUYgJiYKCSAgICAgICAgICAgIGJ5dGVzWzFdID09PSAvKihieXRlKSAqLyAweEJCICYmCgkgICAgICAgICAgICBieXRlc1syXSA9PT0gLyooYnl0ZSkgKi8gMHhCRjsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGggJiYgKGNhbkJlSVNPODg1OTEgfHwgY2FuQmVTaGlmdEpJUyB8fCBjYW5CZVVURjgpOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJ5dGVzW2ldICYgMHhGRjsKCSAgICAgICAgICAgIC8vIFVURi04IHN0dWZmCgkgICAgICAgICAgICBpZiAoY2FuQmVVVEY4KSB7CgkgICAgICAgICAgICAgICAgaWYgKHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDgwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgY2FuQmVVVEY4ID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHZhbHVlICYgMHg4MCkgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4NDApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhCeXRlc0xlZnQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDIwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjJCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4MTApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjNCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDA4KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmNEJ5dGVzQ2hhcnMrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkJlVVRGOCA9IGZhbHNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSAvLyBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyB1dGY4TG93Q2hhcnMrKwoJICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElTTy04ODU5LTEgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gMHg3RiAmJiB2YWx1ZSA8IDB4QTApIHsKCSAgICAgICAgICAgICAgICAgICAgY2FuQmVJU084ODU5MSA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IDB4OUYpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMHhDMCB8fCB2YWx1ZSA9PT0gMHhENyB8fCB2YWx1ZSA9PT0gMHhGNykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaXNvSGlnaE90aGVyKys7CgkgICAgICAgICAgICAgICAgICAgIH0gLy8gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGlzb0hpZ2hDaGFycysrCgkgICAgICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgICAgICB9IC8vIGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIGlzb0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAvLyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTaGlmdF9KSVMgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTKSB7CgkgICAgICAgICAgICAgICAgaWYgKHNqaXNCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDB4NDAgfHwgdmFsdWUgPT09IDB4N0YgfHwgdmFsdWUgPiAweEZDKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVNoaWZ0SklTID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IDB4ODAgfHwgdmFsdWUgPT09IDB4QTAgfHwgdmFsdWUgPiAweEVGKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhbkJlU2hpZnRKSVMgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiAweEEwICYmIHZhbHVlIDwgMHhFMCkgewoJICAgICAgICAgICAgICAgICAgICBzamlzS2F0YWthbmFDaGFycysrOwoJICAgICAgICAgICAgICAgICAgICBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCsrOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA+IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSBzamlzQ3VyS2F0YWthbmFXb3JkTGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID4gMHg3RikgewoJICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgIC8vIHNqaXNEb3VibGVCeXRlc0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGgrKzsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPiBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gc2ppc0N1ckRvdWJsZUJ5dGVzV29yZExlbmd0aDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gc2ppc0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPSAwOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmIHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVTaGlmdEpJUyAmJiBzamlzQnl0ZXNMZWZ0ID4gMCkgewoJICAgICAgICAgICAgY2FuQmVTaGlmdEpJUyA9IGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhc3kgLS0gaWYgdGhlcmUgaXMgQk9NIG9yIGF0IGxlYXN0IDEgdmFsaWQgbm90LXNpbmdsZSBieXRlIGNoYXJhY3RlciAoYW5kIG5vIGV2aWRlbmNlIGl0IGNhbid0IGJlIFVURi04KSwgZG9uZQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmICh1dGY4Ym9tIHx8IHV0ZjJCeXRlc0NoYXJzICsgdXRmM0J5dGVzQ2hhcnMgKyB1dGY0Qnl0ZXNDaGFycyA+IDApKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuVVRGODsKCSAgICAgICAgfQoJICAgICAgICAvLyBFYXN5IC0tIGlmIGFzc3VtaW5nIFNoaWZ0X0pJUyBvciBhdCBsZWFzdCAzIHZhbGlkIGNvbnNlY3V0aXZlIG5vdC1hc2NpaSBjaGFyYWN0ZXJzIChhbmQgbm8gZXZpZGVuY2UgaXQgY2FuJ3QgYmUpLCBkb25lCgkgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTICYmIChTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTIHx8IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPj0gMyB8fCBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID49IDMpKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuU0hJRlRfSklTOwoJICAgICAgICB9CgkgICAgICAgIC8vIERpc3Rpbmd1aXNoaW5nIFNoaWZ0X0pJUyBhbmQgSVNPLTg4NTktMSBjYW4gYmUgYSBsaXR0bGUgdG91Z2ggZm9yIHNob3J0IHdvcmRzLiBUaGUgY3J1ZGUgaGV1cmlzdGljIGlzOgoJICAgICAgICAvLyAtIElmIHdlIHNhdwoJICAgICAgICAvLyAgIC0gb25seSB0d28gY29uc2VjdXRpdmUga2F0YWthbmEgY2hhcnMgaW4gdGhlIHdob2xlIHRleHQsIG9yCgkgICAgICAgIC8vICAgLSBhdCBsZWFzdCAxMCUgb2YgYnl0ZXMgdGhhdCBjb3VsZCBiZSAidXBwZXIiIG5vdC1hbHBoYW51bWVyaWMgTGF0aW4xLAoJICAgICAgICAvLyAtIHRoZW4gd2UgY29uY2x1ZGUgU2hpZnRfSklTLCBlbHNlIElTTy04ODU5LTEKCSAgICAgICAgaWYgKGNhbkJlSVNPODg1OTEgJiYgY2FuQmVTaGlmdEpJUykgewoJICAgICAgICAgICAgcmV0dXJuIChzamlzTWF4S2F0YWthbmFXb3JkTGVuZ3RoID09PSAyICYmIHNqaXNLYXRha2FuYUNoYXJzID09PSAyKSB8fCBpc29IaWdoT3RoZXIgKiAxMCA+PSBsZW5ndGgKCSAgICAgICAgICAgICAgICA/IFN0cmluZ1V0aWxzLlNISUZUX0pJUyA6IFN0cmluZ1V0aWxzLklTTzg4NTkxOwoJICAgICAgICB9CgkgICAgICAgIC8vIE90aGVyd2lzZSwgdHJ5IGluIG9yZGVyIElTTy04ODU5LTEsIFNoaWZ0IEpJUywgVVRGLTggYW5kIGZhbGwgYmFjayB0byBkZWZhdWx0IHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuSVNPODg1OTE7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlU2hpZnRKSVMpIHsKCSAgICAgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5TSElGVF9KSVM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlVVRGOCkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLlVURjg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSB0YWtlIGEgd2lsZCBndWVzcyB3aXRoIHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5QTEFURk9STV9ERUZBVUxUX0VOQ09ESU5HOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMzQzOTcxMS80MzY3NjgzCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYXBwZW5kIFRoZSBuZXcgc3RyaW5nIHRvIGFwcGVuZC4KCSAgICAgKiBAcGFyYW0gYXJncyBBcmd1bWV0cyB2YWx1ZXMgdG8gYmUgZm9ybWF0ZWQuCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZm9ybWF0ID0gZnVuY3Rpb24gKGFwcGVuZCkgewoJICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaSA9IC0xOwoJICAgICAgICBmdW5jdGlvbiBjYWxsYmFjayhleHAsIHAwLCBwMSwgcDIsIHAzLCBwNCkgewoJICAgICAgICAgICAgaWYgKGV4cCA9PT0gJyUlJykKCSAgICAgICAgICAgICAgICByZXR1cm4gJyUnOwoJICAgICAgICAgICAgaWYgKGFyZ3NbKytpXSA9PT0gdW5kZWZpbmVkKQoJICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CgkgICAgICAgICAgICBleHAgPSBwMiA/IHBhcnNlSW50KHAyLnN1YnN0cigxKSkgOiB1bmRlZmluZWQ7CgkgICAgICAgICAgICB2YXIgYmFzZSA9IHAzID8gcGFyc2VJbnQocDMuc3Vic3RyKDEpKSA6IHVuZGVmaW5lZDsKCSAgICAgICAgICAgIHZhciB2YWw7CgkgICAgICAgICAgICBzd2l0Y2ggKHA0KSB7CgkgICAgICAgICAgICAgICAgY2FzZSAncyc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IGFyZ3NbaV07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2MnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBhcmdzW2ldWzBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdmJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChhcmdzW2ldKS50b0ZpeGVkKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ3AnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvUHJlY2lzaW9uKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2UnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvRXhwb25lbnRpYWwoZXhwKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAneCc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGFyZ3NbaV0pLnRvU3RyaW5nKGJhc2UgPyBiYXNlIDogMTYpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdkJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChwYXJzZUludChhcmdzW2ldLCBiYXNlID8gYmFzZSA6IDEwKS50b1ByZWNpc2lvbihleHApKS50b0ZpeGVkKDApOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkodmFsKSA6ICgrdmFsKS50b1N0cmluZyhiYXNlKTsKCSAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQocDEpOyAvKiBwYWRkaW5nIHNpemUgKi8KCSAgICAgICAgICAgIHZhciBjaCA9IHAxICYmIChwMVswXSArICcnKSA9PT0gJzAnID8gJzAnIDogJyAnOyAvKiBpc251bGw/ICovCgkgICAgICAgICAgICB3aGlsZSAodmFsLmxlbmd0aCA8IHNpemUpCgkgICAgICAgICAgICAgICAgdmFsID0gcDAgIT09IHVuZGVmaW5lZCA/IHZhbCArIGNoIDogY2ggKyB2YWw7IC8qIGlzbWludXM/ICovCgkgICAgICAgICAgICByZXR1cm4gdmFsOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZWdleCA9IC8lKC0pPygwP1swLTldKyk/KFsuXVswLTldKyk/KFsjXVswLTldKyk/KFtzY2ZwZXhkJV0pL2c7CgkgICAgICAgIHJldHVybiBhcHBlbmQucmVwbGFjZShyZWdleCwgY2FsbGJhY2spOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRCeXRlcyA9IGZ1bmN0aW9uIChzdHIsIGVuY29kaW5nKSB7CgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5lbmNvZGUoc3RyLCBlbmNvZGluZyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIHRoZSBjaGFyY29kZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIGF0IGluZGV4IHplcm8uCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZ2V0Q2hhckNvZGUgPSBmdW5jdGlvbiAoc3RyLCBpbmRleCkgewoJICAgICAgICBpZiAoaW5kZXggPT09IHZvaWQgMCkgeyBpbmRleCA9IDA7IH0KCSAgICAgICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KGluZGV4KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgY2hhciBmb3IgZ2l2ZW4gY2hhcmNvZGUKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRDaGFyQXQgPSBmdW5jdGlvbiAoY2hhckNvZGUpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpOwoJICAgIH07CgkgICAgU3RyaW5nVXRpbHMuU0hJRlRfSklTID0gQ2hhcmFjdGVyU2V0RUNJXzEkMS5kZWZhdWx0LlNKSVMuZ2V0TmFtZSgpOyAvLyAiU0pJUyIKCSAgICBTdHJpbmdVdGlscy5HQjIzMTIgPSAnR0IyMzEyJzsKCSAgICBTdHJpbmdVdGlscy5JU084ODU5MSA9IENoYXJhY3RlclNldEVDSV8xJDEuZGVmYXVsdC5JU084ODU5XzEuZ2V0TmFtZSgpOyAvLyAiSVNPODg1OV8xIgoJICAgIFN0cmluZ1V0aWxzLkVVQ19KUCA9ICdFVUNfSlAnOwoJICAgIFN0cmluZ1V0aWxzLlVURjggPSBDaGFyYWN0ZXJTZXRFQ0lfMSQxLmRlZmF1bHQuVVRGOC5nZXROYW1lKCk7IC8vICJVVEY4IgoJICAgIFN0cmluZ1V0aWxzLlBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcgPSBTdHJpbmdVdGlscy5VVEY4OyAvLyAiVVRGOCIvL0NoYXJzZXQuZGVmYXVsdENoYXJzZXQoKS5uYW1lKCkKCSAgICBTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTID0gZmFsc2U7CgkgICAgcmV0dXJuIFN0cmluZ1V0aWxzOwoJfSgpKTsKCVN0cmluZ1V0aWxzJDEuZGVmYXVsdCA9IFN0cmluZ1V0aWxzOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmdCdWlsZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBTdHJpbmdVdGlsc18xJDEgPSBTdHJpbmdVdGlscyQxOwoJdmFyIFN0cmluZ0J1aWxkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nQnVpbGRlcih2YWx1ZSkgewoJICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgeyB2YWx1ZSA9ICcnOyB9CgkgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICB9CgkgICAgU3RyaW5nQnVpbGRlci5wcm90b3R5cGUuZW5hYmxlRGVjb2RpbmcgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIGlmICh0eXBlb2YgcyA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gcy50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHRoaXMuZW5jb2RpbmcpIHsKCSAgICAgICAgICAgIC8vIHVzZSBwYXNzZWQgZm9ybWF0IChmcm9tQ2hhckNvZGUgd2lsbCByZXR1cm4gVVRGOCBlbmNvZGluZykKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nVXRpbHNfMSQxLmRlZmF1bHQuY2FzdEFzTm9uVXRmOENoYXIocywgdGhpcy5lbmNvZGluZyk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBjb3JyZWN0bHkgY29udmVydHMgZnJvbSBVVEYtOCwgYnV0IG5vdCBvdGhlciBlbmNvZGluZ3MKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShzKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZENoYXJzID0gZnVuY3Rpb24gKHN0ciwgb2Zmc2V0LCBsZW4pIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldDsgb2Zmc2V0IDwgb2Zmc2V0ICsgbGVuOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kKHN0cltpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNoYXJBdChuKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmRlbGV0ZUNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKG4gKyAxKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnNldENoYXJBdCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgMSk7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zdWJzdHJpbmcgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAbm90ZSBoZWxwZXIgbWV0aG9kIGZvciBSU1MgRXhwYW5kZWQKCSAgICAgKi8KCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zZXRMZW5ndGhUb1plcm8gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSAnJzsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgYy5sZW5ndGgpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0J1aWxkZXI7Cgl9KCkpOwoJU3RyaW5nQnVpbGRlciQxLmRlZmF1bHQgPSBTdHJpbmdCdWlsZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQml0TWF0cml4JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIEJpdEFycmF5XzEkMSA9IEJpdEFycmF5JDE7Cgl2YXIgU3lzdGVtXzEkMyA9IFN5c3RlbSQxOwoJdmFyIEFycmF5c18xID0gQXJyYXlzJDE7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDIgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNyA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgMkQgbWF0cml4IG9mIGJpdHMuIEluIGZ1bmN0aW9uIGFyZ3VtZW50cyBiZWxvdywgYW5kIHRocm91Z2hvdXQgdGhlIGNvbW1vbgoJICogbW9kdWxlLCB4IGlzIHRoZSBjb2x1bW4gcG9zaXRpb24sIGFuZCB5IGlzIHRoZSByb3cgcG9zaXRpb24uIFRoZSBvcmRlcmluZyBpcyBhbHdheXMgeCwgeS4KCSAqIFRoZSBvcmlnaW4gaXMgYXQgdGhlIHRvcC1sZWZ0LjwvcD4KCSAqCgkgKiA8cD5JbnRlcm5hbGx5IHRoZSBiaXRzIGFyZSByZXByZXNlbnRlZCBpbiBhIDEtRCBhcnJheSBvZiAzMi1iaXQgaW50cy4gSG93ZXZlciwgZWFjaCByb3cgYmVnaW5zCgkgKiB3aXRoIGEgbmV3IGludC4gVGhpcyBpcyBkb25lIGludGVudGlvbmFsbHkgc28gdGhhdCB3ZSBjYW4gY29weSBvdXQgYSByb3cgaW50byBhIEJpdEFycmF5IHZlcnkKCSAqIGVmZmljaWVudGx5LjwvcD4KCSAqCgkgKiA8cD5UaGUgb3JkZXJpbmcgb2YgYml0cyBpcyByb3ctbWFqb3IuIFdpdGhpbiBlYWNoIGludCwgdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdHMgYXJlIHVzZWQgZmlyc3QsCgkgKiBtZWFuaW5nIHRoZXkgcmVwcmVzZW50IGxvd2VyIHggdmFsdWVzLiBUaGlzIGlzIGNvbXBhdGlibGUgd2l0aCBCaXRBcnJheSdzIGltcGxlbWVudGF0aW9uLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpdE1hdHJpeCAvKmltcGxlbWVudHMgQ2xvbmVhYmxlKi8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSBzcXVhcmUge0BsaW5rIEJpdE1hdHJpeH0uCgkgICAgICoKCSAgICAgKiBAcGFyYW0gZGltZW5zaW9uIGhlaWdodCBhbmQgd2lkdGgKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoZGltZW5zaW9uOiBudW1iZXIgLyppbnQqLykgewoJICAgIC8vICAgdGhpcyhkaW1lbnNpb24sIGRpbWVuc2lvbikKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSB7QGxpbmsgQml0TWF0cml4fS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB3aWR0aCBiaXQgbWF0cml4IHdpZHRoCgkgICAgICogQHBhcmFtIGhlaWdodCBiaXQgbWF0cml4IGhlaWdodAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyIC8qaW50Ki8sIGhlaWdodDogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh3aWR0aCA8IDEgfHwgaGVpZ2h0IDwgMSkgewoJICAgIC8vICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJCb3RoIGRpbWVuc2lvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCIpCgkgICAgLy8gICB9CgkgICAgLy8gICB0aGlzLndpZHRoID0gd2lkdGgKCSAgICAvLyAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0CgkgICAgLy8gICB0aGlzLnJvd1NpemUgPSAod2lkdGggKyAzMSkgLyAzMgoJICAgIC8vICAgYml0cyA9IG5ldyBpbnRbcm93U2l6ZSAqIGhlaWdodF07CgkgICAgLy8gfQoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeCh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgcm93U2l6ZSAvKmludCovLCBiaXRzKSB7CgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKCSAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkgICAgICAgIHRoaXMucm93U2l6ZSA9IHJvd1NpemU7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGhlaWdodCB8fCBudWxsID09PSBoZWlnaHQpIHsKCSAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgICAgICBpZiAod2lkdGggPCAxIHx8IGhlaWdodCA8IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0JvdGggZGltZW5zaW9ucyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcm93U2l6ZSB8fCBudWxsID09PSByb3dTaXplKSB7CgkgICAgICAgICAgICByb3dTaXplID0gTWF0aC5mbG9vcigod2lkdGggKyAzMSkgLyAzMik7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yb3dTaXplID0gcm93U2l6ZTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICB0aGlzLmJpdHMgPSBuZXcgSW50MzJBcnJheSh0aGlzLnJvd1NpemUgKiB0aGlzLmhlaWdodCk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgLyoqCgkgICAgICogSW50ZXJwcmV0cyBhIDJEIGFycmF5IG9mIGJvb2xlYW5zIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0sIHdoZXJlICJ0cnVlIiBtZWFucyBhbiAib24iIGJpdC4KCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBpbWFnZSBiaXRzIG9mIHRoZSBpbWFnZSwgYXMgYSByb3ctbWFqb3IgMkQgYXJyYXkuIEVsZW1lbnRzIGFyZSBhcnJheXMgcmVwcmVzZW50aW5nIHJvd3MKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCaXRNYXRyaXh9IHJlcHJlc2VudGF0aW9uIG9mIGltYWdlCgkgICAgICovCgkgICAgQml0TWF0cml4LnBhcnNlRnJvbUJvb2xlYW5BcnJheSA9IGZ1bmN0aW9uIChpbWFnZSkgewoJICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UubGVuZ3RoOwoJICAgICAgICB2YXIgd2lkdGggPSBpbWFnZVswXS5sZW5ndGg7CgkgICAgICAgIHZhciBiaXRzID0gbmV3IEJpdE1hdHJpeCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGltYWdlSSA9IGltYWdlW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGltYWdlSVtqXSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldChqLCBpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBzdHJpbmdSZXByZXNlbnRhdGlvbgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcKCSAgICAgKiBAcGFyYW0gdW5zZXRTdHJpbmcKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZ1JlcHJlc2VudGF0aW9uLCBzZXRTdHJpbmcsIHVuc2V0U3RyaW5nKSB7CgkgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnc3RyaW5nUmVwcmVzZW50YXRpb24gY2Fubm90IGJlIG51bGwnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBBcnJheShzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpOwoJICAgICAgICB2YXIgYml0c1BvcyA9IDA7CgkgICAgICAgIHZhciByb3dTdGFydFBvcyA9IDA7CgkgICAgICAgIHZhciByb3dMZW5ndGggPSAtMTsKCSAgICAgICAgdmFyIG5Sb3dzID0gMDsKCSAgICAgICAgdmFyIHBvcyA9IDA7CgkgICAgICAgIHdoaWxlIChwb3MgPCBzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpIHsKCSAgICAgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbi5jaGFyQXQocG9zKSA9PT0gJ1xuJyB8fAoJICAgICAgICAgICAgICAgIHN0cmluZ1JlcHJlc2VudGF0aW9uLmNoYXJBdChwb3MpID09PSAnXHInKSB7CgkgICAgICAgICAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgICAgICAgICBpZiAocm93TGVuZ3RoID09PSAtMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcm93TGVuZ3RoID0gYml0c1BvcyAtIHJvd1N0YXJ0UG9zOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJpdHNQb3MgLSByb3dTdGFydFBvcyAhPT0gcm93TGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdyb3cgbGVuZ3RocyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByb3dTdGFydFBvcyA9IGJpdHNQb3M7CgkgICAgICAgICAgICAgICAgICAgIG5Sb3dzKys7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHBvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoc3RyaW5nUmVwcmVzZW50YXRpb24uc3Vic3RyaW5nKHBvcywgcG9zICsgc2V0U3RyaW5nLmxlbmd0aCkgPT09IHNldFN0cmluZykgewoJICAgICAgICAgICAgICAgIHBvcyArPSBzZXRTdHJpbmcubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGJpdHNbYml0c1Bvc10gPSB0cnVlOwoJICAgICAgICAgICAgICAgIGJpdHNQb3MrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHN0cmluZ1JlcHJlc2VudGF0aW9uLnN1YnN0cmluZyhwb3MsIHBvcyArIHVuc2V0U3RyaW5nLmxlbmd0aCkgPT09IHVuc2V0U3RyaW5nKSB7CgkgICAgICAgICAgICAgICAgcG9zICs9IHVuc2V0U3RyaW5nLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBiaXRzW2JpdHNQb3NdID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgYml0c1BvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnaWxsZWdhbCBjaGFyYWN0ZXIgZW5jb3VudGVyZWQ6ICcgKyBzdHJpbmdSZXByZXNlbnRhdGlvbi5zdWJzdHJpbmcocG9zKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm8gRU9MIGF0IGVuZD8KCSAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgaWYgKHJvd0xlbmd0aCA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICByb3dMZW5ndGggPSBiaXRzUG9zIC0gcm93U3RhcnRQb3M7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmIChiaXRzUG9zIC0gcm93U3RhcnRQb3MgIT09IHJvd0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ3JvdyBsZW5ndGhzIGRvIG5vdCBtYXRjaCcpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgblJvd3MrKzsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbWF0cml4ID0gbmV3IEJpdE1hdHJpeChyb3dMZW5ndGgsIG5Sb3dzKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaXRzUG9zOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChiaXRzW2ldKSB7CgkgICAgICAgICAgICAgICAgbWF0cml4LnNldChNYXRoLmZsb29yKGkgJSByb3dMZW5ndGgpLCBNYXRoLmZsb29yKGkgLyByb3dMZW5ndGgpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbWF0cml4OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+R2V0cyB0aGUgcmVxdWVzdGVkIGJpdCwgd2hlcmUgdHJ1ZSBtZWFucyBibGFjay48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0geCBUaGUgaG9yaXpvbnRhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggY29sdW1uKQoJICAgICAqIEBwYXJhbSB5IFRoZSB2ZXJ0aWNhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggcm93KQoJICAgICAqIEByZXR1cm4gdmFsdWUgb2YgZ2l2ZW4gYml0IGluIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHggLyppbnQqLywgeSAvKmludCovKSB7CgkgICAgICAgIHZhciBvZmZzZXQgPSB5ICogdGhpcy5yb3dTaXplICsgTWF0aC5mbG9vcih4IC8gMzIpOwoJICAgICAgICByZXR1cm4gKCh0aGlzLmJpdHNbb2Zmc2V0XSA+Pj4gKHggJiAweDFmKSkgJiAxKSAhPT0gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgdGhlIGdpdmVuIGJpdCB0byB0cnVlLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB4IFRoZSBob3Jpem9udGFsIGNvbXBvbmVudCAoaS5lLiB3aGljaCBjb2x1bW4pCgkgICAgICogQHBhcmFtIHkgVGhlIHZlcnRpY2FsIGNvbXBvbmVudCAoaS5lLiB3aGljaCByb3cpCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIHw9ICgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRjsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUudW5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdICY9IH4oKDEgPDwgKHggJiAweDFmKSkgJiAweEZGRkZGRkZGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkZsaXBzIHRoZSBnaXZlbiBiaXQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHggVGhlIGhvcml6b250YWwgY29tcG9uZW50IChpLmUuIHdoaWNoIGNvbHVtbikKCSAgICAgKiBAcGFyYW0geSBUaGUgdmVydGljYWwgY29tcG9uZW50IChpLmUuIHdoaWNoIHJvdykKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmZsaXAgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIF49ICgoMSA8PCAoeCAmIDB4MWYpKSAmIDB4RkZGRkZGRkYpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRXhjbHVzaXZlLW9yIChYT1IpOiBGbGlwIHRoZSBiaXQgaW4gdGhpcyB7QGNvZGUgQml0TWF0cml4fSBpZiB0aGUgY29ycmVzcG9uZGluZwoJICAgICAqIG1hc2sgYml0IGlzIHNldC4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBtYXNrIFhPUiBtYXNrCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAobWFzaykgewoJICAgICAgICBpZiAodGhpcy53aWR0aCAhPT0gbWFzay5nZXRXaWR0aCgpIHx8IHRoaXMuaGVpZ2h0ICE9PSBtYXNrLmdldEhlaWdodCgpCgkgICAgICAgICAgICB8fCB0aGlzLnJvd1NpemUgIT09IG1hc2suZ2V0Um93U2l6ZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdpbnB1dCBtYXRyaXggZGltZW5zaW9ucyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcm93QXJyYXkgPSBuZXcgQml0QXJyYXlfMSQxLmRlZmF1bHQoTWF0aC5mbG9vcih0aGlzLndpZHRoIC8gMzIpICsgMSk7CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIHZhciBvZmZzZXQgPSB5ICogcm93U2l6ZTsKCSAgICAgICAgICAgIHZhciByb3cgPSBtYXNrLmdldFJvdyh5LCByb3dBcnJheSkuZ2V0Qml0QXJyYXkoKTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgcm93U2l6ZTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgYml0c1tvZmZzZXQgKyB4XSBePSByb3dbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBtYXggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkrKykgewoJICAgICAgICAgICAgYml0c1tpXSA9IDA7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgYSBzcXVhcmUgcmVnaW9uIG9mIHRoZSBiaXQgbWF0cml4IHRvIHRydWUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGxlZnQgVGhlIGhvcml6b250YWwgcG9zaXRpb24gdG8gYmVnaW4gYXQgKGluY2x1c2l2ZSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB2ZXJ0aWNhbCBwb3NpdGlvbiB0byBiZWdpbiBhdCAoaW5jbHVzaXZlKQoJICAgICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIHJlZ2lvbgoJICAgICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgcmVnaW9uCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXRSZWdpb24gPSBmdW5jdGlvbiAobGVmdCAvKmludCovLCB0b3AgLyppbnQqLywgd2lkdGggLyppbnQqLywgaGVpZ2h0IC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHRvcCA8IDAgfHwgbGVmdCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0xlZnQgYW5kIHRvcCBtdXN0IGJlIG5vbm5lZ2F0aXZlJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGhlaWdodCA8IDEgfHwgd2lkdGggPCAxKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdIZWlnaHQgYW5kIHdpZHRoIG11c3QgYmUgYXQgbGVhc3QgMScpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyB3aWR0aDsKCSAgICAgICAgdmFyIGJvdHRvbSA9IHRvcCArIGhlaWdodDsKCSAgICAgICAgaWYgKGJvdHRvbSA+IHRoaXMuaGVpZ2h0IHx8IHJpZ2h0ID4gdGhpcy53aWR0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnVGhlIHJlZ2lvbiBtdXN0IGZpdCBpbnNpZGUgdGhlIG1hdHJpeCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IHRvcDsgeSA8IGJvdHRvbTsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHJvd1NpemU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gbGVmdDsgeCA8IHJpZ2h0OyB4KyspIHsKCSAgICAgICAgICAgICAgICBiaXRzW29mZnNldCArIE1hdGguZmxvb3IoeCAvIDMyKV0gfD0gKCgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEEgZmFzdCBtZXRob2QgdG8gcmV0cmlldmUgb25lIHJvdyBvZiBkYXRhIGZyb20gdGhlIG1hdHJpeCBhcyBhIEJpdEFycmF5LgoJICAgICAqCgkgICAgICogQHBhcmFtIHkgVGhlIHJvdyB0byByZXRyaWV2ZQoJICAgICAqIEBwYXJhbSByb3cgQW4gb3B0aW9uYWwgY2FsbGVyLWFsbG9jYXRlZCBCaXRBcnJheSwgd2lsbCBiZSBhbGxvY2F0ZWQgaWYgbnVsbCBvciB0b28gc21hbGwKCSAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHRpbmcgQml0QXJyYXkgLSB0aGlzIHJlZmVyZW5jZSBzaG91bGQgYWx3YXlzIGJlIHVzZWQgZXZlbiB3aGVuIHBhc3NpbmcKCSAgICAgKiAgICAgICAgIHlvdXIgb3duIHJvdwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Um93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIGlmIChyb3cgPT09IG51bGwgfHwgcm93ID09PSB1bmRlZmluZWQgfHwgcm93LmdldFNpemUoKSA8IHRoaXMud2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh0aGlzLndpZHRoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHJvdy5jbGVhcigpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiByb3dTaXplOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHJvd1NpemU7IHgrKykgewoJICAgICAgICAgICAgcm93LnNldEJ1bGsoeCAqIDMyLCBiaXRzW29mZnNldCArIHhdKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIHkgcm93IHRvIHNldAoJICAgICAqIEBwYXJhbSByb3cge0BsaW5rIEJpdEFycmF5fSB0byBjb3B5IGZyb20KCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLnNldFJvdyA9IGZ1bmN0aW9uICh5IC8qaW50Ki8sIHJvdykgewoJICAgICAgICBTeXN0ZW1fMSQzLmRlZmF1bHQuYXJyYXljb3B5KHJvdy5nZXRCaXRBcnJheSgpLCAwLCB0aGlzLmJpdHMsIHkgKiB0aGlzLnJvd1NpemUsIHRoaXMucm93U2l6ZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBNb2RpZmllcyB0aGlzIHtAY29kZSBCaXRNYXRyaXh9IHRvIHJlcHJlc2VudCB0aGUgc2FtZSBidXQgcm90YXRlZCAxODAgZGVncmVlcwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUucm90YXRlMTgwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgdG9wUm93ID0gbmV3IEJpdEFycmF5XzEkMS5kZWZhdWx0KHdpZHRoKTsKCSAgICAgICAgdmFyIGJvdHRvbVJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh3aWR0aCk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IE1hdGguZmxvb3IoKGhlaWdodCArIDEpIC8gMik7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB0b3BSb3cgPSB0aGlzLmdldFJvdyhpLCB0b3BSb3cpOwoJICAgICAgICAgICAgYm90dG9tUm93ID0gdGhpcy5nZXRSb3coaGVpZ2h0IC0gMSAtIGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0b3BSb3cucmV2ZXJzZSgpOwoJICAgICAgICAgICAgYm90dG9tUm93LnJldmVyc2UoKTsKCSAgICAgICAgICAgIHRoaXMuc2V0Um93KGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0aGlzLnNldFJvdyhoZWlnaHQgLSAxIC0gaSwgdG9wUm93KTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIHRoZSBlbmNsb3NpbmcgcmVjdGFuZ2xlIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBsZWZ0LHRvcCx3aWR0aCxoZWlnaHR9IGVuY2xvc2luZyByZWN0YW5nbGUgb2YgYWxsIDEgYml0cywgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldEVuY2xvc2luZ1JlY3RhbmdsZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwoJICAgICAgICB2YXIgcm93U2l6ZSA9IHRoaXMucm93U2l6ZTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBsZWZ0ID0gd2lkdGg7CgkgICAgICAgIHZhciB0b3AgPSBoZWlnaHQ7CgkgICAgICAgIHZhciByaWdodCA9IC0xOwoJICAgICAgICB2YXIgYm90dG9tID0gLTE7CgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHgzMiA9IDA7IHgzMiA8IHJvd1NpemU7IHgzMisrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHRoZUJpdHMgPSBiaXRzW3kgKiByb3dTaXplICsgeDMyXTsKCSAgICAgICAgICAgICAgICBpZiAodGhlQml0cyAhPT0gMCkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHRvcCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA+IGJvdHRvbSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeDMyICogMzIgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0ID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdCsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHgzMiAqIDMyICsgYml0OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGlmICh4MzIgKiAzMiArIDMxID4gcmlnaHQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXQgPSAzMTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgodGhlQml0cyA+Pj4gYml0KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPiByaWdodCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0geDMyICogMzIgKyBiaXQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJpZ2h0IDwgbGVmdCB8fCBib3R0b20gPCB0b3ApIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2xlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0ICsgMSwgYm90dG9tIC0gdG9wICsgMV0pOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIGEgY29ybmVyIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSB4LHl9IGNvb3JkaW5hdGUgb2YgdG9wLWxlZnQtbW9zdCAxIGJpdCwgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldFRvcExlZnRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IDA7CgkgICAgICAgIHdoaWxlIChiaXRzT2Zmc2V0IDwgYml0cy5sZW5ndGggJiYgYml0c1tiaXRzT2Zmc2V0XSA9PT0gMCkgewoJICAgICAgICAgICAgYml0c09mZnNldCsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChiaXRzT2Zmc2V0ID09PSBiaXRzLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHkgPSBiaXRzT2Zmc2V0IC8gcm93U2l6ZTsKCSAgICAgICAgdmFyIHggPSAoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDA7CgkgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgYml0Kys7CgkgICAgICAgIH0KCSAgICAgICAgeCArPSBiaXQ7CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW3gsIHldKTsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Qm90dG9tUmlnaHRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IGJpdHMubGVuZ3RoIC0gMTsKCSAgICAgICAgd2hpbGUgKGJpdHNPZmZzZXQgPj0gMCAmJiBiaXRzW2JpdHNPZmZzZXRdID09PSAwKSB7CgkgICAgICAgICAgICBiaXRzT2Zmc2V0LS07CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJpdHNPZmZzZXQgPCAwKSB7CgkgICAgICAgICAgICByZXR1cm4gbnVsbDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IoYml0c09mZnNldCAvIHJvd1NpemUpOwoJICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDMxOwoJICAgICAgICB3aGlsZSAoKHRoZUJpdHMgPj4+IGJpdCkgPT09IDApIHsKCSAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICB9CgkgICAgICAgIHggKz0gYml0OwoJICAgICAgICByZXR1cm4gSW50MzJBcnJheS5mcm9tKFt4LCB5XSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5oZWlnaHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSByb3cgc2l6ZSBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRSb3dTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yb3dTaXplOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdE1hdHJpeCkpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy53aWR0aCA9PT0gb3RoZXIud2lkdGggJiYgdGhpcy5oZWlnaHQgPT09IG90aGVyLmhlaWdodCAmJiB0aGlzLnJvd1NpemUgPT09IG90aGVyLnJvd1NpemUgJiYKCSAgICAgICAgICAgIEFycmF5c18xLmRlZmF1bHQuZXF1YWxzKHRoaXMuYml0cywgb3RoZXIuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGhhc2ggPSB0aGlzLndpZHRoOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy53aWR0aDsKCSAgICAgICAgaGFzaCA9IDMxICogaGFzaCArIHRoaXMuaGVpZ2h0OwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy5yb3dTaXplOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgQXJyYXlzXzEuZGVmYXVsdC5oYXNoQ29kZSh0aGlzLmJpdHMpOwoJICAgICAgICByZXR1cm4gaGFzaDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIHVzaW5nICJYIiBmb3Igc2V0IGFuZCAiICIgZm9yIHVuc2V0IGJpdHMKCSAgICAgKi8KCSAgICAvKkBPdmVycmlkZSovCgkgICAgLy8gcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdG9TdHJpbmcoIjogIlgsICIgICIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgdG9TdHJpbmcoc2V0U3RyaW5nOiBzdHJpbmcgPSAiWCAiLCB1bnNldFN0cmluZzogc3RyaW5nID0gIiAgIik6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5idWlsZFRvU3RyaW5nKHNldFN0cmluZywgdW5zZXRTdHJpbmcsICJcbiIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEBwYXJhbSBsaW5lU2VwYXJhdG9yIG5ld2xpbmUgY2hhcmFjdGVyIGluIHN0cmluZyByZXByZXNlbnRhdGlvbgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MgYW5kIGxpbmUgc2VwYXJhdG9yCgkgICAgICogQGRlcHJlY2F0ZWQgY2FsbCB7QGxpbmsgI3RvU3RyaW5nKFN0cmluZyxTdHJpbmcpfSBvbmx5LCB3aGljaCB1c2VzIFxuIGxpbmUgc2VwYXJhdG9yIGFsd2F5cwoJICAgICAqLwoJICAgIC8vIEBEZXByZWNhdGVkCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIChzZXRTdHJpbmcsIHVuc2V0U3RyaW5nLCBsaW5lU2VwYXJhdG9yKSB7CgkgICAgICAgIGlmIChzZXRTdHJpbmcgPT09IHZvaWQgMCkgeyBzZXRTdHJpbmcgPSAnWCAnOyB9CgkgICAgICAgIGlmICh1bnNldFN0cmluZyA9PT0gdm9pZCAwKSB7IHVuc2V0U3RyaW5nID0gJyAgJzsgfQoJICAgICAgICBpZiAobGluZVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IGxpbmVTZXBhcmF0b3IgPSAnXG4nOyB9CgkgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkVG9TdHJpbmcoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcik7CgkgICAgfTsKCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmJ1aWxkVG9TdHJpbmcgPSBmdW5jdGlvbiAoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcikgewoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgLy8gcmVzdWx0LmFwcGVuZChsaW5lU2VwYXJhdG9yKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IHRoaXMud2lkdGg7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCh0aGlzLmdldCh4LCB5KSA/IHNldFN0cmluZyA6IHVuc2V0U3RyaW5nKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQobGluZVNlcGFyYXRvcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0TWF0cml4KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnJvd1NpemUsIHRoaXMuYml0cy5zbGljZSgpKTsKCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXg7Cgl9KCkpOwoJQml0TWF0cml4JDEuZGVmYXVsdCA9IEJpdE1hdHJpeDsKCgl2YXIgTm90Rm91bmRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShOb3RGb3VuZEV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBOb3RGb3VuZEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZChOb3RGb3VuZEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBOb3RGb3VuZEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5nZXROb3RGb3VuZEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5raW5kID0gJ05vdEZvdW5kRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gTm90Rm91bmRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCkpOwoJTm90Rm91bmRFeGNlcHRpb24kMS5kZWZhdWx0ID0gTm90Rm91bmRFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYyA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24geyovCgl2YXIgQmluYXJpemVyXzEgPSBCaW5hcml6ZXIkMTsKCXZhciBCaXRBcnJheV8xID0gQml0QXJyYXkkMTsKCXZhciBCaXRNYXRyaXhfMSQ1ID0gQml0TWF0cml4JDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQ2ID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qKgoJICogVGhpcyBCaW5hcml6ZXIgaW1wbGVtZW50YXRpb24gdXNlcyB0aGUgb2xkIFpYaW5nIGdsb2JhbCBoaXN0b2dyYW0gYXBwcm9hY2guIEl0IGlzIHN1aXRhYmxlCgkgKiBmb3IgbG93LWVuZCBtb2JpbGUgZGV2aWNlcyB3aGljaCBkb24ndCBoYXZlIGVub3VnaCBDUFUgb3IgbWVtb3J5IHRvIHVzZSBhIGxvY2FsIHRocmVzaG9sZGluZwoJICogYWxnb3JpdGhtLiBIb3dldmVyLCBiZWNhdXNlIGl0IHBpY2tzIGEgZ2xvYmFsIGJsYWNrIHBvaW50LCBpdCBjYW5ub3QgaGFuZGxlIGRpZmZpY3VsdCBzaGFkb3dzCgkgKiBhbmQgZ3JhZGllbnRzLgoJICoKCSAqIEZhc3RlciBtb2JpbGUgZGV2aWNlcyBhbmQgYWxsIGRlc2t0b3AgYXBwbGljYXRpb25zIHNob3VsZCBwcm9iYWJseSB1c2UgSHlicmlkQmluYXJpemVyIGluc3RlYWQuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGMoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5sdW1pbmFuY2VzID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkVNUFRZOwoJICAgICAgICBfdGhpcy5idWNrZXRzID0gbmV3IEludDMyQXJyYXkoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CVUNLRVRTKTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvLyBBcHBsaWVzIHNpbXBsZSBzaGFycGVuaW5nIHRvIHRoZSByb3cgZGF0YSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlIG9mIHRoZSAxRCBSZWFkZXJzLgoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmdldEJsYWNrUm93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IHJvdyA9PT0gbnVsbCB8fCByb3cuZ2V0U2l6ZSgpIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xLmRlZmF1bHQod2lkdGgpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgcm93LmNsZWFyKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5pbml0QXJyYXlzKHdpZHRoKTsKCSAgICAgICAgdmFyIGxvY2FsTHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRSb3coeSwgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgdmFyIGxvY2FsQnVja2V0cyA9IHRoaXMuYnVja2V0czsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICBsb2NhbEJ1Y2tldHNbKGxvY2FsTHVtaW5hbmNlc1t4XSAmIDB4ZmYpID4+IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfU0hJRlRdKys7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJsYWNrUG9pbnQgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuZXN0aW1hdGVCbGFja1BvaW50KGxvY2FsQnVja2V0cyk7CgkgICAgICAgIGlmICh3aWR0aCA8IDMpIHsKCSAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdmVyeSBzbWFsbCBpbWFnZXMKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgICAgIGlmICgobG9jYWxMdW1pbmFuY2VzW3hdICYgMHhmZikgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIHJvdy5zZXQoeCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGxlZnQgPSBsb2NhbEx1bWluYW5jZXNbMF0gJiAweGZmOwoJICAgICAgICAgICAgdmFyIGNlbnRlciA9IGxvY2FsTHVtaW5hbmNlc1sxXSAmIDB4ZmY7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMTsgeCA8IHdpZHRoIC0gMTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gbG9jYWxMdW1pbmFuY2VzW3ggKyAxXSAmIDB4ZmY7CgkgICAgICAgICAgICAgICAgLy8gQSBzaW1wbGUgLTEgNCAtMSBib3ggZmlsdGVyIHdpdGggYSB3ZWlnaHQgb2YgMi4KCSAgICAgICAgICAgICAgICBpZiAoKChjZW50ZXIgKiA0KSAtIGxlZnQgLSByaWdodCkgLyAyIDwgYmxhY2tQb2ludCkgewoJICAgICAgICAgICAgICAgICAgICByb3cuc2V0KHgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBsZWZ0ID0gY2VudGVyOwoJICAgICAgICAgICAgICAgIGNlbnRlciA9IHJpZ2h0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByb3c7CgkgICAgfTsKCSAgICAvLyBEb2VzIG5vdCBzaGFycGVuIHRoZSBkYXRhLCBhcyB0aGlzIGNhbGwgaXMgaW50ZW5kZWQgdG8gb25seSBiZSB1c2VkIGJ5IDJEIFJlYWRlcnMuCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIG1hdHJpeCA9IG5ldyBCaXRNYXRyaXhfMSQ1LmRlZmF1bHQod2lkdGgsIGhlaWdodCk7CgkgICAgICAgIC8vIFF1aWNrbHkgY2FsY3VsYXRlcyB0aGUgaGlzdG9ncmFtIGJ5IHNhbXBsaW5nIGZvdXIgcm93cyBmcm9tIHRoZSBpbWFnZS4gVGhpcyBwcm92ZWQgdG8gYmUKCSAgICAgICAgLy8gbW9yZSByb2J1c3Qgb24gdGhlIGJsYWNrYm94IHRlc3RzIHRoYW4gc2FtcGxpbmcgYSBkaWFnb25hbCBhcyB3ZSB1c2VkIHRvIGRvLgoJICAgICAgICB0aGlzLmluaXRBcnJheXMod2lkdGgpOwoJICAgICAgICB2YXIgbG9jYWxCdWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB5ID0gMTsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgdmFyIHJvdyA9IE1hdGguZmxvb3IoKGhlaWdodCAqIHkpIC8gNSk7CgkgICAgICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzXzEgPSBzb3VyY2UuZ2V0Um93KHJvdywgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgICAgIHZhciByaWdodCA9IE1hdGguZmxvb3IoKHdpZHRoICogNCkgLyA1KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSBNYXRoLmZsb29yKHdpZHRoIC8gNSk7IHggPCByaWdodDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzXzFbeF0gJiAweGZmOwoJICAgICAgICAgICAgICAgIGxvY2FsQnVja2V0c1twaXhlbCA+PiBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUXSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBibGFja1BvaW50ID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludChsb2NhbEJ1Y2tldHMpOwoJICAgICAgICAvLyBXZSBkZWxheSByZWFkaW5nIHRoZSBlbnRpcmUgaW1hZ2UgbHVtaW5hbmNlIHVudGlsIHRoZSBibGFjayBwb2ludCBlc3RpbWF0aW9uIHN1Y2NlZWRzLgoJICAgICAgICAvLyBBbHRob3VnaCB3ZSBlbmQgdXAgcmVhZGluZyBmb3VyIHJvd3MgdHdpY2UsIGl0IGlzIGNvbnNpc3RlbnQgd2l0aCBvdXIgbW90dG8gb2YKCSAgICAgICAgLy8gImZhaWwgcXVpY2tseSIgd2hpY2ggaXMgbmVjZXNzYXJ5IGZvciBjb250aW51b3VzIHNjYW5uaW5nLgoJICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzID0gc291cmNlLmdldE1hdHJpeCgpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzW29mZnNldCArIHhdICYgMHhmZjsKCSAgICAgICAgICAgICAgICBpZiAocGl4ZWwgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIG1hdHJpeC5zZXQoeCwgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBtYXRyaXg7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLnByb3RvdHlwZS5jcmVhdGVCaW5hcml6ZXIgPSBmdW5jdGlvbiAoc291cmNlKSB7CgkgICAgICAgIHJldHVybiBuZXcgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyKHNvdXJjZSk7CgkgICAgfTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmluaXRBcnJheXMgPSBmdW5jdGlvbiAobHVtaW5hbmNlU2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmICh0aGlzLmx1bWluYW5jZXMubGVuZ3RoIDwgbHVtaW5hbmNlU2l6ZSkgewoJICAgICAgICAgICAgdGhpcy5sdW1pbmFuY2VzID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGx1bWluYW5jZVNpemUpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBidWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQlVDS0VUUzsgeCsrKSB7CgkgICAgICAgICAgICBidWNrZXRzW3hdID0gMDsKCSAgICAgICAgfQoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludCA9IGZ1bmN0aW9uIChidWNrZXRzKSB7CgkgICAgICAgIC8vIEZpbmQgdGhlIHRhbGxlc3QgcGVhayBpbiB0aGUgaGlzdG9ncmFtLgoJICAgICAgICB2YXIgbnVtQnVja2V0cyA9IGJ1Y2tldHMubGVuZ3RoOwoJICAgICAgICB2YXIgbWF4QnVja2V0Q291bnQgPSAwOwoJICAgICAgICB2YXIgZmlyc3RQZWFrID0gMDsKCSAgICAgICAgdmFyIGZpcnN0UGVha1NpemUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgaWYgKGJ1Y2tldHNbeF0gPiBmaXJzdFBlYWtTaXplKSB7CgkgICAgICAgICAgICAgICAgZmlyc3RQZWFrID0geDsKCSAgICAgICAgICAgICAgICBmaXJzdFBlYWtTaXplID0gYnVja2V0c1t4XTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChidWNrZXRzW3hdID4gbWF4QnVja2V0Q291bnQpIHsKCSAgICAgICAgICAgICAgICBtYXhCdWNrZXRDb3VudCA9IGJ1Y2tldHNbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCB0aGUgc2Vjb25kLXRhbGxlc3QgcGVhayB3aGljaCBpcyBzb21ld2hhdCBmYXIgZnJvbSB0aGUgdGFsbGVzdCBwZWFrLgoJICAgICAgICB2YXIgc2Vjb25kUGVhayA9IDA7CgkgICAgICAgIHZhciBzZWNvbmRQZWFrU2NvcmUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgdmFyIGRpc3RhbmNlVG9CaWdnZXN0ID0geCAtIGZpcnN0UGVhazsKCSAgICAgICAgICAgIC8vIEVuY291cmFnZSBtb3JlIGRpc3RhbnQgc2Vjb25kIHBlYWtzIGJ5IG11bHRpcGx5aW5nIGJ5IHNxdWFyZSBvZiBkaXN0YW5jZS4KCSAgICAgICAgICAgIHZhciBzY29yZSA9IGJ1Y2tldHNbeF0gKiBkaXN0YW5jZVRvQmlnZ2VzdCAqIGRpc3RhbmNlVG9CaWdnZXN0OwoJICAgICAgICAgICAgaWYgKHNjb3JlID4gc2Vjb25kUGVha1Njb3JlKSB7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVhayA9IHg7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVha1Njb3JlID0gc2NvcmU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTWFrZSBzdXJlIGZpcnN0UGVhayBjb3JyZXNwb25kcyB0byB0aGUgYmxhY2sgcGVhay4KCSAgICAgICAgaWYgKGZpcnN0UGVhayA+IHNlY29uZFBlYWspIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZmlyc3RQZWFrOwoJICAgICAgICAgICAgZmlyc3RQZWFrID0gc2Vjb25kUGVhazsKCSAgICAgICAgICAgIHNlY29uZFBlYWsgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHRoZXJlIGlzIHRvbyBsaXR0bGUgY29udHJhc3QgaW4gdGhlIGltYWdlIHRvIHBpY2sgYSBtZWFuaW5nZnVsIGJsYWNrIHBvaW50LCB0aHJvdyByYXRoZXIKCSAgICAgICAgLy8gdGhhbiB3YXN0ZSB0aW1lIHRyeWluZyB0byBkZWNvZGUgdGhlIGltYWdlLCBhbmQgcmlzayBmYWxzZSBwb3NpdGl2ZXMuCgkgICAgICAgIGlmIChzZWNvbmRQZWFrIC0gZmlyc3RQZWFrIDw9IG51bUJ1Y2tldHMgLyAxNikgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCBhIHZhbGxleSBiZXR3ZWVuIHRoZW0gdGhhdCBpcyBsb3cgYW5kIGNsb3NlciB0byB0aGUgd2hpdGUgcGVhay4KCSAgICAgICAgdmFyIGJlc3RWYWxsZXkgPSBzZWNvbmRQZWFrIC0gMTsKCSAgICAgICAgdmFyIGJlc3RWYWxsZXlTY29yZSA9IC0xOwoJICAgICAgICBmb3IgKHZhciB4ID0gc2Vjb25kUGVhayAtIDE7IHggPiBmaXJzdFBlYWs7IHgtLSkgewoJICAgICAgICAgICAgdmFyIGZyb21GaXJzdCA9IHggLSBmaXJzdFBlYWs7CgkgICAgICAgICAgICB2YXIgc2NvcmUgPSBmcm9tRmlyc3QgKiBmcm9tRmlyc3QgKiAoc2Vjb25kUGVhayAtIHgpICogKG1heEJ1Y2tldENvdW50IC0gYnVja2V0c1t4XSk7CgkgICAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0VmFsbGV5U2NvcmUpIHsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5ID0geDsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5U2NvcmUgPSBzY29yZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gYmVzdFZhbGxleSA8PCBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUOwoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CSVRTID0gNTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUID0gOCAtIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX0JVQ0tFVFMgPSAxIDw8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuRU1QVFkgPSBVaW50OENsYW1wZWRBcnJheS5mcm9tKFswXSk7CgkgICAgcmV0dXJuIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCX0oQmluYXJpemVyXzEuZGVmYXVsdCkpOwoJR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyJDEuZGVmYXVsdCA9IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyRiID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEh5YnJpZEJpbmFyaXplciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyXzEgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMTsKCXZhciBCaXRNYXRyaXhfMSQ0ID0gQml0TWF0cml4JDE7CgkvKioKCSAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGxvY2FsIHRocmVzaG9sZGluZyBhbGdvcml0aG0sIHdoaWNoIHdoaWxlIHNsb3dlciB0aGFuIHRoZQoJICogR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBpcyBmYWlybHkgZWZmaWNpZW50IGZvciB3aGF0IGl0IGRvZXMuIEl0IGlzIGRlc2lnbmVkIGZvcgoJICogaGlnaCBmcmVxdWVuY3kgaW1hZ2VzIG9mIGJhcmNvZGVzIHdpdGggYmxhY2sgZGF0YSBvbiB3aGl0ZSBiYWNrZ3JvdW5kcy4gRm9yIHRoaXMgYXBwbGljYXRpb24sCgkgKiBpdCBkb2VzIGEgbXVjaCBiZXR0ZXIgam9iIHRoYW4gYSBnbG9iYWwgYmxhY2twb2ludCB3aXRoIHNldmVyZSBzaGFkb3dzIGFuZCBncmFkaWVudHMuCgkgKiBIb3dldmVyIGl0IHRlbmRzIHRvIHByb2R1Y2UgYXJ0aWZhY3RzIG9uIGxvd2VyIGZyZXF1ZW5jeSBpbWFnZXMgYW5kIGlzIHRoZXJlZm9yZSBub3QKCSAqIGEgZ29vZCBnZW5lcmFsIHB1cnBvc2UgYmluYXJpemVyIGZvciB1c2VzIG91dHNpZGUgWlhpbmcuCgkgKgoJICogVGhpcyBjbGFzcyBleHRlbmRzIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplciwgdXNpbmcgdGhlIG9sZGVyIGhpc3RvZ3JhbSBhcHByb2FjaCBmb3IgMUQgcmVhZGVycywKCSAqIGFuZCB0aGUgbmV3ZXIgbG9jYWwgYXBwcm9hY2ggZm9yIDJEIHJlYWRlcnMuIDFEIGRlY29kaW5nIHVzaW5nIGEgcGVyLXJvdyBoaXN0b2dyYW0gaXMgYWxyZWFkeQoJICogaW5oZXJlbnRseSBsb2NhbCwgYW5kIG9ubHkgZmFpbHMgZm9yIGhvcml6b250YWwgZ3JhZGllbnRzLiBXZSBjYW4gcmV2aXNpdCB0aGF0IHByb2JsZW0gbGF0ZXIsCgkgKiBidXQgZm9yIG5vdyBpdCB3YXMgbm90IGEgd2luIHRvIHVzZSBsb2NhbCBibG9ja3MgZm9yIDFELgoJICoKCSAqIFRoaXMgQmluYXJpemVyIGlzIHRoZSBkZWZhdWx0IGZvciB0aGUgdW5pdCB0ZXN0cyBhbmQgdGhlIHJlY29tbWVuZGVkIGNsYXNzIGZvciBsaWJyYXJ5IHVzZXJzLgoJICoKCSAqIEBhdXRob3IgZHN3aXRraW5AZ29vZ2xlLmNvbSAoRGFuaWVsIFN3aXRraW4pCgkgKi8KCXZhciBIeWJyaWRCaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGIoSHlicmlkQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEh5YnJpZEJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tYXRyaXggPSBudWxsOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIENhbGN1bGF0ZXMgdGhlIGZpbmFsIEJpdE1hdHJpeCBvbmNlIGZvciBhbGwgcmVxdWVzdHMuIFRoaXMgY291bGQgYmUgY2FsbGVkIG9uY2UgZnJvbSB0aGUKCSAgICAgKiBjb25zdHJ1Y3RvciBpbnN0ZWFkLCBidXQgdGhlcmUgYXJlIHNvbWUgYWR2YW50YWdlcyB0byBkb2luZyBpdCBsYXppbHksIHN1Y2ggYXMgbWFraW5nCgkgICAgICogcHJvZmlsaW5nIGVhc2llciwgYW5kIG5vdCBkb2luZyBoZWF2eSBsaWZ0aW5nIHdoZW4gY2FsbGVycyBkb24ndCBleHBlY3QgaXQuCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLm1hdHJpeCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKHdpZHRoID49IEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiAmJiBoZWlnaHQgPj0gSHlicmlkQmluYXJpemVyLk1JTklNVU1fRElNRU5TSU9OKSB7CgkgICAgICAgICAgICB2YXIgbHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRNYXRyaXgoKTsKCSAgICAgICAgICAgIHZhciBzdWJXaWR0aCA9IHdpZHRoID4+IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKCh3aWR0aCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViV2lkdGgrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciBzdWJIZWlnaHQgPSBoZWlnaHQgPj4gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICBpZiAoKGhlaWdodCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViSGVpZ2h0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgYmxhY2tQb2ludHMgPSBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMobHVtaW5hbmNlcywgc3ViV2lkdGgsIHN1YkhlaWdodCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgICAgICB2YXIgbmV3TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDQuZGVmYXVsdCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgICAgIEh5YnJpZEJpbmFyaXplci5jYWxjdWxhdGVUaHJlc2hvbGRGb3JCbG9jayhsdW1pbmFuY2VzLCBzdWJXaWR0aCwgc3ViSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBibGFja1BvaW50cywgbmV3TWF0cml4KTsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3TWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgLy8gSWYgdGhlIGltYWdlIGlzIHRvbyBzbWFsbCwgZmFsbCBiYWNrIHRvIHRoZSBnbG9iYWwgaGlzdG9ncmFtIGFwcHJvYWNoLgoJICAgICAgICAgICAgdGhpcy5tYXRyaXggPSBfc3VwZXIucHJvdG90eXBlLmdldEJsYWNrTWF0cml4LmNhbGwodGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuY3JlYXRlQmluYXJpemVyID0gZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgICByZXR1cm4gbmV3IEh5YnJpZEJpbmFyaXplcihzb3VyY2UpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRm9yIGVhY2ggYmxvY2sgaW4gdGhlIGltYWdlLCBjYWxjdWxhdGUgdGhlIGF2ZXJhZ2UgYmxhY2sgcG9pbnQgdXNpbmcgYSA1eDUgZ3JpZAoJICAgICAqIG9mIHRoZSBibG9ja3MgYXJvdW5kIGl0LiBBbHNvIGhhbmRsZXMgdGhlIGNvcm5lciBjYXNlcyAoZnJhY3Rpb25hbCBibG9ja3MgYXJlIGNvbXB1dGVkIGJhc2VkCgkgICAgICogb24gdGhlIGxhc3QgcGl4ZWxzIGluIHRoZSByb3cvY29sdW1uIHdoaWNoIGFyZSBhbHNvIHVzZWQgaW4gdGhlIHByZXZpb3VzIGJsb2NrKS4KCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlVGhyZXNob2xkRm9yQmxvY2sgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBibGFja1BvaW50cywgbWF0cml4KSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBzdWJIZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgdG9wXzEgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHksIDIsIHN1YkhlaWdodCAtIDMpOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdWJXaWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHhvZmZzZXQgPSB4IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgICAgIGlmICh4b2Zmc2V0ID4gbWF4WE9mZnNldCkgewoJICAgICAgICAgICAgICAgICAgICB4b2Zmc2V0ID0gbWF4WE9mZnNldDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHgsIDIsIHN1YldpZHRoIC0gMyk7CgkgICAgICAgICAgICAgICAgdmFyIHN1bSA9IDA7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeiA9IC0yOyB6IDw9IDI7IHorKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgYmxhY2tSb3cgPSBibGFja1BvaW50c1t0b3BfMSArIHpdOwoJICAgICAgICAgICAgICAgICAgICBzdW0gKz0gYmxhY2tSb3dbbGVmdCAtIDJdICsgYmxhY2tSb3dbbGVmdCAtIDFdICsgYmxhY2tSb3dbbGVmdF0gKyBibGFja1Jvd1tsZWZ0ICsgMV0gKyBibGFja1Jvd1tsZWZ0ICsgMl07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlID0gc3VtIC8gMjU7CgkgICAgICAgICAgICAgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrKGx1bWluYW5jZXMsIHhvZmZzZXQsIHlvZmZzZXQsIGF2ZXJhZ2UsIHdpZHRoLCBtYXRyaXgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FwID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG1pbiAvKmludCovLCBtYXggLyppbnQqLykgewoJICAgICAgICByZXR1cm4gdmFsdWUgPCBtaW4gPyBtaW4gOiB2YWx1ZSA+IG1heCA/IG1heCA6IHZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbGllcyBhIHNpbmdsZSB0aHJlc2hvbGQgdG8gYSBibG9jayBvZiBwaXhlbHMuCgkgICAgICovCgkgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrID0gZnVuY3Rpb24gKGx1bWluYW5jZXMsIHhvZmZzZXQgLyppbnQqLywgeW9mZnNldCAvKmludCovLCB0aHJlc2hvbGQgLyppbnQqLywgc3RyaWRlIC8qaW50Ki8sIG1hdHJpeCkgewoJICAgICAgICBmb3IgKHZhciB5ID0gMCwgb2Zmc2V0ID0geW9mZnNldCAqIHN0cmlkZSArIHhvZmZzZXQ7IHkgPCBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsgeSsrLCBvZmZzZXQgKz0gc3RyaWRlKSB7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB4KyspIHsKCSAgICAgICAgICAgICAgICAvLyBDb21wYXJpc29uIG5lZWRzIHRvIGJlIDw9IHNvIHRoYXQgYmxhY2sgPT0gMCBwaXhlbHMgYXJlIGJsYWNrIGV2ZW4gaWYgdGhlIHRocmVzaG9sZCBpcyAwLgoJICAgICAgICAgICAgICAgIGlmICgobHVtaW5hbmNlc1tvZmZzZXQgKyB4XSAmIDB4RkYpIDw9IHRocmVzaG9sZCkgewoJICAgICAgICAgICAgICAgICAgICBtYXRyaXguc2V0KHhvZmZzZXQgKyB4LCB5b2Zmc2V0ICsgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDYWxjdWxhdGVzIGEgc2luZ2xlIGJsYWNrIHBvaW50IGZvciBlYWNoIGJsb2NrIG9mIHBpeGVscyBhbmQgc2F2ZXMgaXQgYXdheS4KCSAgICAgKiBTZWUgdGhlIGZvbGxvd2luZyB0aHJlYWQgZm9yIGEgZGlzY3Vzc2lvbiBvZiB0aGlzIGFsZ29yaXRobToKCSAgICAgKiAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL3p4aW5nL2Jyb3dzZV90aHJlYWQvdGhyZWFkL2QwNmVmYTJjMzVhN2RkYzAKCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOndoaXRlc3BhY2UKCSAgICAgICAgdmFyIGJsYWNrUG9pbnRzID0gbmV3IEFycmF5KHN1YkhlaWdodCk7IC8vIHN1YldpZHRoCgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgc3ViSGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGJsYWNrUG9pbnRzW3ldID0gbmV3IEludDMyQXJyYXkoc3ViV2lkdGgpOwoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHN1YldpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgeG9mZnNldCA9IHggPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICAgICAgaWYgKHhvZmZzZXQgPiBtYXhYT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgICAgIHhvZmZzZXQgPSBtYXhYT2Zmc2V0OwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDsKCSAgICAgICAgICAgICAgICB2YXIgbWluID0gMHhGRjsKCSAgICAgICAgICAgICAgICB2YXIgbWF4ID0gMDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciB5eSA9IDAsIG9mZnNldCA9IHlvZmZzZXQgKiB3aWR0aCArIHhvZmZzZXQ7IHl5IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHl5KyssIG9mZnNldCArPSB3aWR0aCkgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaXhlbCA9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN1bSArPSBwaXhlbDsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIGxvb2tpbmcgZm9yIGdvb2QgY29udHJhc3QKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaXhlbCA8IG1pbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IHBpeGVsOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsID4gbWF4KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gcGl4ZWw7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gc2hvcnQtY2lyY3VpdCBtaW4vbWF4IHRlc3RzIG9uY2UgZHluYW1pYyByYW5nZSBpcyBtZXQKCSAgICAgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA+IEh5YnJpZEJpbmFyaXplci5NSU5fRFlOQU1JQ19SQU5HRSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmluaXNoIHRoZSByZXN0IG9mIHRoZSByb3dzIHF1aWNrbHkKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeXkrKywgb2Zmc2V0ICs9IHdpZHRoOyB5eSA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB5eSsrLCBvZmZzZXQgKz0gd2lkdGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgZXN0aW1hdGUgaXMgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHZhbHVlcyBpbiB0aGUgYmxvY2suCgkgICAgICAgICAgICAgICAgdmFyIGF2ZXJhZ2UgPSBzdW0gPj4gKEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSICogMik7CgkgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA8PSBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFyaWF0aW9uIHdpdGhpbiB0aGUgYmxvY2sgaXMgbG93LCBhc3N1bWUgdGhpcyBpcyBhIGJsb2NrIHdpdGggb25seSBsaWdodCBvciBvbmx5CgkgICAgICAgICAgICAgICAgICAgIC8vIGRhcmsgcGl4ZWxzLiBJbiB0aGF0IGNhc2Ugd2UgZG8gbm90IHdhbnQgdG8gdXNlIHRoZSBhdmVyYWdlLCBhcyBpdCB3b3VsZCBkaXZpZGUgdGhpcwoJICAgICAgICAgICAgICAgICAgICAvLyBsb3cgY29udHJhc3QgYXJlYSBpbnRvIGJsYWNrIGFuZCB3aGl0ZSBwaXhlbHMsIGVzc2VudGlhbGx5IGNyZWF0aW5nIGRhdGEgb3V0IG9mIG5vaXNlLgoJICAgICAgICAgICAgICAgICAgICAvLwoJICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCBhc3N1bXB0aW9uIGlzIHRoYXQgdGhlIGJsb2NrIGlzIGxpZ2h0L2JhY2tncm91bmQuIFNpbmNlIG5vIGVzdGltYXRlIGZvcgoJICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGV2ZWwgb2YgZGFyayBwaXhlbHMgZXhpc3RzIGxvY2FsbHksIHVzZSBoYWxmIHRoZSBtaW4gZm9yIHRoZSBibG9jay4KCSAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IG1pbiAvIDI7CgkgICAgICAgICAgICAgICAgICAgIGlmICh5ID4gMCAmJiB4ID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29ycmVjdCB0aGUgIndoaXRlIGJhY2tncm91bmQiIGFzc3VtcHRpb24gZm9yIGJsb2NrcyB0aGF0IGhhdmUgbmVpZ2hib3JzIGJ5IGNvbXBhcmluZwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHBpeGVscyBpbiB0aGlzIGJsb2NrIHRvIHRoZSBwcmV2aW91c2x5IGNhbGN1bGF0ZWQgYmxhY2sgcG9pbnRzLiBUaGlzIGlzIGJhc2VkIG9uCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmFjdCB0aGF0IGRhcmsgYmFyY29kZSBzeW1ib2xvZ3kgaXMgYWx3YXlzIHN1cnJvdW5kZWQgYnkgc29tZSBhbW91bnQgb2YgbGlnaHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2tncm91bmQgZm9yIHdoaWNoIHJlYXNvbmFibGUgYmxhY2sgcG9pbnQgZXN0aW1hdGVzIHdlcmUgbWFkZS4gVGhlIGJwIGVzdGltYXRlZCBhdAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJvdW5kYXJpZXMgaXMgdXNlZCBmb3IgdGhlIGludGVyaW9yLgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIChtaW4gPCBicCkgaXMgYXJiaXRyYXJ5IGJ1dCB3b3JrcyBiZXR0ZXIgdGhhbiBvdGhlciBoZXVyaXN0aWNzIHRoYXQgd2VyZSB0cmllZC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50ID0gKGJsYWNrUG9pbnRzW3kgLSAxXVt4XSArICgyICogYmxhY2tQb2ludHNbeV1beCAtIDFdKSArIGJsYWNrUG9pbnRzW3kgLSAxXVt4IC0gMV0pIC8gNDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPCBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IGF2ZXJhZ2VOZWlnaGJvckJsYWNrUG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYmxhY2tQb2ludHNbeV1beF0gPSBhdmVyYWdlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBibGFja1BvaW50czsKCSAgICB9OwoJICAgIC8vIFRoaXMgY2xhc3MgdXNlcyA1eDUgYmxvY2tzIHRvIGNvbXB1dGUgbG9jYWwgbHVtaW5hbmNlLCB3aGVyZSBlYWNoIGJsb2NrIGlzIDh4OCBwaXhlbHMuCgkgICAgLy8gU28gdGhpcyBpcyB0aGUgc21hbGxlc3QgZGltZW5zaW9uIGluIGVhY2ggYXhpcyB3ZSBjYW4gYWNjZXB0LgoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSID0gMzsKCSAgICBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSA9IDEgPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7IC8vIC4uLjAxMDAuLi4wMAoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0sgPSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSAtIDE7IC8vIC4uLjAwMTEuLi4xMQoJICAgIEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiA9IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFICogNTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UgPSAyNDsKCSAgICByZXR1cm4gSHlicmlkQmluYXJpemVyOwoJfShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXJfMS5kZWZhdWx0KSk7Cgl2YXIgX2RlZmF1bHQkMiA9IEh5YnJpZEJpbmFyaXplciQxLmRlZmF1bHQgPSBIeWJyaWRCaW5hcml6ZXI7CgoJdmFyIFJHQkx1bWluYW5jZVNvdXJjZSQxID0ge307CgoJdmFyIEludmVydGVkTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgl2YXIgTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMSA9IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJDE7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nIHsqLwoJLyoqCgkgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGhpZXJhcmNoeSBpcyB0byBhYnN0cmFjdCBkaWZmZXJlbnQgYml0bWFwIGltcGxlbWVudGF0aW9ucyBhY3Jvc3MKCSAqIHBsYXRmb3JtcyBpbnRvIGEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciByZXF1ZXN0aW5nIGdyZXlzY2FsZSBsdW1pbmFuY2UgdmFsdWVzLiBUaGUgaW50ZXJmYWNlCgkgKiBvbmx5IHByb3ZpZGVzIGltbXV0YWJsZSBtZXRob2RzOyB0aGVyZWZvcmUgY3JvcCBhbmQgcm90YXRpb24gY3JlYXRlIGNvcGllcy4gVGhpcyBpcyB0byBlbnN1cmUKCSAqIHRoYXQgb25lIFJlYWRlciBkb2VzIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsIGx1bWluYW5jZSBzb3VyY2UgYW5kIGxlYXZlIGl0IGluIGFuIHVua25vd24gc3RhdGUKCSAqIGZvciBvdGhlciBSZWFkZXJzIGluIHRoZSBjaGFpbi4KCSAqCgkgKiBAYXV0aG9yIGRzd2l0a2luQGdvb2dsZS5jb20gKERhbmllbCBTd2l0a2luKQoJICovCgl2YXIgTHVtaW5hbmNlU291cmNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEx1bWluYW5jZVNvdXJjZSh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgYml0bWFwLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLndpZHRoOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBUaGUgaGVpZ2h0IG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmhlaWdodDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNyb3BwaW5nLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIGNyb3BwZWQgaW1hZ2UgZGF0YS4gSW1wbGVtZW50YXRpb25zIG1heSBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZQoJICAgICAqIG9yaWdpbmFsIGRhdGEgcmF0aGVyIHRoYW4gYSBjb3B5LiBPbmx5IGNhbGxhYmxlIGlmIGlzQ3JvcFN1cHBvcnRlZCgpIGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gbGVmdCBUaGUgbGVmdCBjb29yZGluYXRlLCB3aGljaCBtdXN0IGJlIGluIFswLGdldFdpZHRoKCkpCgkgICAgICogQHBhcmFtIHRvcCBUaGUgdG9wIGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0SGVpZ2h0KCkpCgkgICAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlIHRvIGNyb3AuCgkgICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcmV0dXJuIEEgY3JvcHBlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCBjcm9wcGluZy4nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCByb3RhdGlvbiBieSA5MCBkZWdyZWVzLicpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBhIG5ldyBvYmplY3Qgd2l0aCByb3RhdGVkIGltYWdlIGRhdGEgYnkgNDUgZGVncmVlcyBjb3VudGVyY2xvY2t3aXNlLgoJICAgICAqIE9ubHkgY2FsbGFibGUgaWYge0BsaW5rICNpc1JvdGF0ZVN1cHBvcnRlZCgpfSBpcyB0cnVlLgoJICAgICAqCgkgICAgICogQHJldHVybiBBIHJvdGF0ZWQgdmVyc2lvbiBvZiB0aGlzIG9iamVjdC4KCSAgICAgKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnJvdGF0ZUNvdW50ZXJDbG9ja3dpc2U0NSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnVGhpcyBsdW1pbmFuY2Ugc291cmNlIGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24gYnkgNDUgZGVncmVlcy4nKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcm93ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRoaXMud2lkdGgpOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQxLmRlZmF1bHQoKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgc291cmNlUm93ID0gdGhpcy5nZXRSb3coeSwgcm93KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGx1bWluYW5jZSA9IHNvdXJjZVJvd1t4XSAmIDB4RkY7CgkgICAgICAgICAgICAgICAgdmFyIGMgPSB2b2lkIDA7CgkgICAgICAgICAgICAgICAgaWYgKGx1bWluYW5jZSA8IDB4NDApIHsKCSAgICAgICAgICAgICAgICAgICAgYyA9ICcjJzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAobHVtaW5hbmNlIDwgMHg4MCkgewoJICAgICAgICAgICAgICAgICAgICBjID0gJysnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmIChsdW1pbmFuY2UgPCAweEMwKSB7CgkgICAgICAgICAgICAgICAgICAgIGMgPSAnLic7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICBjID0gJyAnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGMpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCgnXG4nKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7CgkgICAgfTsKCSAgICByZXR1cm4gTHVtaW5hbmNlU291cmNlOwoJfSgpKTsKCUx1bWluYW5jZVNvdXJjZSQxLmRlZmF1bHQgPSBMdW1pbmFuY2VTb3VyY2U7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnZlcnRlZEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEkMSA9IEx1bWluYW5jZVNvdXJjZSQxOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHdoaWNoIGludmVydHMgdGhlIGx1bWluYW5jZXMgaXQgcmV0dXJucyAtLSBibGFjayBiZWNvbWVzCgkgKiB3aGl0ZSBhbmQgdmljZSB2ZXJzYSwgYW5kIGVhY2ggdmFsdWUgYmVjb21lcyAoMjU1LXZhbHVlKS4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGEoSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UoZGVsZWdhdGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZGVsZWdhdGUuZ2V0V2lkdGgoKSwgZGVsZWdhdGUuZ2V0SGVpZ2h0KCkpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgdmFyIHNvdXJjZVJvdyA9IHRoaXMuZGVsZWdhdGUuZ2V0Um93KHksIHJvdyk7CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7CgkgICAgICAgICAgICBzb3VyY2VSb3dbaV0gPSAvKihieXRlKSovICgyNTUgLSAoc291cmNlUm93W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBzb3VyY2VSb3c7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmdldE1hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIG1hdHJpeCA9IHRoaXMuZGVsZWdhdGUuZ2V0TWF0cml4KCk7CgkgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmdldFdpZHRoKCkgKiB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgaW52ZXJ0ZWRNYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobGVuZ3RoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgaW52ZXJ0ZWRNYXRyaXhbaV0gPSAvKihieXRlKSovICgyNTUgLSAobWF0cml4W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBpbnZlcnRlZE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUuY3JvcChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlLmlzUm90YXRlU3VwcG9ydGVkKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG9yaWdpbmFsIGRlbGVnYXRlIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHNpbmNlIGludmVydCB1bmRvZXMgaXRzZWxmCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCkpOwoJICAgIH07CgkgICAgcmV0dXJuIEludmVydGVkTHVtaW5hbmNlU291cmNlOwoJfShMdW1pbmFuY2VTb3VyY2VfMSQxLmRlZmF1bHQpKTsKCUludmVydGVkTHVtaW5hbmNlU291cmNlJDEuZGVmYXVsdCA9IEludmVydGVkTHVtaW5hbmNlU291cmNlOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUkdCTHVtaW5hbmNlU291cmNlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkgLy8gcmVxdWlyZWQgYmVjYXVzZSBvZiBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYmV0d2VlbiBMdW1pbmFuY2VTb3VyY2UgYW5kIEludmVydGVkTHVtaW5hbmNlU291cmNlCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMSA9IEludmVydGVkTHVtaW5hbmNlU291cmNlJDE7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEgPSBMdW1pbmFuY2VTb3VyY2UkMTsKCXZhciBTeXN0ZW1fMSQyID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNiA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gaGVscCBkZWNvZGUgaW1hZ2VzIGZyb20gZmlsZXMgd2hpY2ggYXJyaXZlIGFzIFJHQiBkYXRhIGZyb20KCSAqIGFuIEFSR0IgcGl4ZWwgYXJyYXkuIEl0IGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24uCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgQmV0YW1pbm9zCgkgKi8KCXZhciBSR0JMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDkoUkdCTHVtaW5hbmNlU291cmNlLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIFJHQkx1bWluYW5jZVNvdXJjZShsdW1pbmFuY2VzLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgZGF0YVdpZHRoIC8qaW50Ki8sIGRhdGFIZWlnaHQgLyppbnQqLywgbGVmdCAvKmludCovLCB0b3AgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5kYXRhV2lkdGggPSBkYXRhV2lkdGg7CgkgICAgICAgIF90aGlzLmRhdGFIZWlnaHQgPSBkYXRhSGVpZ2h0OwoJICAgICAgICBfdGhpcy5sZWZ0ID0gbGVmdDsKCSAgICAgICAgX3RoaXMudG9wID0gdG9wOwoJICAgICAgICBpZiAobHVtaW5hbmNlcy5CWVRFU19QRVJfRUxFTUVOVCA9PT0gNCkgeyAvLyBJbnQzMkFycmF5CgkgICAgICAgICAgICB2YXIgc2l6ZSA9IHdpZHRoICogaGVpZ2h0OwoJICAgICAgICAgICAgdmFyIGx1bWluYW5jZXNVaW50OEFycmF5ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUpOwoJICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgc2l6ZTsgb2Zmc2V0KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgcGl4ZWwgPSBsdW1pbmFuY2VzW29mZnNldF07CgkgICAgICAgICAgICAgICAgdmFyIHIgPSAocGl4ZWwgPj4gMTYpICYgMHhmZjsgLy8gcmVkCgkgICAgICAgICAgICAgICAgdmFyIGcyID0gKHBpeGVsID4+IDcpICYgMHgxZmU7IC8vIDIgKiBncmVlbgoJICAgICAgICAgICAgICAgIHZhciBiID0gcGl4ZWwgJiAweGZmOyAvLyBibHVlCgkgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGdyZWVuLWZhdm91cmluZyBhdmVyYWdlIGNoZWFwbHkKCSAgICAgICAgICAgICAgICBsdW1pbmFuY2VzVWludDhBcnJheVtvZmZzZXRdID0gLyooYnl0ZSkgKi8gKChyICsgZzIgKyBiKSAvIDQpICYgMHhGRjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzVWludDhBcnJheTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGRhdGFXaWR0aCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YVdpZHRoID0gd2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gZGF0YUhlaWdodCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YUhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBsZWZ0KSB7CgkgICAgICAgICAgICBfdGhpcy5sZWZ0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSB0b3ApIHsKCSAgICAgICAgICAgIF90aGlzLnRvcCA9IDA7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKF90aGlzLmxlZnQgKyB3aWR0aCA+IF90aGlzLmRhdGFXaWR0aCB8fCBfdGhpcy50b3AgKyBoZWlnaHQgPiBfdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNi5kZWZhdWx0KCdDcm9wIHJlY3RhbmdsZSBkb2VzIG5vdCBmaXQgd2l0aGluIGltYWdlIGRhdGEuJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gdGhpcy5nZXRIZWlnaHQoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCgnUmVxdWVzdGVkIHJvdyBpcyBvdXRzaWRlIHRoZSBpbWFnZTogJyArIHkpOwoJICAgICAgICB9CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gbnVsbCB8fCByb3cgPT09IHVuZGVmaW5lZCB8fCByb3cubGVuZ3RoIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG9mZnNldCA9ICh5ICsgdGhpcy50b3ApICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIFN5c3RlbV8xJDIuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5sdW1pbmFuY2VzLCBvZmZzZXQsIHJvdywgMCwgd2lkdGgpOwoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJHQkx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0TWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBJZiB0aGUgY2FsbGVyIGFza3MgZm9yIHRoZSBlbnRpcmUgdW5kZXJseWluZyBpbWFnZSwgc2F2ZSB0aGUgY29weSBhbmQgZ2l2ZSB0aGVtIHRoZQoJICAgICAgICAvLyBvcmlnaW5hbCBkYXRhLiBUaGUgZG9jcyBzcGVjaWZpY2FsbHkgd2FybiB0aGF0IHJlc3VsdC5sZW5ndGggbXVzdCBiZSBpZ25vcmVkLgoJICAgICAgICBpZiAod2lkdGggPT09IHRoaXMuZGF0YVdpZHRoICYmIGhlaWdodCA9PT0gdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5sdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhcmVhID0gd2lkdGggKiBoZWlnaHQ7CgkgICAgICAgIHZhciBtYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoYXJlYSk7CgkgICAgICAgIHZhciBpbnB1dE9mZnNldCA9IHRoaXMudG9wICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIC8vIElmIHRoZSB3aWR0aCBtYXRjaGVzIHRoZSBmdWxsIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIGRhdGEsIHBlcmZvcm0gYSBzaW5nbGUgY29weS4KCSAgICAgICAgaWYgKHdpZHRoID09PSB0aGlzLmRhdGFXaWR0aCkgewoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIDAsIGFyZWEpOwoJICAgICAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICAgICAgfQoJICAgICAgICAvLyBPdGhlcndpc2UgY29weSBvbmUgY3JvcHBlZCByb3cgYXQgYSB0aW1lLgoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb3V0cHV0T2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIG91dHB1dE9mZnNldCwgd2lkdGgpOwoJICAgICAgICAgICAgaW5wdXRPZmZzZXQgKz0gdGhpcy5kYXRhV2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSR0JMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmlzQ3JvcFN1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgUkdCTHVtaW5hbmNlU291cmNlKHRoaXMubHVtaW5hbmNlcywgd2lkdGgsIGhlaWdodCwgdGhpcy5kYXRhV2lkdGgsIHRoaXMuZGF0YUhlaWdodCwgdGhpcy5sZWZ0ICsgbGVmdCwgdGhpcy50b3AgKyB0b3ApOwoJICAgIH07CgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMS5kZWZhdWx0KHRoaXMpOwoJICAgIH07CgkgICAgcmV0dXJuIFJHQkx1bWluYW5jZVNvdXJjZTsKCX0oTHVtaW5hbmNlU291cmNlXzEuZGVmYXVsdCkpOwoJdmFyIF9kZWZhdWx0JDEgPSBSR0JMdW1pbmFuY2VTb3VyY2UkMS5kZWZhdWx0ID0gUkdCTHVtaW5hbmNlU291cmNlOwoKCXZhciBRUkNvZGVSZWFkZXIkMSA9IHt9OwoKCXZhciBCYXJjb2RlRm9ybWF0JDEgPSB7fTsKCgkvKgoJICogRGlyZWN0IHBvcnQgdG8gVHlwZVNjcmlwdCBvZiBaWGluZyBieSBBZHJpYW4gVG/ImWPEgwoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFyY29kZUZvcm1hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogRW51bWVyYXRlcyBiYXJjb2RlIGZvcm1hdHMga25vd24gdG8gdGhpcyBwYWNrYWdlLiBQbGVhc2Uga2VlcCBhbHBoYWJldGl6ZWQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJhcmNvZGVGb3JtYXQ7CgkoZnVuY3Rpb24gKEJhcmNvZGVGb3JtYXQpIHsKCSAgICAvKiogQXp0ZWMgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJBWlRFQyJdID0gMF0gPSAiQVpURUMiOwoJICAgIC8qKiBDT0RBQkFSIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREFCQVIiXSA9IDFdID0gIkNPREFCQVIiOwoJICAgIC8qKiBDb2RlIDM5IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfMzkiXSA9IDJdID0gIkNPREVfMzkiOwoJICAgIC8qKiBDb2RlIDkzIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfOTMiXSA9IDNdID0gIkNPREVfOTMiOwoJICAgIC8qKiBDb2RlIDEyOCAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJDT0RFXzEyOCJdID0gNF0gPSAiQ09ERV8xMjgiOwoJICAgIC8qKiBEYXRhIE1hdHJpeCAyRCBiYXJjb2RlIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkRBVEFfTUFUUklYIl0gPSA1XSA9ICJEQVRBX01BVFJJWCI7CgkgICAgLyoqIEVBTi04IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkVBTl84Il0gPSA2XSA9ICJFQU5fOCI7CgkgICAgLyoqIEVBTi0xMyAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJFQU5fMTMiXSA9IDddID0gIkVBTl8xMyI7CgkgICAgLyoqIElURiAoSW50ZXJsZWF2ZWQgVHdvIG9mIEZpdmUpIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIklURiJdID0gOF0gPSAiSVRGIjsKCSAgICAvKiogTWF4aUNvZGUgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJNQVhJQ09ERSJdID0gOV0gPSAiTUFYSUNPREUiOwoJICAgIC8qKiBQREY0MTcgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUERGXzQxNyJdID0gMTBdID0gIlBERl80MTciOwoJICAgIC8qKiBRUiBDb2RlIDJEIGJhcmNvZGUgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUVJfQ09ERSJdID0gMTFdID0gIlFSX0NPREUiOwoJICAgIC8qKiBSU1MgMTQgKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlJTU18xNCJdID0gMTJdID0gIlJTU18xNCI7CgkgICAgLyoqIFJTUyBFWFBBTkRFRCAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUlNTX0VYUEFOREVEIl0gPSAxM10gPSAiUlNTX0VYUEFOREVEIjsKCSAgICAvKiogVVBDLUEgMUQgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiVVBDX0EiXSA9IDE0XSA9ICJVUENfQSI7CgkgICAgLyoqIFVQQy1FIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FIl0gPSAxNV0gPSAiVVBDX0UiOwoJICAgIC8qKiBVUEMvRUFOIGV4dGVuc2lvbiBmb3JtYXQuIE5vdCBhIHN0YW5kLWFsb25lIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSAxNl0gPSAiVVBDX0VBTl9FWFRFTlNJT04iOwoJfSkoQmFyY29kZUZvcm1hdCB8fCAoQmFyY29kZUZvcm1hdCA9IHt9KSk7CglCYXJjb2RlRm9ybWF0JDEuZGVmYXVsdCA9IEJhcmNvZGVGb3JtYXQ7CgoJdmFyIFJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIFN5c3RlbV8xJDEgPSBTeXN0ZW0kMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBiYXJjb2RlIHdpdGhpbiBhbiBpbWFnZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSB0ZXh0OiBzdHJpbmcsCgkgICAgLy8gICAgICAgICAgICAgICBVaW50OEFycmF5IHJhd0J5dGVzLAoJICAgIC8vICAgICAgICAgICAgICAgUmVzdWx0UG9jb25zdCByZXN1bHRQb2ludHM6IEludDMyQXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICBCYXJjb2RlRm9ybWF0IGZvcm1hdCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmVzdWx0UG9pbnRzLCBmb3JtYXQsIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IodGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgVWludDhBcnJheSByYXdCeXRlcywKCSAgICAvLyAgICAgICAgICAgICAgIFJlc3VsdFBvY29uc3QgcmVzdWx0UG9pbnRzOiBJbnQzMkFycmF5LAoJICAgIC8vICAgICAgICAgICAgICAgQmFyY29kZUZvcm1hdCBmb3JtYXQsCgkgICAgLy8gICAgICAgICAgICAgICBsb25nIHRpbWVzdGFtcCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoLAoJICAgIC8vICAgICAgICByZXN1bHRQb2ludHMsIGZvcm1hdCwgdGltZXN0YW1wKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBSZXN1bHQodGV4dCwgcmF3Qnl0ZXMsIG51bUJpdHMsIHJlc3VsdFBvaW50cywgZm9ybWF0LCB0aW1lc3RhbXApIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPT09IHZvaWQgMCkgeyBudW1CaXRzID0gcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoOyB9CgkgICAgICAgIGlmICh0aW1lc3RhbXAgPT09IHZvaWQgMCkgeyB0aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsgfQoJICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwoJICAgICAgICB0aGlzLnJhd0J5dGVzID0gcmF3Qnl0ZXM7CgkgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gcmVzdWx0UG9pbnRzOwoJICAgICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKCSAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXA7CgkgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbnVtQml0cyB8fCBudWxsID09PSBudW1CaXRzKSB7CgkgICAgICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IG51bGwgfHwgcmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludHMgPSByZXN1bHRQb2ludHM7CgkgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwoJICAgICAgICB0aGlzLnJlc3VsdE1ldGFkYXRhID0gbnVsbDsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gdGltZXN0YW1wIHx8IG51bGwgPT09IHRpbWVzdGFtcCkgewoJICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IHRleHQgZW5jb2RlZCBieSB0aGUgYmFyY29kZQoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGV4dDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IGJ5dGVzIGVuY29kZWQgYnkgdGhlIGJhcmNvZGUsIGlmIGFwcGxpY2FibGUsIG90aGVyd2lzZSB7QGNvZGUgbnVsbH0KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0TnVtQml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMubnVtQml0czsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcG9pbnRzIHJlbGF0ZWQgdG8gdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGVzZSBhcmUgdHlwaWNhbGx5IHBvaW50cwoJICAgICAqICAgICAgICAgaWRlbnRpZnlpbmcgZmluZGVyIHBhdHRlcm5zIG9yIHRoZSBjb3JuZXJzIG9mIHRoZSBiYXJjb2RlLiBUaGUgZXhhY3QgbWVhbmluZyBpcwoJICAgICAqICAgICAgICAgc3BlY2lmaWMgdG8gdGhlIHR5cGUgb2YgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkLgoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0UmVzdWx0UG9pbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCYXJjb2RlRm9ybWF0fSByZXByZXNlbnRpbmcgdGhlIGZvcm1hdCBvZiB0aGUgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkCgkgICAgICovCgkgICAgUmVzdWx0LnByb3RvdHlwZS5nZXRCYXJjb2RlRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBNYXB9IG1hcHBpbmcge0BsaW5rIFJlc3VsdE1ldGFkYXRhVHlwZX0ga2V5cyB0byB2YWx1ZXMuIE1heSBiZQoJICAgICAqICAge0Bjb2RlIG51bGx9LiBUaGlzIGNvbnRhaW5zIG9wdGlvbmFsIG1ldGFkYXRhIGFib3V0IHdoYXQgd2FzIGRldGVjdGVkIGFib3V0IHRoZSBiYXJjb2RlLAoJICAgICAqICAgbGlrZSBvcmllbnRhdGlvbi4KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJlc3VsdE1ldGFkYXRhID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRNZXRhZGF0YTsKCSAgICB9OwoJICAgIFJlc3VsdC5wcm90b3R5cGUucHV0TWV0YWRhdGEgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUpIHsKCSAgICAgICAgaWYgKHRoaXMucmVzdWx0TWV0YWRhdGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0TWV0YWRhdGEgPSBuZXcgTWFwKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YS5zZXQodHlwZSwgdmFsdWUpOwoJICAgIH07CgkgICAgUmVzdWx0LnByb3RvdHlwZS5wdXRBbGxNZXRhZGF0YSA9IGZ1bmN0aW9uIChtZXRhZGF0YSkgewoJICAgICAgICBpZiAobWV0YWRhdGEgIT09IG51bGwpIHsKCSAgICAgICAgICAgIGlmICh0aGlzLnJlc3VsdE1ldGFkYXRhID09PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG1ldGFkYXRhOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG5ldyBNYXAobWV0YWRhdGEpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmFkZFJlc3VsdFBvaW50cyA9IGZ1bmN0aW9uIChuZXdQb2ludHMpIHsKCSAgICAgICAgdmFyIG9sZFBvaW50cyA9IHRoaXMucmVzdWx0UG9pbnRzOwoJICAgICAgICBpZiAob2xkUG9pbnRzID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aGlzLnJlc3VsdFBvaW50cyA9IG5ld1BvaW50czsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChuZXdQb2ludHMgIT09IG51bGwgJiYgbmV3UG9pbnRzLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgIHZhciBhbGxQb2ludHMgPSBuZXcgQXJyYXkob2xkUG9pbnRzLmxlbmd0aCArIG5ld1BvaW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgU3lzdGVtXzEkMS5kZWZhdWx0LmFycmF5Y29weShvbGRQb2ludHMsIDAsIGFsbFBvaW50cywgMCwgb2xkUG9pbnRzLmxlbmd0aCk7CgkgICAgICAgICAgICBTeXN0ZW1fMSQxLmRlZmF1bHQuYXJyYXljb3B5KG5ld1BvaW50cywgMCwgYWxsUG9pbnRzLCBvbGRQb2ludHMubGVuZ3RoLCBuZXdQb2ludHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gYWxsUG9pbnRzOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFRpbWVzdGFtcCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRleHQ7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0OwoJfSgpKTsKCVJlc3VsdCQxLmRlZmF1bHQgPSBSZXN1bHQ7CgoJdmFyIFJlc3VsdE1ldGFkYXRhVHlwZSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA4IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHRNZXRhZGF0YVR5cGUkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogUmVwcmVzZW50cyBzb21lIHR5cGUgb2YgbWV0YWRhdGEgYWJvdXQgdGhlIHJlc3VsdCBvZiB0aGUgZGVjb2RpbmcgdGhhdCB0aGUgZGVjb2RlcgoJICogd2lzaGVzIHRvIGNvbW11bmljYXRlIGJhY2sgdG8gdGhlIGNhbGxlci4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlOwoJKGZ1bmN0aW9uIChSZXN1bHRNZXRhZGF0YVR5cGUpIHsKCSAgICAvKioKCSAgICAgKiBVbnNwZWNpZmllZCwgYXBwbGljYXRpb24tc3BlY2lmaWMgbWV0YWRhdGEuIE1hcHMgdG8gYW4gdW5zcGVjaWZpZWQge0BsaW5rIE9iamVjdH0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiT1RIRVIiXSA9IDBdID0gIk9USEVSIjsKCSAgICAvKioKCSAgICAgKiBEZW5vdGVzIHRoZSBsaWtlbHkgYXBwcm94aW1hdGUgb3JpZW50YXRpb24gb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGlzIHZhbHVlCgkgICAgICogaXMgZ2l2ZW4gYXMgZGVncmVlcyByb3RhdGVkIGNsb2Nrd2lzZSBmcm9tIHRoZSBub3JtYWwsIHVwcmlnaHQgb3JpZW50YXRpb24uCgkgICAgICogRm9yIGV4YW1wbGUgYSAxRCBiYXJjb2RlIHdoaWNoIHdhcyBmb3VuZCBieSByZWFkaW5nIHRvcC10by1ib3R0b20gd291bGQgYmUKCSAgICAgKiBzYWlkIHRvIGhhdmUgb3JpZW50YXRpb24gIjkwIi4gVGhpcyBrZXkgbWFwcyB0byBhbiB7QGxpbmsgSW50ZWdlcn0gd2hvc2UKCSAgICAgKiB2YWx1ZSBpcyBpbiB0aGUgcmFuZ2UgWzAsMzYwKS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJPUklFTlRBVElPTiJdID0gMV0gPSAiT1JJRU5UQVRJT04iOwoJICAgIC8qKgoJICAgICAqIDxwPjJEIGJhcmNvZGUgZm9ybWF0cyB0eXBpY2FsbHkgZW5jb2RlIHRleHQsIGJ1dCBhbGxvdyBmb3IgYSBzb3J0IG9mICdieXRlIG1vZGUnCgkgICAgICogd2hpY2ggaXMgc29tZXRpbWVzIHVzZWQgdG8gZW5jb2RlIGJpbmFyeSBkYXRhLiBXaGlsZSB7QGxpbmsgUmVzdWx0fSBtYWtlcyBhdmFpbGFibGUKCSAgICAgKiB0aGUgY29tcGxldGUgcmF3IGJ5dGVzIGluIHRoZSBiYXJjb2RlIGZvciB0aGVzZSBmb3JtYXRzLCBpdCBkb2VzIG5vdCBvZmZlciB0aGUgYnl0ZXMKCSAgICAgKiBmcm9tIHRoZSBieXRlIHNlZ21lbnRzIGFsb25lLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWFwcyB0byBhIHtAbGluayBqYXZhLnV0aWwuTGlzdH0gb2YgYnl0ZSBhcnJheXMgY29ycmVzcG9uZGluZyB0byB0aGUKCSAgICAgKiByYXcgYnl0ZXMgaW4gdGhlIGJ5dGUgc2VnbWVudHMgaW4gdGhlIGJhcmNvZGUsIGluIG9yZGVyLjwvcD4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJCWVRFX1NFR01FTlRTIl0gPSAyXSA9ICJCWVRFX1NFR01FTlRTIjsKCSAgICAvKioKCSAgICAgKiBFcnJvciBjb3JyZWN0aW9uIGxldmVsIHVzZWQsIGlmIGFwcGxpY2FibGUuIFRoZSB2YWx1ZSB0eXBlIGRlcGVuZHMgb24gdGhlCgkgICAgICogZm9ybWF0LCBidXQgaXMgdHlwaWNhbGx5IGEgU3RyaW5nLgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiXSA9IDNdID0gIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHBlcmlvZGljYWxzLCBpbmRpY2F0ZXMgdGhlIGlzc3VlIG51bWJlciBhcyBhbiB7QGxpbmsgSW50ZWdlcn0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiSVNTVUVfTlVNQkVSIl0gPSA0XSA9ICJJU1NVRV9OVU1CRVIiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHByb2R1Y3RzLCBpbmRpY2F0ZXMgdGhlIHN1Z2dlc3RlZCByZXRhaWwgcHJpY2UgaW4gdGhlIGJhcmNvZGUgYXMgYQoJICAgICAqIGZvcm1hdHRlZCB7QGxpbmsgU3RyaW5nfS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJTVUdHRVNURURfUFJJQ0UiXSA9IDVdID0gIlNVR0dFU1RFRF9QUklDRSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBwb3NzaWJsZSBjb3VudHJ5IG9mIG1hbnVmYWN0dXJlIGFzIGEge0BsaW5rIFN0cmluZ30gZGVub3RpbmcgdGhlCgkgICAgICogSVNPIGNvdW50cnkgY29kZS4gU29tZSBtYXAgdG8gbXVsdGlwbGUgcG9zc2libGUgY291bnRyaWVzLCBsaWtlICJVUy9DQSIuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUE9TU0lCTEVfQ09VTlRSWSJdID0gNl0gPSAiUE9TU0lCTEVfQ09VTlRSWSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBleHRlbnNpb24gdGV4dAoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSA3XSA9ICJVUENfRUFOX0VYVEVOU0lPTiI7CgkgICAgLyoqCgkgICAgICogUERGNDE3LXNwZWNpZmljIG1ldGFkYXRhCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUERGNDE3X0VYVFJBX01FVEFEQVRBIl0gPSA4XSA9ICJQREY0MTdfRVhUUkFfTUVUQURBVEEiOwoJICAgIC8qKgoJICAgICAqIElmIHRoZSBjb2RlIGZvcm1hdCBzdXBwb3J0cyBzdHJ1Y3R1cmVkIGFwcGVuZCBhbmQgdGhlIGN1cnJlbnQgc2Nhbm5lZCBjb2RlIGlzIHBhcnQgb2Ygb25lIHRoZW4gdGhlCgkgICAgICogc2VxdWVuY2UgbnVtYmVyIGlzIGdpdmVuIHdpdGggaXQuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UiXSA9IDldID0gIlNUUlVDVFVSRURfQVBQRU5EX1NFUVVFTkNFIjsKCSAgICAvKioKCSAgICAgKiBJZiB0aGUgY29kZSBmb3JtYXQgc3VwcG9ydHMgc3RydWN0dXJlZCBhcHBlbmQgYW5kIHRoZSBjdXJyZW50IHNjYW5uZWQgY29kZSBpcyBwYXJ0IG9mIG9uZSB0aGVuIHRoZQoJICAgICAqIHBhcml0eSBpcyBnaXZlbiB3aXRoIGl0LgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSJdID0gMTBdID0gIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSI7Cgl9KShSZXN1bHRNZXRhZGF0YVR5cGUgfHwgKFJlc3VsdE1ldGFkYXRhVHlwZSA9IHt9KSk7CglSZXN1bHRNZXRhZGF0YVR5cGUkMS5kZWZhdWx0ID0gUmVzdWx0TWV0YWRhdGFUeXBlOwoKCXZhciBEZWNvZGVyJDEgPSB7fTsKCgl2YXIgQ2hlY2tzdW1FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkOCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGVja3N1bUV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNCA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBDaGVja3N1bUV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkOChDaGVja3N1bUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBDaGVja3N1bUV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5nZXRDaGVja3N1bUluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IENoZWNrc3VtRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5raW5kID0gJ0NoZWNrc3VtRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQ2hlY2tzdW1FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCkpOwoJQ2hlY2tzdW1FeGNlcHRpb24kMS5kZWZhdWx0ID0gQ2hlY2tzdW1FeGNlcHRpb247CgoJdmFyIEdlbmVyaWNHRiQxID0ge307CgoJdmFyIEdlbmVyaWNHRlBvbHkkMSA9IHt9OwoKCXZhciBBYnN0cmFjdEdlbmVyaWNHRiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdEdlbmVyaWNHRiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGNvbnRhaW5zIHV0aWxpdHkgbWV0aG9kcyBmb3IgcGVyZm9ybWluZyBtYXRoZW1hdGljYWwgb3BlcmF0aW9ucyBvdmVyCgkgKiB0aGUgR2Fsb2lzIEZpZWxkcy4gT3BlcmF0aW9ucyB1c2UgYSBnaXZlbiBwcmltaXRpdmUgcG9seW5vbWlhbCBpbiBjYWxjdWxhdGlvbnMuPC9wPgoJICoKCSAqIDxwPlRocm91Z2hvdXQgdGhpcyBwYWNrYWdlLCBlbGVtZW50cyBvZiB0aGUgR0YgYXJlIHJlcHJlc2VudGVkIGFzIGFuIHtAY29kZSBpbnR9CgkgKiBmb3IgY29udmVuaWVuY2UgYW5kIHNwZWVkIChidXQgYXQgdGhlIGNvc3Qgb2YgbWVtb3J5KS4KCSAqIDwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBEYXZpZCBPbGl2aWVyCgkgKi8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBYnN0cmFjdEdlbmVyaWNHRigpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiAyIHRvIHRoZSBwb3dlciBvZiBhIGluIEdGKHNpemUpCgkgICAgICovCgkgICAgQWJzdHJhY3RHZW5lcmljR0YucHJvdG90eXBlLmV4cCA9IGZ1bmN0aW9uIChhKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmV4cFRhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBiYXNlIDIgbG9nIG9mIGEgaW4gR0Yoc2l6ZSkKCSAgICAgKi8KCSAgICBBYnN0cmFjdEdlbmVyaWNHRi5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKGEgLyppbnQqLykgewoJICAgICAgICBpZiAoYSA9PT0gMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0aGlzLmxvZ1RhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSW1wbGVtZW50cyBib3RoIGFkZGl0aW9uIGFuZCBzdWJ0cmFjdGlvbiAtLSB0aGV5IGFyZSB0aGUgc2FtZSBpbiBHRihzaXplKS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gc3VtL2RpZmZlcmVuY2Ugb2YgYSBhbmQgYgoJICAgICAqLwoJICAgIEFic3RyYWN0R2VuZXJpY0dGLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIGEgXiBiOwoJICAgIH07CgkgICAgcmV0dXJuIEFic3RyYWN0R2VuZXJpY0dGOwoJfSgpKTsKCUFic3RyYWN0R2VuZXJpY0dGJDEuZGVmYXVsdCA9IEFic3RyYWN0R2VuZXJpY0dGOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGUG9seSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5yZWVkc29sb21vbiB7Ki8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRl8xJDEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIFN5c3RlbV8xID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNCA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgcG9seW5vbWlhbCB3aG9zZSBjb2VmZmljaWVudHMgYXJlIGVsZW1lbnRzIG9mIGEgR0YuCgkgKiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBhcmUgaW1tdXRhYmxlLjwvcD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdlbmVyaWNHRlBvbHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGZpZWxkIHRoZSB7QGxpbmsgR2VuZXJpY0dGfSBpbnN0YW5jZSByZXByZXNlbnRpbmcgdGhlIGZpZWxkIHRvIHVzZQoJICAgICAqIHRvIHBlcmZvcm0gY29tcHV0YXRpb25zCgkgICAgICogQHBhcmFtIGNvZWZmaWNpZW50cyBjb2VmZmljaWVudHMgYXMgaW50cyByZXByZXNlbnRpbmcgZWxlbWVudHMgb2YgR0Yoc2l6ZSksIGFycmFuZ2VkCgkgICAgICogZnJvbSBtb3N0IHNpZ25pZmljYW50IChoaWdoZXN0LXBvd2VyIHRlcm0pIGNvZWZmaWNpZW50IHRvIGxlYXN0IHNpZ25pZmljYW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYXJndW1lbnQgaXMgbnVsbCBvciBlbXB0eSwKCSAgICAgKiBvciBpZiBsZWFkaW5nIGNvZWZmaWNpZW50IGlzIDAgYW5kIHRoaXMgaXMgbm90IGEKCSAgICAgKiBjb25zdGFudCBwb2x5bm9taWFsICh0aGF0IGlzLCBpdCBpcyBub3QgdGhlIG1vbm9taWFsICIwIikKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBHZW5lcmljR0ZQb2x5KGZpZWxkLCBjb2VmZmljaWVudHMpIHsKCSAgICAgICAgaWYgKGNvZWZmaWNpZW50cy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHNMZW5ndGggPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICBpZiAoY29lZmZpY2llbnRzTGVuZ3RoID4gMSAmJiBjb2VmZmljaWVudHNbMF0gPT09IDApIHsKCSAgICAgICAgICAgIC8vIExlYWRpbmcgdGVybSBtdXN0IGJlIG5vbi16ZXJvIGZvciBhbnl0aGluZyBleGNlcHQgdGhlIGNvbnN0YW50IHBvbHlub21pYWwgIjAiCgkgICAgICAgICAgICB2YXIgZmlyc3ROb25aZXJvID0gMTsKCSAgICAgICAgICAgIHdoaWxlIChmaXJzdE5vblplcm8gPCBjb2VmZmljaWVudHNMZW5ndGggJiYgY29lZmZpY2llbnRzW2ZpcnN0Tm9uWmVyb10gPT09IDApIHsKCSAgICAgICAgICAgICAgICBmaXJzdE5vblplcm8rKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChmaXJzdE5vblplcm8gPT09IGNvZWZmaWNpZW50c0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRoaXMuY29lZmZpY2llbnRzID0gSW50MzJBcnJheS5mcm9tKFswXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICB0aGlzLmNvZWZmaWNpZW50cyA9IG5ldyBJbnQzMkFycmF5KGNvZWZmaWNpZW50c0xlbmd0aCAtIGZpcnN0Tm9uWmVybyk7CgkgICAgICAgICAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkoY29lZmZpY2llbnRzLCBmaXJzdE5vblplcm8sIHRoaXMuY29lZmZpY2llbnRzLCAwLCB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBjb2VmZmljaWVudHM7CgkgICAgICAgIH0KCSAgICB9CgkgICAgR2VuZXJpY0dGUG9seS5wcm90b3R5cGUuZ2V0Q29lZmZpY2llbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGRlZ3JlZSBvZiB0aGlzIHBvbHlub21pYWwKCSAgICAgKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5nZXREZWdyZWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGlzIHBvbHlub21pYWwgaXMgdGhlIG1vbm9taWFsICIwIgoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmlzWmVybyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29lZmZpY2llbnRzWzBdID09PSAwOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBjb2VmZmljaWVudCBvZiB4XmRlZ3JlZSB0ZXJtIGluIHRoaXMgcG9seW5vbWlhbAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmdldENvZWZmaWNpZW50ID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50c1t0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxIC0gZGVncmVlXTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gZXZhbHVhdGlvbiBvZiB0aGlzIHBvbHlub21pYWwgYXQgYSBnaXZlbiBwb2ludAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmV2YWx1YXRlQXQgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHJldHVybiB0aGUgeF4wIGNvZWZmaWNpZW50CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgY29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgIGlmIChhID09PSAxKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHRoZSBzdW0gb2YgdGhlIGNvZWZmaWNpZW50cwoJICAgICAgICAgICAgcmVzdWx0ID0gMDsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7IGkgIT09IGxlbmd0aF8xOyBpKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgY29lZmZpY2llbnQgPSBjb2VmZmljaWVudHNbaV07CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gQWJzdHJhY3RHZW5lcmljR0ZfMSQxLmRlZmF1bHQuYWRkT3JTdWJ0cmFjdChyZXN1bHQsIGNvZWZmaWNpZW50KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCSAgICAgICAgcmVzdWx0ID0gY29lZmZpY2llbnRzWzBdOwoJICAgICAgICB2YXIgc2l6ZSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KGZpZWxkLm11bHRpcGx5KGEsIHJlc3VsdCksIGNvZWZmaWNpZW50c1tpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiBvdGhlcjsKCSAgICAgICAgfQoJICAgICAgICBpZiAob3RoZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzbWFsbGVyQ29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBsYXJnZXJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIGlmIChzbWFsbGVyQ29lZmZpY2llbnRzLmxlbmd0aCA+IGxhcmdlckNvZWZmaWNpZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gc21hbGxlckNvZWZmaWNpZW50czsKCSAgICAgICAgICAgIHNtYWxsZXJDb2VmZmljaWVudHMgPSBsYXJnZXJDb2VmZmljaWVudHM7CgkgICAgICAgICAgICBsYXJnZXJDb2VmZmljaWVudHMgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzdW1EaWZmID0gbmV3IEludDMyQXJyYXkobGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCk7CgkgICAgICAgIHZhciBsZW5ndGhEaWZmID0gbGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCAtIHNtYWxsZXJDb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICAvLyBDb3B5IGhpZ2gtb3JkZXIgdGVybXMgb25seSBmb3VuZCBpbiBoaWdoZXItZGVncmVlIHBvbHlub21pYWwncyBjb2VmZmljaWVudHMKCSAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkobGFyZ2VyQ29lZmZpY2llbnRzLCAwLCBzdW1EaWZmLCAwLCBsZW5ndGhEaWZmKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aERpZmY7IGkgPCBsYXJnZXJDb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHN1bURpZmZbaV0gPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KHNtYWxsZXJDb2VmZmljaWVudHNbaSAtIGxlbmd0aERpZmZdLCBsYXJnZXJDb2VmZmljaWVudHNbaV0pOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seSh0aGlzLmZpZWxkLCBzdW1EaWZmKTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKG90aGVyKSB7CgkgICAgICAgIGlmICghdGhpcy5maWVsZC5lcXVhbHMob3RoZXIuZmllbGQpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdHZW5lcmljR0ZQb2x5cyBkbyBub3QgaGF2ZSBzYW1lIEdlbmVyaWNHRiBmaWVsZCcpOwoJICAgICAgICB9CgkgICAgICAgIGlmICh0aGlzLmlzWmVybygpIHx8IG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGFDb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIGFMZW5ndGggPSBhQ29lZmZpY2llbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBiTGVuZ3RoID0gYkNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoYUxlbmd0aCArIGJMZW5ndGggLSAxKTsKCSAgICAgICAgdmFyIGZpZWxkID0gdGhpcy5maWVsZDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBhQ29lZmYgPSBhQ29lZmZpY2llbnRzW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBiTGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgICAgICBwcm9kdWN0W2kgKyBqXSA9IEFic3RyYWN0R2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocHJvZHVjdFtpICsgal0sIGZpZWxkLm11bHRpcGx5KGFDb2VmZiwgYkNvZWZmaWNpZW50c1tqXSkpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uIChzY2FsYXIgLyppbnQqLykgewoJICAgICAgICBpZiAoc2NhbGFyID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNjYWxhciA9PT0gMSkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIHByb2R1Y3RbaV0gPSBmaWVsZC5tdWx0aXBseShjb2VmZmljaWVudHNbaV0sIHNjYWxhcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljR0ZQb2x5KGZpZWxkLCBwcm9kdWN0KTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5QnlNb25vbWlhbCA9IGZ1bmN0aW9uIChkZWdyZWUgLyppbnQqLywgY29lZmZpY2llbnQgLyppbnQqLykgewoJICAgICAgICBpZiAoZGVncmVlIDwgMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChjb2VmZmljaWVudCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmllbGQuZ2V0WmVybygpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIHNpemUgPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICB2YXIgcHJvZHVjdCA9IG5ldyBJbnQzMkFycmF5KHNpemUgKyBkZWdyZWUpOwoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewoJICAgICAgICAgICAgcHJvZHVjdFtpXSA9IGZpZWxkLm11bHRpcGx5KGNvZWZmaWNpZW50c1tpXSwgY29lZmZpY2llbnQpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdEaXZpZGUgYnkgMCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBxdW90aWVudCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHJlbWFpbmRlciA9IHRoaXM7CgkgICAgICAgIHZhciBkZW5vbWluYXRvckxlYWRpbmdUZXJtID0gb3RoZXIuZ2V0Q29lZmZpY2llbnQob3RoZXIuZ2V0RGVncmVlKCkpOwoJICAgICAgICB2YXIgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0gPSBmaWVsZC5pbnZlcnNlKGRlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICB3aGlsZSAocmVtYWluZGVyLmdldERlZ3JlZSgpID49IG90aGVyLmdldERlZ3JlZSgpICYmICFyZW1haW5kZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHZhciBkZWdyZWVEaWZmZXJlbmNlID0gcmVtYWluZGVyLmdldERlZ3JlZSgpIC0gb3RoZXIuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICB2YXIgc2NhbGUgPSBmaWVsZC5tdWx0aXBseShyZW1haW5kZXIuZ2V0Q29lZmZpY2llbnQocmVtYWluZGVyLmdldERlZ3JlZSgpKSwgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICAgICAgdmFyIHRlcm0gPSBvdGhlci5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZmVyZW5jZSwgc2NhbGUpOwoJICAgICAgICAgICAgdmFyIGl0ZXJhdGlvblF1b3RpZW50ID0gZmllbGQuYnVpbGRNb25vbWlhbChkZWdyZWVEaWZmZXJlbmNlLCBzY2FsZSk7CgkgICAgICAgICAgICBxdW90aWVudCA9IHF1b3RpZW50LmFkZE9yU3VidHJhY3QoaXRlcmF0aW9uUXVvdGllbnQpOwoJICAgICAgICAgICAgcmVtYWluZGVyID0gcmVtYWluZGVyLmFkZE9yU3VidHJhY3QodGVybSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtxdW90aWVudCwgcmVtYWluZGVyXTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwoJICAgICAgICBmb3IgKHZhciBkZWdyZWUgPSB0aGlzLmdldERlZ3JlZSgpOyBkZWdyZWUgPj0gMDsgZGVncmVlLS0pIHsKCSAgICAgICAgICAgIHZhciBjb2VmZmljaWVudCA9IHRoaXMuZ2V0Q29lZmZpY2llbnQoZGVncmVlKTsKCSAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCA8IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgLSAnOwoJICAgICAgICAgICAgICAgICAgICBjb2VmZmljaWVudCA9IC1jb2VmZmljaWVudDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgKyAnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgPT09IDAgfHwgY29lZmZpY2llbnQgIT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhUG93ZXIgPSB0aGlzLmZpZWxkLmxvZyhjb2VmZmljaWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYVBvd2VyID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJzEnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFscGhhUG93ZXIgPT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnYSc7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ2FeJzsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhbHBoYVBvd2VyOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGRlZ3JlZSA9PT0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICd4JzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAneF4nOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRlZ3JlZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIEdlbmVyaWNHRlBvbHk7Cgl9KCkpOwoJR2VuZXJpY0dGUG9seSQxLmRlZmF1bHQgPSBHZW5lcmljR0ZQb2x5OwoKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkMyA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcml0aG1ldGljRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ3KEFyaXRobWV0aWNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJpdGhtZXRpY0V4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcml0aG1ldGljRXhjZXB0aW9uLmtpbmQgPSAnQXJpdGhtZXRpY0V4Y2VwdGlvbic7CgkgICAgcmV0dXJuIEFyaXRobWV0aWNFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCkpOwoJQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLmRlZmF1bHQgPSBBcml0aG1ldGljRXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uLnJlZWRzb2xvbW9uIHsqLwoJdmFyIEdlbmVyaWNHRlBvbHlfMSQxID0gR2VuZXJpY0dGUG9seSQxOwoJdmFyIEFic3RyYWN0R2VuZXJpY0dGXzEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIEludGVnZXJfMSQxID0gSW50ZWdlciQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDMgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uXzEgPSBBcml0aG1ldGljRXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgY29udGFpbnMgdXRpbGl0eSBtZXRob2RzIGZvciBwZXJmb3JtaW5nIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG92ZXIKCSAqIHRoZSBHYWxvaXMgRmllbGRzLiBPcGVyYXRpb25zIHVzZSBhIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsIGluIGNhbGN1bGF0aW9ucy48L3A+CgkgKgoJICogPHA+VGhyb3VnaG91dCB0aGlzIHBhY2thZ2UsIGVsZW1lbnRzIG9mIHRoZSBHRiBhcmUgcmVwcmVzZW50ZWQgYXMgYW4ge0Bjb2RlIGludH0KCSAqIGZvciBjb252ZW5pZW5jZSBhbmQgc3BlZWQgKGJ1dCBhdCB0aGUgY29zdCBvZiBtZW1vcnkpLgoJICogPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKiBAYXV0aG9yIERhdmlkIE9saXZpZXIKCSAqLwoJdmFyIEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkNihHZW5lcmljR0YsIF9zdXBlcik7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlIGEgcmVwcmVzZW50YXRpb24gb2YgR0Yoc2l6ZSkgdXNpbmcgdGhlIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsLgoJICAgICAqCgkgICAgICogQHBhcmFtIHByaW1pdGl2ZSBpcnJlZHVjaWJsZSBwb2x5bm9taWFsIHdob3NlIGNvZWZmaWNpZW50cyBhcmUgcmVwcmVzZW50ZWQgYnkKCSAgICAgKiAgdGhlIGJpdHMgb2YgYW4gaW50LCB3aGVyZSB0aGUgbGVhc3Qtc2lnbmlmaWNhbnQgYml0IHJlcHJlc2VudHMgdGhlIGNvbnN0YW50CgkgICAgICogIGNvZWZmaWNpZW50CgkgICAgICogQHBhcmFtIHNpemUgdGhlIHNpemUgb2YgdGhlIGZpZWxkCgkgICAgICogQHBhcmFtIGIgdGhlIGZhY3RvciBiIGluIHRoZSBnZW5lcmF0b3IgcG9seW5vbWlhbCBjYW4gYmUgMC0gb3IgMS1iYXNlZAoJICAgICAqICAoZyh4KSA9ICh4K2FeYikoeCthXihiKzEpKS4uLih4K2FeKGIrMnQtMSkpKS4KCSAgICAgKiAgSW4gbW9zdCBjYXNlcyBpdCBzaG91bGQgYmUgMSwgYnV0IGZvciBRUiBjb2RlIGl0IGlzIDAuCgkgICAgICovCgkgICAgZnVuY3Rpb24gR2VuZXJpY0dGKHByaW1pdGl2ZSAvKmludCovLCBzaXplIC8qaW50Ki8sIGdlbmVyYXRvckJhc2UgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7CgkgICAgICAgIF90aGlzLnNpemUgPSBzaXplOwoJICAgICAgICBfdGhpcy5nZW5lcmF0b3JCYXNlID0gZ2VuZXJhdG9yQmFzZTsKCSAgICAgICAgdmFyIGV4cFRhYmxlID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciB4ID0gMTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIGV4cFRhYmxlW2ldID0geDsKCSAgICAgICAgICAgIHggKj0gMjsgLy8gd2UncmUgYXNzdW1pbmcgdGhlIGdlbmVyYXRvciBhbHBoYSBpcyAyCgkgICAgICAgICAgICBpZiAoeCA+PSBzaXplKSB7CgkgICAgICAgICAgICAgICAgeCBePSBwcmltaXRpdmU7CgkgICAgICAgICAgICAgICAgeCAmPSBzaXplIC0gMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBfdGhpcy5leHBUYWJsZSA9IGV4cFRhYmxlOwoJICAgICAgICB2YXIgbG9nVGFibGUgPSBuZXcgSW50MzJBcnJheShzaXplKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplIC0gMTsgaSsrKSB7CgkgICAgICAgICAgICBsb2dUYWJsZVtleHBUYWJsZVtpXV0gPSBpOwoJICAgICAgICB9CgkgICAgICAgIF90aGlzLmxvZ1RhYmxlID0gbG9nVGFibGU7CgkgICAgICAgIC8vIGxvZ1RhYmxlWzBdID09IDAgYnV0IHRoaXMgc2hvdWxkIG5ldmVyIGJlIHVzZWQKCSAgICAgICAgX3RoaXMuemVybyA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzBdKSk7CgkgICAgICAgIF90aGlzLm9uZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzFdKSk7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRaZXJvID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRPbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm9uZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdGhlIG1vbm9taWFsIHJlcHJlc2VudGluZyBjb2VmZmljaWVudCAqIHheZGVncmVlCgkgICAgICovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5idWlsZE1vbm9taWFsID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovLCBjb2VmZmljaWVudCAvKmludCovKSB7CgkgICAgICAgIGlmIChkZWdyZWUgPCAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkMy5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvZWZmaWNpZW50ID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheShkZWdyZWUgKyAxKTsKCSAgICAgICAgY29lZmZpY2llbnRzWzBdID0gY29lZmZpY2llbnQ7CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seV8xJDEuZGVmYXVsdCh0aGlzLCBjb2VmZmljaWVudHMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBtdWx0aXBsaWNhdGl2ZSBpbnZlcnNlIG9mIGEKCSAgICAgKi8KCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmludmVyc2UgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQXJpdGhtZXRpY0V4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5leHBUYWJsZVt0aGlzLnNpemUgLSB0aGlzLmxvZ1RhYmxlW2FdIC0gMV07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHByb2R1Y3Qgb2YgYSBhbmQgYiBpbiBHRihzaXplKQoJICAgICAqLwoJICAgIEdlbmVyaWNHRi5wcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGEgPT09IDAgfHwgYiA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDA7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZXhwVGFibGVbKHRoaXMubG9nVGFibGVbYV0gKyB0aGlzLmxvZ1RhYmxlW2JdKSAlICh0aGlzLnNpemUgLSAxKV07CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNpemU7CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldEdlbmVyYXRvckJhc2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRvckJhc2U7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICgnR0YoMHgnICsgSW50ZWdlcl8xJDEuZGVmYXVsdC50b0hleFN0cmluZyh0aGlzLnByaW1pdGl2ZSkgKyAnLCcgKyB0aGlzLnNpemUgKyAnKScpOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICByZXR1cm4gbyA9PT0gdGhpczsKCSAgICB9OwoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEyID0gbmV3IEdlbmVyaWNHRigweDEwNjksIDQwOTYsIDEpOyAvLyB4XjEyICsgeF42ICsgeF41ICsgeF4zICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEwID0gbmV3IEdlbmVyaWNHRigweDQwOSwgMTAyNCwgMSk7IC8vIHheMTAgKyB4XjMgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfNiA9IG5ldyBHZW5lcmljR0YoMHg0MywgNjQsIDEpOyAvLyB4XjYgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19QQVJBTSA9IG5ldyBHZW5lcmljR0YoMHgxMywgMTYsIDEpOyAvLyB4XjQgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5RUl9DT0RFX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTFkLCAyNTYsIDApOyAvLyB4XjggKyB4XjQgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkRBVEFfTUFUUklYX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTJkLCAyNTYsIDEpOyAvLyB4XjggKyB4XjUgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfOCA9IEdlbmVyaWNHRi5EQVRBX01BVFJJWF9GSUVMRF8yNTY7CgkgICAgR2VuZXJpY0dGLk1BWElDT0RFX0ZJRUxEXzY0ID0gR2VuZXJpY0dGLkFaVEVDX0RBVEFfNjsKCSAgICByZXR1cm4gR2VuZXJpY0dGOwoJfShBYnN0cmFjdEdlbmVyaWNHRl8xLmRlZmF1bHQpKTsKCUdlbmVyaWNHRiQxLmRlZmF1bHQgPSBHZW5lcmljR0Y7CgoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciQxID0ge307CgoJdmFyIFJlZWRTb2xvbW9uRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDUgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVlZFNvbG9tb25FeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDIgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgUmVlZFNvbG9tb25FeGNlcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDUoUmVlZFNvbG9tb25FeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gUmVlZFNvbG9tb25FeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgUmVlZFNvbG9tb25FeGNlcHRpb24ua2luZCA9ICdSZWVkU29sb21vbkV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQyLmRlZmF1bHQpKTsKCVJlZWRTb2xvbW9uRXhjZXB0aW9uJDEuZGVmYXVsdCA9IFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkNCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDEgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSWxsZWdhbFN0YXRlRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ0KElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSWxsZWdhbFN0YXRlRXhjZXB0aW9uLmtpbmQgPSAnSWxsZWdhbFN0YXRlRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gSWxsZWdhbFN0YXRlRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQxLmRlZmF1bHQpKTsKCUlsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBJbGxlZ2FsU3RhdGVFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWVkU29sb21vbkRlY29kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24ucmVlZHNvbG9tb24geyovCgl2YXIgR2VuZXJpY0dGXzEkMSA9IEdlbmVyaWNHRiQxOwoJdmFyIEdlbmVyaWNHRlBvbHlfMSA9IEdlbmVyaWNHRlBvbHkkMTsKCXZhciBSZWVkU29sb21vbkV4Y2VwdGlvbl8xID0gUmVlZFNvbG9tb25FeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMSA9IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5JbXBsZW1lbnRzIFJlZWQtU29sb21vbiBkZWNvZGluZywgYXMgdGhlIG5hbWUgaW1wbGllcy48L3A+CgkgKgoJICogPHA+VGhlIGFsZ29yaXRobSB3aWxsIG5vdCBiZSBleHBsYWluZWQgaGVyZSwgYnV0IHRoZSBmb2xsb3dpbmcgcmVmZXJlbmNlcyB3ZXJlIGhlbHBmdWwKCSAqIGluIGNyZWF0aW5nIHRoaXMgaW1wbGVtZW50YXRpb246PC9wPgoJICoKCSAqIDx1bD4KCSAqIDxsaT5CcnVjZSBNYWdncy4KCSAqIDxhIGhyZWY9Imh0dHA6Ly93d3cuY3MuY211LmVkdS9hZnMvY3MuY211LmVkdS9wcm9qZWN0L3BzY2ljby1ndXliL3JlYWx3b3JsZC93d3cvcnNfZGVjb2RlLnBzIj4KCSAqICJEZWNvZGluZyBSZWVkLVNvbG9tb24gQ29kZXMiPC9hPiAoc2VlIGRpc2N1c3Npb24gb2YgRm9ybmV5J3MgRm9ybXVsYSk8L2xpPgoJICogPGxpPkouSS4gSGFsbC4gPGEgaHJlZj0id3d3Lm10aC5tc3UuZWR1L35qaGFsbC9jbGFzc2VzL2NvZGVub3Rlcy9HUlMucGRmIj4KCSAqICJDaGFwdGVyIDUuIEdlbmVyYWxpemVkIFJlZWQtU29sb21vbiBDb2RlcyI8L2E+CgkgKiAoc2VlIGRpc2N1c3Npb24gb2YgRXVjbGlkZWFuIGFsZ29yaXRobSk8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgV2lsbGlhbSBSdWNrbGlkZ2UKCSAqIEBhdXRob3Igc2FuZm9yZHNxdWlyZXMKCSAqLwoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBSZWVkU29sb21vbkRlY29kZXIoZmllbGQpIHsKCSAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkOwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5EZWNvZGVzIGdpdmVuIHNldCBvZiByZWNlaXZlZCBjb2Rld29yZHMsIHdoaWNoIGluY2x1ZGUgYm90aCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uCgkgICAgICogY29kZXdvcmRzLiBSZWFsbHksIHRoaXMgbWVhbnMgaXQgdXNlcyBSZWVkLVNvbG9tb24gdG8gZGV0ZWN0IGFuZCBjb3JyZWN0IGVycm9ycywgaW4tcGxhY2UsCgkgICAgICogaW4gdGhlIGlucHV0LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByZWNlaXZlZCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcwoJICAgICAqIEBwYXJhbSB0d29TIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBhdmFpbGFibGUKCSAgICAgKiBAdGhyb3dzIFJlZWRTb2xvbW9uRXhjZXB0aW9uIGlmIGRlY29kaW5nIGZhaWxzIGZvciBhbnkgcmVhc29uCgkgICAgICovCgkgICAgUmVlZFNvbG9tb25EZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbiAocmVjZWl2ZWQsIHR3b1MgLyppbnQqLykgewoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgcG9seSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgcmVjZWl2ZWQpOwoJICAgICAgICB2YXIgc3luZHJvbWVDb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheSh0d29TKTsKCSAgICAgICAgdmFyIG5vRXJyb3IgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR3b1M7IGkrKykgewoJICAgICAgICAgICAgdmFyIGV2YWxSZXN1bHQgPSBwb2x5LmV2YWx1YXRlQXQoZmllbGQuZXhwKGkgKyBmaWVsZC5nZXRHZW5lcmF0b3JCYXNlKCkpKTsKCSAgICAgICAgICAgIHN5bmRyb21lQ29lZmZpY2llbnRzW3N5bmRyb21lQ29lZmZpY2llbnRzLmxlbmd0aCAtIDEgLSBpXSA9IGV2YWxSZXN1bHQ7CgkgICAgICAgICAgICBpZiAoZXZhbFJlc3VsdCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIG5vRXJyb3IgPSBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9FcnJvcikgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzeW5kcm9tZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgc3luZHJvbWVDb2VmZmljaWVudHMpOwoJICAgICAgICB2YXIgc2lnbWFPbWVnYSA9IHRoaXMucnVuRXVjbGlkZWFuQWxnb3JpdGhtKGZpZWxkLmJ1aWxkTW9ub21pYWwodHdvUywgMSksIHN5bmRyb21lLCB0d29TKTsKCSAgICAgICAgdmFyIHNpZ21hID0gc2lnbWFPbWVnYVswXTsKCSAgICAgICAgdmFyIG9tZWdhID0gc2lnbWFPbWVnYVsxXTsKCSAgICAgICAgdmFyIGVycm9yTG9jYXRpb25zID0gdGhpcy5maW5kRXJyb3JMb2NhdGlvbnMoc2lnbWEpOwoJICAgICAgICB2YXIgZXJyb3JNYWduaXR1ZGVzID0gdGhpcy5maW5kRXJyb3JNYWduaXR1ZGVzKG9tZWdhLCBlcnJvckxvY2F0aW9ucyk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JMb2NhdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHJlY2VpdmVkLmxlbmd0aCAtIDEgLSBmaWVsZC5sb2coZXJyb3JMb2NhdGlvbnNbaV0pOwoJICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ0JhZCBlcnJvciBsb2NhdGlvbicpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVjZWl2ZWRbcG9zaXRpb25dID0gR2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocmVjZWl2ZWRbcG9zaXRpb25dLCBlcnJvck1hZ25pdHVkZXNbaV0pOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZWVkU29sb21vbkRlY29kZXIucHJvdG90eXBlLnJ1bkV1Y2xpZGVhbkFsZ29yaXRobSA9IGZ1bmN0aW9uIChhLCBiLCBSIC8qaW50Ki8pIHsKCSAgICAgICAgLy8gQXNzdW1lIGEncyBkZWdyZWUgaXMgPj0gYidzCgkgICAgICAgIGlmIChhLmdldERlZ3JlZSgpIDwgYi5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgdmFyIHRlbXAgPSBhOwoJICAgICAgICAgICAgYSA9IGI7CgkgICAgICAgICAgICBiID0gdGVtcDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgckxhc3QgPSBhOwoJICAgICAgICB2YXIgciA9IGI7CgkgICAgICAgIHZhciB0TGFzdCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHQgPSBmaWVsZC5nZXRPbmUoKTsKCSAgICAgICAgLy8gUnVuIEV1Y2xpZGVhbiBhbGdvcml0aG0gdW50aWwgcidzIGRlZ3JlZSBpcyBsZXNzIHRoYW4gUi8yCgkgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IChSIC8gMiB8IDApKSB7CgkgICAgICAgICAgICB2YXIgckxhc3RMYXN0ID0gckxhc3Q7CgkgICAgICAgICAgICB2YXIgdExhc3RMYXN0ID0gdExhc3Q7CgkgICAgICAgICAgICByTGFzdCA9IHI7CgkgICAgICAgICAgICB0TGFzdCA9IHQ7CgkgICAgICAgICAgICAvLyBEaXZpZGUgckxhc3RMYXN0IGJ5IHJMYXN0LCB3aXRoIHF1b3RpZW50IGluIHEgYW5kIHJlbWFpbmRlciBpbiByCgkgICAgICAgICAgICBpZiAockxhc3QuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgICAgICAvLyBPb3BzLCBFdWNsaWRlYW4gYWxnb3JpdGhtIGFscmVhZHkgdGVybWluYXRlZD8KCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVlZFNvbG9tb25FeGNlcHRpb25fMS5kZWZhdWx0KCdyX3tpLTF9IHdhcyB6ZXJvJyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByID0gckxhc3RMYXN0OwoJICAgICAgICAgICAgdmFyIHEgPSBmaWVsZC5nZXRaZXJvKCk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3JMZWFkaW5nVGVybSA9IHJMYXN0LmdldENvZWZmaWNpZW50KHJMYXN0LmdldERlZ3JlZSgpKTsKCSAgICAgICAgICAgIHZhciBkbHRJbnZlcnNlID0gZmllbGQuaW52ZXJzZShkZW5vbWluYXRvckxlYWRpbmdUZXJtKTsKCSAgICAgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IHJMYXN0LmdldERlZ3JlZSgpICYmICFyLmlzWmVybygpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlZ3JlZURpZmYgPSByLmdldERlZ3JlZSgpIC0gckxhc3QuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gZmllbGQubXVsdGlwbHkoci5nZXRDb2VmZmljaWVudChyLmdldERlZ3JlZSgpKSwgZGx0SW52ZXJzZSk7CgkgICAgICAgICAgICAgICAgcSA9IHEuYWRkT3JTdWJ0cmFjdChmaWVsZC5idWlsZE1vbm9taWFsKGRlZ3JlZURpZmYsIHNjYWxlKSk7CgkgICAgICAgICAgICAgICAgciA9IHIuYWRkT3JTdWJ0cmFjdChyTGFzdC5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZiwgc2NhbGUpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHQgPSBxLm11bHRpcGx5KHRMYXN0KS5hZGRPclN1YnRyYWN0KHRMYXN0TGFzdCk7CgkgICAgICAgICAgICBpZiAoci5nZXREZWdyZWUoKSA+PSByTGFzdC5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMS5kZWZhdWx0KCdEaXZpc2lvbiBhbGdvcml0aG0gZmFpbGVkIHRvIHJlZHVjZSBwb2x5bm9taWFsPycpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBzaWdtYVRpbGRlQXRaZXJvID0gdC5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgaWYgKHNpZ21hVGlsZGVBdFplcm8gPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ3NpZ21hVGlsZGUoMCkgd2FzIHplcm8nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaW52ZXJzZSA9IGZpZWxkLmludmVyc2Uoc2lnbWFUaWxkZUF0WmVybyk7CgkgICAgICAgIHZhciBzaWdtYSA9IHQubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHZhciBvbWVnYSA9IHIubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHJldHVybiBbc2lnbWEsIG9tZWdhXTsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTG9jYXRpb25zID0gZnVuY3Rpb24gKGVycm9yTG9jYXRvcikgewoJICAgICAgICAvLyBUaGlzIGlzIGEgZGlyZWN0IGFwcGxpY2F0aW9uIG9mIENoaWVuJ3Mgc2VhcmNoCgkgICAgICAgIHZhciBudW1FcnJvcnMgPSBlcnJvckxvY2F0b3IuZ2V0RGVncmVlKCk7CgkgICAgICAgIGlmIChudW1FcnJvcnMgPT09IDEpIHsgLy8gc2hvcnRjdXQKCSAgICAgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2Vycm9yTG9jYXRvci5nZXRDb2VmZmljaWVudCgxKV0pOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgSW50MzJBcnJheShudW1FcnJvcnMpOwoJICAgICAgICB2YXIgZSA9IDA7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZmllbGQuZ2V0U2l6ZSgpICYmIGUgPCBudW1FcnJvcnM7IGkrKykgewoJICAgICAgICAgICAgaWYgKGVycm9yTG9jYXRvci5ldmFsdWF0ZUF0KGkpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0W2VdID0gZmllbGQuaW52ZXJzZShpKTsKCSAgICAgICAgICAgICAgICBlKys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGUgIT09IG51bUVycm9ycykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IFJlZWRTb2xvbW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnRXJyb3IgbG9jYXRvciBkZWdyZWUgZG9lcyBub3QgbWF0Y2ggbnVtYmVyIG9mIHJvb3RzJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTWFnbml0dWRlcyA9IGZ1bmN0aW9uIChlcnJvckV2YWx1YXRvciwgZXJyb3JMb2NhdGlvbnMpIHsKCSAgICAgICAgLy8gVGhpcyBpcyBkaXJlY3RseSBhcHBseWluZyBGb3JuZXkncyBGb3JtdWxhCgkgICAgICAgIHZhciBzID0gZXJyb3JMb2NhdGlvbnMubGVuZ3RoOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEludDMyQXJyYXkocyk7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgczsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeGlJbnZlcnNlID0gZmllbGQuaW52ZXJzZShlcnJvckxvY2F0aW9uc1tpXSk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSAxOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaikgewoJICAgICAgICAgICAgICAgICAgICAvLyBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLAoJICAgICAgICAgICAgICAgICAgICAvLyAgICBHZW5lcmljR0YuYWRkT3JTdWJ0cmFjdCgxLCBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKSkpCgkgICAgICAgICAgICAgICAgICAgIC8vIEFib3ZlIHNob3VsZCB3b3JrIGJ1dCBmYWlscyBvbiBzb21lIEFwcGxlIGFuZCBMaW51eCBKREtzIGR1ZSB0byBhIEhvdHNwb3QgYnVnLgoJICAgICAgICAgICAgICAgICAgICAvLyBCZWxvdyBpcyBhIGZ1bm55LWxvb2tpbmcgd29ya2Fyb3VuZCBmcm9tIFN0ZXZlbiBQYXJrZXMKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm0gPSBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1QbHVzMSA9ICh0ZXJtICYgMHgxKSA9PT0gMCA/IHRlcm0gfCAxIDogdGVybSAmIH4xOwoJICAgICAgICAgICAgICAgICAgICBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLCB0ZXJtUGx1czEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KGVycm9yRXZhbHVhdG9yLmV2YWx1YXRlQXQoeGlJbnZlcnNlKSwgZmllbGQuaW52ZXJzZShkZW5vbWluYXRvcikpOwoJICAgICAgICAgICAgaWYgKGZpZWxkLmdldEdlbmVyYXRvckJhc2UoKSAhPT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KHJlc3VsdFtpXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRGVjb2RlcjsKCX0oKSk7CglSZWVkU29sb21vbkRlY29kZXIkMS5kZWZhdWx0ID0gUmVlZFNvbG9tb25EZWNvZGVyOwoKCXZhciBCaXRNYXRyaXhQYXJzZXIkMSA9IHt9OwoKCXZhciBWZXJzaW9uJDEgPSB7fTsKCgl2YXIgRm9ybWF0SW5mb3JtYXRpb24kMSA9IHt9OwoKCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IHt9OwoKCXZhciBBcmd1bWVudEV4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyQzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkMyhBcmd1bWVudEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBcmd1bWVudEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0FyZ3VtZW50RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQXJndW1lbnRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xLmRlZmF1bHQpKTsKCUFyZ3VtZW50RXhjZXB0aW9uJDEuZGVmYXVsdCA9IEFyZ3VtZW50RXhjZXB0aW9uOwoKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CglleHBvcnRzLkVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gdm9pZCAwOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbl8xID0gQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJdmFyIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzOwoJKGZ1bmN0aW9uIChFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcykgewoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJMIl0gPSAwXSA9ICJMIjsKCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1tFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1siTSJdID0gMV0gPSAiTSI7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbIlEiXSA9IDJdID0gIlEiOwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJIIl0gPSAzXSA9ICJIIjsKCX0pKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyB8fCAoZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyA9IHt9KSk7CgkvKioKCSAqIDxwPlNlZSBJU08gMTgwMDQ6MjAwNiwgNi41LjEuIFRoaXMgZW51bSBlbmNhcHN1bGF0ZXMgdGhlIGZvdXIgZXJyb3IgY29ycmVjdGlvbiBsZXZlbHMKCSAqIGRlZmluZWQgYnkgdGhlIFFSIGNvZGUgc3RhbmRhcmQuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFcnJvckNvcnJlY3Rpb25MZXZlbCh2YWx1ZSwgc3RyaW5nVmFsdWUsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2V0KGJpdHMsIHRoaXMpOwoJICAgICAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5nZXRCaXRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZnJvbVN0cmluZyA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIHN3aXRjaCAocykgewoJICAgICAgICAgICAgY2FzZSAnTCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5MOwoJICAgICAgICAgICAgY2FzZSAnTSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5NOwoJICAgICAgICAgICAgY2FzZSAnUSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5ROwoJICAgICAgICAgICAgY2FzZSAnSCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5IOwoJICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uXzEuZGVmYXVsdChzICsgJ25vdCBhdmFpbGFibGUnKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG90aGVyID0gbzsKCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPT09IG90aGVyLnZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgaW50IGNvbnRhaW5pbmcgdGhlIHR3byBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSdzIGVycm9yIGNvcnJlY3Rpb24gbGV2ZWwKCSAgICAgKiBAcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsIHJlcHJlc2VudGluZyB0aGUgZW5jb2RlZCBlcnJvciBjb3JyZWN0aW9uIGxldmVsCgkgICAgICovCgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZm9yQml0cyA9IGZ1bmN0aW9uIChiaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGJpdHMgPCAwIHx8IGJpdHMgPj0gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuZ2V0KGJpdHMpOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX1ZBTFVFID0gbmV3IE1hcCgpOwoJICAgIC8qKiBMID0gfjclIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5MID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkwsICdMJywgMHgwMSk7CgkgICAgLyoqIE0gPSB+MTUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5NID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLk0sICdNJywgMHgwMCk7CgkgICAgLyoqIFEgPSB+MjUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5RID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLlEsICdRJywgMHgwMyk7CgkgICAgLyoqIEggPSB+MzAlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5IID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkgsICdIJywgMHgwMik7CgkgICAgcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IEVycm9yQ29ycmVjdGlvbkxldmVsOwoKCX0oRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9ybWF0SW5mb3JtYXRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbF8xID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWw7Cgl2YXIgSW50ZWdlcl8xID0gSW50ZWdlciQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBRUiBDb2RlJ3MgZm9ybWF0IGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgdGhlIGRhdGEgbWFzayB1c2VkIGFuZAoJICogZXJyb3IgY29ycmVjdGlvbiBsZXZlbC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBzZWUgRGF0YU1hc2sKCSAqIEBzZWUgRXJyb3JDb3JyZWN0aW9uTGV2ZWwKCSAqLwoJdmFyIEZvcm1hdEluZm9ybWF0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZvcm1hdEluZm9ybWF0aW9uKGZvcm1hdEluZm8gLyppbnQqLykgewoJICAgICAgICAvLyBCaXRzIDMsNAoJICAgICAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWxfMS5kZWZhdWx0LmZvckJpdHMoKGZvcm1hdEluZm8gPj4gMykgJiAweDAzKTsKCSAgICAgICAgLy8gQm90dG9tIDMgYml0cwoJICAgICAgICB0aGlzLmRhdGFNYXNrID0gLyooYnl0ZSkgKi8gKGZvcm1hdEluZm8gJiAweDA3KTsKCSAgICB9CgkgICAgRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyA9IGZ1bmN0aW9uIChhIC8qaW50Ki8sIGIgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gSW50ZWdlcl8xLmRlZmF1bHQuYml0Q291bnQoYSBeIGIpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIG1hc2tlZEZvcm1hdEluZm8xIGZvcm1hdCBpbmZvIGluZGljYXRvciwgd2l0aCBtYXNrIHN0aWxsIGFwcGxpZWQKCSAgICAgKiBAcGFyYW0gbWFza2VkRm9ybWF0SW5mbzIgc2Vjb25kIGNvcHkgb2Ygc2FtZSBpbmZvOyBib3RoIGFyZSBjaGVja2VkIGF0IHRoZSBzYW1lIHRpbWUKCSAgICAgKiAgdG8gZXN0YWJsaXNoIGJlc3QgbWF0Y2gKCSAgICAgKiBAcmV0dXJuIGluZm9ybWF0aW9uIGFib3V0IHRoZSBmb3JtYXQgaXQgc3BlY2lmaWVzLCBvciB7QGNvZGUgbnVsbH0KCSAgICAgKiAgaWYgZG9lc24ndCBzZWVtIHRvIG1hdGNoIGFueSBrbm93biBwYXR0ZXJuCgkgICAgICovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24uZGVjb2RlRm9ybWF0SW5mb3JtYXRpb24gPSBmdW5jdGlvbiAobWFza2VkRm9ybWF0SW5mbzEgLyppbnQqLywgbWFza2VkRm9ybWF0SW5mbzIgLyppbnQqLykgewoJICAgICAgICB2YXIgZm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uLmRvRGVjb2RlRm9ybWF0SW5mb3JtYXRpb24obWFza2VkRm9ybWF0SW5mbzEsIG1hc2tlZEZvcm1hdEluZm8yKTsKCSAgICAgICAgaWYgKGZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiBmb3JtYXRJbmZvOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNob3VsZCByZXR1cm4gbnVsbCwgYnV0LCBzb21lIFFSIGNvZGVzIGFwcGFyZW50bHkKCSAgICAgICAgLy8gZG8gbm90IG1hc2sgdGhpcyBpbmZvLiBUcnkgYWdhaW4gYnkgYWN0dWFsbHkgbWFza2luZyB0aGUgcGF0dGVybgoJICAgICAgICAvLyBmaXJzdAoJICAgICAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb24uZG9EZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihtYXNrZWRGb3JtYXRJbmZvMSBeIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX01BU0tfUVIsIG1hc2tlZEZvcm1hdEluZm8yIF4gRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUik7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5kb0RlY29kZUZvcm1hdEluZm9ybWF0aW9uID0gZnVuY3Rpb24gKG1hc2tlZEZvcm1hdEluZm8xIC8qaW50Ki8sIG1hc2tlZEZvcm1hdEluZm8yIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGVfMSwgX2E7CgkgICAgICAgIC8vIEZpbmQgdGhlIGludCBpbiBGT1JNQVRfSU5GT19ERUNPREVfTE9PS1VQIHdpdGggZmV3ZXN0IGJpdHMgZGlmZmVyaW5nCgkgICAgICAgIHZhciBiZXN0RGlmZmVyZW5jZSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgICAgICB2YXIgYmVzdEZvcm1hdEluZm8gPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyQ2KEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVApLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlY29kZUluZm8gPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0SW5mbyA9IGRlY29kZUluZm9bMF07CgkgICAgICAgICAgICAgICAgaWYgKHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8xIHx8IHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8yKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGFuIGV4YWN0IG1hdGNoCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRm9ybWF0SW5mb3JtYXRpb24oZGVjb2RlSW5mb1sxXSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBiaXRzRGlmZmVyZW5jZSA9IEZvcm1hdEluZm9ybWF0aW9uLm51bUJpdHNEaWZmZXJpbmcobWFza2VkRm9ybWF0SW5mbzEsIHRhcmdldEluZm8pOwoJICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgIGJlc3RGb3JtYXRJbmZvID0gZGVjb2RlSW5mb1sxXTsKCSAgICAgICAgICAgICAgICAgICAgYmVzdERpZmZlcmVuY2UgPSBiaXRzRGlmZmVyZW5jZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKG1hc2tlZEZvcm1hdEluZm8xICE9PSBtYXNrZWRGb3JtYXRJbmZvMikgewoJICAgICAgICAgICAgICAgICAgICAvLyBhbHNvIHRyeSB0aGUgb3RoZXIgb3B0aW9uCgkgICAgICAgICAgICAgICAgICAgIGJpdHNEaWZmZXJlbmNlID0gRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyhtYXNrZWRGb3JtYXRJbmZvMiwgdGFyZ2V0SW5mbyk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0Rm9ybWF0SW5mbyA9IGRlY29kZUluZm9bMV07CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2IucmV0dXJuKSkgX2EuY2FsbChfYik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSGFtbWluZyBkaXN0YW5jZSBvZiB0aGUgMzIgbWFza2VkIGNvZGVzIGlzIDcsIGJ5IGNvbnN0cnVjdGlvbiwgc28gPD0gMyBiaXRzCgkgICAgICAgIC8vIGRpZmZlcmluZyBtZWFucyB3ZSBmb3VuZCBhIG1hdGNoCgkgICAgICAgIGlmIChiZXN0RGlmZmVyZW5jZSA8PSAzKSB7CgkgICAgICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEluZm9ybWF0aW9uKGJlc3RGb3JtYXRJbmZvKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbnVsbDsKCSAgICB9OwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWw7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5wcm90b3R5cGUuZ2V0RGF0YU1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFNYXNrOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsLmdldEJpdHMoKSA8PCAzKSB8IHRoaXMuZGF0YU1hc2s7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBGb3JtYXRJbmZvcm1hdGlvbikpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCA9PT0gb3RoZXIuZXJyb3JDb3JyZWN0aW9uTGV2ZWwgJiYKCSAgICAgICAgICAgIHRoaXMuZGF0YU1hc2sgPT09IG90aGVyLmRhdGFNYXNrOwoJICAgIH07CgkgICAgRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUiA9IDB4NTQxMjsKCSAgICAvKioKCSAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYsIEFubmV4IEMsIFRhYmxlIEMuMQoJICAgICAqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVAgPSBbCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1NDEyLCAweDAwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1MTI1LCAweDAxXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1RTdDLCAweDAyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1QjRCLCAweDAzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0NUY5LCAweDA0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0MENFLCAweDA1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0Rjk3LCAweDA2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0QUEwLCAweDA3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3N0M0LCAweDA4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3MkYzLCAweDA5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3REFBLCAweDBBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3ODlELCAweDBCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2NjJGLCAweDBDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2MzE4LCAweDBEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2QzQxLCAweDBFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2OTc2LCAweDBGXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxNjg5LCAweDEwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxM0JFLCAweDExXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxQ0U3LCAweDEyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxOUQwLCAweDEzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwNzYyLCAweDE0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwMjU1LCAweDE1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwRDBDLCAweDE2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwODNCLCAweDE3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzNTVGLCAweDE4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzMDY4LCAweDE5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzRjMxLCAweDFBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzQTA2LCAweDFCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyNEI0LCAweDFDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyMTgzLCAweDFEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyRURBLCAweDFFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyQkVELCAweDFGXSksCgkgICAgXTsKCSAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb247Cgl9KCkpOwoJRm9ybWF0SW5mb3JtYXRpb24kMS5kZWZhdWx0ID0gRm9ybWF0SW5mb3JtYXRpb247CgoJdmFyIEVDQmxvY2tzJDEgPSB7fTsKCgl2YXIgX192YWx1ZXMkNSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0Jsb2NrcyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHNldCBvZiBlcnJvci1jb3JyZWN0aW9uIGJsb2NrcyBpbiBvbmUgc3ltYm9sIHZlcnNpb24uIE1vc3QgdmVyc2lvbnMgd2lsbAoJICogdXNlIGJsb2NrcyBvZiBkaWZmZXJpbmcgc2l6ZXMgd2l0aGluIG9uZSB2ZXJzaW9uLCBzbywgdGhpcyBlbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yCgkgKiBlYWNoIHNldCBvZiBibG9ja3MuIEl0IGFsc28gaG9sZHMgdGhlIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBwZXIgYmxvY2sgc2luY2UgaXQKCSAqIHdpbGwgYmUgdGhlIHNhbWUgYWNyb3NzIGFsbCBibG9ja3Mgd2l0aGluIG9uZSB2ZXJzaW9uLjwvcD4KCSAqLwoJdmFyIEVDQmxvY2tzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEVDQmxvY2tzKGVjQ29kZXdvcmRzUGVyQmxvY2sgLyppbnQqLykgewoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayA9IGVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgICAgIHRoaXMuZWNCbG9ja3MgPSBlY0Jsb2NrczsKCSAgICB9CgkgICAgRUNCbG9ja3MucHJvdG90eXBlLmdldEVDQ29kZXdvcmRzUGVyQmxvY2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0TnVtQmxvY2tzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIHRvdGFsID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tzID0gdGhpcy5lY0Jsb2NrczsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIGVjQmxvY2tzXzEgPSBfX3ZhbHVlcyQ1KGVjQmxvY2tzKSwgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCk7ICFlY0Jsb2Nrc18xXzEuZG9uZTsgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tzXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbCArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2Nrc18xXzEgJiYgIWVjQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGVjQmxvY2tzXzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2Nrc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdG90YWw7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0VG90YWxFQ0NvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayAqIHRoaXMuZ2V0TnVtQmxvY2tzKCk7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0RUNCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQmxvY2tzOwoJICAgIH07CgkgICAgcmV0dXJuIEVDQmxvY2tzOwoJfSgpKTsKCUVDQmxvY2tzJDEuZGVmYXVsdCA9IEVDQmxvY2tzOwoKCXZhciBFQ0IkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yIG9uZSBlcnJvci1jb3JyZWN0aW9uIGJsb2NrIGluIG9uZSBzeW1ib2wgdmVyc2lvbi4KCSAqIFRoaXMgaW5jbHVkZXMgdGhlIG51bWJlciBvZiBkYXRhIGNvZGV3b3JkcywgYW5kIHRoZSBudW1iZXIgb2YgdGltZXMgYSBibG9jayB3aXRoIHRoZXNlCgkgKiBwYXJhbWV0ZXJzIGlzIHVzZWQgY29uc2VjdXRpdmVseSBpbiB0aGUgUVIgY29kZSB2ZXJzaW9uJ3MgZm9ybWF0LjwvcD4KCSAqLwoJdmFyIEVDQiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFQ0IoY291bnQgLyppbnQqLywgZGF0YUNvZGV3b3JkcyAvKmludCovKSB7CgkgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDsKCSAgICAgICAgdGhpcy5kYXRhQ29kZXdvcmRzID0gZGF0YUNvZGV3b3JkczsKCSAgICB9CgkgICAgRUNCLnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY291bnQ7CgkgICAgfTsKCSAgICBFQ0IucHJvdG90eXBlLmdldERhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICByZXR1cm4gRUNCOwoJfSgpKTsKCUVDQiQxLmRlZmF1bHQgPSBFQ0I7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX3ZhbHVlcyQ0ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBCaXRNYXRyaXhfMSQzID0gQml0TWF0cml4JDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSQxID0gRm9ybWF0SW5mb3JtYXRpb24kMTsKCXZhciBFQ0Jsb2Nrc18xID0gRUNCbG9ja3MkMTsKCXZhciBFQ0JfMSA9IEVDQiQxOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDIgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQyID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIFNlZSBJU08gMTgwMDQ6MjAwNiBBbm5leCBECgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFZlcnNpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gVmVyc2lvbih2ZXJzaW9uTnVtYmVyIC8qaW50Ki8sIGFsaWdubWVudFBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmVyc2lvbk51bWJlciA9IHZlcnNpb25OdW1iZXI7CgkgICAgICAgIHRoaXMuYWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBhbGlnbm1lbnRQYXR0ZXJuQ2VudGVyczsKCSAgICAgICAgdGhpcy5lY0Jsb2NrcyA9IGVjQmxvY2tzOwoJICAgICAgICB2YXIgdG90YWwgPSAwOwoJICAgICAgICB2YXIgZWNDb2Rld29yZHMgPSBlY0Jsb2Nrc1swXS5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIHZhciBlY2JBcnJheSA9IGVjQmxvY2tzWzBdLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY2JBcnJheV8xID0gX192YWx1ZXMkNChlY2JBcnJheSksIGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpOyAhZWNiQXJyYXlfMV8xLmRvbmU7IGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVjQmxvY2sgPSBlY2JBcnJheV8xXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdG90YWwgKz0gZWNCbG9jay5nZXRDb3VudCgpICogKGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpICsgZWNDb2Rld29yZHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoZWNiQXJyYXlfMV8xICYmICFlY2JBcnJheV8xXzEuZG9uZSAmJiAoX2EgPSBlY2JBcnJheV8xLnJldHVybikpIF9hLmNhbGwoZWNiQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy50b3RhbENvZGV3b3JkcyA9IHRvdGFsOwoJICAgIH0KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5nZXRWZXJzaW9uTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0VG90YWxDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQ29kZXdvcmRzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDE3ICsgNCAqIHRoaXMudmVyc2lvbk51bWJlcjsKCSAgICB9OwoJICAgIFZlcnNpb24ucHJvdG90eXBlLmdldEVDQmxvY2tzRm9yTGV2ZWwgPSBmdW5jdGlvbiAoZWNMZXZlbCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0Jsb2Nrc1tlY0xldmVsLmdldFZhbHVlKCldOwoJICAgICAgICAvLyBUWVBFU0NSSVBUUE9SVDogb3JpZ2luYWwgd2FzIHVzaW5nIG9yZGluYWwsIGFuZCB1c2luZyB0aGUgb3JkZXIgb2YgbGV2ZWxzIGFzIGRlZmluZWQgaW4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwgZW51bSAoTE1RSCkKCSAgICAgICAgLy8gSSB3aWxsIHVzZSB0aGUgZGlyZWN0IHZhbHVlIGZyb20gRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXMgZW51bSB3aGljaCBpbiB0eXBlc2NyaXB0IGdvZXMgdG8gYSBudW1iZXIKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkRlZHVjZXMgdmVyc2lvbiBpbmZvcm1hdGlvbiBwdXJlbHkgZnJvbSBRUiBDb2RlIGRpbWVuc2lvbnMuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gaW4gbW9kdWxlcwoJICAgICAqIEByZXR1cm4gVmVyc2lvbiBmb3IgYSBRUiBDb2RlIG9mIHRoYXQgZGltZW5zaW9uCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCAxIG1vZCA0CgkgICAgICovCgkgICAgVmVyc2lvbi5nZXRQcm92aXNpb25hbFZlcnNpb25Gb3JEaW1lbnNpb24gPSBmdW5jdGlvbiAoZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiAlIDQgIT09IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmVyc2lvbkZvck51bWJlcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlciA9IGZ1bmN0aW9uICh2ZXJzaW9uTnVtYmVyIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPCAxIHx8IHZlcnNpb25OdW1iZXIgPiA0MCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDIuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBWZXJzaW9uLlZFUlNJT05TW3ZlcnNpb25OdW1iZXIgLSAxXTsKCSAgICB9OwoJICAgIFZlcnNpb24uZGVjb2RlVmVyc2lvbkluZm9ybWF0aW9uID0gZnVuY3Rpb24gKHZlcnNpb25CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGJlc3REaWZmZXJlbmNlID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHZhciBiZXN0VmVyc2lvbiA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgVmVyc2lvbi5WRVJTSU9OX0RFQ09ERV9JTkZPLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgdGFyZ2V0VmVyc2lvbiA9IFZlcnNpb24uVkVSU0lPTl9ERUNPREVfSU5GT1tpXTsKCSAgICAgICAgICAgIC8vIERvIHRoZSB2ZXJzaW9uIGluZm8gYml0cyBtYXRjaCBleGFjdGx5PyBkb25lLgoJICAgICAgICAgICAgaWYgKHRhcmdldFZlcnNpb24gPT09IHZlcnNpb25CaXRzKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlcihpICsgNyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2VlIGlmIHRoaXMgaXMgdGhlIGNsb3Nlc3QgdG8gYSByZWFsIHZlcnNpb24gaW5mbyBiaXQgc3RyaW5nCgkgICAgICAgICAgICAvLyB3ZSBoYXZlIHNlZW4gc28gZmFyCgkgICAgICAgICAgICB2YXIgYml0c0RpZmZlcmVuY2UgPSBGb3JtYXRJbmZvcm1hdGlvbl8xJDEuZGVmYXVsdC5udW1CaXRzRGlmZmVyaW5nKHZlcnNpb25CaXRzLCB0YXJnZXRWZXJzaW9uKTsKCSAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgYmVzdFZlcnNpb24gPSBpICsgNzsKCSAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFdlIGNhbiB0b2xlcmF0ZSB1cCB0byAzIGJpdHMgb2YgZXJyb3Igc2luY2Ugbm8gdHdvIHZlcnNpb24gaW5mbyBjb2Rld29yZHMgd2lsbAoJICAgICAgICAvLyBkaWZmZXIgaW4gbGVzcyB0aGFuIDggYml0cy4KCSAgICAgICAgaWYgKGJlc3REaWZmZXJlbmNlIDw9IDMpIHsKCSAgICAgICAgICAgIHJldHVybiBWZXJzaW9uLmdldFZlcnNpb25Gb3JOdW1iZXIoYmVzdFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGRpZG4ndCBmaW5kIGEgY2xvc2UgZW5vdWdoIG1hdGNoLCBmYWlsCgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIElTTyAxODAwNDoyMDA2IEFubmV4IEUKCSAgICAgKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5idWlsZEZ1bmN0aW9uUGF0dGVybiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpOwoJICAgICAgICB2YXIgYml0TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDMuZGVmYXVsdChkaW1lbnNpb24pOwoJICAgICAgICAvLyBUb3AgbGVmdCBmaW5kZXIgcGF0dGVybiArIHNlcGFyYXRvciArIGZvcm1hdAoJICAgICAgICBiaXRNYXRyaXguc2V0UmVnaW9uKDAsIDAsIDksIDkpOwoJICAgICAgICAvLyBUb3AgcmlnaHQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbihkaW1lbnNpb24gLSA4LCAwLCA4LCA5KTsKCSAgICAgICAgLy8gQm90dG9tIGxlZnQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSA4LCA5LCA4KTsKCSAgICAgICAgLy8gQWxpZ25tZW50IHBhdHRlcm5zCgkgICAgICAgIHZhciBtYXggPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHgrKykgewoJICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzW3hdIC0gMjsKCSAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWF4OyB5KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoKHggPT09IDAgJiYgKHkgPT09IDAgfHwgeSA9PT0gbWF4IC0gMSkpIHx8ICh4ID09PSBtYXggLSAxICYmIHkgPT09IDApKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE5vIGFsaWdubWVudCBwYXR0ZXJucyBuZWFyIHRoZSB0aHJlZSBmaW5kZXIgcGF0dGVybnMKCSAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24odGhpcy5hbGlnbm1lbnRQYXR0ZXJuQ2VudGVyc1t5XSAtIDIsIGksIDUsIDUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFZlcnRpY2FsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oNiwgOSwgMSwgZGltZW5zaW9uIC0gMTcpOwoJICAgICAgICAvLyBIb3Jpem9udGFsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oOSwgNiwgZGltZW5zaW9uIC0gMTcsIDEpOwoJICAgICAgICBpZiAodGhpcy52ZXJzaW9uTnVtYmVyID4gNikgewoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCB0b3AgcmlnaHQKCSAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oZGltZW5zaW9uIC0gMTEsIDAsIDMsIDYpOwoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCBib3R0b20gbGVmdAoJICAgICAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSAxMSwgNiwgMyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICcnICsgdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgQW5uZXggRC4KCSAgICAgICAqIEVsZW1lbnQgaSByZXByZXNlbnRzIHRoZSByYXcgdmVyc2lvbiBiaXRzIHRoYXQgc3BlY2lmeSB2ZXJzaW9uIGkgKyA3CgkgICAgICAgKi8KCSAgICBWZXJzaW9uLlZFUlNJT05fREVDT0RFX0lORk8gPSBJbnQzMkFycmF5LmZyb20oWwoJICAgICAgICAweDA3Qzk0LCAweDA4NUJDLCAweDA5QTk5LCAweDBBNEQzLCAweDBCQkY2LAoJICAgICAgICAweDBDNzYyLCAweDBEODQ3LCAweDBFNjBELCAweDBGOTI4LCAweDEwQjc4LAoJICAgICAgICAweDExNDVELCAweDEyQTE3LCAweDEzNTMyLCAweDE0OUE2LCAweDE1NjgzLAoJICAgICAgICAweDE2OEM5LCAweDE3N0VDLCAweDE4RUM0LCAweDE5MUUxLCAweDFBRkFCLAoJICAgICAgICAweDFCMDhFLCAweDFDQzFBLCAweDFEMzNGLCAweDFFRDc1LCAweDFGMjUwLAoJICAgICAgICAweDIwOUQ1LCAweDIxNkYwLCAweDIyOEJBLCAweDIzNzlGLCAweDI0QjBCLAoJICAgICAgICAweDI1NDJFLCAweDI2QTY0LCAweDI3NTQxLCAweDI4QzY5CgkgICAgXSk7CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgNi41LjEgVGFibGUgOQoJICAgICAgICovCgkgICAgVmVyc2lvbi5WRVJTSU9OUyA9IFsKCSAgICAgICAgbmV3IFZlcnNpb24oMSwgbmV3IEludDMyQXJyYXkoMCksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOSkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMiwgSW50MzJBcnJheS5mcm9tKFs2LCAxOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDEwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMywgSW50MzJBcnJheS5mcm9tKFs2LCAyMl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE1LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1NSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA4MCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA5KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCA0MykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTIpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDYsIEludDMyQXJyYXkuZnJvbShbNiwgMzRdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDcsIEludDMyQXJyYXkuZnJvbShbNiwgMjIsIDM4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDc4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDMxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNCkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNCwgNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMzgpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzOSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxOCksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE5KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDksIEludDMyQXJyYXkuZnJvbShbNiwgMjYsIDQ2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAzNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDM3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTAsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDUwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDY4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxOSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDIwKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDExLCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA4MSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDUxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTIsIEludDMyQXJyYXkuZnJvbShbNiwgMzIsIDU4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDkyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMzYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDEzLCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2Ml0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMzcpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDEyLCAxMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDYsIDY2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA0MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDQxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDE3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNSwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDgsIDcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDg3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgODgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgNDEpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNiwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDk4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0NikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTkpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyMCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTcsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU0LCA3OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxMDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE4LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NiwgODJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIwKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDQzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxOSwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE5LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1OCwgODZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTE0KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDQ0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDQ1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDE3LCAyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDE0KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMCwgSW50MzJBcnJheS5mcm9tKFs2LCAzNCwgNjIsIDkwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDEwNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0MSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIxLCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1MCwgNzIsIDk0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDIpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIyLCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1MCwgNzQsIDk4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDExMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMywgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIxKSwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI0LCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1NCwgODAsIDEwNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTcpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMwLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE3KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyNSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMTA2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTA3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMjYsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzMsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI3LCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2MiwgOTAsIDExOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0LCA5OCwgMTIyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTYpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjEsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgzNywgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTIsIDc4LCAxMDQsIDEzMF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCA0NyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjMsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjUsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTYsIDgyLCAxMDgsIDEzNF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxMywgMTE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQyLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDI4LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzIsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYwLCA4NiwgMTEyLCAxMzhdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzUsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDM1LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzMsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzQsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYyLCA5MCwgMTE4LCAxNDZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNDQsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NCwgNzgsIDEwMiwgMTI2LCAxNTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDEyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMiwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgNDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzYsIEludDMyQXJyYXkuZnJvbShbNiwgMjQsIDUwLCA3NiwgMTAyLCAxMjgsIDE1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMjEpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDY0LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzcsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDU0LCA4MCwgMTA2LCAxMzIsIDE1OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIzKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDI5LCA0NiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCA0NykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0OSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjQsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNDYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzOCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTAsIDEzNiwgMTYyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE4LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzIsIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ4LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM5LCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1NCwgODIsIDExMCwgMTM4LCAxNjZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjAsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCg0MCwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNjcsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig0MCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTgsIDg2LCAxMTQsIDE0MiwgMTcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxMTgpLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyMCwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCg2MSwgMTYpKSkKCSAgICBdOwoJICAgIHJldHVybiBWZXJzaW9uOwoJfSgpKTsKCVZlcnNpb24kMS5kZWZhdWx0ID0gVmVyc2lvbjsKCgl2YXIgRGF0YU1hc2sgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5EYXRhTWFza1ZhbHVlcyA9IHZvaWQgMDsKCXZhciBEYXRhTWFza1ZhbHVlczsKCShmdW5jdGlvbiAoRGF0YU1hc2tWYWx1ZXMpIHsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAwMCJdID0gMF0gPSAiREFUQV9NQVNLXzAwMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18wMDEiXSA9IDFdID0gIkRBVEFfTUFTS18wMDEiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMDEwIl0gPSAyXSA9ICJEQVRBX01BU0tfMDEwIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAxMSJdID0gM10gPSAiREFUQV9NQVNLXzAxMSI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMDAiXSA9IDRdID0gIkRBVEFfTUFTS18xMDAiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMTAxIl0gPSA1XSA9ICJEQVRBX01BU0tfMTAxIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzExMCJdID0gNl0gPSAiREFUQV9NQVNLXzExMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMTEiXSA9IDddID0gIkRBVEFfTUFTS18xMTEiOwoJfSkoRGF0YU1hc2tWYWx1ZXMgPSBleHBvcnRzLkRhdGFNYXNrVmFsdWVzIHx8IChleHBvcnRzLkRhdGFNYXNrVmFsdWVzID0ge30pKTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGRhdGEgbWFza3MgZm9yIHRoZSBkYXRhIGJpdHMgaW4gYSBRUiBjb2RlLCBwZXIgSVNPIDE4MDA0OjIwMDYgNi44LiBJbXBsZW1lbnRhdGlvbnMKCSAqIG9mIHRoaXMgY2xhc3MgY2FuIHVuLW1hc2sgYSByYXcgQml0TWF0cml4LiBGb3Igc2ltcGxpY2l0eSwgdGhleSB3aWxsIHVubWFzayB0aGUgZW50aXJlIEJpdE1hdHJpeCwKCSAqIGluY2x1ZGluZyBhcmVhcyB1c2VkIGZvciBmaW5kZXIgcGF0dGVybnMsIHRpbWluZyBwYXR0ZXJucywgZXRjLiBUaGVzZSBhcmVhcyBzaG91bGQgYmUgdW51c2VkCgkgKiBhZnRlciB0aGUgcG9pbnQgdGhleSBhcmUgdW5tYXNrZWQgYW55d2F5LjwvcD4KCSAqCgkgKiA8cD5Ob3RlIHRoYXQgdGhlIGRpYWdyYW0gaW4gc2VjdGlvbiA2LjguMSBpcyBtaXNsZWFkaW5nIHNpbmNlIGl0IGluZGljYXRlcyB0aGF0IGkgaXMgY29sdW1uIHBvc2l0aW9uCgkgKiBhbmQgaiBpcyByb3cgcG9zaXRpb24uIEluIGZhY3QsIGFzIHRoZSB0ZXh0IHNheXMsIGkgaXMgcm93IHBvc2l0aW9uIGFuZCBqIGlzIGNvbHVtbiBwb3NpdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFNYXNrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNlZSBJU08gMTgwMDQ6MjAwNiA2LjguMQoJICAgIGZ1bmN0aW9uIERhdGFNYXNrKHZhbHVlLCBpc01hc2tlZCkgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuaXNNYXNrZWQgPSBpc01hc2tlZDsKCSAgICB9CgkgICAgLy8gRW5kIG9mIGVudW0gY29uc3RhbnRzLgoJICAgIC8qKgoJICAgICAqIDxwPkltcGxlbWVudGF0aW9ucyBvZiB0aGlzIG1ldGhvZCByZXZlcnNlIHRoZSBkYXRhIG1hc2tpbmcgcHJvY2VzcyBhcHBsaWVkIHRvIGEgUVIgQ29kZSBhbmQKCSAgICAgKiBtYWtlIGl0cyBiaXRzIHJlYWR5IHRvIHJlYWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGJpdHMgcmVwcmVzZW50YXRpb24gb2YgUVIgQ29kZSBiaXRzCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gb2YgUVIgQ29kZSwgcmVwcmVzZW50ZWQgYnkgYml0cywgYmVpbmcgdW5tYXNrZWQKCSAgICAgKi8KCSAgICBEYXRhTWFzay5wcm90b3R5cGUudW5tYXNrQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGRpbWVuc2lvbiAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGltZW5zaW9uOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5pc01hc2tlZChpLCBqKSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLmZsaXAoaiwgaSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBEYXRhTWFzay52YWx1ZXMgPSBuZXcgTWFwKFsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDAwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeCArIHkpIG1vZCAyID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDAwLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMCwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoKGkgKyBqKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeCBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMDEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgJiAweDAxKSA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMDEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoIHkgbW9kIDMgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuIGogJSAzID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKHggKyB5KSBtb2QgMyA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAxMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgKyBqKSAlIDMgPT09IDA7IH0pXSwKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDEwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeC8yICsgeS8zKSBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMCwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMDAsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKChNYXRoLmZsb29yKGkgLyAyKSArIE1hdGguZmxvb3IoaiAvIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeHkgbW9kIDIgKyB4eSBtb2QgMyA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2ID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTAxLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMSwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoaSAqIGopICUgNiA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMTEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoICh4eSBtb2QgMiArIHh5IG1vZCAzKSBtb2QgMiA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2IDwgMwoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSAqIGopICUgNikgPCAzOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKCh4K3kpbW9kIDIgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKiBlcXVpdmFsZW50bHksIHN1Y2ggdGhhdCAoeCArIHkgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTEsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTExLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSArIGogKyAoKGkgKiBqKSAlIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgXSk7CgkgICAgcmV0dXJuIERhdGFNYXNrOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IERhdGFNYXNrOwoKCX0oRGF0YU1hc2spKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdE1hdHJpeFBhcnNlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgVmVyc2lvbl8xJDEgPSBWZXJzaW9uJDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSA9IEZvcm1hdEluZm9ybWF0aW9uJDE7Cgl2YXIgRGF0YU1hc2tfMSA9IERhdGFNYXNrOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCS8qKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJpdE1hdHJpeFBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYml0TWF0cml4IHtAbGluayBCaXRNYXRyaXh9IHRvIHBhcnNlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCA+PSAyMSBhbmQgMSBtb2QgNAoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeFBhcnNlcihiaXRNYXRyaXgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IGJpdE1hdHJpeC5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiA8IDIxIHx8IChkaW1lbnNpb24gJiAweDAzKSAhPT0gMSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0TWF0cml4ID0gYml0TWF0cml4OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5SZWFkcyBmb3JtYXQgaW5mb3JtYXRpb24gZnJvbSBvbmUgb2YgaXRzIHR3byBsb2NhdGlvbnMgd2l0aGluIHRoZSBRUiBDb2RlLjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEZvcm1hdEluZm9ybWF0aW9ufSBlbmNhcHN1bGF0aW5nIHRoZSBRUiBDb2RlJ3MgZm9ybWF0IGluZm8KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIGZvcm1hdCBpbmZvcm1hdGlvbiBsb2NhdGlvbnMgY2Fubm90IGJlIHBhcnNlZCBhcwoJICAgICAqIHRoZSB2YWxpZCBlbmNvZGluZyBvZiBmb3JtYXQgaW5mb3JtYXRpb24KCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRGb3JtYXRJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgaWYgKHRoaXMucGFyc2VkRm9ybWF0SW5mbyAhPT0gbnVsbCAmJiB0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VkRm9ybWF0SW5mbzsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRvcC1sZWZ0IGZvcm1hdCBpbmZvIGJpdHMKCSAgICAgICAgdmFyIGZvcm1hdEluZm9CaXRzMSA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoaSwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyAuLiBhbmQgc2tpcCBhIGJpdCBpbiB0aGUgdGltaW5nIHBhdHRlcm4gLi4uCgkgICAgICAgIGZvcm1hdEluZm9CaXRzMSA9IHRoaXMuY29weUJpdCg3LCA4LCBmb3JtYXRJbmZvQml0czEpOwoJICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgZm9ybWF0SW5mb0JpdHMxID0gdGhpcy5jb3B5Qml0KDgsIDcsIGZvcm1hdEluZm9CaXRzMSk7CgkgICAgICAgIC8vIC4uIGFuZCBza2lwIGEgYml0IGluIHRoZSB0aW1pbmcgcGF0dGVybiAuLi4KCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgaiwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRoZSB0b3AtcmlnaHQvYm90dG9tLWxlZnQgcGF0dGVybiB0b28KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgZm9ybWF0SW5mb0JpdHMyID0gMDsKCSAgICAgICAgdmFyIGpNaW4gPSBkaW1lbnNpb24gLSA3OwoJICAgICAgICBmb3IgKHZhciBqID0gZGltZW5zaW9uIC0gMTsgaiA+PSBqTWluOyBqLS0pIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdCg4LCBqLCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIGZvciAodmFyIGkgPSBkaW1lbnNpb24gLSA4OyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdChpLCA4LCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uXzEuZGVmYXVsdC5kZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihmb3JtYXRJbmZvQml0czEsIGZvcm1hdEluZm9CaXRzMik7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZEZvcm1hdEluZm87CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+UmVhZHMgdmVyc2lvbiBpbmZvcm1hdGlvbiBmcm9tIG9uZSBvZiBpdHMgdHdvIGxvY2F0aW9ucyB3aXRoaW4gdGhlIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgVmVyc2lvbn0gZW5jYXBzdWxhdGluZyB0aGUgUVIgQ29kZSdzIHZlcnNpb24KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIHZlcnNpb24gaW5mb3JtYXRpb24gbG9jYXRpb25zIGNhbm5vdCBiZSBwYXJzZWQgYXMKCSAgICAgKiB0aGUgdmFsaWQgZW5jb2Rpbmcgb2YgdmVyc2lvbiBpbmZvcm1hdGlvbgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUucmVhZFZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZFZlcnNpb24gIT09IG51bGwgJiYgdGhpcy5wYXJzZWRWZXJzaW9uICE9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgcHJvdmlzaW9uYWxWZXJzaW9uID0gTWF0aC5mbG9vcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24gPD0gNikgewoJICAgICAgICAgICAgcmV0dXJuIFZlcnNpb25fMSQxLmRlZmF1bHQuZ2V0VmVyc2lvbkZvck51bWJlcihwcm92aXNpb25hbFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJlYWQgdG9wLXJpZ2h0IHZlcnNpb24gaW5mbzogMyB3aWRlIGJ5IDYgdGFsbAoJICAgICAgICB2YXIgdmVyc2lvbkJpdHMgPSAwOwoJICAgICAgICB2YXIgaWpNaW4gPSBkaW1lbnNpb24gLSAxMTsKCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gZGltZW5zaW9uIC0gOTsgaSA+PSBpak1pbjsgaS0tKSB7CgkgICAgICAgICAgICAgICAgdmVyc2lvbkJpdHMgPSB0aGlzLmNvcHlCaXQoaSwgaiwgdmVyc2lvbkJpdHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBmYWlsZWQuIFRyeSBib3R0b20gbGVmdDogNiB3aWRlIGJ5IDMgdGFsbAoJICAgICAgICB2ZXJzaW9uQml0cyA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSA1OyBpID49IDA7IGktLSkgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IGRpbWVuc2lvbiAtIDk7IGogPj0gaWpNaW47IGotLSkgewoJICAgICAgICAgICAgICAgIHZlcnNpb25CaXRzID0gdGhpcy5jb3B5Qml0KGksIGosIHZlcnNpb25CaXRzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5jb3B5Qml0ID0gZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovLCB2ZXJzaW9uQml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBiaXQgPSB0aGlzLmlzTWlycm9yID8gdGhpcy5iaXRNYXRyaXguZ2V0KGosIGkpIDogdGhpcy5iaXRNYXRyaXguZ2V0KGksIGopOwoJICAgICAgICByZXR1cm4gYml0ID8gKHZlcnNpb25CaXRzIDw8IDEpIHwgMHgxIDogdmVyc2lvbkJpdHMgPDwgMTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlJlYWRzIHRoZSBiaXRzIGluIHRoZSB7QGxpbmsgQml0TWF0cml4fSByZXByZXNlbnRpbmcgdGhlIGZpbmRlciBwYXR0ZXJuIGluIHRoZQoJICAgICAqIGNvcnJlY3Qgb3JkZXIgaW4gb3JkZXIgdG8gcmVjb25zdHJ1Y3QgdGhlIGNvZGV3b3JkcyBieXRlcyBjb250YWluZWQgd2l0aGluIHRoZQoJICAgICAqIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgZXhwZWN0ZWQgaXMgbm90IHJlYWQKCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBmb3JtYXRJbmZvID0gdGhpcy5yZWFkRm9ybWF0SW5mb3JtYXRpb24oKTsKCSAgICAgICAgdmFyIHZlcnNpb24gPSB0aGlzLnJlYWRWZXJzaW9uKCk7CgkgICAgICAgIC8vIEdldCB0aGUgZGF0YSBtYXNrIGZvciB0aGUgZm9ybWF0IHVzZWQgaW4gdGhpcyBRUiBDb2RlLiBUaGlzIHdpbGwgZXhjbHVkZQoJICAgICAgICAvLyBzb21lIGJpdHMgZnJvbSByZWFkaW5nIGFzIHdlIHdpbmQgdGhyb3VnaCB0aGUgYml0IG1hdHJpeC4KCSAgICAgICAgdmFyIGRhdGFNYXNrID0gRGF0YU1hc2tfMS5kZWZhdWx0LnZhbHVlcy5nZXQoZm9ybWF0SW5mby5nZXREYXRhTWFzaygpKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICBkYXRhTWFzay51bm1hc2tCaXRNYXRyaXgodGhpcy5iaXRNYXRyaXgsIGRpbWVuc2lvbik7CgkgICAgICAgIHZhciBmdW5jdGlvblBhdHRlcm4gPSB2ZXJzaW9uLmJ1aWxkRnVuY3Rpb25QYXR0ZXJuKCk7CgkgICAgICAgIHZhciByZWFkaW5nVXAgPSB0cnVlOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkodmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKTsKCSAgICAgICAgdmFyIHJlc3VsdE9mZnNldCA9IDA7CgkgICAgICAgIHZhciBjdXJyZW50Qnl0ZSA9IDA7CgkgICAgICAgIHZhciBiaXRzUmVhZCA9IDA7CgkgICAgICAgIC8vIFJlYWQgY29sdW1ucyBpbiBwYWlycywgZnJvbSByaWdodCB0byBsZWZ0CgkgICAgICAgIGZvciAodmFyIGogPSBkaW1lbnNpb24gLSAxOyBqID4gMDsgaiAtPSAyKSB7CgkgICAgICAgICAgICBpZiAoaiA9PT0gNikgewoJICAgICAgICAgICAgICAgIC8vIFNraXAgd2hvbGUgY29sdW1uIHdpdGggdmVydGljYWwgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgICAgICAgICAgICAvLyBzYXZlcyB0aW1lIGFuZCBtYWtlcyB0aGUgb3RoZXIgY29kZSBwcm9jZWVkIG1vcmUgY2xlYW5seQoJICAgICAgICAgICAgICAgIGotLTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFJlYWQgYWx0ZXJuYXRpbmdseSBmcm9tIGJvdHRvbSB0byB0b3AgdGhlbiB0b3AgdG8gYm90dG9tCgkgICAgICAgICAgICBmb3IgKHZhciBjb3VudCA9IDA7IGNvdW50IDwgZGltZW5zaW9uOyBjb3VudCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGkgPSByZWFkaW5nVXAgPyBkaW1lbnNpb24gLSAxIC0gY291bnQgOiBjb3VudDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCAyOyBjb2wrKykgewoJICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYml0cyBjb3ZlcmVkIGJ5IHRoZSBmdW5jdGlvbiBwYXR0ZXJuCgkgICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25QYXR0ZXJuLmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVhZCBhIGJpdAoJICAgICAgICAgICAgICAgICAgICAgICAgYml0c1JlYWQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIDw8PSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYml0TWF0cml4LmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIHw9IDE7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSd2ZSBtYWRlIGEgd2hvbGUgYnl0ZSwgc2F2ZSBpdCBvZmYKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzUmVhZCA9PT0gOCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRPZmZzZXQrK10gPSAvKihieXRlKSAqLyBjdXJyZW50Qnl0ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRzUmVhZCA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVhZGluZ1VwID0gIXJlYWRpbmdVcDsgLy8gcmVhZGluZ1VwIF49IHRydWU7IC8vIHJlYWRpbmdVcCA9ICFyZWFkaW5nVXA7IC8vIHN3aXRjaCBkaXJlY3Rpb25zCgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJlc3VsdE9mZnNldCAhPT0gdmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldmVydCB0aGUgbWFzayByZW1vdmFsIGRvbmUgd2hpbGUgcmVhZGluZyB0aGUgY29kZSB3b3Jkcy4gVGhlIGJpdCBtYXRyaXggc2hvdWxkIHJldmVydCB0byBpdHMgb3JpZ2luYWwgc3RhdGUuCgkgICAgICovCgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5yZW1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybjsgLy8gV2UgaGF2ZSBubyBmb3JtYXQgaW5mb3JtYXRpb24sIGFuZCBoYXZlIG5vIGRhdGEgbWFzawoJICAgICAgICB9CgkgICAgICAgIHZhciBkYXRhTWFzayA9IERhdGFNYXNrXzEuZGVmYXVsdC52YWx1ZXNbdGhpcy5wYXJzZWRGb3JtYXRJbmZvLmdldERhdGFNYXNrKCldOwoJICAgICAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5iaXRNYXRyaXguZ2V0SGVpZ2h0KCk7CgkgICAgICAgIGRhdGFNYXNrLnVubWFza0JpdE1hdHJpeCh0aGlzLmJpdE1hdHJpeCwgZGltZW5zaW9uKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFByZXBhcmUgdGhlIHBhcnNlciBmb3IgYSBtaXJyb3JlZCBvcGVyYXRpb24uCgkgICAgICogVGhpcyBmbGFnIGhhcyBlZmZlY3Qgb25seSBvbiB0aGUge0BsaW5rICNyZWFkRm9ybWF0SW5mb3JtYXRpb24oKX0gYW5kIHRoZQoJICAgICAqIHtAbGluayAjcmVhZFZlcnNpb24oKX0uIEJlZm9yZSBwcm9jZWVkaW5nIHdpdGgge0BsaW5rICNyZWFkQ29kZXdvcmRzKCl9IHRoZQoJICAgICAqIHtAbGluayAjbWlycm9yKCl9IG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLgoJICAgICAqCgkgICAgICogQHBhcmFtIG1pcnJvciBXaGV0aGVyIHRvIHJlYWQgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm9ybWF0aW9uIG1pcnJvcmVkLgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUuc2V0TWlycm9yID0gZnVuY3Rpb24gKGlzTWlycm9yKSB7CgkgICAgICAgIHRoaXMucGFyc2VkVmVyc2lvbiA9IG51bGw7CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IG51bGw7CgkgICAgICAgIHRoaXMuaXNNaXJyb3IgPSBpc01pcnJvcjsKCSAgICB9OwoJICAgIC8qKiBNaXJyb3IgdGhlIGJpdCBtYXRyaXggaW4gb3JkZXIgdG8gYXR0ZW1wdCBhIHNlY29uZCByZWFkaW5nLiAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUubWlycm9yID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgYml0TWF0cml4ID0gdGhpcy5iaXRNYXRyaXg7CgkgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IGJpdE1hdHJpeC5nZXRXaWR0aCgpOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgeSA9IHggKyAxLCBoZWlnaHQgPSBiaXRNYXRyaXguZ2V0SGVpZ2h0KCk7IHkgPCBoZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgICAgIGlmIChiaXRNYXRyaXguZ2V0KHgsIHkpICE9PSBiaXRNYXRyaXguZ2V0KHksIHgpKSB7CgkgICAgICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5mbGlwKHksIHgpOwoJICAgICAgICAgICAgICAgICAgICBiaXRNYXRyaXguZmxpcCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXhQYXJzZXI7Cgl9KCkpOwoJQml0TWF0cml4UGFyc2VyJDEuZGVmYXVsdCA9IEJpdE1hdHJpeFBhcnNlcjsKCgl2YXIgRGF0YUJsb2NrJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YUJsb2NrJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQxID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIGJsb2NrIG9mIGRhdGEgd2l0aGluIGEgUVIgQ29kZS4gUVIgQ29kZXMgbWF5IHNwbGl0IHRoZWlyIGRhdGEgaW50bwoJICogbXVsdGlwbGUgYmxvY2tzLCBlYWNoIG9mIHdoaWNoIGlzIGEgdW5pdCBvZiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3Jkcy4gRWFjaAoJICogaXMgcmVwcmVzZW50ZWQgYnkgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFCbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEYXRhQmxvY2sobnVtRGF0YUNvZGV3b3JkcyAvKmludCovLCBjb2Rld29yZHMpIHsKCSAgICAgICAgdGhpcy5udW1EYXRhQ29kZXdvcmRzID0gbnVtRGF0YUNvZGV3b3JkczsKCSAgICAgICAgdGhpcy5jb2Rld29yZHMgPSBjb2Rld29yZHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIDxwPldoZW4gUVIgQ29kZXMgdXNlIG11bHRpcGxlIGRhdGEgYmxvY2tzLCB0aGV5IGFyZSBhY3R1YWxseSBpbnRlcmxlYXZlZC4KCSAgICAgKiBUaGF0IGlzLCB0aGUgZmlyc3QgYnl0ZSBvZiBkYXRhIGJsb2NrIDEgdG8gbiBpcyB3cml0dGVuLCB0aGVuIHRoZSBzZWNvbmQgYnl0ZXMsIGFuZCBzbyBvbi4gVGhpcwoJICAgICAqIG1ldGhvZCB3aWxsIHNlcGFyYXRlIHRoZSBkYXRhIGludG8gb3JpZ2luYWwgYmxvY2tzLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByYXdDb2Rld29yZHMgYnl0ZXMgYXMgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBRUiBDb2RlCgkgICAgICogQHBhcmFtIHZlcnNpb24gdmVyc2lvbiBvZiB0aGUgUVIgQ29kZQoJICAgICAqIEBwYXJhbSBlY0xldmVsIGVycm9yLWNvcnJlY3Rpb24gbGV2ZWwgb2YgdGhlIFFSIENvZGUKCSAgICAgKiBAcmV0dXJuIERhdGFCbG9ja3MgY29udGFpbmluZyBvcmlnaW5hbCBieXRlcywgImRlLWludGVybGVhdmVkIiBmcm9tIHJlcHJlc2VudGF0aW9uIGluIHRoZQoJICAgICAqICAgICAgICAgUVIgQ29kZQoJICAgICAqLwoJICAgIERhdGFCbG9jay5nZXREYXRhQmxvY2tzID0gZnVuY3Rpb24gKHJhd0NvZGV3b3JkcywgdmVyc2lvbiwgZWNMZXZlbCkgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgaWYgKHJhd0NvZGV3b3Jkcy5sZW5ndGggIT09IHZlcnNpb24uZ2V0VG90YWxDb2Rld29yZHMoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIG51bWJlciBhbmQgc2l6ZSBvZiBkYXRhIGJsb2NrcyB1c2VkIGJ5IHRoaXMgdmVyc2lvbiBhbmQKCSAgICAgICAgLy8gZXJyb3IgY29ycmVjdGlvbiBsZXZlbAoJICAgICAgICB2YXIgZWNCbG9ja3MgPSB2ZXJzaW9uLmdldEVDQmxvY2tzRm9yTGV2ZWwoZWNMZXZlbCk7CgkgICAgICAgIC8vIEZpcnN0IGNvdW50IHRoZSB0b3RhbCBudW1iZXIgb2YgZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIHRvdGFsQmxvY2tzID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tBcnJheSA9IGVjQmxvY2tzLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY0Jsb2NrQXJyYXlfMSA9IF9fdmFsdWVzJDMoZWNCbG9ja0FycmF5KSwgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKTsgIWVjQmxvY2tBcnJheV8xXzEuZG9uZTsgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBlY0Jsb2NrID0gZWNCbG9ja0FycmF5XzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbEJsb2NrcyArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2NrQXJyYXlfMV8xICYmICFlY0Jsb2NrQXJyYXlfMV8xLmRvbmUgJiYgKF9hID0gZWNCbG9ja0FycmF5XzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2NrQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGVzdGFibGlzaCBEYXRhQmxvY2tzIG9mIHRoZSBhcHByb3ByaWF0ZSBzaXplIGFuZCBudW1iZXIgb2YgZGF0YSBjb2Rld29yZHMKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheSh0b3RhbEJsb2Nrcyk7CgkgICAgICAgIHZhciBudW1SZXN1bHRCbG9ja3MgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZWNCbG9ja0FycmF5XzIgPSBfX3ZhbHVlcyQzKGVjQmxvY2tBcnJheSksIGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCk7ICFlY0Jsb2NrQXJyYXlfMl8xLmRvbmU7IGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tBcnJheV8yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlY0Jsb2NrLmdldENvdW50KCk7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtRGF0YUNvZGV3b3JkcyA9IGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtQmxvY2tDb2Rld29yZHMgPSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCkgKyBudW1EYXRhQ29kZXdvcmRzOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHRbbnVtUmVzdWx0QmxvY2tzKytdID0gbmV3IERhdGFCbG9jayhudW1EYXRhQ29kZXdvcmRzLCBuZXcgVWludDhBcnJheShudW1CbG9ja0NvZGV3b3JkcykpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGVjQmxvY2tBcnJheV8yXzEgJiYgIWVjQmxvY2tBcnJheV8yXzEuZG9uZSAmJiAoX2IgPSBlY0Jsb2NrQXJyYXlfMi5yZXR1cm4pKSBfYi5jYWxsKGVjQmxvY2tBcnJheV8yKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8yKSB0aHJvdyBlXzIuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICAvLyBBbGwgYmxvY2tzIGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIGRhdGEsIGV4Y2VwdCB0aGF0IHRoZSBsYXN0IG4KCSAgICAgICAgLy8gKHdoZXJlIG4gbWF5IGJlIDApIGhhdmUgMSBtb3JlIGJ5dGUuIEZpZ3VyZSBvdXQgd2hlcmUgdGhlc2Ugc3RhcnQuCgkgICAgICAgIHZhciBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGxvbmdlckJsb2Nrc1N0YXJ0QXQgPSByZXN1bHQubGVuZ3RoIC0gMTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IGNoZWNrIGxlbmd0aCBpcyBjb3JyZWN0IGhlcmUKCSAgICAgICAgd2hpbGUgKGxvbmdlckJsb2Nrc1N0YXJ0QXQgPj0gMCkgewoJICAgICAgICAgICAgdmFyIG51bUNvZGV3b3JkcyA9IHJlc3VsdFtsb25nZXJCbG9ja3NTdGFydEF0XS5jb2Rld29yZHMubGVuZ3RoOwoJICAgICAgICAgICAgaWYgKG51bUNvZGV3b3JkcyA9PT0gc2hvcnRlckJsb2Nrc1RvdGFsQ29kZXdvcmRzKSB7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsb25nZXJCbG9ja3NTdGFydEF0LS07CgkgICAgICAgIH0KCSAgICAgICAgbG9uZ2VyQmxvY2tzU3RhcnRBdCsrOwoJICAgICAgICB2YXIgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHMgPSBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgLSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIC8vIFRoZSBsYXN0IGVsZW1lbnRzIG9mIHJlc3VsdCBtYXkgYmUgMSBlbGVtZW50IGxvbmdlcgoJICAgICAgICAvLyBmaXJzdCBmaWxsIG91dCBhcyBtYW55IGVsZW1lbnRzIGFzIGFsbCBvZiB0aGVtIGhhdmUKCSAgICAgICAgdmFyIHJhd0NvZGV3b3Jkc09mZnNldCA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1SZXN1bHRCbG9ja3M7IGorKykgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaV0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIEZpbGwgb3V0IHRoZSBsYXN0IGRhdGEgYmxvY2sgaW4gdGhlIGxvbmdlciBvbmVzCgkgICAgICAgIGZvciAodmFyIGogPSBsb25nZXJCbG9ja3NTdGFydEF0OyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHNdID0gcmF3Q29kZXdvcmRzW3Jhd0NvZGV3b3Jkc09mZnNldCsrXTsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cgYWRkIGluIGVycm9yIGNvcnJlY3Rpb24gYmxvY2tzCgkgICAgICAgIHZhciBtYXggPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IHNob3J0ZXJCbG9ja3NOdW1EYXRhQ29kZXdvcmRzOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgaU9mZnNldCA9IGogPCBsb25nZXJCbG9ja3NTdGFydEF0ID8gaSA6IGkgKyAxOwoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaU9mZnNldF0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldE51bURhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bURhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldENvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29kZXdvcmRzOwoJICAgIH07CgkgICAgcmV0dXJuIERhdGFCbG9jazsKCX0oKSk7CglEYXRhQmxvY2skMS5kZWZhdWx0ID0gRGF0YUJsb2NrOwoKCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEgPSB7fTsKCgl2YXIgQml0U291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdFNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbiB7Ki8KCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIHByb3ZpZGVzIGFuIGVhc3kgYWJzdHJhY3Rpb24gdG8gcmVhZCBiaXRzIGF0IGEgdGltZSBmcm9tIGEgc2VxdWVuY2Ugb2YgYnl0ZXMsIHdoZXJlIHRoZQoJICogbnVtYmVyIG9mIGJpdHMgcmVhZCBpcyBub3Qgb2Z0ZW4gYSBtdWx0aXBsZSBvZiA4LjwvcD4KCSAqCgkgKiA8cD5UaGlzIGNsYXNzIGlzIHRocmVhZC1zYWZlIGJ1dCBub3QgcmVlbnRyYW50IC0tIHVubGVzcyB0aGUgY2FsbGVyIG1vZGlmaWVzIHRoZSBieXRlcyBhcnJheQoJICogaXQgcGFzc2VkIGluLCBpbiB3aGljaCBjYXNlIGFsbCBiZXRzIGFyZSBvZmYuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBCaXRTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJ5dGVzIGJ5dGVzIGZyb20gd2hpY2ggdGhpcyB3aWxsIHJlYWQgYml0cy4gQml0cyB3aWxsIGJlIHJlYWQgZnJvbSB0aGUgZmlyc3QgYnl0ZSBmaXJzdC4KCSAgICAgKiBCaXRzIGFyZSByZWFkIHdpdGhpbiBhIGJ5dGUgZnJvbSBtb3N0LXNpZ25pZmljYW50IHRvIGxlYXN0LXNpZ25pZmljYW50IGJpdC4KCSAgICAgKi8KCSAgICBmdW5jdGlvbiBCaXRTb3VyY2UoYnl0ZXMpIHsKCSAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwOwoJICAgICAgICB0aGlzLmJpdE9mZnNldCA9IDA7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaW5kZXggb2YgbmV4dCBiaXQgaW4gY3VycmVudCBieXRlIHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qml0T2Zmc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRPZmZzZXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgYnl0ZSBpbiBpbnB1dCBieXRlIGFycmF5IHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qnl0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBudW1CaXRzIG51bWJlciBvZiBiaXRzIHRvIHJlYWQKCSAgICAgKiBAcmV0dXJuIGludCByZXByZXNlbnRpbmcgdGhlIGJpdHMgcmVhZC4gVGhlIGJpdHMgd2lsbCBhcHBlYXIgYXMgdGhlIGxlYXN0LXNpZ25pZmljYW50CgkgICAgICogICAgICAgICBiaXRzIG9mIHRoZSBpbnQKCSAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBudW1CaXRzIGlzbid0IGluIFsxLDMyXSBvciBtb3JlIHRoYW4gaXMgYXZhaWxhYmxlCgkgICAgICovCgkgICAgQml0U291cmNlLnByb3RvdHlwZS5yZWFkQml0cyA9IGZ1bmN0aW9uIChudW1CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPCAxIHx8IG51bUJpdHMgPiAzMiB8fCBudW1CaXRzID4gdGhpcy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoJycgKyBudW1CaXRzKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVzdWx0ID0gMDsKCSAgICAgICAgdmFyIGJpdE9mZnNldCA9IHRoaXMuYml0T2Zmc2V0OwoJICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IHRoaXMuYnl0ZU9mZnNldDsKCSAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKCSAgICAgICAgLy8gRmlyc3QsIHJlYWQgcmVtYWluZGVyIGZyb20gY3VycmVudCBieXRlCgkgICAgICAgIGlmIChiaXRPZmZzZXQgPiAwKSB7CgkgICAgICAgICAgICB2YXIgYml0c0xlZnQgPSA4IC0gYml0T2Zmc2V0OwoJICAgICAgICAgICAgdmFyIHRvUmVhZCA9IG51bUJpdHMgPCBiaXRzTGVmdCA/IG51bUJpdHMgOiBiaXRzTGVmdDsKCSAgICAgICAgICAgIHZhciBiaXRzVG9Ob3RSZWFkID0gYml0c0xlZnQgLSB0b1JlYWQ7CgkgICAgICAgICAgICB2YXIgbWFzayA9ICgweEZGID4+ICg4IC0gdG9SZWFkKSkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgIHJlc3VsdCA9IChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQ7CgkgICAgICAgICAgICBudW1CaXRzIC09IHRvUmVhZDsKCSAgICAgICAgICAgIGJpdE9mZnNldCArPSB0b1JlYWQ7CgkgICAgICAgICAgICBpZiAoYml0T2Zmc2V0ID09PSA4KSB7CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0ID0gMDsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTmV4dCByZWFkIHdob2xlIGJ5dGVzCgkgICAgICAgIGlmIChudW1CaXRzID4gMCkgewoJICAgICAgICAgICAgd2hpbGUgKG51bUJpdHMgPj0gOCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgPDwgOCkgfCAoYnl0ZXNbYnl0ZU9mZnNldF0gJiAweEZGKTsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICAgICAgbnVtQml0cyAtPSA4OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gRmluYWxseSByZWFkIGEgcGFydGlhbCBieXRlCgkgICAgICAgICAgICBpZiAobnVtQml0cyA+IDApIHsKCSAgICAgICAgICAgICAgICB2YXIgYml0c1RvTm90UmVhZCA9IDggLSBudW1CaXRzOwoJICAgICAgICAgICAgICAgIHZhciBtYXNrID0gKDB4RkYgPj4gYml0c1RvTm90UmVhZCkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0IDw8IG51bUJpdHMpIHwgKChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQpOwoJICAgICAgICAgICAgICAgIGJpdE9mZnNldCArPSBudW1CaXRzOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0T2Zmc2V0ID0gYml0T2Zmc2V0OwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBieXRlT2Zmc2V0OwoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB0aGF0IGNhbiBiZSByZWFkIHN1Y2Nlc3NmdWxseQoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gOCAqICh0aGlzLmJ5dGVzLmxlbmd0aCAtIHRoaXMuYnl0ZU9mZnNldCkgLSB0aGlzLmJpdE9mZnNldDsKCSAgICB9OwoJICAgIHJldHVybiBCaXRTb3VyY2U7Cgl9KCkpOwoJQml0U291cmNlJDEuZGVmYXVsdCA9IEJpdFNvdXJjZTsKCgl2YXIgRGVjb2RlclJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVyUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBtYXRyaXggb2YgYml0cy4gVGhpcyB0eXBpY2FsbHkKCSAqIGFwcGxpZXMgdG8gMkQgYmFyY29kZSBmb3JtYXRzLiBGb3Igbm93IGl0IGNvbnRhaW5zIHRoZSByYXcgYnl0ZXMgb2J0YWluZWQsCgkgKiBhcyB3ZWxsIGFzIGEgU3RyaW5nIGludGVycHJldGF0aW9uIG9mIHRob3NlIGJ5dGVzLCBpZiBhcHBsaWNhYmxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlclJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocmF3Qnl0ZXM6IFVpbnQ4QXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIExpc3Q8VWludDhBcnJheT4gYnl0ZVNlZ21lbnRzLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBlY0xldmVsKSB7CgkgICAgLy8gICB0aGlzKHJhd0J5dGVzLCB0ZXh0LCBieXRlU2VnbWVudHMsIGVjTGV2ZWwsIC0xLCAtMSkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRGVjb2RlclJlc3VsdChyYXdCeXRlcywgdGV4dCwgYnl0ZVNlZ21lbnRzLCBlY0xldmVsLCBzdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXIsIHN0cnVjdHVyZWRBcHBlbmRQYXJpdHkpIHsKCSAgICAgICAgaWYgKHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9PT0gdm9pZCAwKSB7IHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9IC0xOyB9CgkgICAgICAgIGlmIChzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID09PSB2b2lkIDApIHsgc3RydWN0dXJlZEFwcGVuZFBhcml0eSA9IC0xOyB9CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKCSAgICAgICAgdGhpcy5ieXRlU2VnbWVudHMgPSBieXRlU2VnbWVudHM7CgkgICAgICAgIHRoaXMuZWNMZXZlbCA9IGVjTGV2ZWw7CgkgICAgICAgIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyOwoJICAgICAgICB0aGlzLnN0cnVjdHVyZWRBcHBlbmRQYXJpdHkgPSBzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCB8fCByYXdCeXRlcyA9PT0gbnVsbCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiByYXcgYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSByZXN1bHQsIG9yIHtAY29kZSBudWxsfSBpZiBub3QgYXBwbGljYWJsZQoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldE51bUJpdHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bUJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gbnVtQml0cyBvdmVycmlkZXMgdGhlIG51bWJlciBvZiBiaXRzIHRoYXQgYXJlIHZhbGlkIGluIHtAbGluayAjZ2V0UmF3Qnl0ZXMoKX0KCSAgICAgKiBAc2luY2UgMy4zLjAKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXROdW1CaXRzID0gZnVuY3Rpb24gKG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLm51bUJpdHMgPSBudW1CaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZXN1bHQKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRUZXh0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50ZXh0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBsaXN0IG9mIGJ5dGUgc2VnbWVudHMgaW4gdGhlIHJlc3VsdCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0Qnl0ZVNlZ21lbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5ieXRlU2VnbWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG5hbWUgb2YgZXJyb3IgY29ycmVjdGlvbiBsZXZlbCB1c2VkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFQ0xldmVsID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0xldmVsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJyb3JzIGNvcnJlY3RlZCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0RXJyb3JzQ29ycmVjdGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnNDb3JyZWN0ZWQ7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcnJvcnNDb3JyZWN0ZWQgPSBmdW5jdGlvbiAoZXJyb3JzQ29ycmVjdGVkIC8qSW50ZWdlciovKSB7CgkgICAgICAgIHRoaXMuZXJyb3JzQ29ycmVjdGVkID0gZXJyb3JzQ29ycmVjdGVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJhc3VyZXMgY29ycmVjdGVkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFcmFzdXJlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJhc3VyZXM7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcmFzdXJlcyA9IGZ1bmN0aW9uIChlcmFzdXJlcyAvKkludGVnZXIqLykgewoJICAgICAgICB0aGlzLmVyYXN1cmVzID0gZXJhc3VyZXM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGFyYml0cmFyeSBhZGRpdGlvbmFsIG1ldGFkYXRhCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0T3RoZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuc2V0T3RoZXIgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdGhpcy5vdGhlciA9IG90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuaGFzU3RydWN0dXJlZEFwcGVuZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc3RydWN0dXJlZEFwcGVuZFBhcml0eSA+PSAwICYmIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID49IDA7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRTdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXI7CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlclJlc3VsdDsKCX0oKSk7CglEZWNvZGVyUmVzdWx0JDEuZGVmYXVsdCA9IERlY29kZXJSZXN1bHQ7CgoJdmFyIE1vZGUgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5Nb2RlVmFsdWVzID0gdm9pZCAwOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgTW9kZVZhbHVlczsKCShmdW5jdGlvbiAoTW9kZVZhbHVlcykgewoJICAgIE1vZGVWYWx1ZXNbTW9kZVZhbHVlc1siVEVSTUlOQVRPUiJdID0gMF0gPSAiVEVSTUlOQVRPUiI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJOVU1FUklDIl0gPSAxXSA9ICJOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkFMUEhBTlVNRVJJQyJdID0gMl0gPSAiQUxQSEFOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIlNUUlVDVFVSRURfQVBQRU5EIl0gPSAzXSA9ICJTVFJVQ1RVUkVEX0FQUEVORCI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJCWVRFIl0gPSA0XSA9ICJCWVRFIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkVDSSJdID0gNV0gPSAiRUNJIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIktBTkpJIl0gPSA2XSA9ICJLQU5KSSI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJGTkMxX0ZJUlNUX1BPU0lUSU9OIl0gPSA3XSA9ICJGTkMxX0ZJUlNUX1BPU0lUSU9OIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkZOQzFfU0VDT05EX1BPU0lUSU9OIl0gPSA4XSA9ICJGTkMxX1NFQ09ORF9QT1NJVElPTiI7CgkgICAgLyoqIFNlZSBHQlQgMTgyODQtMjAwMDsgIkhhbnppIiBpcyBhIHRyYW5zbGl0ZXJhdGlvbiBvZiB0aGlzIG1vZGUgbmFtZS4gKi8KCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkhBTlpJIl0gPSA5XSA9ICJIQU5aSSI7Cgl9KShNb2RlVmFsdWVzID0gZXhwb3J0cy5Nb2RlVmFsdWVzIHx8IChleHBvcnRzLk1vZGVWYWx1ZXMgPSB7fSkpOwoJLyoqCgkgKiA8cD5TZWUgSVNPIDE4MDA0OjIwMDYsIDYuNC4xLCBUYWJsZXMgMiBhbmQgMy4gVGhpcyBlbnVtIGVuY2Fwc3VsYXRlcyB0aGUgdmFyaW91cyBtb2RlcyBpbiB3aGljaAoJICogZGF0YSBjYW4gYmUgZW5jb2RlZCB0byBiaXRzIGluIHRoZSBRUiBjb2RlIHN0YW5kYXJkLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgTW9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBNb2RlKHZhbHVlLCBzdHJpbmdWYWx1ZSwgY2hhcmFjdGVyQ291bnRCaXRzRm9yVmVyc2lvbnMsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9ucyA9IGNoYXJhY3RlckNvdW50Qml0c0ZvclZlcnNpb25zOwoJICAgICAgICB0aGlzLmJpdHMgPSBiaXRzOwoJICAgICAgICBNb2RlLkZPUl9CSVRTLnNldChiaXRzLCB0aGlzKTsKCSAgICAgICAgTW9kZS5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgZm91ciBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSBkYXRhIG1vZGUKCSAgICAgKiBAcmV0dXJuIE1vZGUgZW5jb2RlZCBieSB0aGVzZSBiaXRzCgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYml0cyBkbyBub3QgY29ycmVzcG9uZCB0byBhIGtub3duIG1vZGUKCSAgICAgKi8KCSAgICBNb2RlLmZvckJpdHMgPSBmdW5jdGlvbiAoYml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBtb2RlID0gTW9kZS5GT1JfQklUUy5nZXQoYml0cyk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IG1vZGUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1vZGU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmVyc2lvbiB2ZXJzaW9uIGluIHF1ZXN0aW9uCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB1c2VkLCBpbiB0aGlzIFFSIENvZGUgc3ltYm9sIHtAbGluayBWZXJzaW9ufSwgdG8gZW5jb2RlIHRoZQoJICAgICAqICAgICAgICAgY291bnQgb2YgY2hhcmFjdGVycyB0aGF0IHdpbGwgZm9sbG93IGVuY29kZWQgaW4gdGhpcyBNb2RlCgkgICAgICovCgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Q2hhcmFjdGVyQ291bnRCaXRzID0gZnVuY3Rpb24gKHZlcnNpb24pIHsKCSAgICAgICAgdmFyIHZlcnNpb25OdW1iZXIgPSB2ZXJzaW9uLmdldFZlcnNpb25OdW1iZXIoKTsKCSAgICAgICAgdmFyIG9mZnNldDsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPD0gOSkgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmICh2ZXJzaW9uTnVtYmVyIDw9IDI2KSB7CgkgICAgICAgICAgICBvZmZzZXQgPSAxOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9uc1tvZmZzZXRdOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNb2RlKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZTsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIE1vZGUuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5GT1JfVkFMVUUgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5URVJNSU5BVE9SID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5URVJNSU5BVE9SLCAnVEVSTUlOQVRPUicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDAwKTsgLy8gTm90IHJlYWxseSBhIG1vZGUuLi4KCSAgICBNb2RlLk5VTUVSSUMgPSBuZXcgTW9kZShNb2RlVmFsdWVzLk5VTUVSSUMsICdOVU1FUklDJywgSW50MzJBcnJheS5mcm9tKFsxMCwgMTIsIDE0XSksIDB4MDEpOwoJICAgIE1vZGUuQUxQSEFOVU1FUklDID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5BTFBIQU5VTUVSSUMsICdBTFBIQU5VTUVSSUMnLCBJbnQzMkFycmF5LmZyb20oWzksIDExLCAxM10pLCAweDAyKTsKCSAgICBNb2RlLlNUUlVDVFVSRURfQVBQRU5EID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5TVFJVQ1RVUkVEX0FQUEVORCwgJ1NUUlVDVFVSRURfQVBQRU5EJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDMpOyAvLyBOb3Qgc3VwcG9ydGVkCgkgICAgTW9kZS5CWVRFID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5CWVRFLCAnQllURScsIEludDMyQXJyYXkuZnJvbShbOCwgMTYsIDE2XSksIDB4MDQpOwoJICAgIE1vZGUuRUNJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5FQ0ksICdFQ0knLCBJbnQzMkFycmF5LmZyb20oWzAsIDAsIDBdKSwgMHgwNyk7IC8vIGNoYXJhY3RlciBjb3VudHMgZG9uJ3QgYXBwbHkKCSAgICBNb2RlLktBTkpJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5LQU5KSSwgJ0tBTkpJJywgSW50MzJBcnJheS5mcm9tKFs4LCAxMCwgMTJdKSwgMHgwOCk7CgkgICAgTW9kZS5GTkMxX0ZJUlNUX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX0ZJUlNUX1BPU0lUSU9OLCAnRk5DMV9GSVJTVF9QT1NJVElPTicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDA1KTsKCSAgICBNb2RlLkZOQzFfU0VDT05EX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX1NFQ09ORF9QT1NJVElPTiwgJ0ZOQzFfU0VDT05EX1BPU0lUSU9OJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDkpOwoJICAgIC8qKiBTZWUgR0JUIDE4Mjg0LTIwMDA7ICJIYW56aSIgaXMgYSB0cmFuc2xpdGVyYXRpb24gb2YgdGhpcyBtb2RlIG5hbWUuICovCgkgICAgTW9kZS5IQU5aSSA9IG5ldyBNb2RlKE1vZGVWYWx1ZXMuSEFOWkksICdIQU5aSScsIEludDMyQXJyYXkuZnJvbShbOCwgMTAsIDEyXSksIDB4MEQpOwoJICAgIHJldHVybiBNb2RlOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IE1vZGU7CgoJfShNb2RlKSk7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlLmRlY29kZXIgeyovCgl2YXIgQml0U291cmNlXzEgPSBCaXRTb3VyY2UkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSA9IENoYXJhY3RlclNldEVDSTsKCXZhciBEZWNvZGVyUmVzdWx0XzEgPSBEZWNvZGVyUmVzdWx0JDE7Cgl2YXIgU3RyaW5nVXRpbHNfMSA9IFN0cmluZ1V0aWxzJDE7Cgl2YXIgRm9ybWF0RXhjZXB0aW9uXzEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBTdHJpbmdCdWlsZGVyXzEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgU3RyaW5nRW5jb2RpbmdfMSA9IFN0cmluZ0VuY29kaW5nJDE7Cgl2YXIgTW9kZV8xID0gTW9kZTsKCS8qaW1wb3J0IGphdmEuaW8uVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbjsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlFSIENvZGVzIGNhbiBlbmNvZGUgdGV4dCBhcyBiaXRzIGluIG9uZSBvZiBzZXZlcmFsIG1vZGVzLCBhbmQgY2FuIHVzZSBtdWx0aXBsZSBtb2RlcwoJICogaW4gb25lIFFSIENvZGUuIFRoaXMgY2xhc3MgZGVjb2RlcyB0aGUgYml0cyBiYWNrIGludG8gdGV4dC48L3A+CgkgKgoJICogPHA+U2VlIElTTyAxODAwNDoyMDA2LCA2LjQuMyAtIDYuNC43PC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERlY29kZWRCaXRTdHJlYW1QYXJzZXIoKSB7CgkgICAgfQoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlID0gZnVuY3Rpb24gKGJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cykgewoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRTb3VyY2VfMS5kZWZhdWx0KGJ5dGVzKTsKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWlsZGVyXzEuZGVmYXVsdCgpOwoJICAgICAgICB2YXIgYnl0ZVNlZ21lbnRzID0gbmV3IEFycmF5KCk7IC8vIDEKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IEkgZG8gbm90IHVzZSBjb25zdHJ1Y3RvciB3aXRoIHNpemUgMSBhcyBpbiBvcmlnaW5hbCBKYXZhIG1lYW5zIGNhcGFjaXR5IGFuZCB0aGUgYXJyYXkgbGVuZ3RoIGlzIGNoZWNrZWQgYmVsb3cKCSAgICAgICAgdmFyIHN5bWJvbFNlcXVlbmNlID0gLTE7CgkgICAgICAgIHZhciBwYXJpdHlEYXRhID0gLTE7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICB2YXIgY3VycmVudENoYXJhY3RlclNldEVDSSA9IG51bGw7CgkgICAgICAgICAgICB2YXIgZmMxSW5FZmZlY3QgPSBmYWxzZTsKCSAgICAgICAgICAgIHZhciBtb2RlID0gdm9pZCAwOwoJICAgICAgICAgICAgZG8gewoJICAgICAgICAgICAgICAgIC8vIFdoaWxlIHN0aWxsIGFub3RoZXIgc2VnbWVudCB0byByZWFkLi4uCgkgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA0KSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE9LLCBhc3N1bWUgd2UncmUgZG9uZS4gUmVhbGx5LCBhIFRFUk1JTkFUT1IgbW9kZSBzaG91bGQgaGF2ZSBiZWVuIHJlY29yZGVkIGhlcmUKCSAgICAgICAgICAgICAgICAgICAgbW9kZSA9IE1vZGVfMS5kZWZhdWx0LlRFUk1JTkFUT1I7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZUJpdHMgPSBiaXRzLnJlYWRCaXRzKDQpOwoJICAgICAgICAgICAgICAgICAgICBtb2RlID0gTW9kZV8xLmRlZmF1bHQuZm9yQml0cyhtb2RlQml0cyk7IC8vIG1vZGUgaXMgZW5jb2RlZCBieSA0IGJpdHMKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUjoKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkZOQzFfRklSU1RfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuRk5DMV9TRUNPTkRfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkbyBsaXR0bGUgd2l0aCBGTkMxIGV4Y2VwdCBhbHRlciB0aGUgcGFyc2VkIHJlc3VsdCBhIGJpdCBhY2NvcmRpbmcgdG8gdGhlIHNwZWMKCSAgICAgICAgICAgICAgICAgICAgICAgIGZjMUluRWZmZWN0ID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LlNUUlVDVFVSRURfQVBQRU5EOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXIgYW5kIHBhcml0eSBpcyBhZGRlZCBsYXRlciB0byB0aGUgcmVzdWx0IG1ldGFkYXRhCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIG5leHQgOCBiaXRzIChzeW1ib2wgc2VxdWVuY2UgIykgYW5kIDggYml0cyAoZGF0YTogcGFyaXR5KSwgdGhlbiBjb250aW51ZQoJICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VxdWVuY2UgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcGFyaXR5RGF0YSA9IGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5FQ0k6CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VudCBkb2Vzbid0IGFwcGx5IHRvIEVDSQoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5wYXJzZUVDSVZhbHVlKGJpdHMpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXJhY3RlclNldEVDSSA9IENoYXJhY3RlclNldEVDSV8xLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlWYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5IQU5aSToKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGhhbmRsZSBIYW56aSBtb2RlIHdoaWNoIGRvZXMgbm90IHN0YXJ0IHdpdGggY2hhcmFjdGVyIGNvdW50CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGluZXNlIG1vZGUgY29udGFpbnMgYSBzdWIgc2V0IGluZGljYXRvciByaWdodCBhZnRlciBtb2RlIGluZGljYXRvcgoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNldCA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRIYW56aSA9IGJpdHMucmVhZEJpdHMobW9kZS5nZXRDaGFyYWN0ZXJDb3VudEJpdHModmVyc2lvbikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNldCA9PT0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVIYW56aVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudEhhbnppKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gIk5vcm1hbCIgUVIgY29kZSBtb2RlczoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvdyBtYW55IGNoYXJhY3RlcnMgd2lsbCBmb2xsb3csIGVuY29kZWQgaW4gdGhpcyBtb2RlPwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gYml0cy5yZWFkQml0cyhtb2RlLmdldENoYXJhY3RlckNvdW50Qml0cyh2ZXJzaW9uKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0Lk5VTUVSSUM6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlTnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuQUxQSEFOVU1FUklDOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgZmMxSW5FZmZlY3QpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkJZVEU6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgY3VycmVudENoYXJhY3RlclNldEVDSSwgYnl0ZVNlZ21lbnRzLCBoaW50cyk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuS0FOSkk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlS2FuamlTZWdtZW50KGJpdHMsIHJlc3VsdCwgY291bnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSB3aGlsZSAobW9kZSAhPT0gTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUik7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlhZSAvKjogSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIGZyb20gcmVhZEJpdHMoKSBjYWxscwoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbmV3IERlY29kZXJSZXN1bHRfMS5kZWZhdWx0KGJ5dGVzLCByZXN1bHQudG9TdHJpbmcoKSwgYnl0ZVNlZ21lbnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBieXRlU2VnbWVudHMsIGVjTGV2ZWwgPT09IG51bGwgPyBudWxsIDogZWNMZXZlbC50b1N0cmluZygpLCBzeW1ib2xTZXF1ZW5jZSwgcGFyaXR5RGF0YSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZWUgc3BlY2lmaWNhdGlvbiBHQlQgMTgyODQtMjAwMAoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlSGFuemlTZWdtZW50ID0gZnVuY3Rpb24gKGJpdHMsIHJlc3VsdCwgY291bnQgLyppbnQqLykgewoJICAgICAgICAvLyBEb24ndCBjcmFzaCB0cnlpbmcgdG8gcmVhZCBtb3JlIGJpdHMgdGhhbiB3ZSBoYXZlIGF2YWlsYWJsZS4KCSAgICAgICAgaWYgKGNvdW50ICogMTMgPiBiaXRzLmF2YWlsYWJsZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhY2ggY2hhcmFjdGVyIHdpbGwgcmVxdWlyZSAyIGJ5dGVzLiBSZWFkIHRoZSBjaGFyYWN0ZXJzIGFzIDItYnl0ZSBwYWlycwoJICAgICAgICAvLyBhbmQgZGVjb2RlIGFzIEdCMjMxMiBhZnRlcndhcmRzCgkgICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSgyICogY291bnQpOwoJICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCSAgICAgICAgd2hpbGUgKGNvdW50ID4gMCkgewoJICAgICAgICAgICAgLy8gRWFjaCAxMyBiaXRzIGVuY29kZXMgYSAyLWJ5dGUgY2hhcmFjdGVyCgkgICAgICAgICAgICB2YXIgdHdvQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDEzKTsKCSAgICAgICAgICAgIHZhciBhc3NlbWJsZWRUd29CeXRlcyA9ICgoKHR3b0J5dGVzIC8gMHgwNjApIDw8IDgpICYgMHhGRkZGRkZGRikgfCAodHdvQnl0ZXMgJSAweDA2MCk7CgkgICAgICAgICAgICBpZiAoYXNzZW1ibGVkVHdvQnl0ZXMgPCAweDAwM0JGKSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QTFBMSB0byAweEFBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBMUExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QjBBMSB0byAweEZBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBNkExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gPSAvKihieXRlKSAqLyAoKGFzc2VtYmxlZFR3b0J5dGVzID4+IDgpICYgMHhGRik7CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0ICsgMV0gPSAvKihieXRlKSAqLyAoYXNzZW1ibGVkVHdvQnl0ZXMgJiAweEZGKTsKCSAgICAgICAgICAgIG9mZnNldCArPSAyOwoJICAgICAgICAgICAgY291bnQtLTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKGJ1ZmZlciwgU3RyaW5nVXRpbHNfMS5kZWZhdWx0LkdCMjMxMikpOwoJICAgICAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IFRPRE86IGltcGxlbWVudCBHQjIzMTIgZGVjb2RlLiBTdHJpbmdWaWV3IGZyb20gTUROIGNvdWxkIGJlIGEgc3RhcnRpbmcgcG9pbnQKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVLYW5qaVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoY291bnQgKiAxMyA+IGJpdHMuYXZhaWxhYmxlKCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRWFjaCBjaGFyYWN0ZXIgd2lsbCByZXF1aXJlIDIgYnl0ZXMuIFJlYWQgdGhlIGNoYXJhY3RlcnMgYXMgMi1ieXRlIHBhaXJzCgkgICAgICAgIC8vIGFuZCBkZWNvZGUgYXMgU2hpZnRfSklTIGFmdGVyd2FyZHMKCSAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDIgKiBjb3VudCk7CgkgICAgICAgIHZhciBvZmZzZXQgPSAwOwoJICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEzIGJpdHMgZW5jb2RlcyBhIDItYnl0ZSBjaGFyYWN0ZXIKCSAgICAgICAgICAgIHZhciB0d29CeXRlcyA9IGJpdHMucmVhZEJpdHMoMTMpOwoJICAgICAgICAgICAgdmFyIGFzc2VtYmxlZFR3b0J5dGVzID0gKCgodHdvQnl0ZXMgLyAweDBDMCkgPDwgOCkgJiAweEZGRkZGRkZGKSB8ICh0d29CeXRlcyAlIDB4MEMwKTsKCSAgICAgICAgICAgIGlmIChhc3NlbWJsZWRUd29CeXRlcyA8IDB4MDFGMDApIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHg4MTQwIHRvIDB4OUZGQyByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MDgxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHhFMDQwIHRvIDB4RUJCRiByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MEMxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSA9IC8qKGJ5dGUpICovIChhc3NlbWJsZWRUd29CeXRlcyA+PiA4KTsKCSAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyAxXSA9IC8qKGJ5dGUpICovIGFzc2VtYmxlZFR3b0J5dGVzOwoJICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CgkgICAgICAgICAgICBjb3VudC0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNoaWZ0X0pJUyBtYXkgbm90IGJlIHN1cHBvcnRlZCBpbiBzb21lIGVudmlyb25tZW50czoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoU3RyaW5nRW5jb2RpbmdfMS5kZWZhdWx0LmRlY29kZShidWZmZXIsIFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5TSElGVF9KSVMpKTsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBUT0RPOiBpbXBsZW1lbnQgU0hJRlRfSklTIGRlY29kZS4gU3RyaW5nVmlldyBmcm9tIE1ETiBjb3VsZCBiZSBhIHN0YXJ0aW5nIHBvaW50CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoaWdub3JlZCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLCBieXRlU2VnbWVudHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoOCAqIGNvdW50ID4gYml0cy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVhZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCSAgICAgICAgICAgIHJlYWRCeXRlc1tpXSA9IC8qKGJ5dGUpICovIGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVuY29kaW5nOwoJICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgLy8gVGhlIHNwZWMgaXNuJ3QgY2xlYXIgb24gdGhpcyBtb2RlOyBzZWUKCSAgICAgICAgICAgIC8vIHNlY3Rpb24gNi40LjU6IHQgZG9lcyBub3Qgc2F5IHdoaWNoIGVuY29kaW5nIHRvIGFzc3VtaW5nCgkgICAgICAgICAgICAvLyB1cG9uIGRlY29kaW5nLiBJIGhhdmUgc2VlbiBJU08tODg1OS0xIHVzZWQgYXMgd2VsbCBhcwoJICAgICAgICAgICAgLy8gU2hpZnRfSklTIC0tIHdpdGhvdXQgYW55dGhpbmcgbGlrZSBhbiBFQ0kgZGVzaWduYXRvciB0bwoJICAgICAgICAgICAgLy8gZ2l2ZSBhIGhpbnQuCgkgICAgICAgICAgICBlbmNvZGluZyA9IFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5ndWVzc0VuY29kaW5nKHJlYWRCeXRlcywgaGludHMpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgZW5jb2RpbmcgPSBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLmdldE5hbWUoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKHJlYWRCeXRlcywgZW5jb2RpbmcpKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgICAgICBieXRlU2VnbWVudHMucHVzaChyZWFkQnl0ZXMpOwoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPj0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5BTFBIQU5VTUVSSUNfQ0hBUlMubGVuZ3RoKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLkFMUEhBTlVNRVJJQ19DSEFSU1t2YWx1ZV07CgkgICAgfTsKCSAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBmYzFJbkVmZmVjdCkgewoJICAgICAgICAvLyBSZWFkIHR3byBjaGFyYWN0ZXJzIGF0IGEgdGltZQoJICAgICAgICB2YXIgc3RhcnQgPSByZXN1bHQubGVuZ3RoKCk7CgkgICAgICAgIHdoaWxlIChjb3VudCA+IDEpIHsKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTEpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIG5leHRUd29DaGFyc0JpdHMgPSBiaXRzLnJlYWRCaXRzKDExKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcihuZXh0VHdvQ2hhcnNCaXRzIC8gNDUpKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKG5leHRUd29DaGFyc0JpdHMgJSA0NSkpOwoJICAgICAgICAgICAgY291bnQgLT0gMjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY291bnQgPT09IDEpIHsKCSAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogb25lIGNoYXJhY3RlciBsZWZ0CgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDYpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcihiaXRzLnJlYWRCaXRzKDYpKSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gU2VlIHNlY3Rpb24gNi40LjguMSwgNi40LjguMgoJICAgICAgICBpZiAoZmMxSW5FZmZlY3QpIHsKCSAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gbWFzc2FnZSB0aGUgcmVzdWx0IGEgYml0IGlmIGluIGFuIEZOQzEgbW9kZToKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHJlc3VsdC5sZW5ndGgoKTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFyQXQoaSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHJlc3VsdC5sZW5ndGgoKSAtIDEgJiYgcmVzdWx0LmNoYXJBdChpICsgMSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gJSUgaXMgcmVuZGVyZWQgYXMgJQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlbGV0ZUNoYXJBdChpICsgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiBhbHBoYSBtb2RlLCAlIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gRk5DMSBzZXBhcmF0b3IgMHgxRAoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldENoYXJBdChpLCBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4MUQpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVOdW1lcmljU2VnbWVudCA9IGZ1bmN0aW9uIChiaXRzLCByZXN1bHQsIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgLy8gUmVhZCB0aHJlZSBkaWdpdHMgYXQgYSB0aW1lCgkgICAgICAgIHdoaWxlIChjb3VudCA+PSAzKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEwIGJpdHMgZW5jb2RlcyB0aHJlZSBkaWdpdHMKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTApIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIHRocmVlRGlnaXRzQml0cyA9IGJpdHMucmVhZEJpdHMoMTApOwoJICAgICAgICAgICAgaWYgKHRocmVlRGlnaXRzQml0cyA+PSAxMDAwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcih0aHJlZURpZ2l0c0JpdHMgLyAxMDApKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodGhyZWVEaWdpdHNCaXRzIC8gMTApICUgMTApKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIodGhyZWVEaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgICAgIGNvdW50IC09IDM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvdW50ID09PSAyKSB7CgkgICAgICAgICAgICAvLyBUd28gZGlnaXRzIGxlZnQgb3ZlciB0byByZWFkLCBlbmNvZGVkIGluIDcgYml0cwoJICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA3KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciB0d29EaWdpdHNCaXRzID0gYml0cy5yZWFkQml0cyg3KTsKCSAgICAgICAgICAgIGlmICh0d29EaWdpdHNCaXRzID49IDEwMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodHdvRGlnaXRzQml0cyAvIDEwKSkpOwoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcih0d29EaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkgewoJICAgICAgICAgICAgLy8gT25lIGRpZ2l0IGxlZnQgb3ZlciB0byByZWFkCgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIGRpZ2l0Qml0cyA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICBpZiAoZGlnaXRCaXRzID49IDEwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoZGlnaXRCaXRzKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIucGFyc2VFQ0lWYWx1ZSA9IGZ1bmN0aW9uIChiaXRzKSB7CgkgICAgICAgIHZhciBmaXJzdEJ5dGUgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4ODApID09PSAwKSB7CgkgICAgICAgICAgICAvLyBqdXN0IG9uZSBieXRlCgkgICAgICAgICAgICByZXR1cm4gZmlyc3RCeXRlICYgMHg3RjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4QzApID09PSAweDgwKSB7CgkgICAgICAgICAgICAvLyB0d28gYnl0ZXMKCSAgICAgICAgICAgIHZhciBzZWNvbmRCeXRlID0gYml0cy5yZWFkQml0cyg4KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDNGKSA8PCA4KSAmIDB4RkZGRkZGRkYpIHwgc2Vjb25kQnl0ZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4RTApID09PSAweEMwKSB7CgkgICAgICAgICAgICAvLyB0aHJlZSBieXRlcwoJICAgICAgICAgICAgdmFyIHNlY29uZFRoaXJkQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDE2KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDFGKSA8PCAxNikgJiAweEZGRkZGRkZGKSB8IHNlY29uZFRoaXJkQnl0ZXM7CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFNlZSBJU08gMTgwMDQ6MjAwNiwgNi40LjQgVGFibGUgNQoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuQUxQSEFOVU1FUklDX0NIQVJTID0gJzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiAkJSorLS4vOic7CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUID0gMTsKCSAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcjsKCX0oKSk7CglEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEuZGVmYXVsdCA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXI7CgoJdmFyIFFSQ29kZURlY29kZXJNZXRhRGF0YSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDEzIFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShRUkNvZGVEZWNvZGVyTWV0YURhdGEkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiBNZXRhLWRhdGEgY29udGFpbmVyIGZvciBRUiBDb2RlIGRlY29kaW5nLiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBtYXkgYmUgdXNlZCB0byBjb252ZXkgaW5mb3JtYXRpb24gYmFjayB0byB0aGUKCSAqIGRlY29kaW5nIGNhbGxlci4gQ2FsbGVycyBhcmUgZXhwZWN0ZWQgdG8gcHJvY2VzcyB0aGlzLgoJICoKCSAqIEBzZWUgY29tLmdvb2dsZS56eGluZy5jb21tb24uRGVjb2RlclJlc3VsdCNnZXRPdGhlcigpCgkgKi8KCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUVJDb2RlRGVjb2Rlck1ldGFEYXRhKG1pcnJvcmVkKSB7CgkgICAgICAgIHRoaXMubWlycm9yZWQgPSBtaXJyb3JlZDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBRUiBDb2RlIHdhcyBtaXJyb3JlZC4KCSAgICAgKi8KCSAgICBRUkNvZGVEZWNvZGVyTWV0YURhdGEucHJvdG90eXBlLmlzTWlycm9yZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm1pcnJvcmVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbHkgdGhlIHJlc3VsdCBwb2ludHMnIG9yZGVyIGNvcnJlY3Rpb24gZHVlIHRvIG1pcnJvcmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBwb2ludHMgQXJyYXkgb2YgcG9pbnRzIHRvIGFwcGx5IG1pcnJvciBjb3JyZWN0aW9uIHRvLgoJICAgICAqLwoJICAgIFFSQ29kZURlY29kZXJNZXRhRGF0YS5wcm90b3R5cGUuYXBwbHlNaXJyb3JlZENvcnJlY3Rpb24gPSBmdW5jdGlvbiAocG9pbnRzKSB7CgkgICAgICAgIGlmICghdGhpcy5taXJyb3JlZCB8fCBwb2ludHMgPT09IG51bGwgfHwgcG9pbnRzLmxlbmd0aCA8IDMpIHsKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBvaW50c1swXTsKCSAgICAgICAgcG9pbnRzWzBdID0gcG9pbnRzWzJdOwoJICAgICAgICBwb2ludHNbMl0gPSBib3R0b21MZWZ0OwoJICAgICAgICAvLyBObyBuZWVkIHRvICdmaXgnIHRvcC1sZWZ0IGFuZCBhbGlnbm1lbnQgcGF0dGVybi4KCSAgICB9OwoJICAgIHJldHVybiBRUkNvZGVEZWNvZGVyTWV0YURhdGE7Cgl9KCkpOwoJUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDEuZGVmYXVsdCA9IFFSQ29kZURlY29kZXJNZXRhRGF0YTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVjb2RlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZWNvZGVyIHsqLwoJdmFyIENoZWNrc3VtRXhjZXB0aW9uXzEgPSBDaGVja3N1bUV4Y2VwdGlvbiQxOwoJdmFyIEJpdE1hdHJpeF8xJDIgPSBCaXRNYXRyaXgkMTsKCXZhciBHZW5lcmljR0ZfMSA9IEdlbmVyaWNHRiQxOwoJdmFyIFJlZWRTb2xvbW9uRGVjb2Rlcl8xID0gUmVlZFNvbG9tb25EZWNvZGVyJDE7Cgl2YXIgQml0TWF0cml4UGFyc2VyXzEgPSBCaXRNYXRyaXhQYXJzZXIkMTsKCXZhciBEYXRhQmxvY2tfMSA9IERhdGFCbG9jayQxOwoJdmFyIERlY29kZWRCaXRTdHJlYW1QYXJzZXJfMSA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxID0gUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoZSBtYWluIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgUVIgQ29kZSBkZWNvZGluZyAtLSBhcyBvcHBvc2VkIHRvIGxvY2F0aW5nIGFuZCBleHRyYWN0aW5nCgkgKiB0aGUgUVIgQ29kZSBmcm9tIGFuIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEZWNvZGVyKCkgewoJICAgICAgICB0aGlzLnJzRGVjb2RlciA9IG5ldyBSZWVkU29sb21vbkRlY29kZXJfMS5kZWZhdWx0KEdlbmVyaWNHRl8xLmRlZmF1bHQuUVJfQ09ERV9GSUVMRF8yNTYpOwoJICAgIH0KCSAgICAvLyBwdWJsaWMgZGVjb2RlKGltYWdlOiBib29sZWFuW11bXSk6IERlY29kZXJSZXN1bHQgLyp0aHJvd3MgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkNvbnZlbmllbmNlIG1ldGhvZCB0aGF0IGNhbiBkZWNvZGUgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEgMkQgYXJyYXkgb2YgYm9vbGVhbnMuCgkgICAgICogInRydWUiIGlzIHRha2VuIHRvIG1lYW4gYSBibGFjayBtb2R1bGUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGJvb2xlYW5zIHJlcHJlc2VudGluZyB3aGl0ZS9ibGFjayBRUiBDb2RlIG1vZHVsZXMKCSAgICAgKiBAcGFyYW0gaGludHMgZGVjb2RpbmcgaGludHMgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBpbmZsdWVuY2UgZGVjb2RpbmcKCSAgICAgKiBAcmV0dXJuIHRleHQgYW5kIGJ5dGVzIGVuY29kZWQgd2l0aGluIHRoZSBRUiBDb2RlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgdGhlIFFSIENvZGUgY2Fubm90IGJlIGRlY29kZWQKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCb29sZWFuQXJyYXkgPSBmdW5jdGlvbiAoaW1hZ2UsIGhpbnRzKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeChCaXRNYXRyaXhfMSQyLmRlZmF1bHQucGFyc2VGcm9tQm9vbGVhbkFycmF5KGltYWdlKSwgaGludHMpOwoJICAgIH07CgkgICAgLy8gcHVibGljIGRlY29kZUJpdE1hdHJpeChiaXRzOiBCaXRNYXRyaXgpOiBEZWNvZGVyUmVzdWx0IC8qdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uLCBGb3JtYXRFeGNlcHRpb24qLyB7CgkgICAgLy8gICByZXR1cm4gZGVjb2RlKGJpdHMsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkRlY29kZXMgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0uIEEgMSBvciAidHJ1ZSIgaXMgdGFrZW4gdG8gbWVhbiBhIGJsYWNrIG1vZHVsZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0cyBib29sZWFucyByZXByZXNlbnRpbmcgd2hpdGUvYmxhY2sgUVIgQ29kZSBtb2R1bGVzCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kaW5nIGhpbnRzIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gaW5mbHVlbmNlIGRlY29kaW5nCgkgICAgICogQHJldHVybiB0ZXh0IGFuZCBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBRUiBDb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIENvbnN0cnVjdCBhIHBhcnNlciBhbmQgcmVhZCB2ZXJzaW9uLCBlcnJvci1jb3JyZWN0aW9uIGxldmVsCgkgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgQml0TWF0cml4UGFyc2VyXzEuZGVmYXVsdChiaXRzKTsKCSAgICAgICAgdmFyIGV4ID0gbnVsbDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKjogRm9ybWF0RXhjZXB0aW9uLCBDaGVja3N1bUV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICBleCA9IGU7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIC8vIFJldmVydCB0aGUgYml0IG1hdHJpeAoJICAgICAgICAgICAgcGFyc2VyLnJlbWFzaygpOwoJICAgICAgICAgICAgLy8gV2lsbCBiZSBhdHRlbXB0aW5nIGEgbWlycm9yZWQgcmVhZGluZyBvZiB0aGUgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm8uCgkgICAgICAgICAgICBwYXJzZXIuc2V0TWlycm9yKHRydWUpOwoJICAgICAgICAgICAgLy8gUHJlZW1wdGl2ZWx5IHJlYWQgdGhlIHZlcnNpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgICAgIC8vIFByZWVtcHRpdmVseSByZWFkIHRoZSBmb3JtYXQgaW5mb3JtYXRpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCk7CgkgICAgICAgICAgICAvKgoJICAgICAgICAgICAgICogU2luY2Ugd2UncmUgaGVyZSwgdGhpcyBtZWFucyB3ZSBoYXZlIHN1Y2Nlc3NmdWxseSBkZXRlY3RlZCBzb21lIGtpbmQKCSAgICAgICAgICAgICAqIG9mIHZlcnNpb24gYW5kIGZvcm1hdCBpbmZvcm1hdGlvbiB3aGVuIG1pcnJvcmVkLiBUaGlzIGlzIGEgZ29vZCBzaWduLAoJICAgICAgICAgICAgICogdGhhdCB0aGUgUVIgY29kZSBtYXkgYmUgbWlycm9yZWQsIGFuZCB3ZSBzaG91bGQgdHJ5IG9uY2UgbW9yZSB3aXRoIGEKCSAgICAgICAgICAgICAqIG1pcnJvcmVkIGNvbnRlbnQuCgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIFByZXBhcmUgZm9yIGEgbWlycm9yZWQgcmVhZGluZy4KCSAgICAgICAgICAgIHBhcnNlci5taXJyb3IoKTsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIE5vdGlmeSB0aGUgY2FsbGVyIHRoYXQgdGhlIGNvZGUgd2FzIG1pcnJvcmVkLgoJICAgICAgICAgICAgcmVzdWx0LnNldE90aGVyKG5ldyBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxLmRlZmF1bHQodHJ1ZSkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKkZvcm1hdEV4Y2VwdGlvbiB8IENoZWNrc3VtRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIFRocm93IHRoZSBleGNlcHRpb24gZnJvbSB0aGUgb3JpZ2luYWwgcmVhZGluZwoJICAgICAgICAgICAgaWYgKGV4ICE9PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgZXg7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aHJvdyBlOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCaXRNYXRyaXhQYXJzZXIgPSBmdW5jdGlvbiAocGFyc2VyLCBoaW50cykgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCkuZ2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKTsKCSAgICAgICAgLy8gUmVhZCBjb2Rld29yZHMKCSAgICAgICAgdmFyIGNvZGV3b3JkcyA9IHBhcnNlci5yZWFkQ29kZXdvcmRzKCk7CgkgICAgICAgIC8vIFNlcGFyYXRlIGludG8gZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIGRhdGFCbG9ja3MgPSBEYXRhQmxvY2tfMS5kZWZhdWx0LmdldERhdGFCbG9ja3MoY29kZXdvcmRzLCB2ZXJzaW9uLCBlY0xldmVsKTsKCSAgICAgICAgLy8gQ291bnQgdG90YWwgbnVtYmVyIG9mIGRhdGEgYnl0ZXMKCSAgICAgICAgdmFyIHRvdGFsQnl0ZXMgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZGF0YUJsb2Nrc18xID0gX192YWx1ZXMkMihkYXRhQmxvY2tzKSwgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpOyAhZGF0YUJsb2Nrc18xXzEuZG9uZTsgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRhdGFCbG9jayA9IGRhdGFCbG9ja3NfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXMgKz0gZGF0YUJsb2NrLmdldE51bURhdGFDb2Rld29yZHMoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMV8xICYmICFkYXRhQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGRhdGFCbG9ja3NfMS5yZXR1cm4pKSBfYS5jYWxsKGRhdGFCbG9ja3NfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodG90YWxCeXRlcyk7CgkgICAgICAgIHZhciByZXN1bHRPZmZzZXQgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgLy8gRXJyb3ItY29ycmVjdCBhbmQgY29weSBkYXRhIGJsb2NrcyB0b2dldGhlciBpbnRvIGEgc3RyZWFtIG9mIGJ5dGVzCgkgICAgICAgICAgICBmb3IgKHZhciBkYXRhQmxvY2tzXzIgPSBfX3ZhbHVlcyQyKGRhdGFCbG9ja3MpLCBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCk7ICFkYXRhQmxvY2tzXzJfMS5kb25lOyBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZGF0YUJsb2NrID0gZGF0YUJsb2Nrc18yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGV3b3JkQnl0ZXMgPSBkYXRhQmxvY2suZ2V0Q29kZXdvcmRzKCk7CgkgICAgICAgICAgICAgICAgdmFyIG51bURhdGFDb2Rld29yZHMgPSBkYXRhQmxvY2suZ2V0TnVtRGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgIHRoaXMuY29ycmVjdEVycm9ycyhjb2Rld29yZEJ5dGVzLCBudW1EYXRhQ29kZXdvcmRzKTsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHRCeXRlc1tyZXN1bHRPZmZzZXQrK10gPSBjb2Rld29yZEJ5dGVzW2ldOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMl8xICYmICFkYXRhQmxvY2tzXzJfMS5kb25lICYmIChfYiA9IGRhdGFCbG9ja3NfMi5yZXR1cm4pKSBfYi5jYWxsKGRhdGFCbG9ja3NfMik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRGVjb2RlIHRoZSBjb250ZW50cyBvZiB0aGF0IHN0cmVhbSBvZiBieXRlcwoJICAgICAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcl8xLmRlZmF1bHQuZGVjb2RlKHJlc3VsdEJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5HaXZlbiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyByZWNlaXZlZCwgcG9zc2libHkgY29ycnVwdGVkIGJ5IGVycm9ycywgYXR0ZW1wdHMgdG8KCSAgICAgKiBjb3JyZWN0IHRoZSBlcnJvcnMgaW4tcGxhY2UgdXNpbmcgUmVlZC1Tb2xvbW9uIGVycm9yIGNvcnJlY3Rpb24uPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGNvZGV3b3JkQnl0ZXMgZGF0YSBhbmQgZXJyb3IgY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgKiBAcGFyYW0gbnVtRGF0YUNvZGV3b3JkcyBudW1iZXIgb2YgY29kZXdvcmRzIHRoYXQgYXJlIGRhdGEgYnl0ZXMKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5jb3JyZWN0RXJyb3JzID0gZnVuY3Rpb24gKGNvZGV3b3JkQnl0ZXMsIG51bURhdGFDb2Rld29yZHMgLyppbnQqLykgewoJICAgICAgICAvLyBjb25zdCBudW1Db2Rld29yZHMgPSBjb2Rld29yZEJ5dGVzLmxlbmd0aDsKCSAgICAgICAgLy8gRmlyc3QgcmVhZCBpbnRvIGFuIGFycmF5IG9mIGludHMKCSAgICAgICAgdmFyIGNvZGV3b3Jkc0ludHMgPSBuZXcgSW50MzJBcnJheShjb2Rld29yZEJ5dGVzKTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG5vdCByZWFseSBuZWNlc3NhcnkgdG8gdHJhbnNmb3JtIHRvIGludHM/IGNvdWxkIHJlZGVzaWduIGV2ZXJ5dGhpbmcgdG8gd29yayB3aXRoIHVuc2lnbmVkIGJ5dGVzPwoJICAgICAgICAvLyBjb25zdCBjb2Rld29yZHNJbnRzID0gbmV3IEludDMyQXJyYXkobnVtQ29kZXdvcmRzKQoJICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNvZGV3b3JkczsgaSsrKSB7CgkgICAgICAgIC8vICAgY29kZXdvcmRzSW50c1tpXSA9IGNvZGV3b3JkQnl0ZXNbaV0gJiAweEZGCgkgICAgICAgIC8vIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHRoaXMucnNEZWNvZGVyLmRlY29kZShjb2Rld29yZHNJbnRzLCBjb2Rld29yZEJ5dGVzLmxlbmd0aCAtIG51bURhdGFDb2Rld29yZHMpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChpZ25vcmVkIC8qOiBSZWVkU29sb21vbkV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQ2hlY2tzdW1FeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29weSBiYWNrIGludG8gYXJyYXkgb2YgYnl0ZXMgLS0gb25seSBuZWVkIHRvIHdvcnJ5IGFib3V0IHRoZSBieXRlcyB0aGF0IHdlcmUgZGF0YQoJICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGVycm9ycyBpbiB0aGUgZXJyb3ItY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXRhQ29kZXdvcmRzOyBpKyspIHsKCSAgICAgICAgICAgIGNvZGV3b3JkQnl0ZXNbaV0gPSAvKihieXRlKSAqLyBjb2Rld29yZHNJbnRzW2ldOwoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlcjsKCX0oKSk7CglEZWNvZGVyJDEuZGVmYXVsdCA9IERlY29kZXI7CgoJdmFyIERldGVjdG9yJDEgPSB7fTsKCgl2YXIgTWF0aFV0aWxzJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMTIgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hdGhVdGlscyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5kZXRlY3RvciB7Ki8KCS8qKgoJICogR2VuZXJhbCBtYXRoLXJlbGF0ZWQgYW5kIG51bWVyaWMgdXRpbGl0eSBmdW5jdGlvbnMuCgkgKi8KCXZhciBNYXRoVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gTWF0aFV0aWxzKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBFbmRzIHVwIGJlaW5nIGEgYml0IGZhc3RlciB0aGFuIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0uIFRoaXMgbWVyZWx5IHJvdW5kcyBpdHMKCSAgICAgKiBhcmd1bWVudCB0byB0aGUgbmVhcmVzdCBpbnQsIHdoZXJlIHguNSByb3VuZHMgdXAgdG8geCsxLiBTZW1hbnRpY3Mgb2YgdGhpcyBzaG9ydGN1dAoJICAgICAqIGRpZmZlciBzbGlnaHRseSBmcm9tIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0gaW4gdGhhdCBoYWxmIHJvdW5kcyBkb3duIGZvciBuZWdhdGl2ZQoJICAgICAqIHZhbHVlcy4gLTIuNSByb3VuZHMgdG8gLTMsIG5vdCAtMi4gRm9yIHB1cnBvc2VzIGhlcmUgaXQgbWFrZXMgbm8gZGlmZmVyZW5jZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBkIHJlYWwgdmFsdWUgdG8gcm91bmQKCSAgICAgKiBAcmV0dXJuIG5lYXJlc3Qge0Bjb2RlIGludH0KCSAgICAgKi8KCSAgICBNYXRoVXRpbHMucm91bmQgPSBmdW5jdGlvbiAoZCAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE5hTiA9PT0gZCkKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICBpZiAoZCA8PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUikKCSAgICAgICAgICAgIHJldHVybiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjsKCSAgICAgICAgaWYgKGQgPj0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpCgkgICAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHJldHVybiAvKihpbnQpICovIChkICsgKGQgPCAwLjAgPyAtMC41IDogMC41KSkgfCAwOwoJICAgIH07CgkgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG1heWJlIHJlbW92ZSByb3VuZCBtZXRob2QgYW5kIGNhbGwgZGlyZWN0bHkgTWF0aC5yb3VuZCwgaXQgbG9va3MgbGlrZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIGpzCgkgICAgLyoqCgkgICAgICogQHBhcmFtIGFYIHBvaW50IEEgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGFZIHBvaW50IEEgeSBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJYIHBvaW50IEIgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJZIHBvaW50IEIgeSBjb29yZGluYXRlCgkgICAgICogQHJldHVybiBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiBwb2ludHMgQSBhbmQgQgoJICAgICAqLwoJICAgIE1hdGhVdGlscy5kaXN0YW5jZSA9IGZ1bmN0aW9uIChhWCAvKmZsb2F0fGludCovLCBhWSAvKmZsb2F0fGludCovLCBiWCAvKmZsb2F0fGludCovLCBiWSAvKmZsb2F0fGludCovKSB7CgkgICAgICAgIHZhciB4RGlmZiA9IGFYIC0gYlg7CgkgICAgICAgIHZhciB5RGlmZiA9IGFZIC0gYlk7CgkgICAgICAgIHJldHVybiAvKihmbG9hdCkgKi8gTWF0aC5zcXJ0KHhEaWZmICogeERpZmYgKyB5RGlmZiAqIHlEaWZmKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBhWCBwb2ludCBBIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBhWSBwb2ludCBBIHkgY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWCBwb2ludCBCIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWSBwb2ludCBCIHkgY29vcmRpbmF0ZQoJICAgICAqIEByZXR1cm4gRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gcG9pbnRzIEEgYW5kIEIKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgc3RhdGljIGRpc3RhbmNlKGFYOiBudW1iZXIgLyppbnQqLywgYVk6IG51bWJlciAvKmludCovLCBiWDogbnVtYmVyIC8qaW50Ki8sIGJZOiBudW1iZXIgLyppbnQqLyk6IGZsb2F0IHsKCSAgICAvLyAgIGNvbnN0IHhEaWZmID0gYVggLSBiWAoJICAgIC8vICAgY29uc3QgeURpZmYgPSBhWSAtIGJZCgkgICAgLy8gICByZXR1cm4gKGZsb2F0KSBNYXRoLnNxcnQoeERpZmYgKiB4RGlmZiArIHlEaWZmICogeURpZmYpOwoJICAgIC8vIH0KCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYXJyYXkgdmFsdWVzIHRvIHN1bQoJICAgICAqIEByZXR1cm4gc3VtIG9mIHZhbHVlcyBpbiBhcnJheQoJICAgICAqLwoJICAgIE1hdGhVdGlscy5zdW0gPSBmdW5jdGlvbiAoYXJyYXkpIHsKCSAgICAgICAgdmFyIGNvdW50ID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gYXJyYXkubGVuZ3RoOyBpICE9PSBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgYSA9IGFycmF5W2ldOwoJICAgICAgICAgICAgY291bnQgKz0gYTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY291bnQ7CgkgICAgfTsKCSAgICByZXR1cm4gTWF0aFV0aWxzOwoJfSgpKTsKCU1hdGhVdGlscyQxLmRlZmF1bHQgPSBNYXRoVXRpbHM7CgoJdmFyIERldGVjdG9yUmVzdWx0JDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERldGVjdG9yUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGV0ZWN0aW5nIGEgYmFyY29kZSBpbiBhbiBpbWFnZS4gVGhpcyBpbmNsdWRlcyB0aGUgcmF3CgkgKiBtYXRyaXggb2YgYmxhY2svd2hpdGUgcGl4ZWxzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGJhcmNvZGUsIGFuZCBwb3NzaWJseSBwb2ludHMgb2YgaW50ZXJlc3QKCSAqIGluIHRoZSBpbWFnZSwgbGlrZSB0aGUgbG9jYXRpb24gb2YgZmluZGVyIHBhdHRlcm5zIG9yIGNvcm5lcnMgb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGV0ZWN0b3JSZXN1bHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gRGV0ZWN0b3JSZXN1bHQoYml0cywgcG9pbnRzKSB7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzOwoJICAgIH0KCSAgICBEZXRlY3RvclJlc3VsdC5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIERldGVjdG9yUmVzdWx0LnByb3RvdHlwZS5nZXRQb2ludHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnBvaW50czsKCSAgICB9OwoJICAgIHJldHVybiBEZXRlY3RvclJlc3VsdDsKCX0oKSk7CglEZXRlY3RvclJlc3VsdCQxLmRlZmF1bHQgPSBEZXRlY3RvclJlc3VsdDsKCgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSQxID0ge307CgoJdmFyIERlZmF1bHRHcmlkU2FtcGxlciQxID0ge307CgoJdmFyIEdyaWRTYW1wbGVyJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDUgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBJbXBsZW1lbnRhdGlvbnMgb2YgdGhpcyBjbGFzcyBjYW4sIGdpdmVuIGxvY2F0aW9ucyBvZiBmaW5kZXIgcGF0dGVybnMgZm9yIGEgUVIgY29kZSBpbiBhbgoJICogaW1hZ2UsIHNhbXBsZSB0aGUgcmlnaHQgcG9pbnRzIGluIHRoZSBpbWFnZSB0byByZWNvbnN0cnVjdCB0aGUgUVIgY29kZSwgYWNjb3VudGluZyBmb3IKCSAqIHBlcnNwZWN0aXZlIGRpc3RvcnRpb24uIEl0IGlzIGFic3RyYWN0ZWQgc2luY2UgaXQgaXMgcmVsYXRpdmVseSBleHBlbnNpdmUgYW5kIHNob3VsZCBiZSBhbGxvd2VkCgkgKiB0byB0YWtlIGFkdmFudGFnZSBvZiBwbGF0Zm9ybS1zcGVjaWZpYyBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb25zLCBsaWtlIFN1bidzIEphdmEgQWR2YW5jZWQKCSAqIEltYWdpbmcgbGlicmFyeSwgYnV0IHdoaWNoIG1heSBub3QgYmUgYXZhaWxhYmxlIGluIG90aGVyIGVudmlyb25tZW50cyBzdWNoIGFzIEoyTUUsIGFuZCB2aWNlCgkgKiB2ZXJzYS4KCSAqCgkgKiBUaGUgaW1wbGVtZW50YXRpb24gdXNlZCBjYW4gYmUgY29udHJvbGxlZCBieSBjYWxsaW5nIHtAbGluayAjc2V0R3JpZFNhbXBsZXIoR3JpZFNhbXBsZXIpfQoJICogd2l0aCBhbiBpbnN0YW5jZSBvZiBhIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgdGhpcyBpbnRlcmZhY2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdyaWRTYW1wbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEdyaWRTYW1wbGVyKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5DaGVja3MgYSBzZXQgb2YgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIHRyYW5zZm9ybWVkIHRvIHNhbXBsZSBwb2ludHMgb24gYW4gaW1hZ2UgYWdhaW5zdAoJICAgICAqIHRoZSBpbWFnZSdzIGRpbWVuc2lvbnMgdG8gc2VlIGlmIHRoZSBwb2ludCBhcmUgZXZlbiB3aXRoaW4gdGhlIGltYWdlLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHdpbGwgYWN0dWFsbHkgIm51ZGdlIiB0aGUgZW5kcG9pbnRzIGJhY2sgb250byB0aGUgaW1hZ2UgaWYgdGhleSBhcmUgZm91bmQgdG8gYmUKCSAgICAgKiBiYXJlbHkgKGxlc3MgdGhhbiAxIHBpeGVsKSBvZmYgdGhlIGltYWdlLiBUaGlzIGFjY291bnRzIGZvciBpbXBlcmZlY3QgZGV0ZWN0aW9uIG9mIGZpbmRlcgoJICAgICAqIHBhdHRlcm5zIGluIGFuIGltYWdlIHdoZXJlIHRoZSBRUiBDb2RlIHJ1bnMgYWxsIHRoZSB3YXkgdG8gdGhlIGltYWdlIGJvcmRlci48L3A+CgkgICAgICoKCSAgICAgKiA8cD5Gb3IgZWZmaWNpZW5jeSwgdGhlIG1ldGhvZCB3aWxsIGNoZWNrIHBvaW50cyBmcm9tIGVpdGhlciBlbmQgb2YgdGhlIGxpbmUgdW50aWwgb25lIGlzIGZvdW5kCgkgICAgICogdG8gYmUgd2l0aGluIHRoZSBpbWFnZS4gQmVjYXVzZSB0aGUgc2V0IG9mIHBvaW50cyBhcmUgYXNzdW1lZCB0byBiZSBsaW5lYXIsIHRoaXMgaXMgdmFsaWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGltYWdlIGludG8gd2hpY2ggdGhlIHBvaW50cyBzaG91bGQgbWFwCgkgICAgICogQHBhcmFtIHBvaW50cyBhY3R1YWwgcG9pbnRzIGluIHgxLHkxLC4uLix4bix5biBmb3JtCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhbiBlbmRwb2ludCBpcyBsaWVzIG91dHNpZGUgdGhlIGltYWdlIGJvdW5kYXJpZXMKCSAgICAgKi8KCSAgICBHcmlkU2FtcGxlci5jaGVja0FuZE51ZGdlUG9pbnRzID0gZnVuY3Rpb24gKGltYWdlLCBwb2ludHMpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gc3RhcnQgdW50aWwgd2Ugc2VlIHNvbWUgdGhhdCBhcmUgT0s6CgkgICAgICAgIHZhciBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBwb2ludHMubGVuZ3RoICYmIG51ZGdlZDsgb2Zmc2V0ICs9IDIpIHsKCSAgICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0XSk7CgkgICAgICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IocG9pbnRzW29mZnNldCArIDFdKTsKCSAgICAgICAgICAgIGlmICh4IDwgLTEgfHwgeCA+IHdpZHRoIHx8IHkgPCAtMSB8fCB5ID4gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBudWRnZWQgPSBmYWxzZTsKCSAgICAgICAgICAgIGlmICh4ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gMC4wOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmICh4ID09PSB3aWR0aCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gd2lkdGggLSAxOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoeSA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICBwb2ludHNbb2Zmc2V0ICsgMV0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IGhlaWdodCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gZW5kOgoJICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSBwb2ludHMubGVuZ3RoIC0gMjsgb2Zmc2V0ID49IDAgJiYgbnVkZ2VkOyBvZmZzZXQgLT0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKHBvaW50c1tvZmZzZXRdKTsKCSAgICAgICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0ICsgMV0pOwoJICAgICAgICAgICAgaWYgKHggPCAtMSB8fCB4ID4gd2lkdGggfHwgeSA8IC0xIHx8IHkgPiBoZWlnaHQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ1LmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG51ZGdlZCA9IGZhbHNlOwoJICAgICAgICAgICAgaWYgKHggPT09IC0xKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHggPT09IHdpZHRoKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSB3aWR0aCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh5ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IDAuMDsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoeSA9PT0gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldCArIDFdID0gaGVpZ2h0IC0gMTsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXI7Cgl9KCkpOwoJR3JpZFNhbXBsZXIkMS5kZWZhdWx0ID0gR3JpZFNhbXBsZXI7CgoJdmFyIFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGltcGxlbWVudHMgYSBwZXJzcGVjdGl2ZSB0cmFuc2Zvcm0gaW4gdHdvIGRpbWVuc2lvbnMuIEdpdmVuIGZvdXIgc291cmNlIGFuZCBmb3VyCgkgKiBkZXN0aW5hdGlvbiBwb2ludHMsIGl0IHdpbGwgY29tcHV0ZSB0aGUgdHJhbnNmb3JtYXRpb24gaW1wbGllZCBiZXR3ZWVuIHRoZW0uIFRoZSBjb2RlIGlzIGJhc2VkCgkgKiBkaXJlY3RseSB1cG9uIHNlY3Rpb24gMy40LjIgb2YgR2VvcmdlIFdvbGJlcmcncyAiRGlnaXRhbCBJbWFnZSBXYXJwaW5nIjsgc2VlIHBhZ2VzIDU0LTU2LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUGVyc3BlY3RpdmVUcmFuc2Zvcm0oYTExIC8qZmxvYXQqLywgYTIxIC8qZmxvYXQqLywgYTMxIC8qZmxvYXQqLywgYTEyIC8qZmxvYXQqLywgYTIyIC8qZmxvYXQqLywgYTMyIC8qZmxvYXQqLywgYTEzIC8qZmxvYXQqLywgYTIzIC8qZmxvYXQqLywgYTMzIC8qZmxvYXQqLykgewoJICAgICAgICB0aGlzLmExMSA9IGExMTsKCSAgICAgICAgdGhpcy5hMjEgPSBhMjE7CgkgICAgICAgIHRoaXMuYTMxID0gYTMxOwoJICAgICAgICB0aGlzLmExMiA9IGExMjsKCSAgICAgICAgdGhpcy5hMjIgPSBhMjI7CgkgICAgICAgIHRoaXMuYTMyID0gYTMyOwoJICAgICAgICB0aGlzLmExMyA9IGExMzsKCSAgICAgICAgdGhpcy5hMjMgPSBhMjM7CgkgICAgICAgIHRoaXMuYTMzID0gYTMzOwoJICAgIH0KCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsID0gZnVuY3Rpb24gKHgwIC8qZmxvYXQqLywgeTAgLypmbG9hdCovLCB4MSAvKmZsb2F0Ki8sIHkxIC8qZmxvYXQqLywgeDIgLypmbG9hdCovLCB5MiAvKmZsb2F0Ki8sIHgzIC8qZmxvYXQqLywgeTMgLypmbG9hdCovLCB4MHAgLypmbG9hdCovLCB5MHAgLypmbG9hdCovLCB4MXAgLypmbG9hdCovLCB5MXAgLypmbG9hdCovLCB4MnAgLypmbG9hdCovLCB5MnAgLypmbG9hdCovLCB4M3AgLypmbG9hdCovLCB5M3AgLypmbG9hdCovKSB7CgkgICAgICAgIHZhciBxVG9TID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0ucXVhZHJpbGF0ZXJhbFRvU3F1YXJlKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5Myk7CgkgICAgICAgIHZhciBzVG9RID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwcCwgeTBwLCB4MXAsIHkxcCwgeDJwLCB5MnAsIHgzcCwgeTNwKTsKCSAgICAgICAgcmV0dXJuIHNUb1EudGltZXMocVRvUyk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUudHJhbnNmb3JtUG9pbnRzID0gZnVuY3Rpb24gKHBvaW50cykgewoJICAgICAgICB2YXIgbWF4ID0gcG9pbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkgKz0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBwb2ludHNbaV07CgkgICAgICAgICAgICB2YXIgeSA9IHBvaW50c1tpICsgMV07CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSBhMTMgKiB4ICsgYTIzICogeSArIGEzMzsKCSAgICAgICAgICAgIHBvaW50c1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHBvaW50c1tpICsgMV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50cmFuc2Zvcm1Qb2ludHNXaXRoVmFsdWVzID0gZnVuY3Rpb24gKHhWYWx1ZXMsIHlWYWx1ZXMpIHsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgdmFyIG4gPSB4VmFsdWVzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB4ID0geFZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciB5ID0geVZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciBkZW5vbWluYXRvciA9IGExMyAqIHggKyBhMjMgKiB5ICsgYTMzOwoJICAgICAgICAgICAgeFZhbHVlc1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHlWYWx1ZXNbaV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnNxdWFyZVRvUXVhZHJpbGF0ZXJhbCA9IGZ1bmN0aW9uICh4MCAvKmZsb2F0Ki8sIHkwIC8qZmxvYXQqLywgeDEgLypmbG9hdCovLCB5MSAvKmZsb2F0Ki8sIHgyIC8qZmxvYXQqLywgeTIgLypmbG9hdCovLCB4MyAvKmZsb2F0Ki8sIHkzIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgZHgzID0geDAgLSB4MSArIHgyIC0geDM7CgkgICAgICAgIHZhciBkeTMgPSB5MCAtIHkxICsgeTIgLSB5MzsKCSAgICAgICAgaWYgKGR4MyA9PT0gMC4wICYmIGR5MyA9PT0gMC4wKSB7CgkgICAgICAgICAgICAvLyBBZmZpbmUKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCwgeDIgLSB4MSwgeDAsIHkxIC0geTAsIHkyIC0geTEsIHkwLCAwLjAsIDAuMCwgMS4wKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHZhciBkeDEgPSB4MSAtIHgyOwoJICAgICAgICAgICAgdmFyIGR4MiA9IHgzIC0geDI7CgkgICAgICAgICAgICB2YXIgZHkxID0geTEgLSB5MjsKCSAgICAgICAgICAgIHZhciBkeTIgPSB5MyAtIHkyOwoJICAgICAgICAgICAgdmFyIGRlbm9taW5hdG9yID0gZHgxICogZHkyIC0gZHgyICogZHkxOwoJICAgICAgICAgICAgdmFyIGExMyA9IChkeDMgKiBkeTIgLSBkeDIgKiBkeTMpIC8gZGVub21pbmF0b3I7CgkgICAgICAgICAgICB2YXIgYTIzID0gKGR4MSAqIGR5MyAtIGR4MyAqIGR5MSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCArIGExMyAqIHgxLCB4MyAtIHgwICsgYTIzICogeDMsIHgwLCB5MSAtIHkwICsgYTEzICogeTEsIHkzIC0geTAgKyBhMjMgKiB5MywgeTAsIGExMywgYTIzLCAxLjApOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9TcXVhcmUgPSBmdW5jdGlvbiAoeDAgLypmbG9hdCovLCB5MCAvKmZsb2F0Ki8sIHgxIC8qZmxvYXQqLywgeTEgLypmbG9hdCovLCB4MiAvKmZsb2F0Ki8sIHkyIC8qZmxvYXQqLywgeDMgLypmbG9hdCovLCB5MyAvKmZsb2F0Ki8pIHsKCSAgICAgICAgLy8gSGVyZSwgdGhlIGFkam9pbnQgc2VydmVzIGFzIHRoZSBpbnZlcnNlOgoJICAgICAgICByZXR1cm4gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykuYnVpbGRBZGpvaW50KCk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUuYnVpbGRBZGpvaW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBBZGpvaW50IGlzIHRoZSB0cmFuc3Bvc2Ugb2YgdGhlIGNvZmFjdG9yIG1hdHJpeDoKCSAgICAgICAgcmV0dXJuIG5ldyBQZXJzcGVjdGl2ZVRyYW5zZm9ybSh0aGlzLmEyMiAqIHRoaXMuYTMzIC0gdGhpcy5hMjMgKiB0aGlzLmEzMiwgdGhpcy5hMjMgKiB0aGlzLmEzMSAtIHRoaXMuYTIxICogdGhpcy5hMzMsIHRoaXMuYTIxICogdGhpcy5hMzIgLSB0aGlzLmEyMiAqIHRoaXMuYTMxLCB0aGlzLmExMyAqIHRoaXMuYTMyIC0gdGhpcy5hMTIgKiB0aGlzLmEzMywgdGhpcy5hMTEgKiB0aGlzLmEzMyAtIHRoaXMuYTEzICogdGhpcy5hMzEsIHRoaXMuYTEyICogdGhpcy5hMzEgLSB0aGlzLmExMSAqIHRoaXMuYTMyLCB0aGlzLmExMiAqIHRoaXMuYTIzIC0gdGhpcy5hMTMgKiB0aGlzLmEyMiwgdGhpcy5hMTMgKiB0aGlzLmEyMSAtIHRoaXMuYTExICogdGhpcy5hMjMsIHRoaXMuYTExICogdGhpcy5hMjIgLSB0aGlzLmExMiAqIHRoaXMuYTIxKTsKCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50aW1lcyA9IGZ1bmN0aW9uIChvdGhlcikgewoJICAgICAgICByZXR1cm4gbmV3IFBlcnNwZWN0aXZlVHJhbnNmb3JtKHRoaXMuYTExICogb3RoZXIuYTExICsgdGhpcy5hMjEgKiBvdGhlci5hMTIgKyB0aGlzLmEzMSAqIG90aGVyLmExMywgdGhpcy5hMTEgKiBvdGhlci5hMjEgKyB0aGlzLmEyMSAqIG90aGVyLmEyMiArIHRoaXMuYTMxICogb3RoZXIuYTIzLCB0aGlzLmExMSAqIG90aGVyLmEzMSArIHRoaXMuYTIxICogb3RoZXIuYTMyICsgdGhpcy5hMzEgKiBvdGhlci5hMzMsIHRoaXMuYTEyICogb3RoZXIuYTExICsgdGhpcy5hMjIgKiBvdGhlci5hMTIgKyB0aGlzLmEzMiAqIG90aGVyLmExMywgdGhpcy5hMTIgKiBvdGhlci5hMjEgKyB0aGlzLmEyMiAqIG90aGVyLmEyMiArIHRoaXMuYTMyICogb3RoZXIuYTIzLCB0aGlzLmExMiAqIG90aGVyLmEzMSArIHRoaXMuYTIyICogb3RoZXIuYTMyICsgdGhpcy5hMzIgKiBvdGhlci5hMzMsIHRoaXMuYTEzICogb3RoZXIuYTExICsgdGhpcy5hMjMgKiBvdGhlci5hMTIgKyB0aGlzLmEzMyAqIG90aGVyLmExMywgdGhpcy5hMTMgKiBvdGhlci5hMjEgKyB0aGlzLmEyMyAqIG90aGVyLmEyMiArIHRoaXMuYTMzICogb3RoZXIuYTIzLCB0aGlzLmExMyAqIG90aGVyLmEzMSArIHRoaXMuYTIzICogb3RoZXIuYTMyICsgdGhpcy5hMzMgKiBvdGhlci5hMzMpOwoJICAgIH07CgkgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoJfSgpKTsKCVBlcnNwZWN0aXZlVHJhbnNmb3JtJDEuZGVmYXVsdCA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVmYXVsdEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEdyaWRTYW1wbGVyXzEgPSBHcmlkU2FtcGxlciQxOwoJdmFyIEJpdE1hdHJpeF8xJDEgPSBCaXRNYXRyaXgkMTsKCXZhciBQZXJzcGVjdGl2ZVRyYW5zZm9ybV8xJDEgPSBQZXJzcGVjdGl2ZVRyYW5zZm9ybSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEkNCA9IE5vdEZvdW5kRXhjZXB0aW9uJDE7CgkvKioKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWZhdWx0R3JpZFNhbXBsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDIoRGVmYXVsdEdyaWRTYW1wbGVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIERlZmF1bHRHcmlkU2FtcGxlcigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgRGVmYXVsdEdyaWRTYW1wbGVyLnByb3RvdHlwZS5zYW1wbGVHcmlkID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgcDFUb1ggLypmbG9hdCovLCBwMVRvWSAvKmZsb2F0Ki8sIHAyVG9YIC8qZmxvYXQqLywgcDJUb1kgLypmbG9hdCovLCBwM1RvWCAvKmZsb2F0Ki8sIHAzVG9ZIC8qZmxvYXQqLywgcDRUb1ggLypmbG9hdCovLCBwNFRvWSAvKmZsb2F0Ki8sIHAxRnJvbVggLypmbG9hdCovLCBwMUZyb21ZIC8qZmxvYXQqLywgcDJGcm9tWCAvKmZsb2F0Ki8sIHAyRnJvbVkgLypmbG9hdCovLCBwM0Zyb21YIC8qZmxvYXQqLywgcDNGcm9tWSAvKmZsb2F0Ki8sIHA0RnJvbVggLypmbG9hdCovLCBwNEZyb21ZIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSQxLmRlZmF1bHQucXVhZHJpbGF0ZXJhbFRvUXVhZHJpbGF0ZXJhbChwMVRvWCwgcDFUb1ksIHAyVG9YLCBwMlRvWSwgcDNUb1gsIHAzVG9ZLCBwNFRvWCwgcDRUb1ksIHAxRnJvbVgsIHAxRnJvbVksIHAyRnJvbVgsIHAyRnJvbVksIHAzRnJvbVgsIHAzRnJvbVksIHA0RnJvbVgsIHA0RnJvbVkpOwoJICAgICAgICByZXR1cm4gdGhpcy5zYW1wbGVHcmlkV2l0aFRyYW5zZm9ybShpbWFnZSwgZGltZW5zaW9uWCwgZGltZW5zaW9uWSwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBEZWZhdWx0R3JpZFNhbXBsZXIucHJvdG90eXBlLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgdHJhbnNmb3JtKSB7CgkgICAgICAgIGlmIChkaW1lbnNpb25YIDw9IDAgfHwgZGltZW5zaW9uWSA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMSQxLmRlZmF1bHQoZGltZW5zaW9uWCwgZGltZW5zaW9uWSk7CgkgICAgICAgIHZhciBwb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBkaW1lbnNpb25YKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBkaW1lbnNpb25ZOyB5KyspIHsKCSAgICAgICAgICAgIHZhciBtYXggPSBwb2ludHMubGVuZ3RoOwoJICAgICAgICAgICAgdmFyIGlWYWx1ZSA9IHkgKyAwLjU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heDsgeCArPSAyKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW3hdID0gKHggLyAyKSArIDAuNTsKCSAgICAgICAgICAgICAgICBwb2ludHNbeCArIDFdID0gaVZhbHVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50cyhwb2ludHMpOwoJICAgICAgICAgICAgLy8gUXVpY2sgY2hlY2sgdG8gc2VlIGlmIHBvaW50cyB0cmFuc2Zvcm1lZCB0byBzb21ldGhpbmcgaW5zaWRlIHRoZSBpbWFnZQoJICAgICAgICAgICAgLy8gc3VmZmljaWVudCB0byBjaGVjayB0aGUgZW5kcG9pbnRzCgkgICAgICAgICAgICBHcmlkU2FtcGxlcl8xLmRlZmF1bHQuY2hlY2tBbmROdWRnZVBvaW50cyhpbWFnZSwgcG9pbnRzKTsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHggKz0gMikgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KE1hdGguZmxvb3IocG9pbnRzW3hdKSwgTWF0aC5mbG9vcihwb2ludHNbeCArIDFdKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJsYWNrKC1pc2gpIHBpeGVsCgkgICAgICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4IC8gMiwgeSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoYWlvb2JlIC8qOiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgICAgIC8vIFRoaXMgZmVlbHMgd3JvbmcsIGJ1dCwgc29tZXRpbWVzIGlmIHRoZSBmaW5kZXIgcGF0dGVybnMgYXJlIG1pc2lkZW50aWZpZWQsIHRoZSByZXN1bHRpbmcKCSAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gZ2V0cyAidHdpc3RlZCIgc3VjaCB0aGF0IGl0IG1hcHMgYSBzdHJhaWdodCBsaW5lIG9mIHBvaW50cyB0byBhIHNldCBvZiBwb2ludHMKCSAgICAgICAgICAgICAgICAvLyB3aG9zZSBlbmRwb2ludHMgYXJlIGluIGJvdW5kcywgYnV0IG90aGVycyBhcmUgbm90LiBUaGVyZSBpcyBwcm9iYWJseSBzb21lIG1hdGhlbWF0aWNhbAoJICAgICAgICAgICAgICAgIC8vIHdheSB0byBkZXRlY3QgdGhpcyBhYm91dCB0aGUgdHJhbnNmb3JtYXRpb24gdGhhdCBJIGRvbid0IGtub3cgeWV0LgoJICAgICAgICAgICAgICAgIC8vIFRoaXMgcmVzdWx0cyBpbiBhbiB1Z2x5IHJ1bnRpbWUgZXhjZXB0aW9uIGRlc3BpdGUgb3VyIGNsZXZlciBjaGVja3MgYWJvdmUgLS0gY2FuJ3QgaGF2ZQoJICAgICAgICAgICAgICAgIC8vIHRoYXQuIFdlIGNvdWxkIGNoZWNrIGVhY2ggcG9pbnQncyBjb29yZGluYXRlcyBidXQgdGhhdCBmZWVscyBkdXBsaWNhdGl2ZS4gV2Ugc2V0dGxlIGZvcgoJICAgICAgICAgICAgICAgIC8vIGNhdGNoaW5nIGFuZCB3cmFwcGluZyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24uCgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNC5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICByZXR1cm4gRGVmYXVsdEdyaWRTYW1wbGVyOwoJfShHcmlkU2FtcGxlcl8xLmRlZmF1bHQpKTsKCURlZmF1bHRHcmlkU2FtcGxlciQxLmRlZmF1bHQgPSBEZWZhdWx0R3JpZFNhbXBsZXI7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVySW5zdGFuY2UkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIERlZmF1bHRHcmlkU2FtcGxlcl8xID0gRGVmYXVsdEdyaWRTYW1wbGVyJDE7Cgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBHcmlkU2FtcGxlckluc3RhbmNlKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBTZXRzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBHcmlkU2FtcGxlciB1c2VkIGJ5IHRoZSBsaWJyYXJ5LiBPbmUgZ2xvYmFsCgkgICAgICogaW5zdGFuY2UgaXMgc3RvcmVkLCB3aGljaCBtYXkgc291bmQgcHJvYmxlbWF0aWMuIEJ1dCwgdGhlIGltcGxlbWVudGF0aW9uIHByb3ZpZGVkCgkgICAgICogb3VnaHQgdG8gYmUgYXBwcm9wcmlhdGUgZm9yIHRoZSBlbnRpcmUgcGxhdGZvcm0sIGFuZCBhbGwgdXNlcyBvZiB0aGlzIGxpYnJhcnkKCSAgICAgKiBpbiB0aGUgd2hvbGUgbGlmZXRpbWUgb2YgdGhlIEpWTS4gRm9yIGluc3RhbmNlLCBhbiBBbmRyb2lkIGFjdGl2aXR5IGNhbiBzd2FwIGluCgkgICAgICogYW4gaW1wbGVtZW50YXRpb24gdGhhdCB0YWtlcyBhZHZhbnRhZ2Ugb2YgbmF0aXZlIHBsYXRmb3JtIGxpYnJhcmllcy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBuZXdHcmlkU2FtcGxlciBUaGUgcGxhdGZvcm0tc3BlY2lmaWMgb2JqZWN0IHRvIGluc3RhbGwuCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5zZXRHcmlkU2FtcGxlciA9IGZ1bmN0aW9uIChuZXdHcmlkU2FtcGxlcikgewoJICAgICAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3R3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIG9mIEdyaWRTYW1wbGVyCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIEdyaWRTYW1wbGVySW5zdGFuY2UuZ3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3IERlZmF1bHRHcmlkU2FtcGxlcl8xLmRlZmF1bHQoKTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXJJbnN0YW5jZTsKCX0oKSk7CglHcmlkU2FtcGxlckluc3RhbmNlJDEuZGVmYXVsdCA9IEdyaWRTYW1wbGVySW5zdGFuY2U7CgoJdmFyIFJlc3VsdFBvaW50JDEgPSB7fTsKCgl2YXIgRmxvYXQkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGbG9hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIFBvbnlmaWxsIGZvciBKYXZhJ3MgRmxvYXQgY2xhc3MuCgkgKi8KCXZhciBGbG9hdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBGbG9hdCgpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogU2luY1RTIGhhcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gaW50IGFuZCBmbG9hdCwgdGhlcmUncyBhbGwgbnVtYmVycywKCSAgICAgKiB0aGlzIGlzIHVzZWQgb25seSB0byBwb2x5ZmlsbCBKYXZhIGNvZGUuCgkgICAgICovCgkgICAgRmxvYXQuZmxvYXRUb0ludEJpdHMgPSBmdW5jdGlvbiAoZikgewoJICAgICAgICByZXR1cm4gZjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFRoZSBmbG9hdCBtYXggdmFsdWUgaW4gSlMgaXMgdGhlIG51bWJlciBtYXggdmFsdWUuCgkgICAgICovCgkgICAgRmxvYXQuTUFYX1ZBTFVFID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgcmV0dXJuIEZsb2F0OwoJfSgpKTsKCUZsb2F0JDEuZGVmYXVsdCA9IEZsb2F0OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVzdWx0UG9pbnQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCXZhciBNYXRoVXRpbHNfMSQxID0gTWF0aFV0aWxzJDE7Cgl2YXIgRmxvYXRfMSA9IEZsb2F0JDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHBvaW50IG9mIGludGVyZXN0IGluIGFuIGltYWdlIGNvbnRhaW5pbmcgYSBiYXJjb2RlLiBUeXBpY2FsbHksIHRoaXMKCSAqIHdvdWxkIGJlIHRoZSBsb2NhdGlvbiBvZiBhIGZpbmRlciBwYXR0ZXJuIG9yIHRoZSBjb3JuZXIgb2YgdGhlIGJhcmNvZGUsIGZvciBleGFtcGxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0UG9pbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUmVzdWx0UG9pbnQoeCwgeSkgewoJICAgICAgICB0aGlzLnggPSB4OwoJICAgICAgICB0aGlzLnkgPSB5OwoJICAgIH0KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUuZ2V0WCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMueDsKCSAgICB9OwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5nZXRZID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy55OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgUmVzdWx0UG9pbnQpIHsKCSAgICAgICAgICAgIHZhciBvdGhlclBvaW50ID0gb3RoZXI7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy54ID09PSBvdGhlclBvaW50LnggJiYgdGhpcy55ID09PSBvdGhlclBvaW50Lnk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogRmxvYXRfMS5kZWZhdWx0LmZsb2F0VG9JbnRCaXRzKHRoaXMueCkgKyBGbG9hdF8xLmRlZmF1bHQuZmxvYXRUb0ludEJpdHModGhpcy55KTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAnKCcgKyB0aGlzLnggKyAnLCcgKyB0aGlzLnkgKyAnKSc7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBPcmRlcnMgYW4gYXJyYXkgb2YgdGhyZWUgUmVzdWx0UG9pbnRzIGluIGFuIG9yZGVyIFtBLEIsQ10gc3VjaCB0aGF0IEFCIGlzIGxlc3MgdGhhbiBBQwoJICAgICAqIGFuZCBCQyBpcyBsZXNzIHRoYW4gQUMsIGFuZCB0aGUgYW5nbGUgYmV0d2VlbiBCQyBhbmQgQkEgaXMgbGVzcyB0aGFuIDE4MCBkZWdyZWVzLgoJICAgICAqCgkgICAgICogQHBhcmFtIHBhdHRlcm5zIGFycmF5IG9mIHRocmVlIHtAY29kZSBSZXN1bHRQb2ludH0gdG8gb3JkZXIKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5vcmRlckJlc3RQYXR0ZXJucyA9IGZ1bmN0aW9uIChwYXR0ZXJucykgewoJICAgICAgICAvLyBGaW5kIGRpc3RhbmNlcyBiZXR3ZWVuIHBhdHRlcm4gY2VudGVycwoJICAgICAgICB2YXIgemVyb09uZURpc3RhbmNlID0gdGhpcy5kaXN0YW5jZShwYXR0ZXJuc1swXSwgcGF0dGVybnNbMV0pOwoJICAgICAgICB2YXIgb25lVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzFdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciB6ZXJvVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzBdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciBwb2ludEE7CgkgICAgICAgIHZhciBwb2ludEI7CgkgICAgICAgIHZhciBwb2ludEM7CgkgICAgICAgIC8vIEFzc3VtZSBvbmUgY2xvc2VzdCB0byBvdGhlciB0d28gaXMgQjsgQSBhbmQgQyB3aWxsIGp1c3QgYmUgZ3Vlc3NlcyBhdCBmaXJzdAoJICAgICAgICBpZiAob25lVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlICYmIG9uZVR3b0Rpc3RhbmNlID49IHplcm9Ud29EaXN0YW5jZSkgewoJICAgICAgICAgICAgcG9pbnRCID0gcGF0dGVybnNbMF07CgkgICAgICAgICAgICBwb2ludEEgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QyA9IHBhdHRlcm5zWzJdOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHplcm9Ud29EaXN0YW5jZSA+PSBvbmVUd29EaXN0YW5jZSAmJiB6ZXJvVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlKSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMl07CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1syXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMV07CgkgICAgICAgIH0KCSAgICAgICAgLy8gVXNlIGNyb3NzIHByb2R1Y3QgdG8gZmlndXJlIG91dCB3aGV0aGVyIEEgYW5kIEMgYXJlIGNvcnJlY3Qgb3IgZmxpcHBlZC4KCSAgICAgICAgLy8gVGhpcyBhc2tzIHdoZXRoZXIgQkMgeCBCQSBoYXMgYSBwb3NpdGl2ZSB6IGNvbXBvbmVudCwgd2hpY2ggaXMgdGhlIGFycmFuZ2VtZW50CgkgICAgICAgIC8vIHdlIHdhbnQgZm9yIEEsIEIsIEMuIElmIGl0J3MgbmVnYXRpdmUsIHRoZW4gd2UndmUgZ290IGl0IGZsaXBwZWQgYXJvdW5kIGFuZAoJICAgICAgICAvLyBzaG91bGQgc3dhcCBBIGFuZCBDLgoJICAgICAgICBpZiAodGhpcy5jcm9zc1Byb2R1Y3RaKHBvaW50QSwgcG9pbnRCLCBwb2ludEMpIDwgMC4wKSB7CgkgICAgICAgICAgICB2YXIgdGVtcCA9IHBvaW50QTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBvaW50QzsKCSAgICAgICAgICAgIHBvaW50QyA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgcGF0dGVybnNbMF0gPSBwb2ludEE7CgkgICAgICAgIHBhdHRlcm5zWzFdID0gcG9pbnRCOwoJICAgICAgICBwYXR0ZXJuc1syXSA9IHBvaW50QzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBwYXR0ZXJuMSBmaXJzdCBwYXR0ZXJuCgkgICAgICogQHBhcmFtIHBhdHRlcm4yIHNlY29uZCBwYXR0ZXJuCgkgICAgICogQHJldHVybiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5kaXN0YW5jZSA9IGZ1bmN0aW9uIChwYXR0ZXJuMSwgcGF0dGVybjIpIHsKCSAgICAgICAgcmV0dXJuIE1hdGhVdGlsc18xJDEuZGVmYXVsdC5kaXN0YW5jZShwYXR0ZXJuMS54LCBwYXR0ZXJuMS55LCBwYXR0ZXJuMi54LCBwYXR0ZXJuMi55KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHogY29tcG9uZW50IG9mIHRoZSBjcm9zcyBwcm9kdWN0IGJldHdlZW4gdmVjdG9ycyBCQyBhbmQgQkEuCgkgICAgICovCgkgICAgUmVzdWx0UG9pbnQuY3Jvc3NQcm9kdWN0WiA9IGZ1bmN0aW9uIChwb2ludEEsIHBvaW50QiwgcG9pbnRDKSB7CgkgICAgICAgIHZhciBiWCA9IHBvaW50Qi54OwoJICAgICAgICB2YXIgYlkgPSBwb2ludEIueTsKCSAgICAgICAgcmV0dXJuICgocG9pbnRDLnggLSBiWCkgKiAocG9pbnRBLnkgLSBiWSkpIC0gKChwb2ludEMueSAtIGJZKSAqIChwb2ludEEueCAtIGJYKSk7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0UG9pbnQ7Cgl9KCkpOwoJUmVzdWx0UG9pbnQkMS5kZWZhdWx0ID0gUmVzdWx0UG9pbnQ7CgoJdmFyIEFsaWdubWVudFBhdHRlcm5GaW5kZXIkMSA9IHt9OwoKCXZhciBBbGlnbm1lbnRQYXR0ZXJuJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyQxID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFsaWdubWVudFBhdHRlcm4kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgUmVzdWx0UG9pbnRfMSQzID0gUmVzdWx0UG9pbnQkMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGFuIGFsaWdubWVudCBwYXR0ZXJuLCB3aGljaCBhcmUgdGhlIHNtYWxsZXIgc3F1YXJlIHBhdHRlcm5zIGZvdW5kIGluCgkgKiBhbGwgYnV0IHRoZSBzaW1wbGVzdCBRUiBDb2Rlcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEFsaWdubWVudFBhdHRlcm4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDEoQWxpZ25tZW50UGF0dGVybiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZXJtaW5lcyBpZiB0aGlzIGFsaWdubWVudCBwYXR0ZXJuICJhYm91dCBlcXVhbHMiIGFuIGFsaWdubWVudCBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhbiBhdmVyYWdlIG9mIHRoZSB0d28uCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybi5wcm90b3R5cGUuY29tYmluZUVzdGltYXRlID0gZnVuY3Rpb24gKGkgLypmbG9hdCovLCBqIC8qZmxvYXQqLywgbmV3TW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIGNvbWJpbmVkWCA9ICh0aGlzLmdldFgoKSArIGopIC8gMi4wOwoJICAgICAgICB2YXIgY29tYmluZWRZID0gKHRoaXMuZ2V0WSgpICsgaSkgLyAyLjA7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplICsgbmV3TW9kdWxlU2l6ZSkgLyAyLjA7CgkgICAgICAgIHJldHVybiBuZXcgQWxpZ25tZW50UGF0dGVybihjb21iaW5lZFgsIGNvbWJpbmVkWSwgY29tYmluZWRNb2R1bGVTaXplKTsKCSAgICB9OwoJICAgIHJldHVybiBBbGlnbm1lbnRQYXR0ZXJuOwoJfShSZXN1bHRQb2ludF8xJDMuZGVmYXVsdCkpOwoJQWxpZ25tZW50UGF0dGVybiQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX192YWx1ZXMkMSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuXzEgPSBBbGlnbm1lbnRQYXR0ZXJuJDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQzID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBhbGlnbm1lbnQgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBBbGlnbm1lbnQgcGF0dGVybnMgbG9vayBsaWtlIGZpbmRlcgoJICogcGF0dGVybnMgYnV0IGFyZSBzbWFsbGVyIGFuZCBhcHBlYXIgYXQgcmVndWxhciBpbnRlcnZhbHMgdGhyb3VnaG91dCB0aGUgaW1hZ2UuPC9wPgoJICoKCSAqIDxwPkF0IHRoZSBtb21lbnQgdGhpcyBvbmx5IGxvb2tzIGZvciB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAqCgkgKiA8cD5UaGlzIGlzIG1vc3RseSBhIHNpbXBsaWZpZWQgY29weSBvZiB7QGxpbmsgRmluZGVyUGF0dGVybkZpbmRlcn0uIEl0IGlzIGNvcGllZCwKCSAqIHBhc3RlZCBhbmQgc3RyaXBwZWQgZG93biBoZXJlIGZvciBtYXhpbXVtIHBlcmZvcm1hbmNlIGJ1dCBkb2VzIHVuZm9ydHVuYXRlbHkgZHVwbGljYXRlCgkgKiBzb21lIGNvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8qKgoJICAgICAqIDxwPkNyZWF0ZXMgYSBmaW5kZXIgdGhhdCB3aWxsIGxvb2sgaW4gYSBwb3J0aW9uIG9mIHRoZSB3aG9sZSBpbWFnZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gaW1hZ2UgaW1hZ2UgdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIHN0YXJ0WCBsZWZ0IGNvbHVtbiBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSBzdGFydFkgdG9wIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiByZWdpb24gdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2YgcmVnaW9uIHRvIHNlYXJjaAoJICAgICAqIEBwYXJhbSBtb2R1bGVTaXplIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBzbyBmYXIKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyKGltYWdlLCBzdGFydFggLyppbnQqLywgc3RhcnRZIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBtb2R1bGVTaXplIC8qZmxvYXQqLywgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMuc3RhcnRYID0gc3RhcnRYOwoJICAgICAgICB0aGlzLnN0YXJ0WSA9IHN0YXJ0WTsKCSAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwoJICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgdGhpcy5tb2R1bGVTaXplID0gbW9kdWxlU2l6ZTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICAgICAgdGhpcy5wb3NzaWJsZUNlbnRlcnMgPSBbXTsgLy8gbmV3IEFycmF5PGFueT4oNSkpCgkgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBhcnJheSBpbml0aWFsaXphdGlvbiB3aXRob3V0IHNpemUgYXMgdGhlIGxlbmd0aCBpcyBjaGVja2VkIGJlbG93CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSgzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+VGhpcyBtZXRob2QgYXR0ZW1wdHMgdG8gZmluZCB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuIGluIHRoZSBpbWFnZS4gSXQgaXMgYSBiaXQgbWVzc3kgc2luY2UKCSAgICAgKiBpdCdzIHByZXR0eSBwZXJmb3JtYW5jZS1jcml0aWNhbCBhbmQgc28gaXMgd3JpdHRlbiB0byBiZSBmYXN0IGZvcmVtb3N0LjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBub3QgZm91bmQKCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgc3RhcnRYID0gdGhpcy5zdGFydFg7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIG1heEogPSBzdGFydFggKyB3aWR0aDsKCSAgICAgICAgdmFyIG1pZGRsZUkgPSB0aGlzLnN0YXJ0WSArIChoZWlnaHQgLyAyKTsKCSAgICAgICAgLy8gV2UgYXJlIGxvb2tpbmcgZm9yIGJsYWNrL3doaXRlL2JsYWNrIG1vZHVsZXMgaW4gMToxOjEgcmF0aW8KCSAgICAgICAgLy8gdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIHNlZW4gc28gZmFyCgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoMyk7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIGZvciAodmFyIGlHZW4gPSAwOyBpR2VuIDwgaGVpZ2h0OyBpR2VuKyspIHsKCSAgICAgICAgICAgIC8vIFNlYXJjaCBmcm9tIG1pZGRsZSBvdXR3YXJkcwoJICAgICAgICAgICAgdmFyIGkgPSBtaWRkbGVJICsgKChpR2VuICYgMHgwMSkgPT09IDAgPyBNYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSA6IC1NYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSk7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICB2YXIgaiA9IHN0YXJ0WDsKCSAgICAgICAgICAgIC8vIEJ1cm4gb2ZmIGxlYWRpbmcgd2hpdGUgcGl4ZWxzIGJlZm9yZSBhbnl0aGluZyBlbHNlOyBpZiB3ZSBzdGFydCBpbiB0aGUgbWlkZGxlIG9mCgkgICAgICAgICAgICAvLyBhIHdoaXRlIHJ1biwgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNvdW50IGl0cyBsZW5ndGgsIHNpbmNlIHdlIGRvbid0IGtub3cgaWYgdGhlCgkgICAgICAgICAgICAvLyB3aGl0ZSBydW4gY29udGludWVkIHRvIHRoZSBsZWZ0IG9mIHRoZSBzdGFydCBwb2ludAoJICAgICAgICAgICAgd2hpbGUgKGogPCBtYXhKICYmICFpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gMDsKCSAgICAgICAgICAgIHdoaWxlIChqIDwgbWF4SikgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMV0rKzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8gQ291bnRpbmcgd2hpdGUgcGl4ZWxzCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAyKSB7IC8vIEEgd2lubmVyPwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvdW5kUGF0dGVybkNyb3NzKHN0YXRlQ291bnQpKSB7IC8vIFllcwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBqKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gc3RhdGVDb3VudFsyXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gMTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsrK2N1cnJlbnRTdGF0ZV0rKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAodGhpcy5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSkgewoJICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIG1heEopOwoJICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQgIT09IG51bGwpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBub3RoaW5nIHdlIHNhdyB3YXMgb2JzZXJ2ZWQgYW5kIGNvbmZpcm1lZCB0d2ljZS4gSWYgd2UgaGFkCgkgICAgICAgIC8vIGFueSBndWVzcyBhdCBhbGwsIHJldHVybiBpdC4KCSAgICAgICAgaWYgKHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aCAhPT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zc2libGVDZW50ZXJzWzBdOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogR2l2ZW4gYSBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCBzZWVuIGFuZCBhbiBlbmQgcG9zaXRpb24sCgkgICAgICogZmlndXJlcyB0aGUgbG9jYXRpb24gb2YgdGhlIGNlbnRlciBvZiB0aGlzIGJsYWNrL3doaXRlL2JsYWNrIHJ1bi4KCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCwgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIChlbmQgLSBzdGF0ZUNvdW50WzJdKSAtIHN0YXRlQ291bnRbMV0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8xIHJhdGlvcwoJICAgICAqICAgICAgICAgdXNlZCBieSBhbGlnbm1lbnQgcGF0dGVybnMgdG8gYmUgY29uc2lkZXJlZCBhIG1hdGNoCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMubW9kdWxlU2l6ZTsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFtpXSkgPj0gbWF4VmFyaWFuY2UpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5BZnRlciBhIGhvcml6b250YWwgc2NhbiBmaW5kcyBhIHBvdGVudGlhbCBhbGlnbm1lbnQgcGF0dGVybiwgdGhpcyBtZXRob2QKCSAgICAgKiAiY3Jvc3MtY2hlY2tzIiBieSBzY2FubmluZyBkb3duIHZlcnRpY2FsbHkgdGhyb3VnaCB0aGUgY2VudGVyIG9mIHRoZSBwb3NzaWJsZQoJICAgICAqIGFsaWdubWVudCBwYXR0ZXJuIHRvIHNlZSBpZiB0aGUgc2FtZSBwcm9wb3J0aW9uIGlzIGRldGVjdGVkLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydEkgcm93IHdoZXJlIGFuIGFsaWdubWVudCBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYW4gYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBhbGlnbm1lbnQgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAvLyBTdGFydCBjb3VudGluZyB1cCBmcm9tIGNlbnRlcgoJICAgICAgICB2YXIgaSA9IHN0YXJ0STsKCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbMF0gPD0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMF0rKzsKCSAgICAgICAgICAgIGktLTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFswXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIC8vIE5vdyBhbHNvIGNvdW50IGRvd24gZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IHN0YXJ0SSArIDE7CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbMV0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA8IG1heEkgJiYgIWltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzJdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzJdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMl0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSAyICogb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkgPyBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaSkgOiBOYU47CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5UaGlzIGlzIGNhbGxlZCB3aGVuIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4uIEl0IHdpbGwKCSAgICAgKiBjcm9zcyBjaGVjayB3aXRoIGEgdmVydGljYWwgc2NhbiwgYW5kIGlmIHN1Y2Nlc3NmdWwsIHdpbGwgc2VlIGlmIHRoaXMgcGF0dGVybiBoYWQgYmVlbgoJICAgICAqIGZvdW5kIG9uIGEgcHJldmlvdXMgaG9yaXpvbnRhbCBzY2FuLiBJZiBzbywgd2UgY29uc2lkZXIgaXQgY29uZmlybWVkIGFuZCBjb25jbHVkZSB3ZSBoYXZlCgkgICAgICogZm91bmQgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGF0ZUNvdW50IHJlYWRpbmcgc3RhdGUgbW9kdWxlIGNvdW50cyBmcm9tIGhvcml6b250YWwgc2NhbgoJICAgICAqIEBwYXJhbSBpIHJvdyB3aGVyZSBhbGlnbm1lbnQgcGF0dGVybiBtYXkgYmUgZm91bmQKCSAgICAgKiBAcGFyYW0gaiBlbmQgb2YgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4gaW4gcm93CgkgICAgICogQHJldHVybiB7QGxpbmsgQWxpZ25tZW50UGF0dGVybn0gaWYgd2UgaGF2ZSBmb3VuZCB0aGUgc2FtZSBwYXR0ZXJuIHR3aWNlLCBvciBudWxsIGlmIG5vdAoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmhhbmRsZVBvc3NpYmxlQ2VudGVyID0gZnVuY3Rpb24gKHN0YXRlQ291bnQsIGkgLyppbnQqLywgaiAvKmludCovKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICB2YXIgY2VudGVySiA9IEFsaWdubWVudFBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKTsKCSAgICAgICAgdmFyIGNlbnRlckkgPSB0aGlzLmNyb3NzQ2hlY2tWZXJ0aWNhbChpLCAvKihpbnQpICovIGNlbnRlckosIDIgKiBzdGF0ZUNvdW50WzFdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IChzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0pIC8gMy4wOwoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzJDEodGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgYWJvdXQgdGhlIHNhbWUgY2VudGVyIGFuZCBtb2R1bGUgc2l6ZToKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5hYm91dEVxdWFscyhlc3RpbWF0ZWRNb2R1bGVTaXplLCBjZW50ZXJJLCBjZW50ZXJKKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnRlci5jb21iaW5lRXN0aW1hdGUoY2VudGVySSwgY2VudGVySiwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKF9jICYmICFfYy5kb25lICYmIChfYSA9IF9iLnJldHVybikpIF9hLmNhbGwoX2IpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBIYWRuJ3QgZm91bmQgdGhpcyBiZWZvcmU7IHNhdmUgaXQKCSAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBBbGlnbm1lbnRQYXR0ZXJuXzEuZGVmYXVsdChjZW50ZXJKLCBjZW50ZXJJLCBlc3RpbWF0ZWRNb2R1bGVTaXplKTsKCSAgICAgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzLnB1c2gocG9pbnQpOwoJICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjay5mb3VuZFBvc3NpYmxlUmVzdWx0UG9pbnQocG9pbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgcmV0dXJuIEFsaWdubWVudFBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJQWxpZ25tZW50UGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyOwoKCXZhciBGaW5kZXJQYXR0ZXJuRmluZGVyJDEgPSB7fTsKCgl2YXIgRmluZGVyUGF0dGVybiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRmluZGVyUGF0dGVybiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZXRlY3RvciB7Ki8KCXZhciBSZXN1bHRQb2ludF8xJDIgPSBSZXN1bHRQb2ludCQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBmaW5kZXIgcGF0dGVybiwgd2hpY2ggYXJlIHRoZSB0aHJlZSBzcXVhcmUgcGF0dGVybnMgZm91bmQgaW4KCSAqIHRoZSBjb3JuZXJzIG9mIFFSIENvZGVzLiBJdCBhbHNvIGVuY2Fwc3VsYXRlcyBhIGNvdW50IG9mIHNpbWlsYXIgZmluZGVyIHBhdHRlcm5zLAoJICogYXMgYSBjb252ZW5pZW5jZSB0byB0aGUgZmluZGVyJ3MgYm9va2tlZXBpbmcuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBGaW5kZXJQYXR0ZXJuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyhGaW5kZXJQYXR0ZXJuLCBfc3VwZXIpOwoJICAgIC8vIEZpbmRlclBhdHRlcm4ocG9zWDogbnVtYmVyLypmbG9hdCovLCBwb3NZOiBudW1iZXIvKmZsb2F0Ki8sIGVzdGltYXRlZE1vZHVsZVNpemU6IG51bWJlci8qZmxvYXQqLykgewoJICAgIC8vICAgdGhpcyhwb3NYLCBwb3NZLCBlc3RpbWF0ZWRNb2R1bGVTaXplLCAxKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBGaW5kZXJQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8sIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIF90aGlzLmNvdW50ID0gY291bnQ7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNvdW50KSB7CgkgICAgICAgICAgICBfdGhpcy5jb3VudCA9IDE7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybi5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvdW50OwoJICAgIH07CgkgICAgLyoKCSAgICB2b2lkIGluY3JlbWVudENvdW50KCkgewoJICAgICAgdGhpcy5jb3VudCsrCgkgICAgfQoJICAgICAqLwoJICAgIC8qKgoJICAgICAqIDxwPkRldGVybWluZXMgaWYgdGhpcyBmaW5kZXIgcGF0dGVybiAiYWJvdXQgZXF1YWxzIiBhIGZpbmRlciBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhIHdlaWdodGVkIGF2ZXJhZ2UKCSAgICAgKiBiYXNlZCBvbiBjb3VudC4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5jb21iaW5lRXN0aW1hdGUgPSBmdW5jdGlvbiAoaSAvKmZsb2F0Ki8sIGogLypmbG9hdCovLCBuZXdNb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgY29tYmluZWRDb3VudCA9IHRoaXMuY291bnQgKyAxOwoJICAgICAgICB2YXIgY29tYmluZWRYID0gKHRoaXMuY291bnQgKiB0aGlzLmdldFgoKSArIGopIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgdmFyIGNvbWJpbmVkWSA9ICh0aGlzLmNvdW50ICogdGhpcy5nZXRZKCkgKyBpKSAvIGNvbWJpbmVkQ291bnQ7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5jb3VudCAqIHRoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSArIG5ld01vZHVsZVNpemUpIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgcmV0dXJuIG5ldyBGaW5kZXJQYXR0ZXJuKGNvbWJpbmVkWCwgY29tYmluZWRZLCBjb21iaW5lZE1vZHVsZVNpemUsIGNvbWJpbmVkQ291bnQpOwoJICAgIH07CgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm47Cgl9KFJlc3VsdFBvaW50XzEkMi5kZWZhdWx0KSk7CglGaW5kZXJQYXR0ZXJuJDEuZGVmYXVsdCA9IEZpbmRlclBhdHRlcm47CgoJdmFyIEZpbmRlclBhdHRlcm5JbmZvJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5JbmZvJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGluZm9ybWF0aW9uIGFib3V0IGZpbmRlciBwYXR0ZXJucyBpbiBhbiBpbWFnZSwgaW5jbHVkaW5nIHRoZSBsb2NhdGlvbiBvZgoJICogdGhlIHRocmVlIGZpbmRlciBwYXR0ZXJucywgYW5kIHRoZWlyIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5JbmZvID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZpbmRlclBhdHRlcm5JbmZvKHBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHRoaXMuYm90dG9tTGVmdCA9IHBhdHRlcm5DZW50ZXJzWzBdOwoJICAgICAgICB0aGlzLnRvcExlZnQgPSBwYXR0ZXJuQ2VudGVyc1sxXTsKCSAgICAgICAgdGhpcy50b3BSaWdodCA9IHBhdHRlcm5DZW50ZXJzWzJdOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuSW5mby5wcm90b3R5cGUuZ2V0Qm90dG9tTGVmdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYm90dG9tTGVmdDsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5JbmZvLnByb3RvdHlwZS5nZXRUb3BMZWZ0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BMZWZ0OwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkluZm8ucHJvdG90eXBlLmdldFRvcFJpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BSaWdodDsKCSAgICB9OwoJICAgIHJldHVybiBGaW5kZXJQYXR0ZXJuSW5mbzsKCX0oKSk7CglGaW5kZXJQYXR0ZXJuSW5mbyQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuSW5mbzsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5GaW5kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQyID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBSZXN1bHRQb2ludF8xJDEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIEZpbmRlclBhdHRlcm5fMSA9IEZpbmRlclBhdHRlcm4kMTsKCXZhciBGaW5kZXJQYXR0ZXJuSW5mb18xID0gRmluZGVyUGF0dGVybkluZm8kMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDIgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBmaW5kZXIgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBGaW5kZXIgcGF0dGVybnMgYXJlIHRoZSBzcXVhcmUKCSAqIG1hcmtlcnMgYXQgdGhyZWUgY29ybmVycyBvZiBhIFFSIENvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5GaW5kZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogPHA+Q3JlYXRlcyBhIGZpbmRlciB0aGF0IHdpbGwgc2VhcmNoIHRoZSBpbWFnZSBmb3IgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBpbWFnZSBpbWFnZSB0byBzZWFyY2gKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoaW1hZ2U6IEJpdE1hdHJpeCkgewoJICAgIC8vICAgdGhpcyhpbWFnZSwgbnVsbCkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRmluZGVyUGF0dGVybkZpbmRlcihpbWFnZSwgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayA9IHJlc3VsdFBvaW50Q2FsbGJhY2s7CgkgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzID0gW107CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSg1KTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICB9CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0SW1hZ2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmltYWdlOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0UG9zc2libGVDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKGhpbnRzKSB7CgkgICAgICAgIHZhciB0cnlIYXJkZXIgPSAoaGludHMgIT09IG51bGwgJiYgaGludHMgIT09IHVuZGVmaW5lZCkgJiYgdW5kZWZpbmVkICE9PSBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQyLmRlZmF1bHQuVFJZX0hBUkRFUik7CgkgICAgICAgIHZhciBwdXJlQmFyY29kZSA9IChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkKSAmJiB1bmRlZmluZWQgIT09IGhpbnRzLmdldChEZWNvZGVIaW50VHlwZV8xJDIuZGVmYXVsdC5QVVJFX0JBUkNPREUpOwoJICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlOwoJICAgICAgICB2YXIgbWF4SSA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgbWF4SiA9IGltYWdlLmdldFdpZHRoKCk7CgkgICAgICAgIC8vIFdlIGFyZSBsb29raW5nIGZvciBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIGluCgkgICAgICAgIC8vIDE6MTozOjE6MSByYXRpbzsgdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBzdWNoIG1vZHVsZXMgc2VlbiBzbyBmYXIKCSAgICAgICAgLy8gTGV0J3MgYXNzdW1lIHRoYXQgdGhlIG1heGltdW0gdmVyc2lvbiBRUiBDb2RlIHdlIHN1cHBvcnQgdGFrZXMgdXAgMS80IHRoZSBoZWlnaHQgb2YgdGhlCgkgICAgICAgIC8vIGltYWdlLCBhbmQgdGhlbiBhY2NvdW50IGZvciB0aGUgY2VudGVyIGJlaW5nIDMgbW9kdWxlcyBpbiBzaXplLiBUaGlzIGdpdmVzIHRoZSBzbWFsbGVzdAoJICAgICAgICAvLyBudW1iZXIgb2YgcGl4ZWxzIHRoZSBjZW50ZXIgY291bGQgYmUsIHNvIHNraXAgdGhpcyBvZnRlbi4gV2hlbiB0cnlpbmcgaGFyZGVyLCBsb29rIGZvciBhbGwKCSAgICAgICAgLy8gUVIgdmVyc2lvbnMgcmVnYXJkbGVzcyBvZiBob3cgZGVuc2UgdGhleSBhcmUuCgkgICAgICAgIHZhciBpU2tpcCA9IE1hdGguZmxvb3IoKDMgKiBtYXhJKSAvICg0ICogRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUykpOwoJICAgICAgICBpZiAoaVNraXAgPCBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQIHx8IHRyeUhhcmRlcikgewoJICAgICAgICAgICAgaVNraXAgPSBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkb25lID0gZmFsc2U7CgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoNSk7CgkgICAgICAgIGZvciAodmFyIGkgPSBpU2tpcCAtIDE7IGkgPCBtYXhJICYmICFkb25lOyBpICs9IGlTa2lwKSB7CgkgICAgICAgICAgICAvLyBHZXQgYSByb3cgb2YgYmxhY2svd2hpdGUgdmFsdWVzCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0gPSAwOwoJICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IDA7CgkgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heEo7IGorKykgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMSkgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMCkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDQpIHsgLy8gQSB3aW5uZXI/CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsgLy8gWWVzCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIGosIHB1cmVCYXJjb2RlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZXhhbWluaW5nIGV2ZXJ5IG90aGVyIGxpbmUuIENoZWNraW5nIGVhY2ggbGluZSB0dXJuZWQgb3V0IHRvIGJlIHRvbwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwZW5zaXZlIGFuZCBkaWRuJ3QgaW1wcm92ZSBwZXJmb3JtYW5jZS4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlTa2lwID0gMjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQgPT09IHRydWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93U2tpcCA9IHRoaXMuZmluZFJvd1NraXAoKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93U2tpcCA+IHN0YXRlQ291bnRbMl0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCByb3dzIGJldHdlZW4gcm93IG9mIGxvd2VyIGNvbmZpcm1lZCBjZW50ZXIKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRvcCBvZiBwcmVzdW1lZCB0aGlyZCBjb25maXJtZWQgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1dCBiYWNrIHVwIGEgYml0IHRvIGdldCBhIGZ1bGwgY2hhbmNlIG9mIGRldGVjdGluZwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCwgZW50aXJlIHdpZHRoIG9mIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGJ5IHJvd1NraXAsIGJ1dCBiYWNrIG9mZiBieSBzdGF0ZUNvdW50WzJdIChzaXplIG9mIGxhc3QgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mIHBhdHRlcm4gd2Ugc2F3KSB0byBiZSBjb25zZXJ2YXRpdmUsIGFuZCBhbHNvIGJhY2sgb2ZmIGJ5IGlTa2lwIHdoaWNoCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzIGFib3V0IHRvIGJlIHJlLWFkZGVkCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gcm93U2tpcCAtIHN0YXRlQ291bnRbMl0gLSBpU2tpcDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IG1heEogLSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IHN0YXRlQ291bnRbM107CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gc3RhdGVDb3VudFs0XTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAzOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgc3RhdGUgdG8gc3RhcnQgbG9va2luZyBhZ2FpbgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBObywgc2hpZnQgY291bnRzIGJhY2sgYnkgdHdvCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gc3RhdGVDb3VudFszXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IHN0YXRlQ291bnRbNF07CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gMzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WysrY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBtYXhKLCBwdXJlQmFyY29kZSk7CgkgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICBpU2tpcCA9IHN0YXRlQ291bnRbMF07CgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGEgdGhpcmQgb25lCgkgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBhdHRlcm5JbmZvID0gdGhpcy5zZWxlY3RCZXN0UGF0dGVybnMoKTsKCSAgICAgICAgUmVzdWx0UG9pbnRfMSQxLmRlZmF1bHQub3JkZXJCZXN0UGF0dGVybnMocGF0dGVybkluZm8pOwoJICAgICAgICByZXR1cm4gbmV3IEZpbmRlclBhdHRlcm5JbmZvXzEuZGVmYXVsdChwYXR0ZXJuSW5mbyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBHaXZlbiBhIGNvdW50IG9mIGJsYWNrL3doaXRlL2JsYWNrL3doaXRlL2JsYWNrIHBpeGVscyBqdXN0IHNlZW4gYW5kIGFuIGVuZCBwb3NpdGlvbiwKCSAgICAgKiBmaWd1cmVzIHRoZSBsb2NhdGlvbiBvZiB0aGUgY2VudGVyIG9mIHRoaXMgcnVuLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZCA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBlbmQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gKGVuZCAtIHN0YXRlQ291bnRbNF0gLSBzdGF0ZUNvdW50WzNdKSAtIHN0YXRlQ291bnRbMl0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8zLzEvMSByYXRpb3MKCSAgICAgKiAgICAgICAgIHVzZWQgYnkgZmluZGVyIHBhdHRlcm5zIHRvIGJlIGNvbnNpZGVyZWQgYSBtYXRjaAoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHsKCSAgICAgICAgICAgIHZhciBjb3VudCA9IHN0YXRlQ291bnRbaV07CgkgICAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gY291bnQ7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvdGFsTW9kdWxlU2l6ZSA8IDcpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIDcuMDsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgLy8gQWxsb3cgbGVzcyB0aGFuIDUwJSB2YXJpYW5jZSBmcm9tIDEtMS0zLTEtMSBwcm9wb3J0aW9ucwoJICAgICAgICByZXR1cm4gTWF0aC5hYnMobW9kdWxlU2l6ZSAtIHN0YXRlQ291bnRbMF0pIDwgbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzFdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicygzLjAgKiBtb2R1bGVTaXplIC0gc3RhdGVDb3VudFsyXSkgPCAzICogbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzNdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFs0XSkgPCBtYXhWYXJpYW5jZTsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgY3Jvc3NDaGVja1N0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFswXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzFdID0gMDsKCSAgICAgICAgY3Jvc3NDaGVja1N0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFszXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgcmV0dXJuIGNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQWZ0ZXIgYSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jcm9zcy1jcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gZGlhZ29uYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnRJIHJvdyB3aGVyZSBhIGZpbmRlciBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYSBmaW5kZXIgcGF0dGVybgoJICAgICAqIEBwYXJhbSBtYXhDb3VudCBtYXhpbXVtIHJlYXNvbmFibGUgbnVtYmVyIG9mIG1vZHVsZXMgdGhhdCBzaG91bGQgYmUKCSAgICAgKiAgb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcGFyYW0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgVGhlIG9yaWdpbmFsIHN0YXRlIGNvdW50IHRvdGFsLgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwcm9wb3J0aW9ucyBhcmUgd2l0aGluZyBleHBlY3RlZCBsaW1pdHMKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrRGlhZ29uYWwgPSBmdW5jdGlvbiAoc3RhcnRJIC8qaW50Ki8sIGNlbnRlckogLyppbnQqLywgbWF4Q291bnQgLyppbnQqLywgb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgLyppbnQqLykgewoJICAgICAgICB2YXIgc3RhdGVDb3VudCA9IHRoaXMuZ2V0Q3Jvc3NDaGVja1N0YXRlQ291bnQoKTsKCSAgICAgICAgLy8gU3RhcnQgY291bnRpbmcgdXAsIGxlZnQgZnJvbSBjZW50ZXIgZmluZGluZyBibGFjayBjZW50ZXIgbWFzcwoJICAgICAgICB2YXIgaSA9IDA7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHdoaWxlIChzdGFydEkgPj0gaSAmJiBjZW50ZXJKID49IGkgJiYgaW1hZ2UuZ2V0KGNlbnRlckogLSBpLCBzdGFydEkgLSBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgPCBpIHx8IGNlbnRlckogPCBpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyB3aGl0ZSBzcGFjZQoJICAgICAgICB3aGlsZSAoc3RhcnRJID49IGkgJiYgY2VudGVySiA+PSBpICYmICFpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgYWxyZWFkeSB0b28gbWFueSBtb2R1bGVzIGluIHRoaXMgc3RhdGUgb3IgcmFuIG9mZiB0aGUgZWRnZToKCSAgICAgICAgaWYgKHN0YXJ0SSA8IGkgfHwgY2VudGVySiA8IGkgfHwgc3RhdGVDb3VudFsxXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyBibGFjayBib3JkZXIKCSAgICAgICAgd2hpbGUgKHN0YXJ0SSA+PSBpICYmIGNlbnRlckogPj0gaSAmJiBpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMF0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtYXhJID0gaW1hZ2UuZ2V0SGVpZ2h0KCk7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biwgcmlnaHQgZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IDE7CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgaW1hZ2UuZ2V0KGNlbnRlckogKyBpLCBzdGFydEkgKyBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJhbiBvZmYgdGhlIGVkZ2U/CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgIWltYWdlLmdldChjZW50ZXJKICsgaSwgc3RhcnRJICsgaSkgJiYKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKHN0YXJ0SSArIGkgPCBtYXhJICYmIGNlbnRlckogKyBpIDwgbWF4SiAmJiBpbWFnZS5nZXQoY2VudGVySiArIGksIHN0YXJ0SSArIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZmluZGVyLXBhdHRlcm4tbGlrZSBzZWN0aW9uLCBidXQgaXRzIHNpemUgaXMgbW9yZSB0aGFuIDEwMCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgcmV0dXJuIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA8IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAmJgoJICAgICAgICAgICAgRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkFmdGVyIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gdmVydGljYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXJ0SSByb3cgd2hlcmUgYSBmaW5kZXIgcGF0dGVybiB3YXMgZGV0ZWN0ZWQKCSAgICAgKiBAcGFyYW0gY2VudGVySiBjZW50ZXIgb2YgdGhlIHNlY3Rpb24gdGhhdCBhcHBlYXJzIHRvIGNyb3NzIGEgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIC8vIFN0YXJ0IGNvdW50aW5nIHVwIGZyb20gY2VudGVyCgkgICAgICAgIHZhciBpID0gc3RhcnRJOwoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmICFpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biBmcm9tIGNlbnRlcgoJICAgICAgICBpID0gc3RhcnRJICsgMTsKCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJKSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbM10gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB3ZSBmb3VuZCBhIGZpbmRlci1wYXR0ZXJuLWxpa2Ugc2VjdGlvbiwgYnV0IGl0cyBzaXplIGlzIG1vcmUgdGhhbiA0MCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF07CgkgICAgICAgIGlmICg1ICogTWF0aC5hYnMoc3RhdGVDb3VudFRvdGFsIC0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpID49IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBpKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkxpa2Uge0BsaW5rICNjcm9zc0NoZWNrVmVydGljYWwoaW50LCBpbnQsIGludCwgaW50KX0sIGFuZCBpbiBmYWN0IGlzIGJhc2ljYWxseSBpZGVudGljYWwsCgkgICAgICogZXhjZXB0IGl0IHJlYWRzIGhvcml6b250YWxseSBpbnN0ZWFkIG9mIHZlcnRpY2FsbHkuIFRoaXMgaXMgdXNlZCB0byBjcm9zcy1jcm9zcwoJICAgICAqIGNoZWNrIGEgdmVydGljYWwgY3Jvc3MgY2hlY2sgYW5kIGxvY2F0ZSB0aGUgcmVhbCBjZW50ZXIgb2YgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChzdGFydEogLyppbnQqLywgY2VudGVySSAvKmludCovLCBtYXhDb3VudCAvKmludCovLCBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAvKmludCovKSB7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIHZhciBqID0gc3RhcnRKOwoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmIGltYWdlLmdldChqLCBjZW50ZXJJKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmICFpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGogPj0gMCAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgaiA9IHN0YXJ0SiArIDE7CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMl0rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA8IG1heEogJiYgIWltYWdlLmdldChqLCBjZW50ZXJJKSAmJiBzdGF0ZUNvdW50WzNdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFs0XSA8IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdKys7CgkgICAgICAgICAgICBqKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbNF0gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgd2UgZm91bmQgYSBmaW5kZXItcGF0dGVybi1saWtlIHNlY3Rpb24sIGJ1dCBpdHMgc2l6ZSBpcyBzaWduaWZpY2FudGx5IGRpZmZlcmVudCB0aGFuCgkgICAgICAgIC8vIHRoZSBvcmlnaW5hbCwgYXNzdW1lIGl0J3MgYSBmYWxzZSBwb3NpdGl2ZQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdICsgc3RhdGVDb3VudFszXSArCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgaXMgY2FsbGVkIHdoZW4gYSBob3Jpem9udGFsIHNjYW4gZmluZHMgYSBwb3NzaWJsZSBhbGlnbm1lbnQgcGF0dGVybi4gSXQgd2lsbAoJICAgICAqIGNyb3NzIGNoZWNrIHdpdGggYSB2ZXJ0aWNhbCBzY2FuLCBhbmQgaWYgc3VjY2Vzc2Z1bCwgd2lsbCwgYWgsIGNyb3NzLWNyb3NzLWNoZWNrCgkgICAgICogd2l0aCBhbm90aGVyIGhvcml6b250YWwgc2Nhbi4gVGhpcyBpcyBuZWVkZWQgcHJpbWFyaWx5IHRvIGxvY2F0ZSB0aGUgcmVhbCBob3Jpem9udGFsCgkgICAgICogY2VudGVyIG9mIHRoZSBwYXR0ZXJuIGluIGNhc2VzIG9mIGV4dHJlbWUgc2tldy4KCSAgICAgKiBBbmQgdGhlbiB3ZSBjcm9zcy1jcm9zcy1jcm9zcyBjaGVjayB3aXRoIGFub3RoZXIgZGlhZ29uYWwgc2Nhbi48L3A+CgkgICAgICoKCSAgICAgKiA8cD5JZiB0aGF0IHN1Y2NlZWRzIHRoZSBmaW5kZXIgcGF0dGVybiBsb2NhdGlvbiBpcyBhZGRlZCB0byBhIGxpc3QgdGhhdCB0cmFja3MKCSAgICAgKiB0aGUgbnVtYmVyIG9mIHRpbWVzIGVhY2ggbG9jYXRpb24gaGFzIGJlZW4gbmVhcmx5LW1hdGNoZWQgYXMgYSBmaW5kZXIgcGF0dGVybi4KCSAgICAgKiBFYWNoIGFkZGl0aW9uYWwgZmluZCBpcyBtb3JlIGV2aWRlbmNlIHRoYXQgdGhlIGxvY2F0aW9uIGlzIGluIGZhY3QgYSBmaW5kZXIKCSAgICAgKiBwYXR0ZXJuIGNlbnRlcgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXRlQ291bnQgcmVhZGluZyBzdGF0ZSBtb2R1bGUgY291bnRzIGZyb20gaG9yaXpvbnRhbCBzY2FuCgkgICAgICogQHBhcmFtIGkgcm93IHdoZXJlIGZpbmRlciBwYXR0ZXJuIG1heSBiZSBmb3VuZAoJICAgICAqIEBwYXJhbSBqIGVuZCBvZiBwb3NzaWJsZSBmaW5kZXIgcGF0dGVybiBpbiByb3cKCSAgICAgKiBAcGFyYW0gcHVyZUJhcmNvZGUgdHJ1ZSBpZiBpbiAicHVyZSBiYXJjb2RlIiBtb2RlCgkgICAgICogQHJldHVybiB0cnVlIGlmIGEgZmluZGVyIHBhdHRlcm4gY2FuZGlkYXRlIHdhcyBmb3VuZCB0aGlzIHRpbWUKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYW5kbGVQb3NzaWJsZUNlbnRlciA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBpIC8qaW50Ki8sIGogLyppbnQqLywgcHVyZUJhcmNvZGUpIHsKCSAgICAgICAgdmFyIHN0YXRlQ291bnRUb3RhbCA9IHN0YXRlQ291bnRbMF0gKyBzdGF0ZUNvdW50WzFdICsgc3RhdGVDb3VudFsyXSArIHN0YXRlQ291bnRbM10gKwoJICAgICAgICAgICAgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgdmFyIGNlbnRlckogPSBGaW5kZXJQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaik7CgkgICAgICAgIHZhciBjZW50ZXJJID0gdGhpcy5jcm9zc0NoZWNrVmVydGljYWwoaSwgLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCBzdGF0ZUNvdW50WzJdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICAvLyBSZS1jcm9zcyBjaGVjawoJICAgICAgICAgICAgY2VudGVySiA9IHRoaXMuY3Jvc3NDaGVja0hvcml6b250YWwoLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCAvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIHN0YXRlQ291bnRbMl0sIHN0YXRlQ291bnRUb3RhbCk7CgkgICAgICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckopICYmCgkgICAgICAgICAgICAgICAgKCFwdXJlQmFyY29kZSB8fCB0aGlzLmNyb3NzQ2hlY2tEaWFnb25hbCgvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIC8qKGludCkgKi8gTWF0aC5mbG9vcihjZW50ZXJKKSwgc3RhdGVDb3VudFsyXSwgc3RhdGVDb3VudFRvdGFsKSkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IHN0YXRlQ291bnRUb3RhbCAvIDcuMDsKCSAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXJzID0gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwLCBsZW5ndGhfMSA9IHBvc3NpYmxlQ2VudGVycy5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoXzE7IGluZGV4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IHBvc3NpYmxlQ2VudGVyc1tpbmRleF07CgkgICAgICAgICAgICAgICAgICAgIC8vIExvb2sgZm9yIGFib3V0IHRoZSBzYW1lIGNlbnRlciBhbmQgbW9kdWxlIHNpemU6CgkgICAgICAgICAgICAgICAgICAgIGlmIChjZW50ZXIuYWJvdXRFcXVhbHMoZXN0aW1hdGVkTW9kdWxlU2l6ZSwgY2VudGVySSwgY2VudGVySikpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVyc1tpbmRleF0gPSBjZW50ZXIuY29tYmluZUVzdGltYXRlKGNlbnRlckksIGNlbnRlckosIGVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSBuZXcgRmluZGVyUGF0dGVybl8xLmRlZmF1bHQoY2VudGVySiwgY2VudGVySSwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5wdXNoKHBvaW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrLmZvdW5kUG9zc2libGVSZXN1bHRQb2ludChwb2ludCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2Ygcm93cyB3ZSBjb3VsZCBzYWZlbHkgc2tpcCBkdXJpbmcgc2Nhbm5pbmcsIGJhc2VkIG9uIHRoZSBmaXJzdAoJICAgICAqICAgICAgICAgdHdvIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBsb2NhdGVkLiBJbiBzb21lIGNhc2VzIHRoZWlyIHBvc2l0aW9uIHdpbGwKCSAgICAgKiAgICAgICAgIGFsbG93IHVzIHRvIGluZmVyIHRoYXQgdGhlIHRoaXJkIHBhdHRlcm4gbXVzdCBsaWUgYmVsb3cgYSBjZXJ0YWluIHBvaW50IGZhcnRoZXIKCSAgICAgKiAgICAgICAgIGRvd24gaW4gdGhlIGltYWdlLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmZpbmRSb3dTa2lwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKG1heCA8PSAxKSB7CgkgICAgICAgICAgICByZXR1cm4gMDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBudWxsOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9jID0gX2IubmV4dCgpOyAhX2MuZG9uZTsgX2MgPSBfYi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gX2MudmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RDb25maXJtZWRDZW50ZXIgPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBjZW50ZXI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHR3byBjb25maXJtZWQgY2VudGVycwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93IGZhciBkb3duIGNhbiB3ZSBza2lwIGJlZm9yZSByZXN1bWluZyBsb29raW5nIGZvciB0aGUgbmV4dAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF0dGVybj8gSW4gdGhlIHdvcnN0IGNhc2UsIG9ubHkgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIHggLyB5IGNvb3JkaW5hdGVzIG9mIHRoZSB0d28gY2VudGVycy4KCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgeW91IGZpbmQgdG9wIGxlZnQgbGFzdC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzU2tpcHBlZCA9IHRydWU7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLyooaW50KSAqLyBNYXRoLmZsb29yKChNYXRoLmFicyhmaXJzdENvbmZpcm1lZENlbnRlci5nZXRYKCkgLSBjZW50ZXIuZ2V0WCgpKSAtCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmlyc3RDb25maXJtZWRDZW50ZXIuZ2V0WSgpIC0gY2VudGVyLmdldFkoKSkpIC8gMik7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChfYyAmJiAhX2MuZG9uZSAmJiAoX2EgPSBfYi5yZXR1cm4pKSBfYS5jYWxsKF9iKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZmYgd2UgaGF2ZSBmb3VuZCBhdCBsZWFzdCAzIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZAoJICAgICAqICAgICAgICAgYXQgbGVhc3Qge0BsaW5rICNDRU5URVJfUVVPUlVNfSB0aW1lcyBlYWNoLCBhbmQsIHRoZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgb2YgdGhlCgkgICAgICogICAgICAgICBjYW5kaWRhdGVzIGlzICJwcmV0dHkgc2ltaWxhciIKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8yLCBfYSwgZV8zLCBfYjsKCSAgICAgICAgdmFyIGNvbmZpcm1lZENvdW50ID0gMDsKCSAgICAgICAgdmFyIHRvdGFsTW9kdWxlU2l6ZSA9IDAuMDsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9jID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZCA9IF9jLm5leHQoKTsgIV9kLmRvbmU7IF9kID0gX2MubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZC52YWx1ZTsKCSAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBjb25maXJtZWRDb3VudCsrOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcGF0dGVybi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzJfMSkgeyBlXzIgPSB7IGVycm9yOiBlXzJfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2QgJiYgIV9kLmRvbmUgJiYgKF9hID0gX2MucmV0dXJuKSkgX2EuY2FsbChfYyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvbmZpcm1lZENvdW50IDwgMykgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIE9LLCB3ZSBoYXZlIGF0IGxlYXN0IDMgY29uZmlybWVkIGNlbnRlcnMsIGJ1dCwgaXQncyBwb3NzaWJsZSB0aGF0IG9uZSBpcyBhICJmYWxzZSBwb3NpdGl2ZSIKCSAgICAgICAgLy8gYW5kIHRoYXQgd2UgbmVlZCB0byBrZWVwIGxvb2tpbmcuIFdlIGRldGVjdCB0aGlzIGJ5IGFza2luZyBpZiB0aGUgZXN0aW1hdGVkIG1vZHVsZSBzaXplcwoJICAgICAgICAvLyB2YXJ5IHRvbyBtdWNoLiBXZSBhcmJpdHJhcmlseSBzYXkgdGhhdCB3aGVuIHRoZSB0b3RhbCBkZXZpYXRpb24gZnJvbSBhdmVyYWdlIGV4Y2VlZHMKCSAgICAgICAgLy8gNSUgb2YgdGhlIHRvdGFsIG1vZHVsZSBzaXplIGVzdGltYXRlcywgaXQncyB0b28gbXVjaC4KCSAgICAgICAgdmFyIGF2ZXJhZ2UgPSB0b3RhbE1vZHVsZVNpemUgLyBtYXg7CgkgICAgICAgIHZhciB0b3RhbERldmlhdGlvbiA9IDAuMDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9lID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZiA9IF9lLm5leHQoKTsgIV9mLmRvbmU7IF9mID0gX2UubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZi52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbERldmlhdGlvbiArPSBNYXRoLmFicyhwYXR0ZXJuLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzNfMSkgeyBlXzMgPSB7IGVycm9yOiBlXzNfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2YgJiYgIV9mLmRvbmUgJiYgKF9iID0gX2UucmV0dXJuKSkgX2IuY2FsbChfZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMykgdGhyb3cgZV8zLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRvdGFsRGV2aWF0aW9uIDw9IDAuMDUgKiB0b3RhbE1vZHVsZVNpemU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSAzIGJlc3Qge0BsaW5rIEZpbmRlclBhdHRlcm59cyBmcm9tIG91ciBsaXN0IG9mIGNhbmRpZGF0ZXMuIFRoZSAiYmVzdCIgYXJlCgkgICAgICogICAgICAgICB0aG9zZSB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZCBhdCBsZWFzdCB7QGxpbmsgI0NFTlRFUl9RVU9SVU19IHRpbWVzLCBhbmQgd2hvc2UgbW9kdWxlCgkgICAgICogICAgICAgICBzaXplIGRpZmZlcnMgZnJvbSB0aGUgYXZlcmFnZSBhbW9uZyB0aG9zZSBwYXR0ZXJucyB0aGUgbGVhc3QKCSAgICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIGlmIDMgc3VjaCBmaW5kZXIgcGF0dGVybnMgZG8gbm90IGV4aXN0CgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuc2VsZWN0QmVzdFBhdHRlcm5zID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV80LCBfYSwgZV81LCBfYjsKCSAgICAgICAgdmFyIHN0YXJ0U2l6ZSA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKHN0YXJ0U2l6ZSA8IDMpIHsKCSAgICAgICAgICAgIC8vIENvdWxkbid0IGZpbmQgZW5vdWdoIGZpbmRlciBwYXR0ZXJucwoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBvc3NpYmxlQ2VudGVycyA9IHRoaXMucG9zc2libGVDZW50ZXJzOwoJICAgICAgICB2YXIgYXZlcmFnZTsKCSAgICAgICAgLy8gRmlsdGVyIG91dGxpZXIgcG9zc2liaWxpdGllcyB3aG9zZSBtb2R1bGUgc2l6ZSBpcyB0b28gZGlmZmVyZW50CgkgICAgICAgIGlmIChzdGFydFNpemUgPiAzKSB7CgkgICAgICAgICAgICAvLyBCdXQgd2UgY2FuIG9ubHkgYWZmb3JkIHRvIGRvIHNvIGlmIHdlIGhhdmUgYXQgbGVhc3QgNCBwb3NzaWJpbGl0aWVzIHRvIGNob29zZSBmcm9tCgkgICAgICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMC4wOwoJICAgICAgICAgICAgdmFyIHNxdWFyZSA9IDAuMDsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgX2MgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9kID0gX2MubmV4dCgpOyAhX2QuZG9uZTsgX2QgPSBfYy5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IF9kLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGNlbnRlci5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgICAgIHRvdGFsTW9kdWxlU2l6ZSArPSBzaXplOwoJICAgICAgICAgICAgICAgICAgICBzcXVhcmUgKz0gc2l6ZSAqIHNpemU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgY2F0Y2ggKGVfNF8xKSB7IGVfNCA9IHsgZXJyb3I6IGVfNF8xIH07IH0KCSAgICAgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChfZCAmJiAhX2QuZG9uZSAmJiAoX2EgPSBfYy5yZXR1cm4pKSBfYS5jYWxsKF9jKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzQpIHRocm93IGVfNC5lcnJvcjsgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYXZlcmFnZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIHN0YXJ0U2l6ZTsKCSAgICAgICAgICAgIHZhciBzdGREZXYgPSBNYXRoLnNxcnQoc3F1YXJlIC8gc3RhcnRTaXplIC0gYXZlcmFnZSAqIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzLnNvcnQoCgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIDxwPk9yZGVycyBieSBmdXJ0aGVzdCBmcm9tIGF2ZXJhZ2U8L3A+CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIEZ1cnRoZXN0RnJvbUF2ZXJhZ2VDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICB2YXIgZEEgPSBNYXRoLmFicyhjZW50ZXIyLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgICAgIHZhciBkQiA9IE1hdGguYWJzKGNlbnRlcjEuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAtMSA6IGRBID4gZEIgPyAxIDogMDsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgdmFyIGxpbWl0ID0gTWF0aC5tYXgoMC4yICogYXZlcmFnZSwgc3RkRGV2KTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zc2libGVDZW50ZXJzLmxlbmd0aCAmJiBwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMzsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBwb3NzaWJsZUNlbnRlcnNbaV07CgkgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBhdHRlcm4uZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSkgPiBsaW1pdCkgewoJICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKGksIDEpOwoJICAgICAgICAgICAgICAgICAgICBpLS07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMykgewoJICAgICAgICAgICAgLy8gVGhyb3cgYXdheSBhbGwgYnV0IHRob3NlIGZpcnN0IHNpemUgY2FuZGlkYXRlIHBvaW50cyB3ZSBmb3VuZC4KCSAgICAgICAgICAgIHZhciB0b3RhbE1vZHVsZVNpemUgPSAwLjA7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGZvciAodmFyIHBvc3NpYmxlQ2VudGVyc18xID0gX192YWx1ZXMocG9zc2libGVDZW50ZXJzKSwgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKTsgIXBvc3NpYmxlQ2VudGVyc18xXzEuZG9uZTsgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXIgPSBwb3NzaWJsZUNlbnRlcnNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcG9zc2libGVDZW50ZXIuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGNhdGNoIChlXzVfMSkgeyBlXzUgPSB7IGVycm9yOiBlXzVfMSB9OyB9CgkgICAgICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICBpZiAocG9zc2libGVDZW50ZXJzXzFfMSAmJiAhcG9zc2libGVDZW50ZXJzXzFfMS5kb25lICYmIChfYiA9IHBvc3NpYmxlQ2VudGVyc18xLnJldHVybikpIF9iLmNhbGwocG9zc2libGVDZW50ZXJzXzEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfNSkgdGhyb3cgZV81LmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhdmVyYWdlID0gdG90YWxNb2R1bGVTaXplIC8gcG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5zb3J0KAoJICAgICAgICAgICAgLyoqCgkgICAgICAgICAgICAgKiA8cD5PcmRlcnMgYnkge0BsaW5rIEZpbmRlclBhdHRlcm4jZ2V0Q291bnQoKX0sIGRlc2NlbmRpbmcuPC9wPgoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICAvLyBDZW50ZXJDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICBpZiAoY2VudGVyMi5nZXRDb3VudCgpID09PSBjZW50ZXIxLmdldENvdW50KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRBID0gTWF0aC5hYnMoY2VudGVyMi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRCID0gTWF0aC5hYnMoY2VudGVyMS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAxIDogZEEgPiBkQiA/IC0xIDogMDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW50ZXIyLmdldENvdW50KCkgLSBjZW50ZXIxLmdldENvdW50KCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKDMpOyAvLyB0aGlzIGlzIG5vdCByZWFseSBuZWNlc3NhcnkgYXMgd2Ugb25seSByZXR1cm4gZmlyc3QgMyBhbnl3YXkKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzBdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzFdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzJdCgkgICAgICAgIF07CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLkNFTlRFUl9RVU9SVU0gPSAyOwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuTUlOX1NLSVAgPSAzOyAvLyAxIHBpeGVsL21vZHVsZSB0aW1lcyAzIG1vZHVsZXMvY2VudGVyCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUyA9IDU3OyAvLyBzdXBwb3J0IHVwIHRvIHZlcnNpb24gMTAgZm9yIG1vYmlsZSBjbGllbnRzCgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJRmluZGVyUGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuRmluZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGV0ZWN0b3IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIE1hdGhVdGlsc18xID0gTWF0aFV0aWxzJDE7Cgl2YXIgRGV0ZWN0b3JSZXN1bHRfMSA9IERldGVjdG9yUmVzdWx0JDE7CgkvLyBpbXBvcnQgR3JpZFNhbXBsZXIgZnJvbSAnLi4vLi4vY29tbW9uL0dyaWRTYW1wbGVyJzsKCXZhciBHcmlkU2FtcGxlckluc3RhbmNlXzEgPSBHcmlkU2FtcGxlckluc3RhbmNlJDE7Cgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtJDE7Cgl2YXIgRGVjb2RlSGludFR5cGVfMSQxID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdFBvaW50XzEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIFZlcnNpb25fMSA9IFZlcnNpb24kMTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyXzEgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDE7Cgl2YXIgRmluZGVyUGF0dGVybkZpbmRlcl8xID0gRmluZGVyUGF0dGVybkZpbmRlciQxOwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgbG9naWMgdGhhdCBjYW4gZGV0ZWN0IGEgUVIgQ29kZSBpbiBhbiBpbWFnZSwgZXZlbiBpZiB0aGUgUVIgQ29kZQoJICogaXMgcm90YXRlZCBvciBza2V3ZWQsIG9yIHBhcnRpYWxseSBvYnNjdXJlZC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERldGVjdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERldGVjdG9yKGltYWdlKSB7CgkgICAgICAgIHRoaXMuaW1hZ2UgPSBpbWFnZTsKCSAgICB9CgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLmdldEltYWdlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5pbWFnZTsKCSAgICB9OwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5nZXRSZXN1bHRQb2ludENhbGxiYWNrID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBkZXRlY3QoKTogRGV0ZWN0b3JSZXN1bHQgLyp0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZXRlY3QobnVsbCkKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGhpbnRzIG9wdGlvbmFsIGhpbnRzIHRvIGRldGVjdG9yCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAoaGludHMpIHsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gKGhpbnRzID09PSBudWxsIHx8IGhpbnRzID09PSB1bmRlZmluZWQpID8gbnVsbCA6CgkgICAgICAgICAgICAvKihSZXN1bHRQb2ludENhbGxiYWNrKSAqLyBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQxLmRlZmF1bHQuTkVFRF9SRVNVTFRfUE9JTlRfQ0FMTEJBQ0spOwoJICAgICAgICB2YXIgZmluZGVyID0gbmV3IEZpbmRlclBhdHRlcm5GaW5kZXJfMS5kZWZhdWx0KHRoaXMuaW1hZ2UsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHZhciBpbmZvID0gZmluZGVyLmZpbmQoaGludHMpOwoJICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmluZGVyUGF0dGVybkluZm8oaW5mbyk7CgkgICAgfTsKCSAgICBEZXRlY3Rvci5wcm90b3R5cGUucHJvY2Vzc0ZpbmRlclBhdHRlcm5JbmZvID0gZnVuY3Rpb24gKGluZm8pIHsKCSAgICAgICAgdmFyIHRvcExlZnQgPSBpbmZvLmdldFRvcExlZnQoKTsKCSAgICAgICAgdmFyIHRvcFJpZ2h0ID0gaW5mby5nZXRUb3BSaWdodCgpOwoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IGluZm8uZ2V0Qm90dG9tTGVmdCgpOwoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMuY2FsY3VsYXRlTW9kdWxlU2l6ZSh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCk7CgkgICAgICAgIGlmIChtb2R1bGVTaXplIDwgMS4wKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ05vIHBhdHRlcm4gZm91bmQgaW4gcHJvY2Nlc3MgZmluZGVyLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkaW1lbnNpb24gPSBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHByb3Zpc2lvbmFsVmVyc2lvbiA9IFZlcnNpb25fMS5kZWZhdWx0LmdldFByb3Zpc2lvbmFsVmVyc2lvbkZvckRpbWVuc2lvbihkaW1lbnNpb24pOwoJICAgICAgICB2YXIgbW9kdWxlc0JldHdlZW5GUENlbnRlcnMgPSBwcm92aXNpb25hbFZlcnNpb24uZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpIC0gNzsKCSAgICAgICAgdmFyIGFsaWdubWVudFBhdHRlcm4gPSBudWxsOwoJICAgICAgICAvLyBBbnl0aGluZyBhYm92ZSB2ZXJzaW9uIDEgaGFzIGFuIGFsaWdubWVudCBwYXR0ZXJuCgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24uZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMoKS5sZW5ndGggPiAwKSB7CgkgICAgICAgICAgICAvLyBHdWVzcyB3aGVyZSBhICJib3R0b20gcmlnaHQiIGZpbmRlciBwYXR0ZXJuIHdvdWxkIGhhdmUgYmVlbgoJICAgICAgICAgICAgdmFyIGJvdHRvbVJpZ2h0WCA9IHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpICsgYm90dG9tTGVmdC5nZXRYKCk7CgkgICAgICAgICAgICB2YXIgYm90dG9tUmlnaHRZID0gdG9wUmlnaHQuZ2V0WSgpIC0gdG9wTGVmdC5nZXRZKCkgKyBib3R0b21MZWZ0LmdldFkoKTsKCSAgICAgICAgICAgIC8vIEVzdGltYXRlIHRoYXQgYWxpZ25tZW50IHBhdHRlcm4gaXMgY2xvc2VyIGJ5IDMgbW9kdWxlcwoJICAgICAgICAgICAgLy8gZnJvbSAiYm90dG9tIHJpZ2h0IiB0byBrbm93biB0b3AgbGVmdCBsb2NhdGlvbgoJICAgICAgICAgICAgdmFyIGNvcnJlY3Rpb25Ub1RvcExlZnQgPSAxLjAgLSAzLjAgLyBtb2R1bGVzQmV0d2VlbkZQQ2VudGVyczsKCSAgICAgICAgICAgIHZhciBlc3RBbGlnbm1lbnRYID0gLyooaW50KSAqLyBNYXRoLmZsb29yKHRvcExlZnQuZ2V0WCgpICsgY29ycmVjdGlvblRvVG9wTGVmdCAqIChib3R0b21SaWdodFggLSB0b3BMZWZ0LmdldFgoKSkpOwoJICAgICAgICAgICAgdmFyIGVzdEFsaWdubWVudFkgPSAvKihpbnQpICovIE1hdGguZmxvb3IodG9wTGVmdC5nZXRZKCkgKyBjb3JyZWN0aW9uVG9Ub3BMZWZ0ICogKGJvdHRvbVJpZ2h0WSAtIHRvcExlZnQuZ2V0WSgpKSk7CgkgICAgICAgICAgICAvLyBLaW5kIG9mIGFyYml0cmFyeSAtLSBleHBhbmQgc2VhcmNoIHJhZGl1cyBiZWZvcmUgZ2l2aW5nIHVwCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gNDsgaSA8PSAxNjsgaSA8PD0gMSkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudFBhdHRlcm4gPSB0aGlzLmZpbmRBbGlnbm1lbnRJblJlZ2lvbihtb2R1bGVTaXplLCBlc3RBbGlnbm1lbnRYLCBlc3RBbGlnbm1lbnRZLCBpKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNhdGNoIChyZSAvKk5vdEZvdW5kRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCEocmUgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHJlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIHRyeSBuZXh0IHJvdW5kCgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSWYgd2UgZGlkbid0IGZpbmQgYWxpZ25tZW50IHBhdHRlcm4uLi4gd2VsbCB0cnkgYW55d2F5IHdpdGhvdXQgaXQKCSAgICAgICAgfQoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gRGV0ZWN0b3IuY3JlYXRlVHJhbnNmb3JtKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBhbGlnbm1lbnRQYXR0ZXJuLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgYml0cyA9IERldGVjdG9yLnNhbXBsZUdyaWQodGhpcy5pbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgcG9pbnRzOwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgcG9pbnRzID0gW2JvdHRvbUxlZnQsIHRvcExlZnQsIHRvcFJpZ2h0XTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHBvaW50cyA9IFtib3R0b21MZWZ0LCB0b3BMZWZ0LCB0b3BSaWdodCwgYWxpZ25tZW50UGF0dGVybl07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBEZXRlY3RvclJlc3VsdF8xLmRlZmF1bHQoYml0cywgcG9pbnRzKTsKCSAgICB9OwoJICAgIERldGVjdG9yLmNyZWF0ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCwgYWxpZ25tZW50UGF0dGVybiwgZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGRpbU1pbnVzVGhyZWUgPSBkaW1lbnNpb24gLSAzLjU7CgkgICAgICAgIHZhciBib3R0b21SaWdodFg7IC8qZmxvYXQqLwoJICAgICAgICB2YXIgYm90dG9tUmlnaHRZOyAvKmZsb2F0Ki8KCSAgICAgICAgdmFyIHNvdXJjZUJvdHRvbVJpZ2h0WDsgLypmbG9hdCovCgkgICAgICAgIHZhciBzb3VyY2VCb3R0b21SaWdodFk7IC8qZmxvYXQqLwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiAhPT0gbnVsbCkgewoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gYWxpZ25tZW50UGF0dGVybi5nZXRYKCk7CgkgICAgICAgICAgICBib3R0b21SaWdodFkgPSBhbGlnbm1lbnRQYXR0ZXJuLmdldFkoKTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WCA9IGRpbU1pbnVzVGhyZWUgLSAzLjA7CgkgICAgICAgICAgICBzb3VyY2VCb3R0b21SaWdodFkgPSBzb3VyY2VCb3R0b21SaWdodFg7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBEb24ndCBoYXZlIGFuIGFsaWdubWVudCBwYXR0ZXJuLCBqdXN0IG1ha2UgdXAgdGhlIGJvdHRvbS1yaWdodCBwb2ludAoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gKHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpKSArIGJvdHRvbUxlZnQuZ2V0WCgpOwoJICAgICAgICAgICAgYm90dG9tUmlnaHRZID0gKHRvcFJpZ2h0LmdldFkoKSAtIHRvcExlZnQuZ2V0WSgpKSArIGJvdHRvbUxlZnQuZ2V0WSgpOwoJICAgICAgICAgICAgc291cmNlQm90dG9tUmlnaHRYID0gZGltTWludXNUaHJlZTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WSA9IGRpbU1pbnVzVGhyZWU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtXzEuZGVmYXVsdC5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsKDMuNSwgMy41LCBkaW1NaW51c1RocmVlLCAzLjUsIHNvdXJjZUJvdHRvbVJpZ2h0WCwgc291cmNlQm90dG9tUmlnaHRZLCAzLjUsIGRpbU1pbnVzVGhyZWUsIHRvcExlZnQuZ2V0WCgpLCB0b3BMZWZ0LmdldFkoKSwgdG9wUmlnaHQuZ2V0WCgpLCB0b3BSaWdodC5nZXRZKCksIGJvdHRvbVJpZ2h0WCwgYm90dG9tUmlnaHRZLCBib3R0b21MZWZ0LmdldFgoKSwgYm90dG9tTGVmdC5nZXRZKCkpOwoJICAgIH07CgkgICAgRGV0ZWN0b3Iuc2FtcGxlR3JpZCA9IGZ1bmN0aW9uIChpbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24gLyppbnQqLykgewoJICAgICAgICB2YXIgc2FtcGxlciA9IEdyaWRTYW1wbGVySW5zdGFuY2VfMS5kZWZhdWx0LmdldEluc3RhbmNlKCk7CgkgICAgICAgIHJldHVybiBzYW1wbGVyLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtKGltYWdlLCBkaW1lbnNpb24sIGRpbWVuc2lvbiwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkNvbXB1dGVzIHRoZSBkaW1lbnNpb24gKG51bWJlciBvZiBtb2R1bGVzIG9uIGEgc2l6ZSkgb2YgdGhlIFFSIENvZGUgYmFzZWQgb24gdGhlIHBvc2l0aW9uCgkgICAgICogb2YgdGhlIGZpbmRlciBwYXR0ZXJucyBhbmQgZXN0aW1hdGVkIG1vZHVsZSBzaXplLjwvcD4KCSAgICAgKi8KCSAgICBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uID0gZnVuY3Rpb24gKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdGx0ckNlbnRlcnNEaW1lbnNpb24gPSBNYXRoVXRpbHNfMS5kZWZhdWx0LnJvdW5kKFJlc3VsdFBvaW50XzEuZGVmYXVsdC5kaXN0YW5jZSh0b3BMZWZ0LCB0b3BSaWdodCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHRsYmxDZW50ZXJzRGltZW5zaW9uID0gTWF0aFV0aWxzXzEuZGVmYXVsdC5yb3VuZChSZXN1bHRQb2ludF8xLmRlZmF1bHQuZGlzdGFuY2UodG9wTGVmdCwgYm90dG9tTGVmdCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IE1hdGguZmxvb3IoKHRsdHJDZW50ZXJzRGltZW5zaW9uICsgdGxibENlbnRlcnNEaW1lbnNpb24pIC8gMikgKyA3OwoJICAgICAgICBzd2l0Y2ggKGRpbWVuc2lvbiAmIDB4MDMpIHsgLy8gbW9kIDQKCSAgICAgICAgICAgIGNhc2UgMDoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24rKzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIC8vIDE/IGRvIG5vdGhpbmcKCSAgICAgICAgICAgIGNhc2UgMjoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24tLTsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ0RpbWVuc2lvbnMgY291bGQgYmUgbm90IGZvdW5kLicpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBkaW1lbnNpb247CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5Db21wdXRlcyBhbiBhdmVyYWdlIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBiYXNlZCBvbiBlc3RpbWF0ZWQgZGVyaXZlZCBmcm9tIHRoZSBwb3NpdGlvbnMKCSAgICAgKiBvZiB0aGUgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB0b3BMZWZ0IGRldGVjdGVkIHRvcC1sZWZ0IGZpbmRlciBwYXR0ZXJuIGNlbnRlcgoJICAgICAqIEBwYXJhbSB0b3BSaWdodCBkZXRlY3RlZCB0b3AtcmlnaHQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHBhcmFtIGJvdHRvbUxlZnQgZGV0ZWN0ZWQgYm90dG9tLWxlZnQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHJldHVybiBlc3RpbWF0ZWQgbW9kdWxlIHNpemUKCSAgICAgKi8KCSAgICBEZXRlY3Rvci5wcm90b3R5cGUuY2FsY3VsYXRlTW9kdWxlU2l6ZSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCkgewoJICAgICAgICAvLyBUYWtlIHRoZSBhdmVyYWdlCgkgICAgICAgIHJldHVybiAodGhpcy5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5KHRvcExlZnQsIHRvcFJpZ2h0KSArCgkgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZU1vZHVsZVNpemVPbmVXYXkodG9wTGVmdCwgYm90dG9tTGVmdCkpIC8gMi4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RXN0aW1hdGVzIG1vZHVsZSBzaXplIGJhc2VkIG9uIHR3byBmaW5kZXIgcGF0dGVybnMgLS0gaXQgdXNlcwoJICAgICAqIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuQm90aFdheXMoaW50LCBpbnQsIGludCwgaW50KX0gdG8gZmlndXJlIHRoZQoJICAgICAqIHdpZHRoIG9mIGVhY2gsIG1lYXN1cmluZyBhbG9uZyB0aGUgYXhpcyBiZXR3ZWVuIHRoZWlyIGNlbnRlcnMuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5ID0gZnVuY3Rpb24gKHBhdHRlcm4sIG90aGVyUGF0dGVybikgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZUVzdDEgPSB0aGlzLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzKC8qKGludCkgKi8gTWF0aC5mbG9vcihwYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRZKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRZKCkpKTsKCSAgICAgICAgdmFyIG1vZHVsZVNpemVFc3QyID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW5Cb3RoV2F5cygvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFkoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKHBhdHRlcm4uZ2V0WSgpKSk7CgkgICAgICAgIGlmIChpc05hTihtb2R1bGVTaXplRXN0MSkpIHsKCSAgICAgICAgICAgIHJldHVybiBtb2R1bGVTaXplRXN0MiAvIDcuMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaXNOYU4obW9kdWxlU2l6ZUVzdDIpKSB7CgkgICAgICAgICAgICByZXR1cm4gbW9kdWxlU2l6ZUVzdDEgLyA3LjA7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQXZlcmFnZSB0aGVtLCBhbmQgZGl2aWRlIGJ5IDcgc2luY2Ugd2UndmUgY291bnRlZCB0aGUgd2lkdGggb2YgMyBibGFjayBtb2R1bGVzLAoJICAgICAgICAvLyBhbmQgMSB3aGl0ZSBhbmQgMSBibGFjayBtb2R1bGUgb24gZWl0aGVyIHNpZGUuIEVyZ28sIGRpdmlkZSBzdW0gYnkgMTQuCgkgICAgICAgIHJldHVybiAobW9kdWxlU2l6ZUVzdDEgKyBtb2R1bGVTaXplRXN0MikgLyAxNC4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuKGludCwgaW50LCBpbnQsIGludCl9OyBjb21wdXRlcyB0aGUgdG90YWwgd2lkdGggb2YKCSAgICAgKiBhIGZpbmRlciBwYXR0ZXJuIGJ5IGxvb2tpbmcgZm9yIGEgYmxhY2std2hpdGUtYmxhY2sgcnVuIGZyb20gdGhlIGNlbnRlciBpbiB0aGUgZGlyZWN0aW9uCgkgICAgICogb2YgYW5vdGhlciBwb2ludCAoYW5vdGhlciBmaW5kZXIgcGF0dGVybiBjZW50ZXIpLCBhbmQgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiB0b28uCgkgICAgICovCgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzID0gZnVuY3Rpb24gKGZyb21YIC8qaW50Ki8sIGZyb21ZIC8qaW50Ki8sIHRvWCAvKmludCovLCB0b1kgLyppbnQqLykgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCB0b1gsIHRvWSk7CgkgICAgICAgIC8vIE5vdyBjb3VudCBvdGhlciB3YXkgLS0gZG9uJ3QgcnVuIG9mZiBpbWFnZSB0aG91Z2ggb2YgY291cnNlCgkgICAgICAgIHZhciBzY2FsZSA9IDEuMDsKCSAgICAgICAgdmFyIG90aGVyVG9YID0gZnJvbVggLSAodG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAob3RoZXJUb1ggPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21YIC8gLyooZmxvYXQpICovIChmcm9tWCAtIG90aGVyVG9YKTsKCSAgICAgICAgICAgIG90aGVyVG9YID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWCA+PSB0aGlzLmltYWdlLmdldFdpZHRoKCkpIHsKCSAgICAgICAgICAgIHNjYWxlID0gKHRoaXMuaW1hZ2UuZ2V0V2lkdGgoKSAtIDEgLSBmcm9tWCkgLyAvKihmbG9hdCkgKi8gKG90aGVyVG9YIC0gZnJvbVgpOwoJICAgICAgICAgICAgb3RoZXJUb1ggPSB0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlclRvWSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihmcm9tWSAtICh0b1kgLSBmcm9tWSkgKiBzY2FsZSk7CgkgICAgICAgIHNjYWxlID0gMS4wOwoJICAgICAgICBpZiAob3RoZXJUb1kgPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21ZIC8gLyooZmxvYXQpICovIChmcm9tWSAtIG90aGVyVG9ZKTsKCSAgICAgICAgICAgIG90aGVyVG9ZID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWSA+PSB0aGlzLmltYWdlLmdldEhlaWdodCgpKSB7CgkgICAgICAgICAgICBzY2FsZSA9ICh0aGlzLmltYWdlLmdldEhlaWdodCgpIC0gMSAtIGZyb21ZKSAvIC8qKGZsb2F0KSAqLyAob3RoZXJUb1kgLSBmcm9tWSk7CgkgICAgICAgICAgICBvdGhlclRvWSA9IHRoaXMuaW1hZ2UuZ2V0SGVpZ2h0KCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIG90aGVyVG9YID0gLyooaW50KSAqLyBNYXRoLmZsb29yKGZyb21YICsgKG90aGVyVG9YIC0gZnJvbVgpICogc2NhbGUpOwoJICAgICAgICByZXN1bHQgKz0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCBvdGhlclRvWCwgb3RoZXJUb1kpOwoJICAgICAgICAvLyBNaWRkbGUgcGl4ZWwgaXMgZG91YmxlLWNvdW50ZWQgdGhpcyB3YXk7IHN1YnRyYWN0IDEKCSAgICAgICAgcmV0dXJuIHJlc3VsdCAtIDEuMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHRyYWNlcyBhIGxpbmUgZnJvbSBhIHBvaW50IGluIHRoZSBpbWFnZSwgaW4gdGhlIGRpcmVjdGlvbiB0b3dhcmRzIGFub3RoZXIgcG9pbnQuCgkgICAgICogSXQgYmVnaW5zIGluIGEgYmxhY2sgcmVnaW9uLCBhbmQga2VlcHMgZ29pbmcgdW50aWwgaXQgZmluZHMgd2hpdGUsIHRoZW4gYmxhY2ssIHRoZW4gd2hpdGUgYWdhaW4uCgkgICAgICogSXQgcmVwb3J0cyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQgdG8gdGhpcyBwb2ludC48L3A+CgkgICAgICoKCSAgICAgKiA8cD5UaGlzIGlzIHVzZWQgd2hlbiBmaWd1cmluZyBvdXQgaG93IHdpZGUgYSBmaW5kZXIgcGF0dGVybiBpcywgd2hlbiB0aGUgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBtYXkgYmUgc2tld2VkIG9yIHJvdGF0ZWQuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4gPSBmdW5jdGlvbiAoZnJvbVggLyppbnQqLywgZnJvbVkgLyppbnQqLywgdG9YIC8qaW50Ki8sIHRvWSAvKmludCovKSB7CgkgICAgICAgIC8vIE1pbGQgdmFyaWFudCBvZiBCcmVzZW5oYW0ncyBhbGdvcml0aG0KCSAgICAgICAgLy8gc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQnJlc2VuaGFtJ3NfbGluZV9hbGdvcml0aG0KCSAgICAgICAgdmFyIHN0ZWVwID0gTWF0aC5hYnModG9ZIC0gZnJvbVkpID4gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAoc3RlZXApIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZnJvbVg7CgkgICAgICAgICAgICBmcm9tWCA9IGZyb21ZOwoJICAgICAgICAgICAgZnJvbVkgPSB0ZW1wOwoJICAgICAgICAgICAgdGVtcCA9IHRvWDsKCSAgICAgICAgICAgIHRvWCA9IHRvWTsKCSAgICAgICAgICAgIHRvWSA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyh0b1kgLSBmcm9tWSk7CgkgICAgICAgIHZhciBlcnJvciA9IC1keCAvIDI7CgkgICAgICAgIHZhciB4c3RlcCA9IGZyb21YIDwgdG9YID8gMSA6IC0xOwoJICAgICAgICB2YXIgeXN0ZXAgPSBmcm9tWSA8IHRvWSA/IDEgOiAtMTsKCSAgICAgICAgLy8gSW4gYmxhY2sgcGl4ZWxzLCBsb29raW5nIGZvciB3aGl0ZSwgZmlyc3Qgb3Igc2Vjb25kIHRpbWUuCgkgICAgICAgIHZhciBzdGF0ZSA9IDA7CgkgICAgICAgIC8vIExvb3AgdXAgdW50aWwgeCA9PSB0b1gsIGJ1dCBub3QgYmV5b25kCgkgICAgICAgIHZhciB4TGltaXQgPSB0b1ggKyB4c3RlcDsKCSAgICAgICAgZm9yICh2YXIgeCA9IGZyb21YLCB5ID0gZnJvbVk7IHggIT09IHhMaW1pdDsgeCArPSB4c3RlcCkgewoJICAgICAgICAgICAgdmFyIHJlYWxYID0gc3RlZXAgPyB5IDogeDsKCSAgICAgICAgICAgIHZhciByZWFsWSA9IHN0ZWVwID8geCA6IHk7CgkgICAgICAgICAgICAvLyBEb2VzIGN1cnJlbnQgcGl4ZWwgbWVhbiB3ZSBoYXZlIG1vdmVkIHdoaXRlIHRvIGJsYWNrIG9yIHZpY2UgdmVyc2E/CgkgICAgICAgICAgICAvLyBTY2FubmluZyBibGFjayBpbiBzdGF0ZSAwLDIgYW5kIHdoaXRlIGluIHN0YXRlIDEsIHNvIGlmIHdlIGZpbmQgdGhlIHdyb25nCgkgICAgICAgICAgICAvLyBjb2xvciwgYWR2YW5jZSB0byBuZXh0IHN0YXRlIG9yIGVuZCBpZiB3ZSBhcmUgaW4gc3RhdGUgMiBhbHJlYWR5CgkgICAgICAgICAgICBpZiAoKHN0YXRlID09PSAxKSA9PT0gdGhpcy5pbWFnZS5nZXQocmVhbFgsIHJlYWxZKSkgewoJICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aFV0aWxzXzEuZGVmYXVsdC5kaXN0YW5jZSh4LCB5LCBmcm9tWCwgZnJvbVkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBzdGF0ZSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZXJyb3IgKz0gZHk7CgkgICAgICAgICAgICBpZiAoZXJyb3IgPiAwKSB7CgkgICAgICAgICAgICAgICAgaWYgKHkgPT09IHRvWSkgewoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgeSArPSB5c3RlcDsKCSAgICAgICAgICAgICAgICBlcnJvciAtPSBkeDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBGb3VuZCBibGFjay13aGl0ZS1ibGFjazsgZ2l2ZSB0aGUgYmVuZWZpdCBvZiB0aGUgZG91YnQgdGhhdCB0aGUgbmV4dCBwaXhlbCBvdXRzaWRlIHRoZSBpbWFnZQoJICAgICAgICAvLyBpcyAid2hpdGUiIHNvIHRoaXMgbGFzdCBwb2ludCBhdCAodG9YK3hTdGVwLHRvWSkgaXMgdGhlIHJpZ2h0IGVuZGluZy4gVGhpcyBpcyByZWFsbHkgYQoJICAgICAgICAvLyBzbWFsbCBhcHByb3hpbWF0aW9uOyAodG9YK3hTdGVwLHRvWSt5U3RlcCkgbWlnaHQgYmUgcmVhbGx5IGNvcnJlY3QuIElnbm9yZSB0aGlzLgoJICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKCSAgICAgICAgICAgIHJldHVybiBNYXRoVXRpbHNfMS5kZWZhdWx0LmRpc3RhbmNlKHRvWCArIHhzdGVwLCB0b1ksIGZyb21YLCBmcm9tWSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gZWxzZSB3ZSBkaWRuJ3QgZmluZCBldmVuIGJsYWNrLXdoaXRlLWJsYWNrOyBubyBlc3RpbWF0ZSBpcyByZWFsbHkgcG9zc2libGUKCSAgICAgICAgcmV0dXJuIE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkF0dGVtcHRzIHRvIGxvY2F0ZSBhbiBhbGlnbm1lbnQgcGF0dGVybiBpbiBhIGxpbWl0ZWQgcmVnaW9uIG9mIHRoZSBpbWFnZSwgd2hpY2ggaXMKCSAgICAgKiBndWVzc2VkIHRvIGNvbnRhaW4gaXQuIFRoaXMgbWV0aG9kIHVzZXMge0BsaW5rIEFsaWdubWVudFBhdHRlcm59LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBvdmVyYWxsRXN0TW9kdWxlU2l6ZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgc28gZmFyCgkgICAgICogQHBhcmFtIGVzdEFsaWdubWVudFggeCBjb29yZGluYXRlIG9mIGNlbnRlciBvZiBhcmVhIHByb2JhYmx5IGNvbnRhaW5pbmcgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gZXN0QWxpZ25tZW50WSB5IGNvb3JkaW5hdGUgb2YgYWJvdmUKCSAgICAgKiBAcGFyYW0gYWxsb3dhbmNlRmFjdG9yIG51bWJlciBvZiBwaXhlbHMgaW4gYWxsIGRpcmVjdGlvbnMgdG8gc2VhcmNoIGZyb20gdGhlIGNlbnRlcgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kLCBvciBudWxsIG90aGVyd2lzZQoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgYW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnMgZHVyaW5nIGRldGVjdGlvbgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5maW5kQWxpZ25tZW50SW5SZWdpb24gPSBmdW5jdGlvbiAob3ZlcmFsbEVzdE1vZHVsZVNpemUgLypmbG9hdCovLCBlc3RBbGlnbm1lbnRYIC8qaW50Ki8sIGVzdEFsaWdubWVudFkgLyppbnQqLywgYWxsb3dhbmNlRmFjdG9yIC8qZmxvYXQqLykgewoJICAgICAgICAvLyBMb29rIGZvciBhbiBhbGlnbm1lbnQgcGF0dGVybiAoMyBtb2R1bGVzIGluIHNpemUpIGFyb3VuZCB3aGVyZSBpdAoJICAgICAgICAvLyBzaG91bGQgYmUKCSAgICAgICAgdmFyIGFsbG93YW5jZSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihhbGxvd2FuY2VGYWN0b3IgKiBvdmVyYWxsRXN0TW9kdWxlU2l6ZSk7CgkgICAgICAgIHZhciBhbGlnbm1lbnRBcmVhTGVmdFggPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRYIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFSaWdodFggPSBNYXRoLm1pbih0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxLCBlc3RBbGlnbm1lbnRYICsgYWxsb3dhbmNlKTsKCSAgICAgICAgaWYgKGFsaWdubWVudEFyZWFSaWdodFggLSBhbGlnbm1lbnRBcmVhTGVmdFggPCBvdmVyYWxsRXN0TW9kdWxlU2l6ZSAqIDMpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgnQWxpZ25tZW50IHRvcCBleGNlZWRzIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS4nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYWxpZ25tZW50QXJlYVRvcFkgPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRZIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFCb3R0b21ZID0gTWF0aC5taW4odGhpcy5pbWFnZS5nZXRIZWlnaHQoKSAtIDEsIGVzdEFsaWdubWVudFkgKyBhbGxvd2FuY2UpOwoJICAgICAgICBpZiAoYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSA8IG92ZXJhbGxFc3RNb2R1bGVTaXplICogMykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMS5kZWZhdWx0KCdBbGlnbm1lbnQgYm90dG9tIGV4Y2VlZHMgZXN0aW1hdGVkIG1vZHVsZSBzaXplLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhbGlnbm1lbnRGaW5kZXIgPSBuZXcgQWxpZ25tZW50UGF0dGVybkZpbmRlcl8xLmRlZmF1bHQodGhpcy5pbWFnZSwgYWxpZ25tZW50QXJlYUxlZnRYLCBhbGlnbm1lbnRBcmVhVG9wWSwgYWxpZ25tZW50QXJlYVJpZ2h0WCAtIGFsaWdubWVudEFyZWFMZWZ0WCwgYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSwgb3ZlcmFsbEVzdE1vZHVsZVNpemUsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHJldHVybiBhbGlnbm1lbnRGaW5kZXIuZmluZCgpOwoJICAgIH07CgkgICAgcmV0dXJuIERldGVjdG9yOwoJfSgpKTsKCURldGVjdG9yJDEuZGVmYXVsdCA9IERldGVjdG9yOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUVJDb2RlUmVhZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlIHsqLwoJdmFyIEJhcmNvZGVGb3JtYXRfMSA9IEJhcmNvZGVGb3JtYXQkMTsKCXZhciBCaXRNYXRyaXhfMSA9IEJpdE1hdHJpeCQxOwoJdmFyIERlY29kZUhpbnRUeXBlXzEgPSBEZWNvZGVIaW50VHlwZSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdF8xID0gUmVzdWx0JDE7Cgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlXzEgPSBSZXN1bHRNZXRhZGF0YVR5cGUkMTsKCS8vIGltcG9ydCBEZXRlY3RvclJlc3VsdCBmcm9tICcuLi9jb21tb24vRGV0ZWN0b3JSZXN1bHQnOwoJdmFyIERlY29kZXJfMSA9IERlY29kZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSA9IFFSQ29kZURlY29kZXJNZXRhRGF0YSQxOwoJdmFyIERldGVjdG9yXzEgPSBEZXRlY3RvciQxOwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5NYXA7Ki8KCS8qKgoJICogVGhpcyBpbXBsZW1lbnRhdGlvbiBjYW4gZGV0ZWN0IGFuZCBkZWNvZGUgUVIgQ29kZXMgaW4gYW4gaW1hZ2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFFSQ29kZVJlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBRUkNvZGVSZWFkZXIoKSB7CgkgICAgICAgIHRoaXMuZGVjb2RlciA9IG5ldyBEZWNvZGVyXzEuZGVmYXVsdCgpOwoJICAgIH0KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmdldERlY29kZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBMb2NhdGVzIGFuZCBkZWNvZGVzIGEgUVIgY29kZSBpbiBhbiBpbWFnZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gYSByZXByZXNlbnRpbmc6IHN0cmluZyB0aGUgY29udGVudCBlbmNvZGVkIGJ5IHRoZSBRUiBjb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhIFFSIGNvZGUgY2Fubm90IGJlIGZvdW5kCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgYSBRUiBjb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIC8vIHB1YmxpYyBkZWNvZGUoaW1hZ2U6IEJpbmFyeUJpdG1hcCk6IFJlc3VsdCAvKnRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiwgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiAqLyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5kZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChpbWFnZSwgaGludHMpIHsKCSAgICAgICAgdmFyIGRlY29kZXJSZXN1bHQ7CgkgICAgICAgIHZhciBwb2ludHM7CgkgICAgICAgIGlmIChoaW50cyAhPT0gdW5kZWZpbmVkICYmIGhpbnRzICE9PSBudWxsICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEuZGVmYXVsdC5QVVJFX0JBUkNPREUpKSB7CgkgICAgICAgICAgICB2YXIgYml0cyA9IFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMoaW1hZ2UuZ2V0QmxhY2tNYXRyaXgoKSk7CgkgICAgICAgICAgICBkZWNvZGVyUmVzdWx0ID0gdGhpcy5kZWNvZGVyLmRlY29kZUJpdE1hdHJpeChiaXRzLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGRldGVjdG9yUmVzdWx0ID0gbmV3IERldGVjdG9yXzEuZGVmYXVsdChpbWFnZS5nZXRCbGFja01hdHJpeCgpKS5kZXRlY3QoaGludHMpOwoJICAgICAgICAgICAgZGVjb2RlclJlc3VsdCA9IHRoaXMuZGVjb2Rlci5kZWNvZGVCaXRNYXRyaXgoZGV0ZWN0b3JSZXN1bHQuZ2V0Qml0cygpLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBkZXRlY3RvclJlc3VsdC5nZXRQb2ludHMoKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB0aGUgY29kZSB3YXMgbWlycm9yZWQ6IHN3YXAgdGhlIGJvdHRvbS1sZWZ0IGFuZCB0aGUgdG9wLXJpZ2h0IHBvaW50cy4KCSAgICAgICAgaWYgKGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKSBpbnN0YW5jZW9mIFFSQ29kZURlY29kZXJNZXRhRGF0YV8xLmRlZmF1bHQpIHsKCSAgICAgICAgICAgIGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKS5hcHBseU1pcnJvcmVkQ29ycmVjdGlvbihwb2ludHMpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgUmVzdWx0XzEuZGVmYXVsdChkZWNvZGVyUmVzdWx0LmdldFRleHQoKSwgZGVjb2RlclJlc3VsdC5nZXRSYXdCeXRlcygpLCB1bmRlZmluZWQsIHBvaW50cywgQmFyY29kZUZvcm1hdF8xLmRlZmF1bHQuUVJfQ09ERSwgdW5kZWZpbmVkKTsKCSAgICAgICAgdmFyIGJ5dGVTZWdtZW50cyA9IGRlY29kZXJSZXN1bHQuZ2V0Qnl0ZVNlZ21lbnRzKCk7CgkgICAgICAgIGlmIChieXRlU2VnbWVudHMgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkJZVEVfU0VHTUVOVFMsIGJ5dGVTZWdtZW50cyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBkZWNvZGVyUmVzdWx0LmdldEVDTGV2ZWwoKTsKCSAgICAgICAgaWYgKGVjTGV2ZWwgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwsIGVjTGV2ZWwpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChkZWNvZGVyUmVzdWx0Lmhhc1N0cnVjdHVyZWRBcHBlbmQoKSkgewoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UsIGRlY29kZXJSZXN1bHQuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyKCkpOwoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfUEFSSVRZLCBkZWNvZGVyUmVzdWx0LmdldFN0cnVjdHVyZWRBcHBlbmRQYXJpdHkoKSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBkbyBub3RoaW5nCgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBUaGlzIG1ldGhvZCBkZXRlY3RzIGEgY29kZSBpbiBhICJwdXJlIiBpbWFnZSAtLSB0aGF0IGlzLCBwdXJlIG1vbm9jaHJvbWUgaW1hZ2UKCSAgICAgKiB3aGljaCBjb250YWlucyBvbmx5IGFuIHVucm90YXRlZCwgdW5za2V3ZWQsIGltYWdlIG9mIGEgY29kZSwgd2l0aCBzb21lIHdoaXRlIGJvcmRlcgoJICAgICAqIGFyb3VuZCBpdC4gVGhpcyBpcyBhIHNwZWNpYWxpemVkIG1ldGhvZCB0aGF0IHdvcmtzIGV4Y2VwdGlvbmFsbHkgZmFzdCBpbiB0aGlzIHNwZWNpYWwKCSAgICAgKiBjYXNlLgoJICAgICAqCgkgICAgICogQHNlZSBjb20uZ29vZ2xlLnp4aW5nLmRhdGFtYXRyaXguRGF0YU1hdHJpeFJlYWRlciNleHRyYWN0UHVyZUJpdHMoQml0TWF0cml4KQoJICAgICAqLwoJICAgIFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMgPSBmdW5jdGlvbiAoaW1hZ2UpIHsKCSAgICAgICAgdmFyIGxlZnRUb3BCbGFjayA9IGltYWdlLmdldFRvcExlZnRPbkJpdCgpOwoJICAgICAgICB2YXIgcmlnaHRCb3R0b21CbGFjayA9IGltYWdlLmdldEJvdHRvbVJpZ2h0T25CaXQoKTsKCSAgICAgICAgaWYgKGxlZnRUb3BCbGFjayA9PT0gbnVsbCB8fCByaWdodEJvdHRvbUJsYWNrID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1vZHVsZVNpemUgPSB0aGlzLm1vZHVsZVNpemUobGVmdFRvcEJsYWNrLCBpbWFnZSk7CgkgICAgICAgIHZhciB0b3AgPSBsZWZ0VG9wQmxhY2tbMV07CgkgICAgICAgIHZhciBib3R0b20gPSByaWdodEJvdHRvbUJsYWNrWzFdOwoJICAgICAgICB2YXIgbGVmdCA9IGxlZnRUb3BCbGFja1swXTsKCSAgICAgICAgdmFyIHJpZ2h0ID0gcmlnaHRCb3R0b21CbGFja1swXTsKCSAgICAgICAgLy8gU2FuaXR5IGNoZWNrIQoJICAgICAgICBpZiAobGVmdCA+PSByaWdodCB8fCB0b3AgPj0gYm90dG9tKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJvdHRvbSAtIHRvcCAhPT0gcmlnaHQgLSBsZWZ0KSB7CgkgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UsIHdoZXJlIGJvdHRvbS1yaWdodCBtb2R1bGUgd2Fzbid0IGJsYWNrIHNvIHdlIGZvdW5kIHNvbWV0aGluZyBlbHNlIGluIHRoZSBsYXN0IHJvdwoJICAgICAgICAgICAgLy8gQXNzdW1lIGl0J3MgYSBzcXVhcmUsIHNvIHVzZSBoZWlnaHQgYXMgdGhlIHdpZHRoCgkgICAgICAgICAgICByaWdodCA9IGxlZnQgKyAoYm90dG9tIC0gdG9wKTsKCSAgICAgICAgICAgIGlmIChyaWdodCA+PSBpbWFnZS5nZXRXaWR0aCgpKSB7CgkgICAgICAgICAgICAgICAgLy8gQWJvcnQgaWYgdGhhdCB3b3VsZCBub3QgbWFrZSBzZW5zZSAtLSBvZmYgaW1hZ2UKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1hdHJpeFdpZHRoID0gTWF0aC5yb3VuZCgocmlnaHQgLSBsZWZ0ICsgMSkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIG1hdHJpeEhlaWdodCA9IE1hdGgucm91bmQoKGJvdHRvbSAtIHRvcCArIDEpIC8gbW9kdWxlU2l6ZSk7CgkgICAgICAgIGlmIChtYXRyaXhXaWR0aCA8PSAwIHx8IG1hdHJpeEhlaWdodCA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG1hdHJpeEhlaWdodCAhPT0gbWF0cml4V2lkdGgpIHsKCSAgICAgICAgICAgIC8vIE9ubHkgcG9zc2libHkgZGVjb2RlIHNxdWFyZSByZWdpb25zCgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gUHVzaCBpbiB0aGUgImJvcmRlciIgYnkgaGFsZiB0aGUgbW9kdWxlIHdpZHRoIHNvIHRoYXQgd2Ugc3RhcnQKCSAgICAgICAgLy8gc2FtcGxpbmcgaW4gdGhlIG1pZGRsZSBvZiB0aGUgbW9kdWxlLiBKdXN0IGluIGNhc2UgdGhlIGltYWdlIGlzIGEKCSAgICAgICAgLy8gbGl0dGxlIG9mZiwgdGhpcyB3aWxsIGhlbHAgcmVjb3Zlci4KCSAgICAgICAgdmFyIG51ZGdlID0gLyooaW50KSAqLyBNYXRoLmZsb29yKG1vZHVsZVNpemUgLyAyLjApOwoJICAgICAgICB0b3AgKz0gbnVkZ2U7CgkgICAgICAgIGxlZnQgKz0gbnVkZ2U7CgkgICAgICAgIC8vIEJ1dCBjYXJlZnVsIHRoYXQgdGhpcyBkb2VzIG5vdCBzYW1wbGUgb2ZmIHRoZSBlZGdlCgkgICAgICAgIC8vICJyaWdodCIgaXMgdGhlIGZhcnRoZXN0LXJpZ2h0IHZhbGlkIHBpeGVsIGxvY2F0aW9uIC0tIHJpZ2h0KzEgaXMgbm90IG5lY2Vzc2FyaWx5CgkgICAgICAgIC8vIFRoaXMgaXMgcG9zaXRpdmUgYnkgaG93IG11Y2ggdGhlIGlubmVyIHggbG9vcCBiZWxvdyB3b3VsZCBiZSB0b28gbGFyZ2UKCSAgICAgICAgdmFyIG51ZGdlZFRvb0ZhclJpZ2h0ID0gbGVmdCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4V2lkdGggLSAxKSAqIG1vZHVsZVNpemUpIC0gcmlnaHQ7CgkgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IDApIHsKCSAgICAgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsZWZ0IC09IG51ZGdlZFRvb0ZhclJpZ2h0OwoJICAgICAgICB9CgkgICAgICAgIC8vIFNlZSBsb2dpYyBhYm92ZQoJICAgICAgICB2YXIgbnVkZ2VkVG9vRmFyRG93biA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4SGVpZ2h0IC0gMSkgKiBtb2R1bGVTaXplKSAtIGJvdHRvbTsKCSAgICAgICAgaWYgKG51ZGdlZFRvb0ZhckRvd24gPiAwKSB7CgkgICAgICAgICAgICBpZiAobnVkZ2VkVG9vRmFyRG93biA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3AgLT0gbnVkZ2VkVG9vRmFyRG93bjsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cganVzdCByZWFkIG9mZiB0aGUgYml0cwoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMS5kZWZhdWx0KG1hdHJpeFdpZHRoLCBtYXRyaXhIZWlnaHQpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hdHJpeEhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgaU9mZnNldCA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcih5ICogbW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1hdHJpeFdpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KGxlZnQgKyAvKihpbnQpICovIE1hdGguZmxvb3IoeCAqIG1vZHVsZVNpemUpLCBpT2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIubW9kdWxlU2l6ZSA9IGZ1bmN0aW9uIChsZWZ0VG9wQmxhY2ssIGltYWdlKSB7CgkgICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHggPSBsZWZ0VG9wQmxhY2tbMF07CgkgICAgICAgIHZhciB5ID0gbGVmdFRvcEJsYWNrWzFdOwoJICAgICAgICB2YXIgaW5CbGFjayA9IHRydWU7CgkgICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IDA7CgkgICAgICAgIHdoaWxlICh4IDwgd2lkdGggJiYgeSA8IGhlaWdodCkgewoJICAgICAgICAgICAgaWYgKGluQmxhY2sgIT09IGltYWdlLmdldCh4LCB5KSkgewoJICAgICAgICAgICAgICAgIGlmICgrK3RyYW5zaXRpb25zID09PSA1KSB7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpbkJsYWNrID0gIWluQmxhY2s7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB4Kys7CgkgICAgICAgICAgICB5Kys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHggPT09IHdpZHRoIHx8IHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiAoeCAtIGxlZnRUb3BCbGFja1swXSkgLyA3LjA7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTID0gbmV3IEFycmF5KCk7CgkgICAgcmV0dXJuIFFSQ29kZVJlYWRlcjsKCX0oKSk7Cgl2YXIgX2RlZmF1bHQgPSBRUkNvZGVSZWFkZXIkMS5kZWZhdWx0ID0gUVJDb2RlUmVhZGVyOwoKCXZhciB0b0dyYXlzY2FsZUJ1ZmZlciA9IGZ1bmN0aW9uIHRvR3JheXNjYWxlQnVmZmVyKGltYWdlQnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CgkgIHZhciBncmF5c2NhbGVCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwoKCSAgZm9yICh2YXIgaSA9IDAsIGogPSAwLCBsZW5ndGhfMSA9IGltYWdlQnVmZmVyLmxlbmd0aDsgaSA8IGxlbmd0aF8xOyBpICs9IDQsIGorKykgewoJICAgIHZhciBncmF5ID0gdm9pZCAwOwoJICAgIHZhciBhbHBoYSA9IGltYWdlQnVmZmVyW2kgKyAzXTsgLy8gVGhlIGNvbG9yIG9mIGZ1bGx5LXRyYW5zcGFyZW50IHBpeGVscyBpcyBpcnJlbGV2YW50LiBUaGV5IGFyZSBvZnRlbiwgdGVjaG5pY2FsbHksIGZ1bGx5LXRyYW5zcGFyZW50CgkgICAgLy8gYmxhY2sgKDAgYWxwaGEsIGFuZCB0aGVuIDAgUkdCKS4gVGhleSBhcmUgb2Z0ZW4gdXNlZCwgb2YgY291cnNlIGFzIHRoZSAid2hpdGUiIGFyZWEgaW4gYQoJICAgIC8vIGJhcmNvZGUgaW1hZ2UuIEZvcmNlIGFueSBzdWNoIHBpeGVsIHRvIGJlIHdoaXRlOgoKCSAgICBpZiAoYWxwaGEgPT09IDApIHsKCSAgICAgIGdyYXkgPSAweEZGOwoJICAgIH0gZWxzZSB7CgkgICAgICB2YXIgcGl4ZWxSID0gaW1hZ2VCdWZmZXJbaV07CgkgICAgICB2YXIgcGl4ZWxHID0gaW1hZ2VCdWZmZXJbaSArIDFdOwoJICAgICAgdmFyIHBpeGVsQiA9IGltYWdlQnVmZmVyW2kgKyAyXTsgLy8gLjI5OVIgKyAwLjU4N0cgKyAwLjExNEIgKFlVVi9ZSVEgZm9yIFBBTCBhbmQgTlRTQyksCgkgICAgICAvLyAoMzA2KlIpID4+IDEwIGlzIGFwcHJveGltYXRlbHkgZXF1YWwgdG8gUiowLjI5OSwgYW5kIHNvIG9uLgoJICAgICAgLy8gMHgyMDAgPj4gMTAgaXMgMC41LCBpdCBpbXBsZW1lbnRzIHJvdW5kaW5nLgoKCSAgICAgIGdyYXkgPSAzMDYgKiBwaXhlbFIgKyA2MDEgKiBwaXhlbEcgKyAxMTcgKiBwaXhlbEIgKyAweDIwMCA+PiAxMDsKCSAgICB9CgoJICAgIGdyYXlzY2FsZUJ1ZmZlcltqXSA9IGdyYXk7CgkgIH0KCgkgIHJldHVybiBncmF5c2NhbGVCdWZmZXI7Cgl9OwoKCXZhciByZWFkZXIgPSBuZXcgX2RlZmF1bHQoKTsKCXNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCgkgIHRyeSB7CgkgICAgdmFyIGx1bWluYW5jZXMgPSB0b0dyYXlzY2FsZUJ1ZmZlcihlLmRhdGEuZGF0YSwgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgbHVtaW5hbmNlU291cmNlID0gbmV3IF9kZWZhdWx0JDEobHVtaW5hbmNlcywgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgaHlicmlkQmluYXJpemVyID0gbmV3IF9kZWZhdWx0JDIobHVtaW5hbmNlU291cmNlKTsKCSAgICB2YXIgYmluYXJ5Qml0bWFwID0gbmV3IF9kZWZhdWx0JDMoaHlicmlkQmluYXJpemVyKTsKCSAgICB2YXIgZGVjb2RlZCA9IHJlYWRlci5kZWNvZGUoYmluYXJ5Qml0bWFwKTsKCSAgICBwb3N0TWVzc2FnZShkZWNvZGVkKTsKCSAgfSBjYXRjaCAoZXJyKSB7CgkgICAgcG9zdE1lc3NhZ2UobnVsbCk7CgkgIH0KCX0pOwoKfSkoKTsKCg==",null,!1),f1=["constraints","onError","onLoad","onScan","resolution","qrArea"];function ky(e,g){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var I=Object.getOwnPropertySymbols(e);g&&(I=I.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,I)}return t}function Xy(e){for(var g=1;g<arguments.length;g++){var t=arguments[g]!=null?arguments[g]:{};g%2?ky(Object(t),!0).forEach(function(I){$H(e,I,t[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ky(Object(t)).forEach(function(I){Object.defineProperty(e,I,Object.getOwnPropertyDescriptor(t,I))})}return e}var V1=function(){return new B1},Jy=function(g){g&&(g.getVideoTracks&&g.getAudioTracks?(g.getVideoTracks().forEach(function(t){g.removeTrack(t),t.stop()}),g.getAudioTracks().forEach(function(t){g.removeTrack(t),t.stop()})):g.stop())},a0=function(g){var t=g.constraints,I=g.onError,n=g.onLoad,l=g.onScan,C=g.resolution,s=g.qrArea,r=C1(g,f1),a=B.useRef(null),o=B.useRef(null),c=B.useRef(document.createElement("canvas")),A=B.useRef(null),b=B.useRef(),m=B.useState(null),Z=n1(m,2),G=Z[0],h=Z[1],u=B.useRef(!1),y=B.useRef();B.useEffect(function(){y.current=V1();var f=y.current;return f.onmessage=function(X){l&&l(X.data?Xy(Xy({},X.data),{},{canvas:c.current}):null),u.current=!1},function(){f.terminate()}},[l]);var W=JSON.stringify(s),S=B.useCallback(function(){var f=JSON.parse(W),X=y.current,U=o.current&&o.current.readyState===o.current.HAVE_ENOUGH_DATA;if(!u.current&&U){u.current=!0;var Y=o.current.videoWidth,N=o.current.videoHeight,j=Y>N?Y:N,_=Math.floor(C/j*100)/100;N=Math.floor(_*N),Y=Math.floor(_*Y),c.current.width=Y,c.current.height=N,A.current=c.current.getContext("2d"),A.current.drawImage(o.current,0,0,Y,N);var tg;f&&f.length===2&&f[0]>0&&f[1]>0?tg=A.current.getImageData(Math.floor((Y-f[0])/2),Math.floor((N-f[1])/2),f[0],f[1]):tg=A.current.getImageData(0,0,Y,N),X.postMessage(tg)}b.current=requestAnimationFrame(S)},[C,W]),J=JSON.stringify(t);return B.useEffect(function(){var f=JSON.parse(J),X=!0;return navigator.mediaDevices.getUserMedia(f).then(function(U){if(!X)Jy(U);else{a.current=U;try{o.current&&(o.current.srcObject=U,o.current.setAttribute("playsinline",!0))}catch{h(window.URL.createObjectURL(U))}n&&n(),b.current=requestAnimationFrame(S)}}).catch(function(U){return X?I(U):null}),function(){cancelAnimationFrame(b.current),X=!1,Jy(a.current),G&&window.URL.revokeObjectURL(G)}},[S,J,I,n,G]),B.createElement("video",Wm({autoPlay:!0,playsInline:!0,src:G,ref:o},r))};a0.propTypes={constraints:YC.object,onError:YC.func.isRequired,onLoad:YC.func,onScan:YC.func.isRequired,resolution:YC.number,qrArea:YC.array};a0.defaultProps={constraints:{audio:!1,video:!0},resolution:640,qrArea:[]};const W1=()=>{var S;const[e,g]=B.useState(!1),[t,I]=B.useState(null),[n,l]=B.useState(null),[C,s]=B.useState(null),[r,a]=B.useState(""),[o,c]=B.useState(null),[A,b]=B.useState(null),[m,Z]=B.useState(null),G=async J=>{J&&!t&&(I(J),g(!1),await u(J.text))},h=J=>{console.error(J),J.message.includes("The request is not allowed")||K.error("Ensure camera permissions are allowed")},u=async J=>{l("loading");try{let f;try{f=JSON.parse(J).ticketId}catch{f=J}if(!f)throw new Error("Invalid QR Code format");const X=mI(),U=await X.getTicket(f);if(U.ticketId.toString()==="0")throw new Error("Ticket does not exist");let Y="N/A",N=null;try{const L=X.filters.TicketPurchased(f),v=await X.queryFilter(L);if(v.length>0){const z=v[v.length-1];Y=z.transactionHash;const M=await z.getBlock();N=new Date(M.timestamp*1e3)}}catch(L){console.warn("Could not fetch event history:",L)}let j="Unknown",_="N/A",tg=U.isSecondHand,F=null,T=null,gg=null;if(tg)try{const L=X.filters.TicketTransferred(f),v=await X.queryFilter(L);if(v.length>0){gg=v[0].args.from;try{const M=await fetch(`http://localhost:5000/api/purchases/by-wallet/${gg}/ticket/${f}`);if(M.ok){const hg=await M.json();hg.data&&hg.data.purchase&&hg.data.purchase.buyerInfo&&(F=hg.data.purchase.buyerInfo.name||"Unknown",T=hg.data.purchase.buyerInfo.phone||"N/A")}}catch(M){console.warn("Could not fetch original owner details:",M),F="Unknown",T="N/A"}}}catch(L){console.warn("Could not fetch transfer events:",L)}try{if(U.buyer){const L=await fetch(`http://localhost:5000/api/users/${U.buyer}`);if(L.ok){const v=await L.json();if(v.success&&v.data&&v.data.user)j=v.data.user.username||v.data.user.name||"Unknown",_=v.data.user.phone||"N/A",console.log(` Fetched user profile for ${U.buyer}:`,j,_);else{console.warn("User profile not found, falling back to purchase record");const z=await fetch(`http://localhost:5000/api/purchases/ticket/${f}`);if(z.ok){const M=await z.json();M.data&&M.data.purchase&&M.data.purchase.buyerInfo&&(j=M.data.purchase.buyerInfo.name||"Unknown",_=M.data.purchase.buyerInfo.phone||"N/A")}}}}}catch(L){console.error("Could not fetch user details:",L);try{const v=await fetch(`http://localhost:5000/api/purchases/ticket/${f}`);if(v.ok){const z=await v.json();z.data&&z.data.purchase&&z.data.purchase.buyerInfo&&(j=z.data.purchase.buyerInfo.name||"Unknown",_=z.data.purchase.buyerInfo.phone||"N/A")}}catch(v){console.error("Could not fetch purchase details:",v)}}const x={id:U.ticketId.toString(),eventName:U.eventName,organizer:U.organizer,buyer:U.buyer,isSold:U.isSold,isRefunded:U.isRefunded,purchaseTime:N||new Date,txHash:Y,buyerName:j,buyerPhone:_,isTransferred:tg,originalOwnerName:F,originalOwnerPhone:T,originalOwnerAddress:gg};s(x);try{if(await X.hasTicketBeenUsed(f)){const v=await X.getTicketEntryTime(f),z=new Date(v.toNumber()*1e3);c("used"),b(z),l("already_used"),K.error("Ticket Already Used!");return}c("unused");try{const v=localStorage.getItem("token"),M=await(await fetch("http://localhost:5000/api/entry/mark-used",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify({ticketId:f,eventName:U.eventName,location:{gate:"Main Entrance"}})})).json();if(!M.success&&M.error==="DUPLICATE_SCAN"){Z(M.lastScan),l("duplicate"),K.error("Duplicate Scan Detected!");return}l("valid"),K.success("Ticket Verified Successfully!")}catch(v){console.error("Entry marking failed:",v),l("valid"),K.success("Ticket Verified (Backend logging unavailable)")}}catch(L){console.error("Entry status check failed:",L),l("valid")}}catch(f){console.error("Verification failed:",f),l("invalid"),a(f.message||"Invalid Ticket Data")}},y=()=>{I(null),l(null),s(null),c(null),b(null),Z(null),g(!0)},W=J=>{J&&J!=="N/A"&&window.open(`https://sepolia.etherscan.io/tx/${J}`,"_blank")};return i.jsxs("div",{className:"max-w-md mx-auto px-4 py-6",children:[i.jsxs("div",{className:"text-center mb-6",children:[i.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center justify-center",children:[i.jsx(GI,{className:"w-6 h-6 mr-2 text-primary-600"}),"Gatekeeper Scanner"]}),i.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Scan customer QR for entry details"})]}),i.jsxs("div",{className:"bg-black rounded-2xl overflow-hidden shadow-2xl relative min-h-[400px] flex flex-col items-center justify-center",children:[e&&i.jsxs("div",{className:"w-full h-full relative",children:[i.jsx(a0,{delay:300,onError:h,onScan:G,style:{width:"100%",height:"400px",objectFit:"cover"},constraints:{video:{facingMode:"environment"}}}),i.jsxs("div",{className:"absolute inset-0 border-2 border-primary-500/50 pointer-events-none",children:[i.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-56 h-56 border-2 border-white rounded-lg opacity-80"}),i.jsx("p",{className:"absolute bottom-6 left-0 right-0 text-center text-white font-medium bg-black/60 py-2",children:"Align QR Code within frame"})]})]}),!e&&!n&&i.jsxs("div",{className:"bg-gray-900 w-full h-[400px] flex flex-col items-center justify-center text-white p-6",children:[i.jsx(my,{className:"w-16 h-16 text-gray-600 mb-4"}),i.jsx("p",{className:"text-gray-400 mb-6 text-center",children:"Ready to verify incoming guests"}),i.jsxs("button",{onClick:()=>g(!0),className:"bg-primary-600 hover:bg-primary-700 text-white px-8 py-3 rounded-full font-bold flex items-center transition-all transform hover:scale-105 shadow-lg shadow-primary-600/30",children:[i.jsx(my,{className:"w-5 h-5 mr-2"}),"Activate Scanner"]})]}),n==="loading"&&i.jsxs("div",{className:"bg-white w-full h-[400px] flex flex-col items-center justify-center",children:[i.jsx(Dg,{className:"w-12 h-12 text-primary-600 animate-spin mb-4"}),i.jsx("p",{className:"text-gray-600 font-medium animate-pulse",children:"Fetching Details..."})]}),n==="valid"&&C&&i.jsxs("div",{className:"bg-green-50 w-full h-full p-6 flex flex-col items-center justify-center animate-in fade-in zoom-in duration-300",children:[i.jsx("div",{className:"w-14 h-14 bg-green-100 rounded-full flex items-center justify-center mb-2",children:i.jsx(ZC,{className:"w-8 h-8 text-green-600"})}),i.jsx("h2",{className:"text-xl font-bold text-green-800 mb-4",children:"ACCESS GRANTED"}),i.jsxs("div",{className:"w-full bg-white rounded-xl p-4 shadow-sm border border-green-100 space-y-3 text-left text-sm",children:[i.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-100",children:[i.jsxs("span",{className:"text-gray-500 flex items-center",children:[i.jsx(hy,{className:"w-3 h-3 mr-1"})," Ticket ID"]}),i.jsxs("span",{className:"font-mono font-bold text-gray-800",children:["#",C.id]})]}),m&&i.jsxs("div",{className:"bg-red-100 border-2 border-red-500 rounded-lg p-3 mb-3 animate-in fade-in slide-in-from-top duration-300",children:[i.jsxs("div",{className:"flex items-center mb-2",children:[i.jsx(n0,{className:"w-5 h-5 text-red-700 mr-2 flex-shrink-0"}),i.jsx("span",{className:"font-bold text-red-900 text-sm uppercase tracking-wide",children:"Duplicate Scan Detected!"})]}),i.jsx("p",{className:"text-xs text-red-800 mb-2",children:"This ticket was scanned recently. Possible fraud attempt."}),i.jsxs("div",{className:"bg-white rounded p-2 text-xs",children:[i.jsxs("p",{className:"text-gray-600",children:["Last Scan: ",new Date(m.time).toLocaleString()]}),m.location&&i.jsxs("p",{className:"text-gray-600",children:["Location: ",m.location.gate||"Unknown"]})]})]}),C.isTransferred&&i.jsxs("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-lg p-3 mb-3 animate-in fade-in slide-in-from-top duration-300",children:[i.jsxs("div",{className:"flex items-center mb-3",children:[i.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center mr-2",children:i.jsx(Gm,{className:"w-4 h-4 text-amber-700"})}),i.jsx("span",{className:"font-bold text-amber-900 text-sm uppercase tracking-wide",children:"Transferred Ticket"})]}),i.jsx("div",{className:"bg-white rounded-lg p-3 mb-2 border border-amber-200",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx(Ve,{className:"w-4 h-4 mr-2 text-gray-500 mt-0.5 flex-shrink-0"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Original Buyer"}),i.jsx("p",{className:"font-semibold text-gray-900",children:C.originalOwnerName||"Unknown"}),i.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:C.originalOwnerPhone||"N/A"}),C.originalOwnerAddress&&i.jsxs("p",{className:"text-[10px] text-gray-400 font-mono mt-1 break-all",children:[C.originalOwnerAddress.slice(0,10),"...",C.originalOwnerAddress.slice(-8)]})]})]})}),i.jsx("div",{className:"flex justify-center my-1",children:i.jsx("div",{className:"w-6 h-6 bg-amber-200 rounded-full flex items-center justify-center",children:i.jsx(Gm,{className:"w-3 h-3 text-amber-700"})})}),i.jsx("div",{className:"bg-green-50 rounded-lg p-3 border-2 border-green-300",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx(fy,{className:"w-4 h-4 mr-2 text-green-700 mt-0.5 flex-shrink-0"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-xs text-green-700 font-semibold mb-1",children:"Current Owner (Valid Holder)"}),i.jsx("p",{className:"font-bold text-green-900",children:C.buyerName}),i.jsx("p",{className:"text-xs text-green-800 mt-0.5",children:C.buyerPhone})]})]})})]}),!C.isTransferred&&i.jsxs("div",{className:"bg-gray-50 p-2 rounded-lg space-y-2 mb-2",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(fy,{className:"w-4 h-4 mr-2 text-primary-600"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-500",children:"Name"}),i.jsx("p",{className:"font-semibold text-gray-900",children:C.buyerName})]})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx(l0,{className:"w-4 h-4 mr-2 text-primary-600"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-500",children:"Phone"}),i.jsx("p",{className:"font-semibold text-gray-900",children:C.buyerPhone})]})]})]}),i.jsxs("div",{className:"space-y-2 pt-1",children:[i.jsxs("div",{className:"flex items-start",children:[i.jsx(Ve,{className:"w-4 h-4 mr-2 text-gray-400 mt-0.5"}),i.jsxs("div",{className:"w-full",children:[i.jsx("p",{className:"text-xs text-gray-500",children:"Wallet"}),i.jsx("p",{className:"font-mono text-[10px] text-gray-600 break-all bg-gray-100 p-1 rounded",children:C.buyer})]})]}),i.jsxs("div",{className:"flex items-start",children:[i.jsx(Ui,{className:"w-4 h-4 mr-2 text-gray-400 mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-500",children:"Purchased"}),i.jsx("p",{className:"text-gray-800 text-xs",children:((S=C.purchaseTime)==null?void 0:S.toLocaleString())||"Unknown"})]})]}),i.jsxs("div",{className:"flex items-start",children:[i.jsx(RH,{className:"w-4 h-4 mr-2 text-gray-400 mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-500",children:"Transaction"}),i.jsxs("button",{onClick:()=>W(C.txHash),className:"text-primary-600 hover:text-primary-800 text-xs font-mono underline text-left break-all",children:[C.txHash.substring(0,15),"..."]})]})]})]})]}),i.jsxs("button",{onClick:y,className:"mt-4 w-full bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-semibold flex items-center justify-center shadow-lg shadow-green-600/20",children:[i.jsx(vd,{className:"w-4 h-4 mr-2"}),"Scan Next Ticket"]})]}),n==="already_used"&&C&&i.jsxs("div",{className:"bg-orange-50 w-full h-full p-6 flex flex-col items-center justify-center animate-in fade-in zoom-in duration-300",children:[i.jsx("div",{className:"w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-3",children:i.jsx(zi,{className:"w-10 h-10 text-orange-600"})}),i.jsx("h2",{className:"text-2xl font-bold text-orange-800 mb-2",children:"ALREADY USED"}),i.jsx("p",{className:"text-orange-700 mb-4 text-center font-medium",children:"This ticket was already scanned for entry"}),i.jsxs("div",{className:"w-full bg-white rounded-xl p-4 shadow-sm border border-orange-200 space-y-2 text-sm mb-4",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("span",{className:"text-gray-500 flex items-center",children:[i.jsx(hy,{className:"w-3 h-3 mr-1"})," Ticket ID"]}),i.jsxs("span",{className:"font-mono font-bold text-gray-800",children:["#",C.id]})]}),i.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-orange-100",children:[i.jsxs("span",{className:"text-gray-500 flex items-center",children:[i.jsx(Ui,{className:"w-3 h-3 mr-1"})," Entry Time"]}),i.jsx("span",{className:"font-semibold text-orange-800",children:A==null?void 0:A.toLocaleString()})]}),i.jsxs("div",{className:"pt-2 border-t border-orange-100",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Ticket Holder"}),i.jsx("p",{className:"font-semibold text-gray-900",children:C.buyerName}),i.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:C.buyerPhone})]})]}),i.jsxs("button",{onClick:y,className:"mt-2 w-full bg-gray-900 text-white px-6 py-3 rounded-lg hover:bg-gray-800 font-semibold flex items-center justify-center",children:[i.jsx(vd,{className:"w-4 h-4 mr-2"}),"Scan Next Ticket"]})]}),(n==="invalid"||n==="refunded"||n==="unsold")&&i.jsxs("div",{className:"bg-red-50 w-full h-full p-6 flex flex-col items-center justify-center animate-in fade-in zoom-in duration-300",children:[i.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-4",children:i.jsx(zi,{className:"w-12 h-12 text-red-600"})}),i.jsx("h2",{className:"text-2xl font-bold text-red-800 mb-1",children:"ACCESS DENIED"}),i.jsx("p",{className:"text-red-600/80 mb-6 font-medium text-center px-4",children:n==="refunded"?"Ticket REFUNDED":n==="unsold"?"Ticket NEVER SOLD":r}),i.jsxs("button",{onClick:y,className:"mt-2 w-full bg-gray-900 text-white px-6 py-3 rounded-lg hover:bg-gray-800 font-semibold flex items-center justify-center",children:[i.jsx(vd,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})]})]})},S1=()=>{const{account:e,isConnected:g}=ft(),[t,I]=B.useState([]),[n,l]=B.useState(!0),[C,s]=B.useState(null),[r,a]=B.useState(new Set),[o,c]=B.useState(!1),[A,b]=B.useState(null),[m,Z]=B.useState({receiverAddress:"",reason:""}),[G,h]=B.useState(!1),u=B.useCallback(async()=>{if(e)try{l(!0),s(null);const f=await gl();let X;try{X=await f.getMyTickets()}catch(tg){console.warn("Error fetching tickets:",tg.message),I([]);return}const U=Array.from(X||[]);let Y=new Set;try{const{data:tg}=await qe.get("/transfers/my-requests");tg.forEach(F=>{F.status==="pending"&&Y.add(F.ticketId.toString())}),a(Y)}catch(tg){console.warn("Failed to fetch pending transfers:",tg)}if(U.length===0){I([]);return}const N=U.map(async tg=>{try{const F=await f.getTicket(tg);return{id:tg.toString(),eventName:F.eventName,organizer:F.organizer,eventDate:new Date(Number(F.eventDate)*1e3),price:F.price.toString(),posterUrl:F.posterUrl,ticketImageUrl:F.ticketImageUrl,seller:F.seller,buyer:F.buyer,isSold:F.isSold,isDownloaded:F.isDownloaded,isRefunded:F.isRefunded,isSecondHand:F.isSecondHand,previousOwner:F.previousOwner,totalTickets:Number(F.totalTickets),availableTickets:Number(F.availableTickets)}}catch(F){return console.warn(`Failed to load ticket ${tg}:`,F),null}}),_=(await Promise.all(N)).filter(tg=>tg!==null);I(_.reverse())}catch(f){console.error("Error loading my tickets:",f),s("Failed to load your tickets")}finally{l(!1)}},[e]);B.useEffect(()=>{g&&e?u():l(!1)},[g,e,u]);const y=f=>{b(f),Z({receiverAddress:"",reason:""}),c(!0)},W=async f=>{var X,U,Y;if(f.preventDefault(),!!A)try{if(h(!0),!m.receiverAddress.startsWith("0x")||m.receiverAddress.length!==42){K.error("Invalid Ethereum address format");return}await qe.post("/transfers/request",{ticketId:A.id,receiverAddress:m.receiverAddress,reason:m.reason,eventName:((X=A.metadata)==null?void 0:X.name)||A.name||A.eventName||"Event Name"}),K.success("Transfer request submitted! Waiting for organizer approval."),c(!1),u()}catch(N){console.error("Transfer request failed:",N),K.error(((Y=(U=N.response)==null?void 0:U.data)==null?void 0:Y.message)||"Failed to submit transfer request")}finally{h(!1)}},S=f=>f.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),J=f=>r.has(f.id)?{text:"Transfer Pending",color:"bg-yellow-100 text-yellow-800",icon:Ui}:f.isRefunded?{text:"Refunded",color:"bg-red-100 text-red-800"}:f.isDownloaded?{text:"Downloaded (NFT)",color:"bg-green-100 text-green-800"}:f.isSold?{text:"Purchased",color:"bg-blue-100 text-blue-800"}:{text:"Available",color:"bg-gray-100 text-gray-800"};return g?n?i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",children:[i.jsx(Dg,{className:"w-10 h-10 animate-spin text-primary-600 mb-4"}),i.jsx("p",{className:"text-gray-600",children:"Loading your tickets..."})]}):i.jsxs("div",{className:"space-y-6 relative",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Tickets"}),i.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Wallet: ",i.jsx("span",{className:"font-mono",children:gt(e)})]})]}),i.jsxs("button",{onClick:u,className:"btn-secondary flex items-center space-x-2",children:[i.jsx(Xc,{className:"w-4 h-4"}),i.jsx("span",{children:"Refresh"})]})]}),t.length===0?i.jsxs("div",{className:"text-center py-16 bg-white rounded-2xl border-2 border-dashed border-gray-200",children:[i.jsx("div",{className:"w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(Qn,{className:"w-8 h-8 text-gray-400"})}),i.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Tickets Found"}),i.jsxs("p",{className:"text-gray-500 max-w-md mx-auto mb-8",children:["You haven't purchased any tickets yet with this wallet (",gt(e),")."]}),i.jsx($g,{to:"/tickets",className:"btn-primary",children:"Browse Events"})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(f=>{const X=J(f),U=r.has(f.id);return i.jsxs("div",{className:"card group hover:shadow-lg transition-all duration-300",children:[i.jsxs("div",{className:"aspect-video bg-gray-100 rounded-lg mb-4 overflow-hidden relative",children:[i.jsx("img",{src:DV(f.posterUrl),alt:f.eventName,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onError:Y=>{Y.target.src="https://images.unsplash.com/photo-1459749411177-2c46996b3e81?auto=format&fit=crop&q=80"}}),i.jsxs("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-md text-xs font-bold flex items-center gap-1 ${X.color}`,children:[X.icon&&i.jsx(X.icon,{className:"w-3 h-3"}),X.text]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("h3",{className:"text-lg font-bold text-gray-900 line-clamp-1",children:f.eventName}),i.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(nl,{className:"w-4 h-4 mr-2 text-gray-400"}),S(f.eventDate)]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx(Ve,{className:"w-4 h-4 mr-2 text-gray-400"}),i.jsxs("span",{className:"truncate",children:["Org: ",f.organizer]})]}),f.isSecondHand&&f.previousOwner&&f.previousOwner!=="0x0000000000000000000000000000000000000000"&&i.jsxs("div",{className:"flex items-center text-blue-600 bg-blue-50 px-2 py-1 rounded text-xs mt-1 border border-blue-100",children:[i.jsx(VA,{className:"w-3 h-3 mr-1"}),i.jsxs("span",{className:"truncate",children:["From: ",gt(f.previousOwner)]})]})]}),i.jsxs("div",{className:"flex flex-col gap-2 pt-3 border-t border-gray-100",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx($g,{to:`/ticket/${f.id}`,className:"flex-1 btn-outline text-center text-sm py-2",children:"View"}),!f.isDownloaded&&!U?i.jsxs($g,{to:`/ticket/${f.id}`,className:"flex-1 btn-primary text-center text-sm py-2 flex items-center justify-center gap-1",children:[i.jsx(pm,{className:"w-3 h-3"})," Download"]}):f.isDownloaded?i.jsxs($g,{to:`/ticket/${f.id}/print`,className:"flex-1 btn-secondary text-center text-sm py-2 flex items-center justify-center gap-1",children:[i.jsx(GI,{className:"w-3 h-3"})," Print"]}):i.jsx("span",{className:"hidden"})]}),!U&&!f.isRefunded&&!f.isSecondHand&&i.jsxs("button",{onClick:()=>y(f),className:"w-full text-xs text-gray-500 hover:text-primary-600 flex items-center justify-center gap-1 py-1 border border-transparent hover:border-gray-200 rounded transition-colors",children:[i.jsx(yy,{className:"w-3 h-3"})," Transfer / Gift Ticket"]}),f.isSecondHand&&i.jsx("div",{className:"text-center text-xs text-gray-400 font-medium py-1",children:"Ticket Non-Transferable (Limit Reached)"}),U&&i.jsx("div",{className:"text-center text-xs text-yellow-600 font-medium py-1",children:"Transfer Request Under Review"})]})]})]},f.id)})}),o&&i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:i.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6 animate-in fade-in zoom-in duration-200",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Transfer Ticket"}),i.jsx("button",{onClick:()=>c(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:i.jsx(C0,{className:"w-5 h-5"})})]}),i.jsxs("form",{onSubmit:W,className:"space-y-4",children:[i.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-sm text-blue-800 mb-4",children:[i.jsxs("p",{className:"font-semibold",children:["Requesting transfer for: ",A==null?void 0:A.eventName]}),i.jsx("p",{className:"mt-1 text-xs opacity-80",children:"This request will be sent to the organizer for approval. Once approved, the ticket will be moved to the new wallet address."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Receiver Wallet Address (0x...)"}),i.jsx("input",{type:"text",required:!0,placeholder:"0x...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all font-mono text-sm",value:m.receiverAddress,onChange:f=>Z({...m,receiverAddress:f.target.value})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for Transfer"}),i.jsx("textarea",{required:!0,rows:"3",placeholder:"e.g. Cannot attend due to illness, Gift for a friend...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all resize-none",value:m.reason,onChange:f=>Z({...m,reason:f.target.value})})]}),i.jsxs("div",{className:"flex gap-3 pt-2",children:[i.jsx("button",{type:"button",onClick:()=>c(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),i.jsx("button",{type:"submit",disabled:G,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors font-medium flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:G?i.jsxs(i.Fragment,{children:[i.jsx(Dg,{className:"w-4 h-4 animate-spin"}),"Sending..."]}):i.jsxs(i.Fragment,{children:[i.jsx(yy,{className:"w-4 h-4"}),"Submit Request"]})})]})]})]})})]}):i.jsxs("div",{className:"text-center py-12",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Connect Wallet"}),i.jsx("p",{className:"text-gray-600 mb-6",children:"Please connect your wallet to view your tickets."}),i.jsx("button",{onClick:()=>window.location.reload(),className:"btn-primary",children:"Connect"})]})};var HA={},$V={exports:{}},R1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",k1=R1,X1=k1;function gW(){}function eW(){}eW.resetWarningCache=gW;var J1=function(){function e(I,n,l,C,s,r){if(r!==X1){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}e.isRequired=e;function g(){return e}var t={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:g,element:e,elementType:e,instanceOf:g,node:e,objectOf:g,oneOf:g,oneOfType:g,shape:g,exact:g,checkPropTypes:eW,resetWarningCache:gW};return t.PropTypes=t,t};$V.exports=J1();var tW=$V.exports,IW={L:1,M:0,Q:3,H:2},nW={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},w1=nW;function lW(e){this.mode=w1.MODE_8BIT_BYTE,this.data=e}lW.prototype={getLength:function(e){return this.data.length},write:function(e){for(var g=0;g<this.data.length;g++)e.put(this.data.charCodeAt(g),8)}};var Y1=lW,Co=IW;function AI(e,g){this.totalCount=e,this.dataCount=g}AI.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];AI.getRSBlocks=function(e,g){var t=AI.getRsBlockTable(e,g);if(t==null)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+g);for(var I=t.length/3,n=new Array,l=0;l<I;l++)for(var C=t[l*3+0],s=t[l*3+1],r=t[l*3+2],a=0;a<C;a++)n.push(new AI(s,r));return n};AI.getRsBlockTable=function(e,g){switch(g){case Co.L:return AI.RS_BLOCK_TABLE[(e-1)*4+0];case Co.M:return AI.RS_BLOCK_TABLE[(e-1)*4+1];case Co.Q:return AI.RS_BLOCK_TABLE[(e-1)*4+2];case Co.H:return AI.RS_BLOCK_TABLE[(e-1)*4+3];default:return}};var v1=AI;function CW(){this.buffer=new Array,this.length=0}CW.prototype={get:function(e){var g=Math.floor(e/8);return(this.buffer[g]>>>7-e%8&1)==1},put:function(e,g){for(var t=0;t<g;t++)this.putBit((e>>>g-t-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(e){var g=Math.floor(this.length/8);this.buffer.length<=g&&this.buffer.push(0),e&&(this.buffer[g]|=128>>>this.length%8),this.length++}};var N1=CW,Ut={glog:function(e){if(e<1)throw new Error("glog("+e+")");return Ut.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return Ut.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var ge=0;ge<8;ge++)Ut.EXP_TABLE[ge]=1<<ge;for(var ge=8;ge<256;ge++)Ut.EXP_TABLE[ge]=Ut.EXP_TABLE[ge-4]^Ut.EXP_TABLE[ge-5]^Ut.EXP_TABLE[ge-6]^Ut.EXP_TABLE[ge-8];for(var ge=0;ge<255;ge++)Ut.LOG_TABLE[Ut.EXP_TABLE[ge]]=ge;var sW=Ut,hl=sW;function Ko(e,g){if(e.length==null)throw new Error(e.length+"/"+g);for(var t=0;t<e.length&&e[t]==0;)t++;this.num=new Array(e.length-t+g);for(var I=0;I<e.length-t;I++)this.num[I]=e[I+t]}Ko.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var g=new Array(this.getLength()+e.getLength()-1),t=0;t<this.getLength();t++)for(var I=0;I<e.getLength();I++)g[t+I]^=hl.gexp(hl.glog(this.get(t))+hl.glog(e.get(I)));return new Ko(g,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var g=hl.glog(this.get(0))-hl.glog(e.get(0)),t=new Array(this.getLength()),I=0;I<this.getLength();I++)t[I]=this.get(I);for(var I=0;I<e.getLength();I++)t[I]^=hl.gexp(hl.glog(e.get(I))+g);return new Ko(t,0).mod(e)}};var rW=Ko,rt=nW,wy=rW,H1=sW,dn={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},Og={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var g=e<<10;Og.getBCHDigit(g)-Og.getBCHDigit(Og.G15)>=0;)g^=Og.G15<<Og.getBCHDigit(g)-Og.getBCHDigit(Og.G15);return(e<<10|g)^Og.G15_MASK},getBCHTypeNumber:function(e){for(var g=e<<12;Og.getBCHDigit(g)-Og.getBCHDigit(Og.G18)>=0;)g^=Og.G18<<Og.getBCHDigit(g)-Og.getBCHDigit(Og.G18);return e<<12|g},getBCHDigit:function(e){for(var g=0;e!=0;)g++,e>>>=1;return g},getPatternPosition:function(e){return Og.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,g,t){switch(e){case dn.PATTERN000:return(g+t)%2==0;case dn.PATTERN001:return g%2==0;case dn.PATTERN010:return t%3==0;case dn.PATTERN011:return(g+t)%3==0;case dn.PATTERN100:return(Math.floor(g/2)+Math.floor(t/3))%2==0;case dn.PATTERN101:return g*t%2+g*t%3==0;case dn.PATTERN110:return(g*t%2+g*t%3)%2==0;case dn.PATTERN111:return(g*t%3+(g+t)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var g=new wy([1],0),t=0;t<e;t++)g=g.multiply(new wy([1,H1.gexp(t)],0));return g},getLengthInBits:function(e,g){if(1<=g&&g<10)switch(e){case rt.MODE_NUMBER:return 10;case rt.MODE_ALPHA_NUM:return 9;case rt.MODE_8BIT_BYTE:return 8;case rt.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(g<27)switch(e){case rt.MODE_NUMBER:return 12;case rt.MODE_ALPHA_NUM:return 11;case rt.MODE_8BIT_BYTE:return 16;case rt.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else if(g<41)switch(e){case rt.MODE_NUMBER:return 14;case rt.MODE_ALPHA_NUM:return 13;case rt.MODE_8BIT_BYTE:return 16;case rt.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}else throw new Error("type:"+g)},getLostPoint:function(e){for(var g=e.getModuleCount(),t=0,I=0;I<g;I++)for(var n=0;n<g;n++){for(var l=0,C=e.isDark(I,n),s=-1;s<=1;s++)if(!(I+s<0||g<=I+s))for(var r=-1;r<=1;r++)n+r<0||g<=n+r||s==0&&r==0||C==e.isDark(I+s,n+r)&&l++;l>5&&(t+=3+l-5)}for(var I=0;I<g-1;I++)for(var n=0;n<g-1;n++){var a=0;e.isDark(I,n)&&a++,e.isDark(I+1,n)&&a++,e.isDark(I,n+1)&&a++,e.isDark(I+1,n+1)&&a++,(a==0||a==4)&&(t+=3)}for(var I=0;I<g;I++)for(var n=0;n<g-6;n++)e.isDark(I,n)&&!e.isDark(I,n+1)&&e.isDark(I,n+2)&&e.isDark(I,n+3)&&e.isDark(I,n+4)&&!e.isDark(I,n+5)&&e.isDark(I,n+6)&&(t+=40);for(var n=0;n<g;n++)for(var I=0;I<g-6;I++)e.isDark(I,n)&&!e.isDark(I+1,n)&&e.isDark(I+2,n)&&e.isDark(I+3,n)&&e.isDark(I+4,n)&&!e.isDark(I+5,n)&&e.isDark(I+6,n)&&(t+=40);for(var o=0,n=0;n<g;n++)for(var I=0;I<g;I++)e.isDark(I,n)&&o++;var c=Math.abs(100*o/g/g-50)/5;return t+=c*10,t}},F1=Og,x1=Y1,iW=v1,aW=N1,cl=F1,K1=rW;function hI(e,g){this.typeNumber=e,this.errorCorrectLevel=g,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var lt=hI.prototype;lt.addData=function(e){var g=new x1(e);this.dataList.push(g),this.dataCache=null};lt.isDark=function(e,g){if(e<0||this.moduleCount<=e||g<0||this.moduleCount<=g)throw new Error(e+","+g);return this.modules[e][g]};lt.getModuleCount=function(){return this.moduleCount};lt.make=function(){if(this.typeNumber<1){var e=1;for(e=1;e<40;e++){for(var g=iW.getRSBlocks(e,this.errorCorrectLevel),t=new aW,I=0,n=0;n<g.length;n++)I+=g[n].dataCount;for(var n=0;n<this.dataList.length;n++){var l=this.dataList[n];t.put(l.mode,4),t.put(l.getLength(),cl.getLengthInBits(l.mode,e)),l.write(t)}if(t.getLengthInBits()<=I*8)break}this.typeNumber=e}this.makeImpl(!1,this.getBestMaskPattern())};lt.makeImpl=function(e,g){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var t=0;t<this.moduleCount;t++){this.modules[t]=new Array(this.moduleCount);for(var I=0;I<this.moduleCount;I++)this.modules[t][I]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,g),this.typeNumber>=7&&this.setupTypeNumber(e),this.dataCache==null&&(this.dataCache=hI.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,g)};lt.setupPositionProbePattern=function(e,g){for(var t=-1;t<=7;t++)if(!(e+t<=-1||this.moduleCount<=e+t))for(var I=-1;I<=7;I++)g+I<=-1||this.moduleCount<=g+I||(0<=t&&t<=6&&(I==0||I==6)||0<=I&&I<=6&&(t==0||t==6)||2<=t&&t<=4&&2<=I&&I<=4?this.modules[e+t][g+I]=!0:this.modules[e+t][g+I]=!1)};lt.getBestMaskPattern=function(){for(var e=0,g=0,t=0;t<8;t++){this.makeImpl(!0,t);var I=cl.getLostPoint(this);(t==0||e>I)&&(e=I,g=t)}return g};lt.createMovieClip=function(e,g,t){var I=e.createEmptyMovieClip(g,t),n=1;this.make();for(var l=0;l<this.modules.length;l++)for(var C=l*n,s=0;s<this.modules[l].length;s++){var r=s*n,a=this.modules[l][s];a&&(I.beginFill(0,100),I.moveTo(r,C),I.lineTo(r+n,C),I.lineTo(r+n,C+n),I.lineTo(r,C+n),I.endFill())}return I};lt.setupTimingPattern=function(){for(var e=8;e<this.moduleCount-8;e++)this.modules[e][6]==null&&(this.modules[e][6]=e%2==0);for(var g=8;g<this.moduleCount-8;g++)this.modules[6][g]==null&&(this.modules[6][g]=g%2==0)};lt.setupPositionAdjustPattern=function(){for(var e=cl.getPatternPosition(this.typeNumber),g=0;g<e.length;g++)for(var t=0;t<e.length;t++){var I=e[g],n=e[t];if(this.modules[I][n]==null)for(var l=-2;l<=2;l++)for(var C=-2;C<=2;C++)l==-2||l==2||C==-2||C==2||l==0&&C==0?this.modules[I+l][n+C]=!0:this.modules[I+l][n+C]=!1}};lt.setupTypeNumber=function(e){for(var g=cl.getBCHTypeNumber(this.typeNumber),t=0;t<18;t++){var I=!e&&(g>>t&1)==1;this.modules[Math.floor(t/3)][t%3+this.moduleCount-8-3]=I}for(var t=0;t<18;t++){var I=!e&&(g>>t&1)==1;this.modules[t%3+this.moduleCount-8-3][Math.floor(t/3)]=I}};lt.setupTypeInfo=function(e,g){for(var t=this.errorCorrectLevel<<3|g,I=cl.getBCHTypeInfo(t),n=0;n<15;n++){var l=!e&&(I>>n&1)==1;n<6?this.modules[n][8]=l:n<8?this.modules[n+1][8]=l:this.modules[this.moduleCount-15+n][8]=l}for(var n=0;n<15;n++){var l=!e&&(I>>n&1)==1;n<8?this.modules[8][this.moduleCount-n-1]=l:n<9?this.modules[8][15-n-1+1]=l:this.modules[8][15-n-1]=l}this.modules[this.moduleCount-8][8]=!e};lt.mapData=function(e,g){for(var t=-1,I=this.moduleCount-1,n=7,l=0,C=this.moduleCount-1;C>0;C-=2)for(C==6&&C--;;){for(var s=0;s<2;s++)if(this.modules[I][C-s]==null){var r=!1;l<e.length&&(r=(e[l]>>>n&1)==1);var a=cl.getMask(g,I,C-s);a&&(r=!r),this.modules[I][C-s]=r,n--,n==-1&&(l++,n=7)}if(I+=t,I<0||this.moduleCount<=I){I-=t,t=-t;break}}};hI.PAD0=236;hI.PAD1=17;hI.createData=function(e,g,t){for(var I=iW.getRSBlocks(e,g),n=new aW,l=0;l<t.length;l++){var C=t[l];n.put(C.mode,4),n.put(C.getLength(),cl.getLengthInBits(C.mode,e)),C.write(n)}for(var s=0,l=0;l<I.length;l++)s+=I[l].dataCount;if(n.getLengthInBits()>s*8)throw new Error("code length overflow. ("+n.getLengthInBits()+">"+s*8+")");for(n.getLengthInBits()+4<=s*8&&n.put(0,4);n.getLengthInBits()%8!=0;)n.putBit(!1);for(;!(n.getLengthInBits()>=s*8||(n.put(hI.PAD0,8),n.getLengthInBits()>=s*8));)n.put(hI.PAD1,8);return hI.createBytes(n,I)};hI.createBytes=function(e,g){for(var t=0,I=0,n=0,l=new Array(g.length),C=new Array(g.length),s=0;s<g.length;s++){var r=g[s].dataCount,a=g[s].totalCount-r;I=Math.max(I,r),n=Math.max(n,a),l[s]=new Array(r);for(var o=0;o<l[s].length;o++)l[s][o]=255&e.buffer[o+t];t+=r;var c=cl.getErrorCorrectPolynomial(a),A=new K1(l[s],c.getLength()-1),b=A.mod(c);C[s]=new Array(c.getLength()-1);for(var o=0;o<C[s].length;o++){var m=o+b.getLength()-C[s].length;C[s][o]=m>=0?b.get(m):0}}for(var Z=0,o=0;o<g.length;o++)Z+=g[o].totalCount;for(var G=new Array(Z),h=0,o=0;o<I;o++)for(var s=0;s<g.length;s++)o<l[s].length&&(G[h++]=l[s][o]);for(var o=0;o<n;o++)for(var s=0;s<g.length;s++)o<C[s].length&&(G[h++]=C[s][o]);return G};var E1=hI,o0={};Object.defineProperty(o0,"__esModule",{value:!0});var U1=Object.assign||function(e){for(var g=1;g<arguments.length;g++){var t=arguments[g];for(var I in t)Object.prototype.hasOwnProperty.call(t,I)&&(e[I]=t[I])}return e},z1=tW,it=cW(z1),oW=B,so=cW(oW);function cW(e){return e&&e.__esModule?e:{default:e}}function Q1(e,g){var t={};for(var I in e)g.indexOf(I)>=0||Object.prototype.hasOwnProperty.call(e,I)&&(t[I]=e[I]);return t}var L1={bgColor:it.default.oneOfType([it.default.object,it.default.string]).isRequired,bgD:it.default.string.isRequired,fgColor:it.default.oneOfType([it.default.object,it.default.string]).isRequired,fgD:it.default.string.isRequired,size:it.default.number.isRequired,title:it.default.string,viewBoxSize:it.default.number.isRequired,xmlns:it.default.string},c0=(0,oW.forwardRef)(function(e,g){var t=e.bgColor,I=e.bgD,n=e.fgD,l=e.fgColor,C=e.size,s=e.title,r=e.viewBoxSize,a=e.xmlns,o=a===void 0?"http://www.w3.org/2000/svg":a,c=Q1(e,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return so.default.createElement("svg",U1({},c,{height:C,ref:g,viewBox:"0 0 "+r+" "+r,width:C,xmlns:o}),s?so.default.createElement("title",null,s):null,so.default.createElement("path",{d:I,fill:t}),so.default.createElement("path",{d:n,fill:l}))});c0.displayName="QRCodeSvg";c0.propTypes=L1;o0.default=c0;Object.defineProperty(HA,"__esModule",{value:!0});HA.QRCode=void 0;var T1=Object.assign||function(e){for(var g=1;g<arguments.length;g++){var t=arguments[g];for(var I in t)Object.prototype.hasOwnProperty.call(t,I)&&(e[I]=t[I])}return e},M1=tW,fI=Ra(M1),D1=IW,j1=Ra(D1),P1=E1,O1=Ra(P1),AW=B,q1=Ra(AW),_1=o0,$1=Ra(_1);function Ra(e){return e&&e.__esModule?e:{default:e}}function g9(e,g){var t={};for(var I in e)g.indexOf(I)>=0||Object.prototype.hasOwnProperty.call(e,I)&&(t[I]=e[I]);return t}var e9={bgColor:fI.default.oneOfType([fI.default.object,fI.default.string]),fgColor:fI.default.oneOfType([fI.default.object,fI.default.string]),level:fI.default.string,size:fI.default.number,value:fI.default.string.isRequired},FA=(0,AW.forwardRef)(function(e,g){var t=e.bgColor,I=t===void 0?"#FFFFFF":t,n=e.fgColor,l=n===void 0?"#000000":n,C=e.level,s=C===void 0?"L":C,r=e.size,a=r===void 0?256:r,o=e.value,c=g9(e,["bgColor","fgColor","level","size","value"]),A=new O1.default(-1,j1.default[s]);A.addData(o),A.make();var b=A.modules;return q1.default.createElement($1.default,T1({},c,{bgColor:I,bgD:b.map(function(m,Z){return m.map(function(G,h){return G?"":"M "+h+" "+Z+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:l,fgD:b.map(function(m,Z){return m.map(function(G,h){return G?"M "+h+" "+Z+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:g,size:a,viewBoxSize:b.length}))});HA.QRCode=FA;FA.displayName="QRCode";FA.propTypes=e9;var t9=HA.default=FA;const I9=()=>{const{id:e}=$p(),g=pI(),{account:t}=ft(),[I,n]=B.useState(null),[l,C]=B.useState(!0),[s,r]=B.useState(!1);B.useEffect(()=>{e&&a()},[e]);const a=async()=>{try{C(!0);const b=await mI().getTicket(e);n({id:e,eventName:b.eventName,organizer:b.organizer,eventDate:new Date(Number(b.eventDate)*1e3),buyer:b.buyer,isDownloaded:b.isDownloaded})}catch(A){console.error("Error loading ticket:",A),K.error("Failed to load ticket details")}finally{C(!1)}},o=()=>(I==null?void 0:I.buyer)&&t&&I.buyer.toLowerCase()===t.toLowerCase(),c=I?JSON.stringify({ticketId:I.id,eventName:I.eventName,buyer:I.buyer,timestamp:Date.now()}):"";return l?i.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:i.jsx(Dg,{className:"w-10 h-10 animate-spin text-primary-600"})}):!I||!o()?i.jsxs("div",{className:"text-center mt-10",children:[i.jsx("h2",{className:"text-xl font-bold text-red-600",children:"Access Denied"}),i.jsx("p",{className:"text-gray-600 mt-2",children:"You do not own this ticket."}),i.jsx("button",{onClick:()=>g("/my-tickets"),className:"btn-primary mt-4",children:"Back to My Tickets"})]}):i.jsxs("div",{className:"max-w-lg mx-auto p-4",children:[i.jsxs("button",{onClick:()=>g("/my-tickets"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 mb-6",children:[i.jsx(EV,{className:"w-4 h-4"}),i.jsx("span",{children:"Back"})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200",children:[i.jsxs("div",{className:"bg-primary-600 p-6 text-white text-center",children:[i.jsx("h1",{className:"text-2xl font-bold",children:I.eventName}),i.jsxs("p",{className:"opacity-90 mt-1",children:[I.eventDate.toLocaleDateString(),"  ",I.eventDate.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),i.jsxs("div",{className:"p-8 flex flex-col items-center justify-center bg-white",children:[i.jsx("div",{className:"bg-white p-4 rounded-xl shadow-inner border-2 border-dashed border-gray-300",children:i.jsx(t9,{value:c,size:256,style:{height:"auto",maxWidth:"100%",width:"100%"},viewBox:"0 0 256 256"})}),i.jsxs("p",{className:"text-center text-sm text-gray-500 mt-6 flex items-center",children:[i.jsx(JH,{className:"w-4 h-4 mr-1"}),"Show this QR code at the entrance"]})]}),i.jsxs("div",{className:"bg-gray-50 p-4 border-t border-gray-100 flex justify-between items-center",children:[i.jsxs("div",{className:"flex items-center text-green-700 text-sm font-medium",children:[i.jsx(GI,{className:"w-4 h-4 mr-1.5"}),"Verified Owner"]}),i.jsxs("button",{onClick:()=>r(!s),className:"text-primary-600 text-sm hover:underline flex items-center",children:[i.jsx(SH,{className:"w-4 h-4 mr-1"}),s?"Hide Details":"Ticket Info"]})]}),s&&i.jsx("div",{className:"p-6 bg-gray-50 border-t border-gray-200 animate-fade-in",children:i.jsxs("div",{className:"space-y-3 text-sm",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-500",children:"Ticket ID"}),i.jsxs("span",{className:"font-mono font-bold",children:["#",I.id]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-500",children:"Organizer"}),i.jsx("span",{className:"font-medium",children:I.organizer})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-500",children:"Owner"}),i.jsx("span",{className:"font-mono text-xs text-gray-600",children:I.buyer})]})]})})]})]})},n9="modulepreload",l9=function(e){return"/"+e},Yy={},C9=function(g,t,I){if(!t||t.length===0)return g();const n=document.getElementsByTagName("link");return Promise.all(t.map(l=>{if(l=l9(l),l in Yy)return;Yy[l]=!0;const C=l.endsWith(".css"),s=C?'[rel="stylesheet"]':"";if(!!I)for(let o=n.length-1;o>=0;o--){const c=n[o];if(c.href===l&&(!C||c.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${s}`))return;const a=document.createElement("link");if(a.rel=C?"stylesheet":n9,C||(a.as="script",a.crossOrigin=""),a.href=l,document.head.appendChild(a),C)return new Promise((o,c)=>{a.addEventListener("load",o),a.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>g()).catch(l=>{const C=new Event("vite:preloadError",{cancelable:!0});if(C.payload=l,window.dispatchEvent(C),!C.defaultPrevented)throw l})},s9=()=>{const[e,g]=B.useState(!1),t=async()=>{try{if(g(!0),!window.ethereum){Sg.error("MetaMask not found");return}await window.ethereum.request({method:"eth_requestAccounts"});const{ethers:I}=await C9(()=>import("./index-064835ae.js"),[]),n=new I.BrowserProvider(window.ethereum),l=await n.getSigner();console.log("Provider:",n),console.log("Signer:",l),console.log("Signer address:",await l.getAddress());const C="0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0",s=["function createSale(string memory eventName, string memory organizer, uint256 eventDate, uint256 saleEndDate, uint256 price, uint256 totalTickets, string memory posterCID, string memory ticketCID) external"],r=new I.Contract(C,s,l);console.log("Contract:",r),console.log("Contract address:",r.target);const a="test"+Math.floor(Math.random()*1e3),o="testorg",c=Math.floor(Date.now()/1e3)+86400,A=Math.floor(Date.now()/1e3)+3600,b=I.parseEther("0.01"),m=1,Z="QmTest",G="QmTest2";console.log("Test parameters:",{eventName:a,organizer:o,eventDate:c,saleEndDate:A,price:I.formatEther(b),totalTickets:m,posterCID:Z,ticketCID:G}),console.log("Attempting transaction...");const h=await r.createSale(a,o,c,A,b,m,Z,G);console.log("Transaction submitted:",h.hash),Sg.success("Transaction submitted!");const u=await h.wait();console.log("Transaction confirmed:",u),Sg.success("Transaction confirmed!")}catch(I){console.error("Error:",I),Sg.error("Error: "+I.message)}finally{g(!1)}};return i.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:i.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6",children:[i.jsx("h1",{className:"text-2xl font-bold text-center mb-6",children:"Test Create Sale"}),i.jsx("button",{onClick:t,disabled:e,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50",children:e?"Testing...":"Test Create Sale"}),i.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[i.jsx("p",{children:"This will test the createSale function with simple parameters."}),i.jsx("p",{children:"Check the browser console for detailed logs."})]})]})})},r9=()=>{const{account:e,isConnected:g}=ft(),{user:t}=ol(),[I,n]=B.useState({totalTickets:0,totalSpent:"0",recentActivity:[]}),[l,C]=B.useState(!0);B.useEffect(()=>{console.log("Current User Data:",t)},[t]),B.useEffect(()=>{e&&s()},[e]);const s=async()=>{try{C(!0);const o=await(await fetch(`http://localhost:5000/api/purchases/user/${e}`)).json();if(o.success){const c=o.data.purchases,A=c.reduce((m,Z)=>m+BigInt(Z.price),0n),b=Wc(A);n({totalTickets:c.length,totalSpent:b,recentActivity:c.slice(0,5)})}}catch(a){console.error("Failed to load profile stats:",a)}finally{C(!1)}},r=()=>t?t.name||t.username||t.nickname||"User":"Anonymous User";return g?i.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 animate-fade-in",children:[i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden",children:[i.jsx("div",{className:"bg-gradient-to-r from-primary-600 to-primary-800 h-32 relative",children:i.jsx("div",{className:"absolute -bottom-12 left-8",children:i.jsx("div",{className:"w-24 h-24 bg-white rounded-full p-1 shadow-lg",children:i.jsx("div",{className:"w-full h-full bg-gray-100 rounded-full flex items-center justify-center text-primary-600 overflow-hidden",children:t!=null&&t.profileImage?i.jsx("img",{src:t.profileImage,alt:"Profile",className:"w-full h-full object-cover"}):i.jsx(UV,{className:"w-16 h-16"})})})})}),i.jsx("div",{className:"pt-16 pb-6 px-8",children:i.jsx("div",{className:"flex justify-between items-start",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r()}),i.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-500",children:[i.jsxs("div",{className:"flex items-center bg-gray-100 px-2 py-1 rounded",children:[i.jsx(yC,{className:"w-3 h-3 mr-1.5 text-gray-400"}),i.jsx("span",{className:"font-mono text-xs",children:gt(e)})]}),(t==null?void 0:t.email)&&i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:"w-1 h-1 bg-gray-300 rounded-full mr-4"}),t.email]})]})]})})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Tickets Bought"}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:l?i.jsx(Dg,{className:"w-6 h-6 animate-spin"}):I.totalTickets})]}),i.jsx("div",{className:"p-3 bg-blue-50 text-blue-600 rounded-lg",children:i.jsx(Qn,{className:"w-8 h-8"})})]})}),i.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Spent"}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:l?i.jsx(Dg,{className:"w-6 h-6 animate-spin"}):`${I.totalSpent} ETH`})]}),i.jsx("div",{className:"p-3 bg-purple-50 text-purple-600 rounded-lg",children:i.jsx(fH,{className:"w-8 h-8"})})]})})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Recent Activity"}),i.jsx("div",{className:"space-y-4",children:l?i.jsx("div",{className:"text-center py-4 text-gray-500",children:"Loading activity..."}):I.recentActivity.length===0?i.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg border border-dashed border-gray-200",children:[i.jsx(Qn,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),i.jsx("p",{className:"text-gray-500 text-sm",children:"No recent purchases found."})]}):I.recentActivity.map(a=>i.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-50 rounded-lg transition-colors border border-transparent hover:border-gray-100",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"bg-primary-50 p-2.5 rounded-lg border border-primary-100",children:i.jsx(Qn,{className:"w-5 h-5 text-primary-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-900",children:a.eventName}),i.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500 mt-0.5",children:[i.jsx(nl,{className:"w-3 h-3"}),i.jsx("span",{children:new Date(a.purchaseDate).toLocaleDateString()}),i.jsx("span",{children:""}),i.jsxs("span",{className:"font-mono",children:["#",a.ticketId]})]})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsxs("span",{className:"block font-medium text-gray-900",children:[Wc(a.price)," ETH"]}),i.jsx("span",{className:`text-xs capitalize px-2 py-0.5 rounded-full ${a.status==="purchased"?"bg-green-100 text-green-700":a.status==="refunded"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"}`,children:a.status})]})]},a.purchaseId))})]})]}):i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",children:[i.jsx(yC,{className:"w-16 h-16 text-gray-300 mb-4"}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Wallet Not Connected"}),i.jsx("p",{className:"text-gray-500 mt-2",children:"Please connect your wallet to view your profile."})]})},i9=()=>{const{account:e,isConnected:g}=ft(),[t,I]=B.useState([]),[n,l]=B.useState(!0),[C,s]=B.useState(null),r=B.useCallback(async()=>{try{l(!0);const{data:c}=await qe.get("/transfers/pending");I(c)}catch(c){console.error("Failed to load requests:",c),K.error("Failed to load transfer requests")}finally{l(!1)}},[]);B.useEffect(()=>{g&&r()},[g,r]);const a=async c=>{var A;if(window.confirm(`Are you sure you want to approve this transfer for Ticket #${c.ticketId}?`))try{s(c._id);const b=K.loading("Processing Transfer on Blockchain..."),m=await gl();console.log(`Transferring Ticket ${c.ticketId} from ${c.senderAddress} to ${c.receiverAddress}`);const Z=await m.organizerTransferTicket(c.senderAddress,c.receiverAddress,c.ticketId);K.loading("Transaction submitted. Waiting for confirmation...",{id:b}),await Z.wait(),K.loading("Updating database...",{id:b}),await qe.post("/transfers/approve",{requestId:c._id,txHash:Z.hash}),K.success("Transfer Successful!",{id:b}),I(G=>G.filter(h=>h._id!==c._id))}catch(b){console.error("Transfer failed:",b);let m="Transfer failed";b.reason?m=b.reason:(A=b.data)!=null&&A.message?m=b.data.message:b.message&&(m=b.message),K.error(`Error: ${m}`)}finally{s(null)}},o=async c=>{if(window.confirm("Reject this transfer request?"))try{s(c._id),await qe.post("/transfers/reject",{requestId:c._id}),K.success("Request Rejected"),I(A=>A.filter(b=>b._id!==c._id))}catch(A){console.error("Rejection failed:",A),K.error("Failed to reject request")}finally{s(null)}};return g?i.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Transfer Requests"}),i.jsx("p",{className:"text-gray-500 mt-1",children:"Manage ticket transfer requests from users"})]}),i.jsxs("div",{className:"bg-blue-50 text-blue-800 px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium",children:[i.jsx(Ui,{className:"w-4 h-4"}),"Pending: ",t.length]})]}),n?i.jsx("div",{className:"flex justify-center py-12",children:i.jsx(Dg,{className:"w-8 h-8 animate-spin text-primary-600"})}):t.length===0?i.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(ZC,{className:"w-8 h-8 text-green-500"})}),i.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"All Caught Up!"}),i.jsx("p",{className:"text-gray-500 mt-2",children:"There are no pending transfer requests at the moment."})]}):i.jsx("div",{className:"grid gap-4",children:t.map(c=>i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex flex-col lg:flex-row lg:items-center justify-between gap-6 transition-all hover:shadow-md",children:[i.jsxs("div",{className:"flex-1 space-y-4",children:[i.jsx("div",{className:"flex items-start justify-between",children:i.jsxs("div",{children:[i.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 mb-2",children:["Ticket #",c.ticketId]}),i.jsx("h3",{className:"text-lg font-bold text-gray-900",children:c.eventName||`Ticket ID: ${c.ticketId}`}),i.jsxs("p",{className:"text-sm text-gray-500",children:["Requested on ",new Date(c.createdAt).toLocaleDateString()]})]})}),i.jsxs("div",{className:"flex items-center gap-4 bg-gray-50 p-4 rounded-lg",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 uppercase tracking-wider font-semibold mb-1",children:[i.jsx(Ve,{className:"w-3 h-3"})," From (Sender)"]}),i.jsx("div",{className:"font-mono text-sm text-gray-700 truncate",title:c.senderAddress,children:gt(c.senderAddress)})]}),i.jsx("div",{className:"flex items-center justify-center",children:i.jsx(VA,{className:"w-5 h-5 text-gray-400"})}),i.jsxs("div",{className:"flex-1 text-right",children:[i.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs text-gray-500 uppercase tracking-wider font-semibold mb-1",children:["To (Receiver) ",i.jsx(Ve,{className:"w-3 h-3"})]}),i.jsx("div",{className:"font-mono text-sm text-gray-700 truncate",title:c.receiverAddress,children:gt(c.receiverAddress)})]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:"Reason:"}),i.jsxs("p",{className:"text-sm text-gray-600 italic border-l-2 border-gray-300 pl-3",children:['"',c.reason,'"']})]})]}),i.jsxs("div",{className:"flex lg:flex-col gap-3 min-w-[140px]",children:[i.jsxs("button",{onClick:()=>a(c),disabled:!!C,className:"flex-1 btn-primary bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[C===c._id?i.jsx(Dg,{className:"w-4 h-4 animate-spin"}):i.jsx(ZC,{className:"w-4 h-4"}),"Approve"]}),i.jsxs("button",{onClick:()=>o(c),disabled:!!C,className:"flex-1 bg-white border border-red-200 text-red-600 hover:bg-red-50 py-2 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx(zi,{className:"w-4 h-4"}),"Reject"]})]})]},c._id))})]}):i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",children:[i.jsx(vH,{className:"w-12 h-12 text-gray-400 mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Admin Access Required"}),i.jsx("p",{className:"text-gray-500",children:"Please connect your wallet to manage transfers."})]})},a9=()=>{const e=pI(),{account:g,isConnected:t,connect:I}=ft(),{handleWalletLogin:n,isAuthenticated:l,isLoading:C}=ol(),[s,r]=B.useState(!1);B.useEffect(()=>{l&&e("/")},[l,e]);const a=async()=>{if(!t){K.error("Please connect your wallet first");return}try{r(!0),await n()}catch(o){console.error("Login error:",o),K.error(o.message||"Login failed")}finally{r(!1)}};return i.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-white to-primary-100 flex items-center justify-center px-4",children:i.jsxs("div",{className:"max-w-md w-full",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-primary-600 rounded-full mb-4",children:i.jsx(yC,{className:"w-8 h-8 text-white"})}),i.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"NFT Ticketing System"}),i.jsx("p",{className:"text-gray-600",children:"Secure, blockchain-based event ticketing"})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6 text-center",children:"Welcome Back"}),i.jsx("div",{className:"space-y-4",children:t?i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:[i.jsxs("div",{className:"flex items-center gap-2 text-green-700 mb-2",children:[i.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),i.jsx("span",{className:"font-semibold",children:"Wallet Connected"})]}),i.jsx("p",{className:"text-sm text-green-600 font-mono truncate",children:g})]}),i.jsx("button",{onClick:a,disabled:s||C,className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-xl font-semibold hover:from-primary-700 hover:to-primary-800 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:s?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Authenticating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(kH,{className:"w-5 h-5"}),"Sign In with Wallet",i.jsx(VA,{className:"w-5 h-5"})]})})]}):i.jsxs("button",{onClick:I,disabled:C,className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-xl font-semibold hover:from-primary-700 hover:to-primary-800 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx(yC,{className:"w-5 h-5"}),"Connect MetaMask Wallet"]})}),i.jsxs("div",{className:"relative my-8",children:[i.jsx("div",{className:"absolute inset-0 flex items-center",children:i.jsx("div",{className:"w-full border-t border-gray-200"})}),i.jsx("div",{className:"relative flex justify-center text-sm",children:i.jsx("span",{className:"px-4 bg-white text-gray-500",children:"New to the platform?"})})]}),i.jsx($g,{to:"/signup",className:"block w-full text-center px-6 py-3 border-2 border-primary-600 text-primary-600 rounded-xl font-semibold hover:bg-primary-50 transition-all duration-200",children:"Create an Account"})]}),i.jsx("div",{className:"mt-6 text-center text-sm text-gray-600",children:i.jsxs("p",{children:["By connecting your wallet, you agree to our"," ",i.jsx("a",{href:"#",className:"text-primary-600 hover:underline",children:"Terms of Service"})," ","and"," ",i.jsx("a",{href:"#",className:"text-primary-600 hover:underline",children:"Privacy Policy"})]})})]})})},o9=()=>{const e=pI(),{account:g,isConnected:t,connect:I}=ft(),{register:n,isAuthenticated:l,isLoading:C,pendingAuth:s}=ol(),[r,a]=B.useState({username:"",email:"",phone:"",isOrganizer:!1}),[o,c]=B.useState({}),[A,b]=B.useState(!1);B.useEffect(()=>{l&&e("/")},[l,e]);const m=()=>{const u={};r.username.trim()?r.username.length<3&&(u.username="Username must be at least 3 characters"):u.username="Username is required";const y=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;r.email.trim()?y.test(r.email)||(u.email="Invalid email format"):u.email="Email is required";const W=/^[0-9]{10,15}$/;return r.phone.trim()?W.test(r.phone.replace(/[\s\-\(\)]/g,""))||(u.phone="Invalid phone number (10-15 digits)"):u.phone="Phone number is required",c(u),Object.keys(u).length===0},Z=u=>{const{name:y,value:W}=u.target;a(S=>({...S,[y]:W})),o[y]&&c(S=>({...S,[y]:""}))},G=u=>{a(y=>({...y,isOrganizer:u}))},h=async u=>{if(u.preventDefault(),!t){K.error("Please connect your wallet first");return}if(!m()){K.error("Please fix the form errors");return}try{b(!0),await n(r),K.success("Account created successfully!"),e("/")}catch(y){console.error("Registration error:",y),K.error(y.message||"Registration failed")}finally{b(!1)}};return i.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-white to-primary-100 py-12 px-4",children:i.jsxs("div",{className:"max-w-2xl mx-auto",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-primary-600 rounded-full mb-4",children:i.jsx(Vy,{className:"w-8 h-8 text-white"})}),i.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Create Your Account"}),i.jsx("p",{className:"text-gray-600",children:"Join the future of event ticketing"})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[i.jsxs("div",{className:"mb-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full ${t?"bg-green-500":"bg-gray-300"} text-white font-bold`,children:t?i.jsx(ZC,{className:"w-5 h-5"}):"1"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Connect Wallet"})]}),t?i.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:[i.jsxs("div",{className:"flex items-center gap-2 text-green-700 mb-2",children:[i.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),i.jsx("span",{className:"font-semibold",children:"Wallet Connected"})]}),i.jsx("p",{className:"text-sm text-green-600 font-mono truncate",children:g})]}):i.jsxs("button",{onClick:I,disabled:C,className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-xl font-semibold hover:from-primary-700 hover:to-primary-800 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50",children:[i.jsx(yC,{className:"w-5 h-5"}),"Connect MetaMask Wallet"]})]}),t&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"mb-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary-600 text-white font-bold",children:"2"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Your Information"})]}),i.jsxs("form",{onSubmit:h,className:"space-y-5",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Username *"}),i.jsxs("div",{className:"relative",children:[i.jsx(Ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),i.jsx("input",{type:"text",name:"username",value:r.username,onChange:Z,className:`w-full pl-11 pr-4 py-3 border ${o.username?"border-red-500":"border-gray-300"} rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all`,placeholder:"Enter your username"})]}),o.username&&i.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.username})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),i.jsxs("div",{className:"relative",children:[i.jsx(QV,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),i.jsx("input",{type:"email",name:"email",value:r.email,onChange:Z,className:`w-full pl-11 pr-4 py-3 border ${o.email?"border-red-500":"border-gray-300"} rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all`,placeholder:"your.email@example.com"})]}),o.email&&i.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.email})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),i.jsxs("div",{className:"relative",children:[i.jsx(l0,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),i.jsx("input",{type:"tel",name:"phone",value:r.phone,onChange:Z,className:`w-full pl-11 pr-4 py-3 border ${o.phone?"border-red-500":"border-gray-300"} rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all`,placeholder:"+1 (555) 123-4567"})]}),o.phone&&i.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.phone})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Account Type *"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx("button",{type:"button",onClick:()=>G(!1),className:`p-4 border-2 rounded-xl transition-all ${r.isOrganizer?"border-gray-200 hover:border-gray-300":"border-primary-600 bg-primary-50"}`,children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"font-semibold text-gray-900",children:"Customer"}),i.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Buy and manage tickets"})]})}),i.jsx("button",{type:"button",onClick:()=>G(!0),className:`p-4 border-2 rounded-xl transition-all ${r.isOrganizer?"border-primary-600 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"font-semibold text-gray-900",children:"Organizer"}),i.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Create and manage events"})]})})]})]}),i.jsx("button",{type:"submit",disabled:A||C,className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-xl font-semibold hover:from-primary-700 hover:to-primary-800 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed mt-6",children:A?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Creating Account..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Vy,{className:"w-5 h-5"}),"Create Account",i.jsx(VA,{className:"w-5 h-5"})]})})]})]})}),i.jsxs("div",{className:"mt-6 text-center text-sm text-gray-600",children:["Already have an account?"," ",i.jsx($g,{to:"/login",className:"text-primary-600 font-semibold hover:underline",children:"Sign In"})]})]})]})})};const vy=({children:e,requireOrganizer:g=!1})=>{const{user:t,isLoading:I}=ol();return I?i.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):t?g&&!t.isOrganizer?i.jsx(Hb,{to:"/",replace:!0}):e:i.jsx(Hb,{to:"/",replace:!0})};function c9(){return i.jsx(Fv,{children:i.jsx(hH,{children:i.jsx(Q2,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:i.jsxs("div",{className:"min-h-screen bg-gray-50",children:[i.jsx(FH,{children:i.jsxs(N2,{children:[i.jsx(Re,{path:"/",element:i.jsx(xH,{})}),i.jsx(Re,{path:"/login",element:i.jsx(a9,{})}),i.jsx(Re,{path:"/signup",element:i.jsx(o9,{})}),i.jsx(Re,{path:"/tickets",element:i.jsx(DH,{})}),i.jsx(Re,{path:"/ticket/:id",element:i.jsx(PH,{})}),i.jsx(Re,{path:"/ticket/:id/print",element:i.jsx(I9,{})}),i.jsx(Re,{path:"/verify",element:i.jsx(OH,{})}),i.jsx(Re,{path:"/my-tickets",element:i.jsx(S1,{})}),i.jsx(Re,{path:"/profile",element:i.jsx(r9,{})}),i.jsx(Re,{path:"/organizer/transfers",element:i.jsx(i9,{})}),i.jsx(Re,{path:"/create-sale",element:i.jsx(vy,{requireOrganizer:!0,children:i.jsx(MH,{})})}),i.jsx(Re,{path:"/organizer/verify",element:i.jsx(vy,{requireOrganizer:!0,children:i.jsx(W1,{})})}),i.jsx(Re,{path:"/test-create",element:i.jsx(s9,{})})]})}),i.jsx(Nk,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10B981",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#EF4444",secondary:"#fff"}}}})]})})})})}Nd.createRoot(document.getElementById("root")).render(i.jsx(Ty.StrictMode,{children:i.jsx(c9,{})}));export{Zg as $,uc as A,$ as B,lm as C,tV as D,KY as E,H as F,LJ as G,In as H,tm as I,AV as J,Ze as K,Sr as L,dv as M,uI as N,Kt as O,fC as P,te as Q,Fi as R,JB as S,hc as T,rC as U,Vv as V,rV as W,Bg as X,q as Y,Ig as Z,iV as _,Z9 as a,Ga as a$,nw as a0,Bc as a1,pe as a2,Ni as a3,dC as a4,Za as a5,Kk as a6,ye as a7,Hk as a8,Vg as a9,nv as aA,mc as aB,mC as aC,cI as aD,hA as aE,NZ as aF,Xd as aG,Ba as aH,XY as aI,DY as aJ,uA as aK,ne as aL,ar as aM,xe as aN,sC as aO,JY as aP,Df as aQ,xi as aR,Ae as aS,Of as aT,Pk as aU,ki as aV,sZ as aW,aB as aX,cf as aY,b9 as aZ,Tk as a_,Xi as aa,Il as ab,lA as ac,Rh as ad,m9 as ae,OZ as af,Lk as ag,YY as ah,Ei as ai,MI as aj,FY as ak,HY as al,Th as am,qf as an,bA as ao,Vc as ap,wY as aq,Ye as ar,oI as as,Lh as at,dB as au,XI as av,xZ as aw,QZ as ax,eX as ay,$n as az,ZX as b,rY as b0,Mk as b1,sY as b2,fB as b3,rX as b4,Ac as b5,W9 as b6,V9 as b7,nA as b8,S9 as b9,sf as ba,Sh as bb,R9 as bc,Xl as bd,gm as be,aX as bf,iX as bg,u9 as bh,Uk as bi,h9 as bj,k9 as bk,G9 as c,BX as d,Vr as e,vh as f,ng as g,D as h,V as i,pg as j,Hg as k,jI as l,ag as m,lC as n,Af as o,p9 as p,yI as q,B9 as r,sA as s,Kg as t,AX as u,AB as v,Jh as w,ss as x,Ek as y,tn as z};
//# sourceMappingURL=index-27433598.js.map
